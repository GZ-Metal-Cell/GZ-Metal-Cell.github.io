<!DOCTYPE html>
<html lang=zh-CN data-theme="light">
	
<script src="/js/plugins/toggleTheme.js"></script>

	<script>
		setTheme();
	</script>
	<head>
		
<title>Unity-HotFix | Zi-Zi's Journey</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/images/icon/favicon.ico">
<link href="/css/plugins/print.css" media="print" rel="stylesheet" />

<link rel="stylesheet" href="/css/index.css">



<meta name="keywords" content="CSharp,Unity,">
<meta name="description" content="学习自火星网校。">



<script src="/js/plugins/jquery.min.js"></script>


<script src="/js/plugins/hljs.min.js"></script>


<script src="/js/plugins/init.js"></script>


<script src="/js/plugins/hide.js"></script>


<script src="/js/plugins/tabs.js"></script>



    



    
<script src="/js/plugins/alert-title.js"></script>

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-base.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-dark-class.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-light.css">






    

	<meta name="generator" content="Hexo 6.1.0"></head>

	<body>
		<header class="sticky-header">
	<nav>
		<div class="nav-left">
			<a href="/" class="logo">
				<img no-lazy src="/images/headers_icon/logo.webp" alt="Quieter">
			</a>
			<ul class="breadcrumb" id="breadcrumb"></ul>
		</div>
		<div class="nav-right">
			<ul>
				
					<li>
						<a href="/">
						  主页
						</a>
					</li>
				
					<li>
						<a href="/categories">
						  类别
						</a>
					</li>
				
					<li>
						<a href="/tags">
						  标签
						</a>
					</li>
				
					<li>
						<a href="/archives">
						  归档
						</a>
					</li>
				
					<li>
						<a href="/galleries">
						  相册
						</a>
					</li>
				
					<li>
						<a href="/links">
						  链接
						</a>
					</li>
				
					<li>
						<a href="/about">
						  关于
						</a>
					</li>
								  
			</ul>
		</div>
		<div class="nav-right-close">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
				<path fill="none" d="M0 0h24v24H0z" />
				<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
			</svg>
		</div>

		<div class="sidebar">
    <div class="topo">
        <p>Zi-Zi's Journey</p>
    </div>
    <ul>
        
        <li>
            <a href="/">
                主页
            </a>
        </li>
        
        <li>
            <a href="/categories">
                类别
            </a>
        </li>
        
        <li>
            <a href="/tags">
                标签
            </a>
        </li>
        
        <li>
            <a href="/archives">
                归档
            </a>
        </li>
        
        <li>
            <a href="/galleries">
                相册
            </a>
        </li>
        
        <li>
            <a href="/links">
                链接
            </a>
        </li>
        
        <li>
            <a href="/about">
                关于
            </a>
        </li>
        
    </ul>
    <div class="sidebar-footer">
        
        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
        </a>
        
    </div>
</div>
<div class='shelter'>
    <script>
        $(function() {
            $('.nav-right-close > svg').click(function() {
                $('.sidebar').animate({
                    right: "0"
                }, 500);
                $('.shelter').fadeIn("slow");
            
                var element = $('.topo');
                element.addClass('custom-style');
            
                var links = null;
                if ("") {
                    links = "".split(',');
                } else {
                    links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
                }
            
                var randomLink = links[Math.floor(Math.random() * links.length)];
                element.css('background-image', "url('" + randomLink + "')");
            });
          
            $('.shelter').click(function(e) {
                $('.sidebar').animate({
                    right: "-100%"
                }, 500);
                $('.shelter').fadeOut("slow");
            });
        });      
    </script>
</div>
	</nav>

	
		<div class="header-background"></div>
	

	<script>
		const name = 'post';
		const ul = document.querySelectorAll('.nav-right ul')[0];
		const lis = ul.querySelectorAll('li');

		if (name == 'home') {
			lis[0].classList.add('select');
		} else {
			for (let i = 0; i < lis.length; i++) {
				const li = lis[i];
				const a = li.querySelector('a');
				if (name === a.href.split('/')[3]) {
					li.classList.add('select');
				}
			}
		}
	</script>
	
	<script>
		var element = document.querySelector('.header-background');
		if(element) {
			element.classList.add('custom-style');
			var links = null;
			if("")
			{
				links = "".split(',');
			} else
			{
				links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
			}
			var randomLink = links[Math.floor(Math.random() * links.length)];
			element.style.backgroundImage = "url('" + randomLink + "')";
		}
	</script>

	
<script src="/js/plugins/breadcrumb.js"></script>

	<script>
		var menus_title = [];
		
			menus_title.push({home: '主页'});
		
			menus_title.push({categories: '类别'});
		
			menus_title.push({tags: '标签'});
		
			menus_title.push({archives: '归档'});
		
			menus_title.push({galleries: '相册'});
		
			menus_title.push({links: '链接'});
		
			menus_title.push({about: '关于'});
		
		
			
				postsBreadcrumb(
					document.getElementById('breadcrumb'),
					"类别",
					"/categories",
					"学习",
					"/categories/学习",
					1
				);
			
		
	</script>
</header>

<div class="main-wrapper">
    <main class="post">
        <header class="main-header">
	
		
			
				
<link rel="stylesheet" href="/css/plugins/fancybox.css">

				
<script src="/js/plugins/fancybox.umd.js"></script>

				
<script src="/js/plugins/fancybox.js"></script>

			
			<div class="post-header-background-content">
				<ul class="post-header-tag">
					
						
							<li><a href="/tags/CSharp"><span>CSharp</span></a></li>
						
							<li><a href="/tags/Unity"><span>Unity</span></a></li>
						
					
				</ul>
				
				<h1>Unity-HotFix</h1>
		
				
					<div class="post-header-desc">
						<svg t="1714702231661" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1154" xmlns:xlink="http://www.w3.org/1999/xlink"
						width="20" height="20">
						<path
							d="M778.24 117.76A46.08 46.08 0 0 1 824.32 163.84v430.08c0 8.4992-4.13696 16.01536-10.50624 20.6848l-0.24576 0.2048L587.5712 846.09024a35.84 35.84 0 0 1-61.48096-25.06752v-220.9792a46.08 46.08 0 0 1 46.08-46.08l200.94976-0.02048V168.96h-522.24v686.08H389.12c13.25056 0 24.1664 10.07616 25.47712 22.97856l0.12288 2.62144c0 14.1312-11.4688 25.6-25.6 25.6h-143.36A46.08 46.08 0 0 1 199.68 860.16V163.84A46.08 46.08 0 0 1 245.76 117.76h532.48z m-26.78784 487.38304h-174.16192v178.176l174.16192-178.176z m-45.19936-169.94304a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z m0-122.88a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z"
							fill="#ffffff" p-id="1155"></path>
						</svg>
						<p>学习自火星网校。</p>
					</div>
				
		
				<div class="post-header-info">
					<svg t="1604839279282" class="icon" viewBox="0 0 1024 1024" version="1.1"
					xmlns="http://www.w3.org/2000/svg" p-id="2901" width="20" height="20">
						<path
							d="M513 956.3c-247.7 0-448-200.3-448-448S265.3 66.2 513 66.2s448 200.3 448 448-200.3 442.1-448 442.1z m0-830.9c-212.2 0-388.8 170.7-388.8 388.8C124.2 726.3 294.9 903 513 903c212.2 0 388.8-170.7 388.8-388.8S725.2 125.4 513 125.4z m0 430.2c-94.2 0-170.7-76.5-170.7-170.7S418.8 207.8 513 207.8s170.7 76.5 170.7 170.7S607.2 555.6 513 555.6z m0-289.1c-64.6 0-112 52.8-112 112s47.4 117.9 112 117.9 112-52.8 112-112-47.4-117.9-112-117.9z m0 689.8c-135.7 0-259-58.7-341.9-158.9l-11.8-17.8 11.8-17.8c76.5-117.9 206.2-188.5 347.8-188.5 135.7 0 265 64.6 341.9 182.6l11.8 17.8-11.8 17.8C778 897.1 648.7 956.3 513 956.3zM230.3 773.2C300.9 849.7 406.9 897 513 897c112 0 218.1-47.4 288.6-129.8-70.5-88.2-170.7-135.6-282.7-135.6s-218.1 53.3-288.6 141.6z"
							p-id="2902" fill="#ffffff"></path>
					</svg>
					<div class="post-header-info-author">
						<a href="/about">Zi-Zi</a>
					</div>
					
						<div class="post-header-info-categories">
							
								<a href="/categories/学习">学习</a>
							
						</div>
					
					<time>2025/02/28 09:39:00</time>
				</div>
		
				
					<div class="post-header-stat">
						<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve" width="20" height="20">
							<path fill="#FFFFFF" d="M187.2,165.6c0,2.6-2.1,4.7-4.7,4.7H17.5c-2.6,0-4.7-2.1-4.7-4.7s2.1-4.7,4.7-4.7h165.1
								C185.2,160.9,187.2,163,187.2,165.6z"/>
							<path fill="#FFFFFF" d="M17.5,29.7c2.6,0,4.7,2.1,4.7,4.7v131.2c0,2.6-2.1,4.7-4.7,4.7s-4.7-2.1-4.7-4.7V34.4
								C12.8,31.8,14.9,29.7,17.5,29.7z M77.9,91.5c1.8,1.8,1.8,4.8,0,6.6l-39.8,39.8c-1.9,1.8-4.9,1.7-6.6-0.2c-1.7-1.8-1.7-4.6,0-6.4
								l39.8-39.8C73.1,89.6,76,89.6,77.9,91.5z M169.9,70.2c1.6,2.1,1.1,5-0.9,6.5c0,0,0,0,0,0l-64.2,48.2c-2.1,1.5-5,1.1-6.6-0.9
								c-1.6-2.1-1.1-5,0.9-6.5c0,0,0,0,0,0l64.2-48.2C165.4,67.7,168.3,68.1,169.9,70.2L169.9,70.2z"/>
							<path fill="#FFFFFF" d="M104.6,124.5c-1.8,1.8-4.8,1.8-6.6,0L71.6,98.1c-1.8-1.8-1.8-4.8,0-6.6c1.8-1.8,4.8-1.8,6.6,0l26.3,26.3
								C106.4,119.6,106.4,122.6,104.6,124.5C104.6,124.4,104.6,124.4,104.6,124.5z"/>
						</svg>
		
						
							
<script src="/js/plugins/wordCount.js"></script>

							<p class="post-count">文字数：---</p>
						
		
						
							<p id="busuanzi_container_page_pv" style='display:none;'>阅读数：<span id="busuanzi_value_page_pv"></span></p>
						
					</div>
				
			</div>
		
	
</header>
        <div class="post-content article-container">
            <article class="post-content-info">
                <h1 id="%E8%B5%84%E6%BA%90" tabindex="-1">资源</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1F3411w7hw/">Unity就业课-AB 包 异步加载-热更新开发（一）_哔哩哔哩_bilibili</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1i94y117xh/">Unity3D 就业课-Lua 语言-热更新开发（二）_哔哩哔哩_bilibili</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1JT411V7V1/">Unity3D 就业课-XLua 语言-热更新开发（三）_哔哩哔哩_bilibili</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1of4y1f7fh/">Unity3D 就业课-C# 调用 Lua 方法-热更新开发（四）_哔哩哔哩_bilibili</a></li>
</ul>
<h1 id="%E6%AD%A3%E6%96%87" tabindex="-1">正文</h1>
<h2 id="%E7%BC%96%E8%BE%91%E5%99%A8%E5%BC%80%E5%8F%91" tabindex="-1" id="编辑器开发">编辑器开发</h2>
<h3 id="01-%E7%BC%96%E8%BE%91%E5%99%A8%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D" tabindex="-1" id="01-编辑器开发基础介绍">01 编辑器开发基础介绍</h3>
<p>如此构建项目：</p>
<ul>
<li><code>Assets</code>
<ul>
<li><code>Scenes</code></li>
<li><code>Scripts</code>
<ul>
<li><code>MultiResources.cs</code></li>
</ul>
</li>
<li><code>TestA</code>
<ul>
<li><code>Resources</code>
<ul>
<li><code>Cube.prefab</code></li>
</ul>
</li>
</ul>
</li>
<li><code>TestB</code>
<ul>
<li><code>Resources</code>
<ul>
<li><code>Sphere.prefab</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>给 <code>Main Camera</code> 绑一个 <code>MultiResources.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MultiResources</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-comment">// Start is called before the first frame update</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        Object cube = Resources.Load(<span class="hljs-string">&quot;Cube&quot;</span>);<br>        GameObject obj1 = Instantiate(cube) <span class="hljs-keyword">as</span> GameObject;<br><br>        Object sphere = Resources.Load(<span class="hljs-string">&quot;Sphere&quot;</span>);<br>        GameObject obj2 = Instantiate(sphere) <span class="hljs-keyword">as</span> GameObject;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="01.webp" alt="webp"></p>
<p>​	运行程序，预制体被创建，这说明 <code>Resources/</code> 是 Unity 中的一个特殊文件夹（存储跟随游戏包的资源目录）</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li><code>Plugins</code>：需要跨语言调用的代码逻辑代码存储目录，手机 SDK 接入</li>
<li><code>Resources</code>：存储跟随游戏包的资源目录</li>
<li><code>StreamingAssets</code>：只读，存储跟随游戏包的资源目录</li>
</ul>
</div>
<h3 id="02-03-%E7%BC%96%E8%BE%91%E5%99%A8%E6%A3%80%E8%A7%86%E5%99%A8%E9%9D%A2%E6%9D%BF%E7%AE%80%E5%8D%95%E6%89%A9%E5%B1%95-1" tabindex="-1" id="02-03-编辑器检视器面板简单扩展-1">02-03 编辑器检视器面板简单扩展 1</h3>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>用于在 C# 运行时，传递程序中各种元素（类，结构体，变量，方法，枚举，组件）的行为信息的声明标签。一个声明标签是通过<strong>放置在它所在应用元素的前面</strong>的方括号“[]”中来描述。</p>
</div>
<p>写一个 <code>Assets/Scripts/SimpleInspector.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System;<br><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-comment">// 对象如果不标记为可序列化，则 Unity 在存储的时候，会认为他不可被序列化，那么也就无法被显示</span><br><span class="hljs-comment">// Unity 的内置 JSON 工具运行原理与之类似</span><br>[<span class="hljs-meta">Serializable</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Numerical</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Atk;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Def;<br>&#125;<br><br><span class="hljs-comment">// 职业枚举</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> Profession<br>&#123;<br>    Warrior = <span class="hljs-number">0</span>,<br>    Wizard,<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SimpleInspector</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-comment">// 隐藏公共成员变量，防止 Inspector 的值影响到它</span><br>    <span class="hljs-comment">// 同时保证脚本中变量的可访问度</span><br>    [<span class="hljs-meta">HideInInspector</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> ID = <span class="hljs-number">99</span>;<br><br>    <span class="hljs-comment">// 私有变量，检视面板可见</span><br>    <span class="hljs-comment">// Unity 会将对象进行序列化存储，所以即使是私有的，那么标记为可序列化后，就会显示，共有默认值是可序列化的</span><br>    [<span class="hljs-meta">SerializeField</span>]<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> Name;<br><br>    <span class="hljs-comment">// 监视面板显示对象</span><br>    <span class="hljs-keyword">public</span> Numerical Num;<br><br>    <span class="hljs-comment">// 把当前成员变量上方留 50 像素空白区域</span><br>    [<span class="hljs-meta">Space(50)</span>]<br><br>    <span class="hljs-comment">// 当前成员变量上方加入一个标题文字</span><br>    [<span class="hljs-meta">Header(<span class="hljs-string">&quot;年龄&quot;</span>)</span>]<br><br>    <span class="hljs-comment">// 添加变量悬浮提示文字</span><br>    <span class="hljs-comment">// 一个成员变量可以添加多个特性</span><br>    [<span class="hljs-meta">Tooltip(<span class="hljs-string">&quot;不要填写大于 150 岁的年龄&quot;</span>)</span>]<br>    <span class="hljs-comment">// 给数值设定范围（最小 0，最大 150）</span><br>    [<span class="hljs-meta">Range(0, 150)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age;<br><br>    <span class="hljs-comment">// 指定输入框，拥有五行</span><br>    [<span class="hljs-meta">Multiline(5)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> NickName;<br><br>    <span class="hljs-comment">// 默认显示五行，最多显示十行内容，再多用滚动条控制显示区域</span><br>    [<span class="hljs-meta">TextArea(5, 10)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Description;<br><br>    <span class="hljs-keyword">public</span> Color Flag;<br><br>    <span class="hljs-keyword">public</span> Texture Tex;<br><br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-built_in">string</span>&gt; Tags;<br><br>    <span class="hljs-keyword">public</span> Profession Pro;<br><br>    <span class="hljs-comment">// 给小齿轮添加一个回调函数</span><br>    [<span class="hljs-meta">ContextMenu(<span class="hljs-string">&quot;输出攻防比：&quot;</span>)</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PrintADProportion</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;攻击/防御比例：&quot;</span> + Num.Atk + <span class="hljs-string">&quot;/&quot;</span> + Num.Def);<br>    &#125;<br><br>    <span class="hljs-comment">// 给一个成员变量添加右键菜单</span><br>    <span class="hljs-comment">// 第一个参数是菜单的名称</span><br>    <span class="hljs-comment">// 第二个参数是右键点击的回调函数</span><br>    [<span class="hljs-meta">ContextMenuItem(<span class="hljs-string">&quot;输出国家&quot;</span>, <span class="hljs-string">&quot;OutCountry&quot;</span>)</span>]<br>    [<span class="hljs-meta">Tooltip(<span class="hljs-string">&quot;右键菜单&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Country;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OutCountry</span>()</span><br>    &#123;<br>        Debug.Log(Country);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="02.webp" alt="webp"></p>
<p><img src="03.webp" alt="webp"></p>
<p><img src="04.webp" alt="webp"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-comment">// 将 Player 组件添加到 AddComponent 上</span><br><span class="hljs-comment">// 第一个参数：分类名/组件名</span><br><span class="hljs-comment">// 第二个参数：列表中显示的顺序</span><br>[<span class="hljs-meta">AddComponentMenu(<span class="hljs-string">&quot;自定义控制器/玩家控制器&quot;</span>, 1)</span>]<br><span class="hljs-comment">// 使生命周期函数，在编辑器状态下可以执行，游戏中也可以正常使用</span><br><span class="hljs-comment">// Update() 在场景中对象发生变化或项目组织发生变化时会在编辑器下执行</span><br>[<span class="hljs-meta">ExecuteInEditMode</span>]<br><span class="hljs-comment">// 关于类型和类名</span><br><span class="hljs-comment">// BoxCollider：是类名，适用于函数提供泛型方法</span><br><span class="hljs-comment">// typeof(BoxCollider)：System.Type，C# 的类型，适用于函数需要 System.Type 参数</span><br><br><span class="hljs-comment">// 当前组件依赖于盒子碰撞体</span><br><span class="hljs-comment">// 当前组件挂载在对象时，盒子碰撞体会一起被添加上去</span><br><span class="hljs-comment">// 当 Player 组件没有被移除时，盒子碰撞体不能被删除</span><br>[<span class="hljs-meta">RequireComponent(typeof(BoxCollider))</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Player</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-comment">// Update is called once per frame</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;Update&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p><img src="05.webp" alt="webp"></p>
<p>创建一个多选的列表：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C#">[<span class="hljs-meta">Flags</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> PlayerLoveColor<br>&#123;<br>    Green = <span class="hljs-number">1</span>,<br>    Red = <span class="hljs-number">2</span>,<br>    Pink = <span class="hljs-number">4</span>,<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="06.webp" alt="webp"></p>
<h3 id="04-05-%E7%BC%96%E8%BE%91%E5%99%A8%E6%A3%80%E8%A7%86%E5%99%A8%E9%9D%A2%E6%9D%BF%E6%B7%B1%E5%BA%A6%E6%89%A9%E5%B1%95-1" tabindex="-1" id="04-05-编辑器检视器面板深度扩展-1">04-05 编辑器检视器面板深度扩展 1</h3>
<p>编辑 <code>Assets/Scripts/Player.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System;<br><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-comment">// 职业枚举</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> PlayerProProfession<br>&#123;<br>    Warrior = <span class="hljs-number">0</span>,<br>    Wizard,<br>&#125;<br><br>[<span class="hljs-meta">Flags</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> PlayerLoveColor<br>&#123;<br>    Green = <span class="hljs-number">1</span>,<br>    Red = <span class="hljs-number">2</span>,<br>    Pink = <span class="hljs-number">4</span>,<br>&#125;<br><br><span class="hljs-comment">// 将 Player 组件添加到 AddComponent 上</span><br><span class="hljs-comment">// 第一个参数：分类名/组件名</span><br><span class="hljs-comment">// 第二个参数：列表中显示的顺序</span><br>[<span class="hljs-meta">AddComponentMenu(<span class="hljs-string">&quot;自定义控制器/玩家控制器&quot;</span>, 1)</span>]<br><span class="hljs-comment">// 使生命周期函数，在编辑器状态下可以执行，游戏中也可以正常使用</span><br><span class="hljs-comment">// Update() 在场景中对象发生变化或项目组织发生变化时会在编辑器下执行</span><br>[<span class="hljs-meta">ExecuteInEditMode</span>]<br><span class="hljs-comment">// 关于类型和类名</span><br><span class="hljs-comment">// BoxCollider：是类名，适用于函数提供泛型方法</span><br><span class="hljs-comment">// typeof(BoxCollider)：System.Type，C# 的类型，适用于函数需要 System.Type 参数</span><br><br><span class="hljs-comment">// 当前组件依赖于盒子碰撞体</span><br><span class="hljs-comment">// 当前组件挂载在对象时，盒子碰撞体会一起被添加上去</span><br><span class="hljs-comment">// 当 Player 组件没有被移除时，盒子碰撞体不能被删除</span><br>[<span class="hljs-meta">RequireComponent(typeof(BoxCollider))</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Player</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> ID;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> Atk;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> isMan;<br>    <span class="hljs-keyword">public</span> Vector3 HeadDir;<br>    <span class="hljs-keyword">public</span> Color Hair;<br>    <span class="hljs-keyword">public</span> GameObject Weapon;<br>    <span class="hljs-keyword">public</span> Texture Cloth;<br>    <span class="hljs-keyword">public</span> PlayerProProfession Pro;<br>    <span class="hljs-keyword">public</span> PlayerLoveColor LoveColor;<br><br>    <span class="hljs-comment">// Update is called once per frame</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;Update&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>Assets/Editor/PlayerEditor.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-comment">// 步骤 1：引入编辑器的命名空间，检视器属于编辑器开发范畴</span><br><span class="hljs-keyword">using</span> UnityEditor;<br><br>[<span class="hljs-meta">CustomEditor(typeof(Player))</span>]  <span class="hljs-comment">// 步骤 3：将编辑器开发脚本与需要编辑的组件脚本建立外挂关联关系</span><br><span class="hljs-comment">// 外挂脚本因为存储在 Editor 目录下，所以不会被打入最终的游戏包</span><br><span class="hljs-comment">// 不继承 Mono，而是继承自 Editor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PlayerEditor</span> : <span class="hljs-title">Editor</span>  <span class="hljs-comment">// 步骤 2：继承 Editor 类，使用编辑器相关的成员变量和生命周期函数</span><br>&#123;<br>    <span class="hljs-comment">// 获得到需要编辑显示的组件</span><br>    <span class="hljs-keyword">private</span> Player _Componet;<br><br>    <span class="hljs-comment">// 当关联组件所在对象被选中或组件被添加时，调用</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEnable</span>()</span><br>    &#123;<br>        _Componet = target <span class="hljs-keyword">as</span> Player;<br>    &#125;<br><br>    <span class="hljs-comment">// 当关联组件所在对象被取消或组件被移除时，调用</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnDisable</span>()</span><br>    &#123;<br>        _Componet = <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 用于绘制检视面板的生命周期函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnInspectorGUI</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// 标题显示</span><br>        EditorGUILayout.LabelField(<span class="hljs-string">&quot;人物相关属性&quot;</span>);<br><br>        <span class="hljs-comment">// 整型</span><br>        _Componet.ID = EditorGUILayout.IntField(<span class="hljs-string">&quot;玩家 ID&quot;</span>, _Componet.ID);<br>        <span class="hljs-comment">// 文本</span><br>        _Componet.Name = EditorGUILayout.TextField(<span class="hljs-string">&quot;玩家名称&quot;</span>, _Componet.Name);<br>        <span class="hljs-comment">// 浮点数</span><br>        _Componet.Atk = EditorGUILayout.FloatField(<span class="hljs-string">&quot;玩家攻击力&quot;</span>, _Componet.Atk);<br>        <span class="hljs-comment">// 布尔值</span><br>        _Componet.isMan = EditorGUILayout.Toggle(<span class="hljs-string">&quot;是否为男性&quot;</span>, _Componet.isMan);<br>        <span class="hljs-comment">// 向量</span><br>        _Componet.HeadDir = EditorGUILayout.Vector3Field(<span class="hljs-string">&quot;头部方向&quot;</span>, _Componet.HeadDir);<br>        <span class="hljs-comment">// 颜色</span><br>        _Componet.Hair = EditorGUILayout.ColorField(<span class="hljs-string">&quot;颜色&quot;</span>, _Componet.Hair);<br><br>        <span class="hljs-comment">// 对象数据类型绘制</span><br>        <span class="hljs-comment">// 参数 1：标题</span><br>        <span class="hljs-comment">// 参数 2：原始组件的值</span><br>        <span class="hljs-comment">// 参数 3：成员变量的类型</span><br>        <span class="hljs-comment">// 参数 4：是否可以将场景中的对象拖给这个成员变量</span><br>        _Componet.Weapon = EditorGUILayout.ObjectField(<span class="hljs-string">&quot;武器&quot;</span>, _Componet.Weapon, <span class="hljs-keyword">typeof</span>(GameObject), <span class="hljs-literal">true</span>) <span class="hljs-keyword">as</span> GameObject;<br>        <span class="hljs-comment">// 纹理</span><br>        _Componet.Cloth = EditorGUILayout.ObjectField(<span class="hljs-string">&quot;衣服材质贴图&quot;</span>, _Componet.Cloth, <span class="hljs-keyword">typeof</span>(Texture), <span class="hljs-literal">true</span>) <span class="hljs-keyword">as</span> Texture;<br><br>        <span class="hljs-comment">// 枚举数据类型绘制</span><br>        <span class="hljs-comment">// 单选枚举</span><br>        _Componet.Pro = (PlayerProProfession)EditorGUILayout.EnumPopup(<span class="hljs-string">&quot;职业&quot;</span>, _Componet.Pro);<br>        <span class="hljs-comment">// 多选枚举</span><br>        _Componet.LoveColor = (PlayerLoveColor)EditorGUILayout.EnumFlagsField(<span class="hljs-string">&quot;爱好&quot;</span>, _Componet.LoveColor);<br>        <span class="hljs-comment">// 终极数据类型绘制</span><br>        <span class="hljs-comment">// 更新可序列化数据</span><br>        serializedObject.Update();<br>        <span class="hljs-comment">// 通过成员变量名找到组件上的成员变量</span><br>        SerializedProperty sp = serializedObject.FindProperty(<span class="hljs-string">&quot;Items&quot;</span>);<br>        <span class="hljs-comment">// 可序列化数据绘制（取到的数据，标题，是否将所有获得的序列化数据显示出来）</span><br>        _Componet.Atk = EditorGUILayout.Slider(<span class="hljs-keyword">new</span> GUIContent(<span class="hljs-string">&quot;攻击力&quot;</span>), _Componet.Atk, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>);<br><br>        <span class="hljs-keyword">if</span> (_Componet.Atk &gt; <span class="hljs-number">80</span>)<br>        &#123;<br>            <span class="hljs-comment">// 显示消息框（红色）</span><br>            EditorGUILayout.HelpBox(<span class="hljs-string">&quot;攻击力过高&quot;</span>, MessageType.Error);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (_Componet.Atk &lt; <span class="hljs-number">20</span>)<br>        &#123;<br>            <span class="hljs-comment">// 显示消息框（黄色）</span><br>            EditorGUILayout.HelpBox(<span class="hljs-string">&quot;攻击力过低&quot;</span>, MessageType.Warning);<br>        &#125;<br><br>        <span class="hljs-comment">// 按钮显示和元素排列</span><br>        <span class="hljs-comment">// （按钮是否被按下）显示按钮（按钮名称）</span><br>        GUILayout.Button(<span class="hljs-string">&quot;来个按钮&quot;</span>);<br>        GUILayout.Button(<span class="hljs-string">&quot;来个按钮&quot;</span>);<br><br>        <span class="hljs-comment">// 开始横向排列绘制</span><br>        EditorGUILayout.BeginHorizontal();<br><br>        GUILayout.Button(<span class="hljs-string">&quot;再来个按钮&quot;</span>);<br>        GUILayout.Button(<span class="hljs-string">&quot;再来个按钮&quot;</span>);<br><br>        <span class="hljs-comment">// 结束横向排列绘制</span><br>        EditorGUILayout.EndHorizontal();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>此时就会修改 <code>Player</code> 的显示面板：</p>
<p><img src="07.webp" alt="webp"></p>
<h3 id="06-%E7%BC%96%E8%BE%91%E5%99%A8%E8%8F%9C%E5%8D%95%E6%A0%8F%E6%89%A9%E5%B1%95" tabindex="-1" id="06-编辑器菜单栏扩展">06 编辑器菜单栏扩展</h3>
<p>创建 <code>Assets/Editor/Menu.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> UnityEditor;<br><br><span class="hljs-comment">// 顶部菜单类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Menu</span> &#123;<br>    <span class="hljs-comment">// 在顶部显示“工具”菜单，下方有“导出 AB 资源包”，点击执行函数</span><br>    [<span class="hljs-meta">MenuItem(<span class="hljs-string">&quot;工具/导出 AB 资源包&quot;</span>)</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildAB</span>()</span><br>    &#123;<br>        Debug.Log(Application.persistentDataPath);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="08.webp" alt="webp"></p>
<h3 id="07-%E7%BC%96%E8%BE%91%E5%99%A8%E5%9C%BA%E6%99%AF%E8%A7%86%E7%AA%97%E6%89%A9%E5%B1%95" tabindex="-1" id="07-编辑器场景视窗扩展">07 编辑器场景视窗扩展</h3>
<p>创建 <code>Assets/Editor/PopWindow.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> UnityEditor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PopWindow</span> : <span class="hljs-title">EditorWindow</span><br>&#123;<br>    [<span class="hljs-meta">MenuItem(<span class="hljs-string">&quot;工具/创建窗口&quot;</span>)</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OpenWindow</span>()</span><br>    &#123;<br>        PopWindow window = GetWindow&lt;PopWindow&gt;(<span class="hljs-literal">false</span>, <span class="hljs-string">&quot;弹窗标题&quot;</span>, <span class="hljs-literal">true</span>);<br>        window.minSize = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">400</span>, <span class="hljs-number">300</span>);<br>        window.maxSize = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">800</span>, <span class="hljs-number">600</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 开窗口调用</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEnable</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;OnEnable&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 关闭窗口调用</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnDisable</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;OnDisable&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 更新</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;Update&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGUI</span>()</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (GUILayout.Button(<span class="hljs-string">&quot;测试点击&quot;</span>))<br>        &#123;<br>            Debug.Log(<span class="hljs-string">&quot;测试点击&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 场景结构发生变化，执行回调函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnHierarchyChange</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;hierarchy&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 项目结构发生变化，执行回调函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnProjectChange</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;project&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 选中物体发生变化，执行回调函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnSelectionChange</span>()</span><br>    &#123;<br>        Debug.Log(Selection.activeGameObject.name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="09.webp" alt="webp"></p>
<p>创建一个 <code>Assets/Scripts/NodeManager.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br>[<span class="hljs-meta">ExecuteInEditMode</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NodeManager</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> List&lt;GameObject&gt; nodes = <span class="hljs-keyword">new</span> List&lt;GameObject&gt;();<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDrawGizmos</span>()</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (nodes == <span class="hljs-literal">null</span> || nodes.Count &lt; <span class="hljs-number">2</span>)<br>            <span class="hljs-keyword">return</span>;<br><br>        Gizmos.color = Color.red;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; nodes.Count - <span class="hljs-number">1</span>; i++)<br>        &#123;<br>            Gizmos.DrawLine(nodes[i].transform.position, nodes[i + <span class="hljs-number">1</span>].transform.position);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建一个 <code>Assets/Editor/NodeManagerEditor.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> UnityEditor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NodeWindow</span> : <span class="hljs-title">EditorWindow</span><br>&#123;<br>    <span class="hljs-keyword">static</span> NodeWindow window;<br><br>    <span class="hljs-keyword">static</span> GameObject nodeManager;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OpenWindow</span>(<span class="hljs-params">GameObject manager</span>)</span><br>    &#123;<br>        nodeManager = manager;<br>        <span class="hljs-comment">// 真正开启了一个窗口</span><br>        window = EditorWindow.GetWindow&lt;NodeWindow&gt;();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// 通过窗口的 Update，每帧执行一次，当前被选中的对象为板子</span><br>        Selection.activeGameObject = nodeManager;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CloseWindow</span>()</span><br>    &#123;<br>        window.Close();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 外挂式关联 NodeManager</span><br>[<span class="hljs-meta">CustomEditor(typeof(NodeManager))</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NodeManagerEditor</span> : <span class="hljs-title">Editor</span><br>&#123;<br><br>    NodeManager manager;<br><br>    <span class="hljs-built_in">bool</span> isEditor = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 是否是编辑的状态</span><br><br>    <span class="hljs-comment">// 当选中带有 NodeManager 组件对象的时候，获得组件</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnEnable</span>()</span><br>    &#123;<br>        manager = (NodeManager)target;<br>    &#125;<br><br>    <span class="hljs-comment">// 绘制组件的生命周期函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnInspectorGUI</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// 通过终极的数据获取方法，显示列表中的数据</span><br>        serializedObject.Update();<br>        SerializedProperty nodes = serializedObject.FindProperty(<span class="hljs-string">&quot;nodes&quot;</span>);<br>        EditorGUILayout.PropertyField(nodes, <span class="hljs-keyword">new</span> GUIContent(<span class="hljs-string">&quot;路径&quot;</span>), <span class="hljs-literal">true</span>);<br>        serializedObject.ApplyModifiedProperties();<br><br>        <span class="hljs-comment">// 开始编辑的开关</span><br>        <span class="hljs-keyword">if</span> (!isEditor &amp;&amp; GUILayout.Button(<span class="hljs-string">&quot;开始编辑&quot;</span>))<br>        &#123;<br>            NodeWindow.OpenWindow(manager.gameObject);  <span class="hljs-comment">// 调用打开界面的方法</span><br>            isEditor = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// 改变状态变成编辑模式</span><br>        &#125;<br>        <span class="hljs-comment">// 结束编辑的开关</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isEditor &amp;&amp; GUILayout.Button(<span class="hljs-string">&quot;结束编辑&quot;</span>))<br>        &#123;<br>            NodeWindow.CloseWindow();  <span class="hljs-comment">// 调用关闭界面的方法</span><br>            isEditor = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 改变状态变成非编辑模式</span><br>        &#125;<br><br>        <span class="hljs-comment">// 删除按钮</span><br>        <span class="hljs-keyword">if</span> (GUILayout.Button(<span class="hljs-string">&quot;删除最后一个节点&quot;</span>))<br>        &#123;<br>            RemoveAtLast();<br>        &#125;<br>        <span class="hljs-comment">// 删除所有按钮</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (GUILayout.Button(<span class="hljs-string">&quot;删除所有节点&quot;</span>))<br>        &#123;<br>            RemoveAll();<br>        &#125;<br>    &#125;<br><br>    RaycastHit hit;<br><br>    <span class="hljs-comment">// 有点类似前期 Update 函数，发送射线</span><br>    <span class="hljs-comment">// 当选中关联的脚本挂载的物体</span><br>    <span class="hljs-comment">// 当鼠标在 Scene 视图下发生变化时，执行该方法，比如鼠标移动，比如鼠标的点击</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnSceneGUI</span>()</span><br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (!isEditor)  <span class="hljs-comment">// 非编辑状态下不能生成路点</span><br>        &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 当鼠标按下左键时发射一条射线 </span><br>        <span class="hljs-comment">// 非运行时，使用 Event 类</span><br>        <span class="hljs-comment">// Event.current.button 判断鼠标是哪个按键的（0 是鼠标左键）</span><br>        <span class="hljs-comment">// Event.current.type 判断鼠标的事件方式的（鼠标按下）</span><br>        <span class="hljs-keyword">if</span> (Event.current.button == <span class="hljs-number">0</span> &amp;&amp; Event.current.type == EventType.MouseDown)<br>        &#123;<br>            <span class="hljs-comment">// 从鼠标的位置需要发射射线了</span><br>            <span class="hljs-comment">// 因为是从 Scene 视图下发射射线，跟场景中的摄像机并没有关系，所以不能使用相机发射射线的方法</span><br>            <span class="hljs-comment">// 从编辑器 GUI 中的一个点向世界定义一条射线, 参数一般都是鼠标的坐标</span><br>            Ray ray = HandleUtility.GUIPointToWorldRay(Event.current.mousePosition);<br>            <span class="hljs-keyword">if</span> (Physics.Raycast(ray, <span class="hljs-keyword">out</span> hit, <span class="hljs-number">100</span>))<br>                &#123;<br>                    <span class="hljs-comment">// 需要在检测到的点实例化，路点</span><br>                    InstancePathNode(hit.point + Vector3.up * <span class="hljs-number">0.1f</span>);<br>            &#125;<br><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成节点</span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name=&quot;position&quot;&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">InstancePathNode</span>(<span class="hljs-params">Vector3 position</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// 点预制体</span><br>        GameObject prefab = Resources.Load&lt;GameObject&gt;(<span class="hljs-string">&quot;PathNode&quot;</span>);<br>        <span class="hljs-comment">// 点对象，生成到 Plane 的子物体下</span><br>        GameObject pathNode = Instantiate&lt;GameObject&gt;(prefab, position, Quaternion.identity, manager.transform);<br>        <span class="hljs-comment">// 把生成的路点添加到列表里</span><br>        manager.nodes.Add(pathNode);<br>    &#125;<br><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> 删除最后一个节点</span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RemoveAtLast</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// 保证有节点才能删节点</span><br>        <span class="hljs-keyword">if</span> (manager.nodes.Count &gt; <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-comment">// 从场景中删除游戏物体</span><br>            DestroyImmediate(manager.nodes[manager.nodes.Count - <span class="hljs-number">1</span>]);<br>            <span class="hljs-comment">// 把该节点从列表中移除</span><br>            manager.nodes.RemoveAt(manager.nodes.Count - <span class="hljs-number">1</span>);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> 删除所有的节点</span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RemoveAll</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// 遍历删除所有的节点物体</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; manager.nodes.Count; i++)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (manager.nodes[i] != <span class="hljs-literal">null</span>)<br>            &#123;<br>                DestroyImmediate(manager.nodes[i]);<br>            &#125;<br>        &#125;<br><br>        manager.nodes.Clear();  <span class="hljs-comment">// 清空列表</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建一个 <code>Assets/Resources/PathNode.prefab</code>：</p>
<p><img src="10.webp" alt="webp"></p>
<p><img src="11.webp" alt="webp"></p>
<h2 id="ab-%E5%8C%85" tabindex="-1" id="AB-包">AB 包</h2>
<h3 id="08-%E5%A4%8D%E4%B9%A0%E5%8F%8A%E4%BB%8A%E5%A4%A9%E4%BB%8B%E7%BB%8D" tabindex="-1" id="08-复习及今天介绍">08 复习及今天介绍</h3>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p><strong>AB 包和 Resources 的区别</strong></p>
<ul>
<li>
<p>存储</p>
<ul>
<li>Resources 内部资源存储在游戏的发布包中，</li>
<li>AB 包存储在独立的文件中（AB 包存储在非特殊目录下时，不在游戏的发布包中）。</li>
</ul>
</li>
<li>
<p>加载</p>
<ul>
<li>Resources 内部资源使用 <code>Resources.Load()</code></li>
<li>AB 包（可以理解为可下载的 <code>Resources</code>）
<ul>
<li>获得 AB 包文件（下载，解压 streaming 拷贝到可写目录）</li>
<li>加载步骤 1：通过 AB 包文件路径，加载 AB 包文件</li>
<li>加载步骤 2：通过名称（资源，o）加载内部资源</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>AssetBundle 的定义</strong></p>
<p>​	AssetBundle 是把一些资源文件，场景文件或二进制文件以某种紧密的方式保存在一起的一些文件。</p>
<p>​	AssetBundle 内部不能包含 C# 脚本文件，AssetBundle 可以配合 Lua 实现资源和游戏逻辑代码的更新。</p>
<p>​	AssetBundle 是<strong>独立于游戏主包存在的资源存储文件</strong>，使用内部资源时，需要单独下载和加载。</p>
<p><img src="12.webp" alt="webp"></p>
<p><strong>热更新</strong></p>
<p>​	不关闭 Unity 应用的前提，实现游戏资源和代码逻辑的更新。</p>
</div>
<h3 id="09-ab-%E5%8C%85%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AF%BC%E5%87%BA%E5%B7%A5%E5%85%B7%E5%AE%9E%E7%8E%B0" tabindex="-1" id="09-AB-包介绍及导出工具实现">09 AB 包介绍及导出工具实现</h3>
<p><img src="13.webp" alt="webp"></p>
<p>选中若干资源，打包成 AssetBundle（给其命名）。</p>
<p>创建 <code>Assets/Editor/ExportAB.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> UnityEditor;<br><span class="hljs-keyword">using</span> System.IO;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExportAB</span><br>&#123;<br>    [<span class="hljs-meta">MenuItem(<span class="hljs-string">&quot;AB 包/导出&quot;</span>)</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Export</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;导出 AB 包&quot;</span>);<br>        <span class="hljs-comment">// 项目的 Assets 目录的路径</span><br>        <span class="hljs-built_in">string</span> path = Application.dataPath;<br>        path = path.Substring(<span class="hljs-number">0</span>, path.Length - <span class="hljs-number">6</span>) + <span class="hljs-string">&quot;ab&quot;</span>;<br><br>        <span class="hljs-comment">// 防止路径不存在</span><br>        <span class="hljs-keyword">if</span> (!Directory.Exists(path))<br>        &#123;<br>            Directory.CreateDirectory(path);<br>        &#125;<br><br>        <span class="hljs-comment">// 导出 AB 包的核心代码，生成 AB 包文件</span><br>        <span class="hljs-comment">// 参数 1：AB 文件存储路径</span><br>        <span class="hljs-comment">// 参数 2：导出选项</span><br>        <span class="hljs-comment">// 参数 3：平台（不同平台的 AB 包是不一样的）</span><br>        BuildPipeline.BuildAssetBundles(<br>            path,<br>            BuildAssetBundleOptions.None,<br>            BuildTarget.StandaloneWindows);<br><br>        Debug.Log(<span class="hljs-string">&quot;导出完成&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p><code>BuildAssetBundleOptions</code> 是 Unity 提供的一组标志枚举，用于控制 <code>BuildPipeline.BuildAssetBundles</code> 方法的行为。以下是常见的选项：</p>
<p><strong>常见的 <code>BuildAssetBundleOptions</code> 选项：</strong></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>无特殊选项，使用默认的打包方式。</td>
</tr>
<tr>
<td><code>UncompressedAssetBundle</code></td>
<td>生成未压缩的 AB 包，加载更快但占用空间更大。</td>
</tr>
<tr>
<td><code>DisableWriteTypeTree</code></td>
<td>禁用类型树，减少文件大小，但可能会导致跨版本不兼容。</td>
</tr>
<tr>
<td><code>DeterministicAssetBundle</code></td>
<td>生成一致的 AB 文件，确保相同资源的哈希值相同，以便版本管理。</td>
</tr>
<tr>
<td><code>ForceRebuildAssetBundle</code></td>
<td>强制重新构建所有 AB 文件，而不使用已有的缓存。</td>
</tr>
<tr>
<td><code>IgnoreTypeTreeChanges</code></td>
<td>忽略类型树的更改，提高跨 Unity 版本的兼容性。</td>
</tr>
<tr>
<td><code>AppendHashToAssetBundleName</code></td>
<td>在 AB 文件名后追加哈希值，以确保版本更新时不会覆盖旧版本。</td>
</tr>
<tr>
<td><code>ChunkBasedCompression</code></td>
<td>使用 LZ4 压缩，提高运行时解压速度，适用于频繁加载的资源。</td>
</tr>
<tr>
<td><code>StrictMode</code></td>
<td>在构建时启用严格模式，检测可能的错误并抛出异常。</td>
</tr>
<tr>
<td><code>DryRunBuild</code></td>
<td>进行模拟构建，但不会实际生成 AB 文件，可用于调试。</td>
</tr>
</tbody>
</table>
</div>
<h3 id="10-ab-%E5%8C%85%E8%B5%84%E6%BA%90%E7%AE%80%E5%8D%95%E5%8A%A0%E8%BD%BD" tabindex="-1" id="10-AB-包资源简单加载">10 AB 包资源简单加载</h3>
<p>创建 <code>Assets/Scripts/Config.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Config</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> ABPath = Application.dataPath.Substring(<span class="hljs-number">0</span>, Application.dataPath.Length - <span class="hljs-number">6</span>) + <span class="hljs-string">&quot;ab&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>Assets/Scripts/SimpleLoad.cs</code> 并绑定在场景的某个组件中：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> UnityEngine.UI;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SimpleLoad</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> Image Icon;<br>    <span class="hljs-comment">// Start is called before the first frame update</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// 第一步加载 AB 文件</span><br>        AssetBundle ab = AssetBundle.LoadFromFile(Config.ABPath + <span class="hljs-string">&quot;/ui&quot;</span>);<br><br>        <span class="hljs-comment">// 第二步加载资源</span><br>        Sprite sp = ab.LoadAsset&lt;Sprite&gt;(<span class="hljs-string">&quot;参考图&quot;</span>);<br><br>        GameObject.Find(<span class="hljs-string">&quot;/Canvas/Image&quot;</span>).GetComponent&lt;Image&gt;().sprite = sp;<br><br>        Debug.Log(<span class="hljs-string">&quot;加载完成&quot;</span> + sp.name);<br><br>        Icon.sprite = sp;<br><br>        ab.Unload(<span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="14.webp" alt="webp"></p>
<h3 id="11-%E8%B5%84%E6%BA%90%E7%83%AD%E6%9B%B4%E6%96%B0%E6%BC%94%E7%A4%BA" tabindex="-1" id="11-资源热更新演示">11 资源热更新演示</h3>
<p>导入资源中的 AB 包：<code>ab/old/test</code> 和 <code>ab/New/test</code></p>
<p>创建 <code>Assets/Scripts/HotUpdate.cs</code> 并导入到场景中：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> UnityEngine.UI;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HotUpdate</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> Image Icon;<br>    <span class="hljs-comment">// Start is called before the first frame update</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        AssetBundle ab = AssetBundle.LoadFromFile(Config.ABPath + <span class="hljs-string">&quot;Old/test&quot;</span>);<br>        Sprite sp = ab.LoadAsset&lt;Sprite&gt;(<span class="hljs-string">&quot;btn_go_back&quot;</span>);<br><br>        Icon.sprite = sp;<br>        ab.Unload(<span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 点击按钮后，加载新 AB 包里面的 btn_go_back 资源</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ChangeAB</span>()</span><br>    &#123;<br>        AssetBundle ab = AssetBundle.LoadFromFile(Config.ABPath + <span class="hljs-string">&quot;New/test&quot;</span>);<br>        Sprite sp = ab.LoadAsset&lt;Sprite&gt;(<span class="hljs-string">&quot;btn_go_back&quot;</span>);<br><br>        Icon.sprite = sp;<br>        ab.Unload(<span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="15.webp" alt="webp"></p>
<p><code>Button</code> 绑定 <code>ChangeAB()</code>，后，即可按下按钮更改图片。</p>
<h3 id="12-%E4%BC%98%E5%8C%96%E5%AF%BC%E5%87%BA%E5%B7%A5%E5%85%B7%E5%8F%8A%E4%BE%9D%E8%B5%96%E5%8A%A0%E8%BD%BD" tabindex="-1" id="12-优化导出工具及依赖加载">12 优化导出工具及依赖加载</h3>
<p>编辑 <code>ExportAB.cs</code>，将 AB 包导出至不同的平台：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs C#">[<span class="hljs-meta">MenuItem(<span class="hljs-string">&quot;AB 包导出/Windows&quot;</span>)</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ForWindows</span>()</span><br>&#123;<br>    Export(BuildTarget.StandaloneWindows);<br>&#125;<br><br>[<span class="hljs-meta">MenuItem(<span class="hljs-string">&quot;AB 包导出/Mac&quot;</span>)</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ForMac</span>()</span><br>&#123;<br>    Export(BuildTarget.StandaloneOSX);<br>&#125;<br><br>[<span class="hljs-meta">MenuItem(<span class="hljs-string">&quot;AB 包导出/iOS&quot;</span>)</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ForiOS</span>()</span><br>&#123;<br>    Export(BuildTarget.iOS);<br>&#125;<br><br>[<span class="hljs-meta">MenuItem(<span class="hljs-string">&quot;AB 包导出/Android&quot;</span>)</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ForAndroid</span>()</span><br>&#123;<br>    Export(BuildTarget.Android);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="12-%E4%BC%98%E5%8C%96%E5%AF%BC%E5%87%BA%E5%B7%A5%E5%85%B7%E5%8F%8A%E4%BE%9D%E8%B5%96%E5%8A%A0%E8%BD%BD-1" tabindex="-1" id="12-优化导出工具及依赖加载-2">12 优化导出工具及依赖加载</h3>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>加载 AB 包内部数据</p>
<p>​	如果想处理依赖关系的加载，则必须加载主AB包，因为依赖关系的存储，都存储在主 AB 包的配置文件中</p>
<p>第一步（加载依赖的 AB 包文件）</p>
<ol>
<li>
<p>加载主 AB 包</p>
</li>
<li>
<p>根据主 AB 包的配置文件，获得我当前需要加载的 AB 所依赖的 AB 们</p>
</li>
<li>
<p>将所有的依赖 AB 们，加载进来</p>
</li>
</ol>
<p>第二步（加载 AB 包文件）</p>
<ul>
<li><code>AB 包 = AssetBundle.LoadFromFile(AB 包文件路径)</code></li>
<li><code>AssetBundle.LoadFromFileSync(AB 包文件路径)</code></li>
</ul>
<p>第三步（加载 AB 包内部资源）</p>
<ul>
<li>
<p><code>资源对象 = AB 包对象.LoadAsset&lt;资源类型&gt;(“资源名称”)</code></p>
</li>
<li>
<p><code>AB 包对象.LoadAssetSync&lt;资源类型&gt;(“资源名称”)</code></p>
</li>
</ul>
<p>注意！！！：AB 包不能重复加载</p>
</div>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Load</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// 加载主 AB 包</span><br>        AssetBundle main = AssetBundle.LoadFromFile(Config.ABPath + <span class="hljs-string">&quot;/ab&quot;</span>);<br>        <br>        <span class="hljs-comment">// 获取主 AB 包的配置文件</span><br>        AssetBundleManifest manifest = main.LoadAsset&lt;AssetBundleManifest&gt;(<span class="hljs-string">&quot;AssetBundleManifest&quot;</span>);<br>        <br>        <span class="hljs-comment">// 分析预制体所在 AB 包，依赖哪些 AB 包</span><br>        <span class="hljs-comment">// deps 存储了所有依赖的 ab 包的名字</span><br>        <span class="hljs-built_in">string</span>[] deps = manifest.GetAllDependencies(<span class="hljs-string">&quot;test2&quot;</span>);<br>        <br>        <span class="hljs-comment">// 加载依赖的 AB 包</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; deps.Length; i++)<br>        &#123;<br>            AssetBundle.LoadFromFile(Config.ABPath + <span class="hljs-string">&quot;/&quot;</span> + deps[i]);<br>        &#125;<br>        <br>        <span class="hljs-comment">// 加载预制体所在的 AB 包</span><br>		AssetBundle test2 = AssetBundle.LoadFromFile(Config.ABPath + <span class="hljs-string">&quot;/test2&quot;</span>);<br>        <br>        <span class="hljs-comment">// 加载预制体</span><br>        Object prefab = test2.LoadAsset(<span class="hljs-string">&quot;Image&quot;</span>);<br>        <br>		Gameobject img = Instantiate(prefab) <span class="hljs-keyword">as</span> Gameobject;<br>        img.transform.SetParent(GameObject.Find(<span class="hljs-string">&quot;/Canvas&quot;</span>).transform);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="13-%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD" tabindex="-1" id="13-异步加载">13 异步加载</h3>
<p>使用协程 <code>IEnumerator</code> 进行异步加载（<code>Resources</code> / <code>AB 包</code> 两种方式），创建 <code>Assets/Scripts/AsyncLoad.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> UnityEngine.UI;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AsyncLoad</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-comment">// Start is called before the first frame update</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// StartCoroutine(LoadImage());</span><br>        StartCoroutine(LoadAB());<br>    &#125;<br><br>    <span class="hljs-function">IEnumerator <span class="hljs-title">LoadImage</span>()</span><br>    &#123;<br>        ResourceRequest rr = Resources.LoadAsync&lt;Sprite&gt;(<span class="hljs-string">&quot;参考图&quot;</span>);<br>        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> rr;<br><br>        GameObject.Find(<span class="hljs-string">&quot;/Canvas/Image&quot;</span>).GetComponents&lt;Image&gt;()[<span class="hljs-number">0</span>].sprite = rr.asset <span class="hljs-keyword">as</span> Sprite;<br>    &#125;<br><br>    <span class="hljs-function">IEnumerator <span class="hljs-title">LoadAB</span>()</span><br>    &#123;<br>        AssetBundleCreateRequest abcr = AssetBundle.LoadFromFileAsync(Config.ABPath + <span class="hljs-string">&quot;/ui&quot;</span>);<br>        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> abcr;<br><br>        GameObject.Find(<span class="hljs-string">&quot;/Canvas/Image&quot;</span>).GetComponents&lt;Image&gt;()[<span class="hljs-number">0</span>].sprite = abcr.assetBundle.LoadAsset&lt;Sprite&gt;(<span class="hljs-string">&quot;参考图&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="14-%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90" tabindex="-1" id="14-内存分析">14 内存分析</h3>
<p>创建一个 <code>Assets/Scripts/Memory.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> UnityEngine.UI;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Memory</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    AssetBundle ab;<br>    <span class="hljs-keyword">public</span> Image img;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LoadFile</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;LoadFile()&quot;</span>);<br>        <span class="hljs-keyword">if</span> (ab == <span class="hljs-literal">null</span>)<br>        &#123;<br>            ab = AssetBundle.LoadFromFile(Config.ABPath + <span class="hljs-string">&quot;/ui&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LoadImage</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;LoadImage()&quot;</span>);<br>        <span class="hljs-keyword">if</span> (ab!= <span class="hljs-literal">null</span>)<br>        &#123;<br>            img.sprite = ab.LoadAsset&lt;Sprite&gt;(<span class="hljs-string">&quot;参考图&quot;</span>);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UnloadFile</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;UnloadFile()&quot;</span>);<br>        <span class="hljs-keyword">if</span> (ab != <span class="hljs-literal">null</span>)<br>        &#123;<br>            ab.Unload(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 参数代表，是否将场景中通过 AB 包加载出来的资源，同 AB 包一起销毁</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Recycling</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;Recycling()&quot;</span>);<br>        Resources.UnloadUnusedAssets();  <span class="hljs-comment">// 将所有没有使用过的资源进行回收</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="16.webp" alt="webp"></p>
<p>按 <code>Ctrl</code> + <code>7</code> 即可调用出内存分析界面，在加载 AB 包后，内存使用量会上升。</p>
<p><img src="17.webp" alt="webp"></p>
<h2 id="lua" tabindex="-1" id="Lua">Lua</h2>
<h3 id="15-lua-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" tabindex="-1" id="15-Lua-环境搭建">15 Lua 环境搭建</h3>
<p>安装 <code>LuaForWindows_v5.1.5-52.exe</code>：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/rjpcomputing/luaforwindows/releases">Releases · rjpcomputing/luaforwindows</a></li>
</ul>
<p><img src="18.webp" alt="webp"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/jupyter-xeus/xeus-lua?tab=readme-ov-file">jupyter-xeus/xeus-lua: Jupyter kernel for the Lua programming language</a></li>
</ul>
<p>这个仓库可以让你在线使用 Jupyter Notebook 进行 Lua 的编写。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/lua/lua-tutorial.html">Lua 教程 | 菜鸟教程</a></li>
</ul>
<h3 id="16-lua-%E5%8F%98%E9%87%8F%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" tabindex="-1" id="16-Lua-变量与数据类型">16 Lua 变量与数据类型</h3>
<p>Lua 注释：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- Lua 的单行注释</span><br><br><span class="hljs-comment">--[[</span><br><span class="hljs-comment">    这是 Lua 的多行注释</span><br><span class="hljs-comment">]]</span><br></code></pre></td></tr></table></figure>
<p>变量操作：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">name = <span class="hljs-string">&quot;hxsd&quot;</span><br><span class="hljs-built_in">print</span>(name)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">hxsd<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">_VERSION</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Lua 5.4<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(id)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">nil<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">name = <span class="hljs-literal">nil</span><br><span class="hljs-built_in">print</span>(name)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">nil<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> name = <span class="hljs-string">&quot;Unity&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(name))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-built_in">type</span>(name)))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">string <br>string<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(bb))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">nil<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(bb) == <span class="hljs-string">&quot;nil&quot;</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">true<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-number">123</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-number">1.0</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">number <br>number<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-literal">true</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">boolean<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-string">&#x27;hxsd&#x27;</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">string<br></code></pre></td></tr></table></figure>
<h3 id="17-lua-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C" tabindex="-1" id="17-Lua-字符串操作">17 Lua 字符串操作</h3>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> str1 = <span class="hljs-string">&quot;Abc&quot;</span><br><span class="hljs-keyword">local</span> str2 = <span class="hljs-string">&#x27;def&#x27;</span><br><br><span class="hljs-built_in">print</span>(str1 .. str2)<br><br><span class="hljs-built_in">print</span>(#str1)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">upper</span>(str1))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">lower</span>(str1))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Abcdef <br>3 <br>ABC <br>abc <br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 多行字符串</span><br><span class="hljs-keyword">local</span> str3 = <span class="hljs-string">[[</span><br><span class="hljs-string">one</span><br><span class="hljs-string">two</span><br><span class="hljs-string">]]</span><br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1&quot;</span> + <span class="hljs-string">&quot;2&quot;</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">3<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 字符串查找</span><br><span class="hljs-comment">-- 参数 1：被查找的字符串</span><br><span class="hljs-comment">-- 参数 2：查找的内容</span><br><span class="hljs-comment">-- 返回值起始找到的位置和结束找到的位置</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">find</span>(<span class="hljs-string">&quot;abcdefg&quot;</span>, <span class="hljs-string">&quot;cde&quot;</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">3 5<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 字符串反转</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">reverse</span>(<span class="hljs-string">&quot;abcdefg&quot;</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">gfedcba<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">sub</span>(<span class="hljs-string">&quot;abcdefg&quot;</span>, <span class="hljs-number">3</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cdefg<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">sub</span>(<span class="hljs-string">&quot;abcdefg&quot;</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cdef<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> data = <span class="hljs-string">&quot;abcdefghijkm&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">sub</span>(data, <span class="hljs-number">3</span>, #data - <span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cdefghijk<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&quot;I&#x27;m the %d player, other is %d&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">I&#x27;m the 1 player, other is 2<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">rep</span>(<span class="hljs-string">&quot;abc&quot;</span>, <span class="hljs-number">2</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">abcabc<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">char</span>(<span class="hljs-number">65</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">A<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">byte</span>(<span class="hljs-string">&quot;A&quot;</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">65<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 字符串替换</span><br><span class="hljs-comment">-- 参数 1：原始串</span><br><span class="hljs-comment">-- 参数 2：需要替换的内容</span><br><span class="hljs-comment">-- 参数 3：替换的内容</span><br><span class="hljs-comment">-- 返回替换后的字符串及匹配次数</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">string</span>.<span class="hljs-built_in">gsub</span>(<span class="hljs-string">&quot;abcd&quot;</span>, <span class="hljs-string">&quot;bc&quot;</span>, <span class="hljs-string">&quot;**&quot;</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">a**d 1<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>((<span class="hljs-built_in">string</span>.<span class="hljs-built_in">gsub</span>(<span class="hljs-string">&quot;abcd&quot;</span>, <span class="hljs-string">&quot;bc&quot;</span>, <span class="hljs-string">&quot;**&quot;</span>)))<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">a**d<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> new_str = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">gsub</span>(<span class="hljs-string">&quot;abcd&quot;</span>, <span class="hljs-string">&quot;bc&quot;</span>, <span class="hljs-string">&quot;**&quot;</span>)<br><span class="hljs-built_in">print</span>(new_str)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">a**d<br></code></pre></td></tr></table></figure>
<h3 id="18-lua-%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6" tabindex="-1" id="18-Lua-逻辑控制">18 Lua 逻辑控制</h3>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> data = &#123;&#125;<br><span class="hljs-comment">-- 起始索引是 1 开始</span><br><span class="hljs-comment">-- 类型可以混合</span><br><span class="hljs-comment">-- 索引值可以为负数</span><br><span class="hljs-comment">-- 即使索引从 1 开始，也可以赋值 0 索引</span><br><span class="hljs-comment">-- 索引可以断开</span><br><span class="hljs-comment">-- 初始化时对于没有索引的值，索引是从 1 向上累加的</span><br><span class="hljs-comment">-- 初始化提供索引的赋值方法，[索引值] = 数值</span><br>data = &#123;<span class="hljs-string">&quot;abc&quot;</span>, <span class="hljs-number">123</span>, [<span class="hljs-number">-1</span>] = <span class="hljs-number">100</span>, [<span class="hljs-number">0</span>] = <span class="hljs-number">99</span>, [<span class="hljs-number">4</span>] = <span class="hljs-number">233</span>&#125;<br><br><span class="hljs-built_in">print</span>(data[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(data[<span class="hljs-number">2</span>])<br><span class="hljs-built_in">print</span>(data[<span class="hljs-number">-1</span>])<br><span class="hljs-built_in">print</span>(data[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(data[<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(data[<span class="hljs-number">123</span>])<br><br><span class="hljs-comment">-- 获取数组的长度</span><br><span class="hljs-comment">-- 这种方式，获得的是从 1 案引开始，索引连续的数据个数，中间断开，计数结束</span><br><span class="hljs-comment">-- 这种方式不稳定</span><br><span class="hljs-built_in">print</span>(#data)<br><br><span class="hljs-comment">-- 修改某一个值</span><br>data[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;def&quot;</span><br><span class="hljs-built_in">print</span>(data[<span class="hljs-number">1</span>])<br><br><span class="hljs-keyword">local</span> data2 = &#123;&#123;<span class="hljs-string">&quot;aa&quot;</span>, <span class="hljs-string">&quot;bb&quot;</span>&#125;, &#123;<span class="hljs-number">11</span>, <span class="hljs-number">22</span>&#125;&#125;<br><span class="hljs-built_in">print</span>(data2[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">abc <br>123 <br>100 <br>99 <br>233 <br>nil <br>2 <br>def <br>11 <br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-number">2</span> ^ <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">8.0<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-number">2</span> ^ <span class="hljs-number">0.5</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1.4142135623731<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-number">2</span> ~= <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">true<br></code></pre></td></tr></table></figure>
<ul>
<li>Lua 没有 <code>++</code></li>
<li>Lua 没有 <code>+=</code>，<code>-=</code>，<code>*=</code></li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span>(<span class="hljs-literal">false</span>)<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;条件 1 达成&quot;</span>)<br><span class="hljs-keyword">elseif</span>(<span class="hljs-literal">true</span>)<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;elseif 达成&quot;</span>)<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;else 达成&quot;</span>)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">elseif 达成<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span>(<span class="hljs-literal">true</span>)<br><span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-literal">true</span>)<br>    <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入第二层 if&quot;</span>)<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">进入第二层 if<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">while</span> (num &lt; <span class="hljs-number">3</span>)<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">print</span>(num)<br>    num = num + <span class="hljs-number">1</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1 <br>2 <br></code></pre></td></tr></table></figure>
<h3 id="19-lua-%E8%AF%AD%E6%B3%95%E4%BB%8B%E7%BB%8D" tabindex="-1" id="19-Lua-语法介绍">19 Lua 语法介绍</h3>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> num = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">repeat</span><br>    <span class="hljs-built_in">print</span>(num)<br>    num = num + <span class="hljs-number">1</span><br><span class="hljs-keyword">until</span>(num &gt; <span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1 <br>2 <br>3 <br>4 <br>5<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> data = &#123;<span class="hljs-string">&quot;aa&quot;</span>, <span class="hljs-string">&quot;bb&quot;</span>, <span class="hljs-string">&quot;cc&quot;</span>, <span class="hljs-string">&quot;dd&quot;</span>, <span class="hljs-string">&quot;ee&quot;</span>&#125;<br><br><span class="hljs-comment">-- 参数 1：变量 i 的初始值，遍历 Lua 表，使用 1</span><br><span class="hljs-comment">-- 参数 2：增长到多少</span><br><span class="hljs-comment">-- [参数 3]：增长步长，默认值是 1</span><br><span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, #data, <span class="hljs-number">2</span><br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">print</span>(data[i])<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">aa <br>cc <br>ee<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- break 会跳出循环，没有 continue</span><br><span class="hljs-keyword">repeat</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-literal">true</span>)<br>    <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;此处跳出&quot;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">until</span>(<span class="hljs-literal">true</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;继续执行&quot;</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">此处跳出 <br>继续执行<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 迭代器（遍历 table）</span><br><span class="hljs-comment">-- one 是不加中括号的字符串索引</span><br><span class="hljs-comment">-- &quot;aa&quot; &quot;bb&quot;自动加 1，2 索引</span><br><span class="hljs-comment">-- [4] 指定数字索引</span><br><span class="hljs-comment">-- [-1] 指定负数索引</span><br><span class="hljs-comment">-- [&quot;two&quot;] 是加中括号的字符串密引写法</span><br><span class="hljs-keyword">local</span> data = &#123;one = <span class="hljs-string">&quot;cc&quot;</span>, <span class="hljs-string">&quot;aa&quot;</span>, <span class="hljs-string">&quot;bb&quot;</span>, [<span class="hljs-number">4</span>] = <span class="hljs-number">3</span>, [<span class="hljs-number">-1</span>] = <span class="hljs-number">4</span>, [<span class="hljs-string">&quot;two&quot;</span>] = <span class="hljs-string">&quot;dd&quot;</span>&#125;<br><br><span class="hljs-comment">-- 连续索引数值迭代器</span><br><span class="hljs-comment">-- 迭代器就是指向table的指针</span><br><span class="hljs-comment">-- 连续数字索引迭代器，只会获取从 1 开始的数字索引，且必须索引是连续的才能持续获得值</span><br><span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(data)<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;k: &quot;</span> .. k .. <span class="hljs-string">&quot;, v: &quot;</span> .. v)<br><span class="hljs-keyword">end</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-------------------&quot;</span>)<br><br><span class="hljs-comment">-- 所有数值迭代器</span><br><span class="hljs-comment">-- 相对于 ipairs，所有数值迭代器去掉了 i</span><br><span class="hljs-comment">-- i 可以理解为 int，去掉 int 的迭代器，也就去掉了连续数值案引的限定</span><br><span class="hljs-comment">-- 获取 table 长度的最稳定方法，就是使用所有数值迭代器获取</span><br><span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(data)<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;K: &quot;</span> .. k .. <span class="hljs-string">&quot;, V: &quot;</span> .. v)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">k: 1, v: aa <br>k: 2, v: bb <br>------------------- <br>K: 1, V: aa <br>K: 2, V: bb <br>K: -1, V: 4 <br>K: 4, V: 3 <br>K: one, V: cc <br>K: two, V: dd<br></code></pre></td></tr></table></figure>
<h3 id="20-lua-%E5%87%BD%E6%95%B0%E4%B8%8E%E8%A1%A8" tabindex="-1" id="20-Lua-函数与表">20 Lua 函数与表</h3>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">func1</span><span class="hljs-params">()</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;这是 func1&quot;</span>)<br><span class="hljs-keyword">end</span><br><br>func1()<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这是 func1<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> func3 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span></span><br>    <span class="hljs-built_in">print</span>(a + b)<br><span class="hljs-keyword">end</span><br><br>func3(<span class="hljs-number">5</span>, <span class="hljs-number">7</span>)<br>func3(<span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>)  <span class="hljs-comment">-- 参数可以多出来</span><br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">12 <br>12 <br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> func4 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(...)</span></span><br>    <span class="hljs-comment">-- 将无固定参数，转换为 table</span><br>    <span class="hljs-comment">-- arg 的作用域是 func4 的函数体</span><br>    <span class="hljs-keyword">local</span> <span class="hljs-built_in">arg</span> = &#123;...&#125;<br>    <span class="hljs-keyword">local</span> total = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(<span class="hljs-built_in">arg</span>)<br>    <span class="hljs-keyword">do</span><br>        total = total + v<br>    <span class="hljs-keyword">end</span><br><br>    <span class="hljs-built_in">print</span>(total)<br><span class="hljs-keyword">end</span><br><br>func4(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>func4(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">6 <br>15<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">func5</span><span class="hljs-params">()</span></span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">99</span>, <span class="hljs-number">100</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-built_in">print</span>(func5())<br><br><span class="hljs-comment">-- 将多返回值，同时赋值给两个变量</span><br><span class="hljs-keyword">local</span> num1, num2 = func5()<br><span class="hljs-built_in">print</span>(num1)<br><span class="hljs-built_in">print</span>(num2)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">99 100 <br>99 <br>100 <br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> data = &#123;one = <span class="hljs-string">&quot;cc&quot;</span>, <span class="hljs-string">&quot;aa&quot;</span>, <span class="hljs-string">&quot;bb&quot;</span>, [<span class="hljs-number">4</span>] = <span class="hljs-number">3</span>, [<span class="hljs-number">-1</span>] = <span class="hljs-number">4</span>, [<span class="hljs-string">&quot;two&quot;</span>] = <span class="hljs-string">&quot;dd&quot;</span>&#125;<br><br><span class="hljs-built_in">print</span>(data[<span class="hljs-number">2</span>])<br><span class="hljs-built_in">print</span>(data[<span class="hljs-string">&quot;one&quot;</span>])<br><span class="hljs-built_in">print</span>(data.two)<br><br><span class="hljs-comment">-- 因为函数是一种数据类型</span><br><span class="hljs-comment">-- 所以将 func1 索引下定义了一个函数</span><br>data.func1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;data 表中的 func1 函数&quot;</span>)<br><span class="hljs-keyword">end</span><br><br>data.func1()<br><br>data.func2 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>    <span class="hljs-built_in">print</span>(data.two)<br><span class="hljs-keyword">end</span><br><br>data.func2()<br><br><span class="hljs-comment">-- 成员函数定义时，显式加入 self 变量，对应 C# 的 this 关键字</span><br><span class="hljs-comment">-- 函数内部可以通过 self 变量获取当前 table 的其他值或函数</span><br>data.func3 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(self)</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">self</span>.two)<br><span class="hljs-keyword">end</span><br><br>data:func3()<br><br><span class="hljs-comment">-- 第二种 self 调用写法</span><br><span class="hljs-comment">-- 隐式给 self 赋值</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">data:func4</span><span class="hljs-params">()</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;func3: &quot;</span> .. <span class="hljs-built_in">self</span>.two)<br><span class="hljs-keyword">end</span><br><br>data:func4()<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">bb <br>cc <br>dd <br>data 表中的 func1 函数 <br>dd <br>dd <br>func3: dd <br></code></pre></td></tr></table></figure>
<h3 id="21-lua-%E5%AD%90%E6%96%87%E4%BB%B6%E4%B8%8E%E5%85%83%E8%A1%A8" tabindex="-1" id="21-Lua-子文件与元表">21 Lua 子文件与元表</h3>
<p>创建 <code>appName.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> <span class="hljs-built_in">config</span> = &#123;&#125;<br><br><span class="hljs-built_in">config</span>.appName = <span class="hljs-string">&quot;hxsd&quot;</span><br><br><span class="hljs-keyword">return</span> <span class="hljs-built_in">config</span><br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">package</span>.<span class="hljs-built_in">loaded</span>[<span class="hljs-string">&quot;test&quot;</span>]<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">true<br></code></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> <span class="hljs-built_in">config</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;appName&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">config</span>.appName)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">hxsd<br></code></pre></td></tr></table></figure>
<p>元表：<a target="_blank" rel="noopener" href="https://www.runoob.com/lua/lua-metatables.html">Lua 元表(Metatable) | 菜鸟教程</a></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> t1 = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br><span class="hljs-built_in">print</span>(t1)<br><br><span class="hljs-keyword">local</span> meta = &#123;<br>    <span class="hljs-built_in">__tostring</span> = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(t)</span></span><br>        <span class="hljs-keyword">local</span> <span class="hljs-built_in">format</span> = <span class="hljs-string">&quot;&#123;&quot;</span><br>        <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(t)<br>        <span class="hljs-keyword">do</span><br>            <span class="hljs-built_in">format</span> = <span class="hljs-built_in">format</span> .. v .. <span class="hljs-string">&#x27;, &#x27;</span><br>        <span class="hljs-keyword">end</span><br>    <br>        <span class="hljs-built_in">format</span> = <span class="hljs-built_in">format</span> .. <span class="hljs-string">&quot;&#125;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">format</span><br>    <span class="hljs-keyword">end</span><br>&#125;<br><br><span class="hljs-built_in">setmetatable</span>(<br>    t1,<br>    meta<br>);<br><br><span class="hljs-built_in">print</span>(t1)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&#123; 1, 2, 3 &#125; <br>[[&#123;1, 2, 3, &#125;]]<br></code></pre></td></tr></table></figure>
<p>这里说直接 <code>print()</code> 列表会输出内存地址，然而这里并没有，是不是 Lua 更新了？</p>
<h2 id="xlua" tabindex="-1" id="xLua">xLua</h2>
<h3 id="23-%E7%83%AD%E6%9B%B4%E6%96%B0%E7%AE%80%E4%BB%8B" tabindex="-1" id="23-热更新简介">23 热更新简介</h3>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p><strong>什么是冷更新</strong></p>
<p>​	开发者将测试好的代码，发布到应用商店的审核平台，平台方会进行稳定性及性能测试。测试成功后，用户即可在 AppStore，看到应用的更新信息，用户点击应用更新后，需要先关闭应用，再进行更新。</p>
<p><strong>什么是热更新</strong></p>
<p>​	广义：无需关闭应用，不停机状态下修复漏洞，更新资源等，重点是更新逻辑代码。</p>
<p>​	狭义定义（iOS 热更新）：无需将代码重新打包提交至 AppStore，即可更新客户端的执行代码，即不用下载 app 而自动更新程序。</p>
<p>​	现状：苹果禁止了 C# 的部分反射操作，禁止 JIT（即时编译，程序运行时创建并运行新代码），不允许逻辑热更新，只允许使用 AssetBundle 进行资源热更新。</p>
<p>​	注意：2017 年，苹果更新了热更新政策说明，上线后的项目，一旦发现使用热更新，一样会以下架处理。</p>
<p><img src="19.webp" alt="webp"></p>
<p><strong>常见的 Unity 热更新插件</strong></p>
<ul>
<li>
<p>sLua：最快的 Lua 插件</p>
</li>
<li>
<p>toLua：由 uLua 发展而来的，第三代 Lua 热更新方案</p>
</li>
<li>
<p>xLua：特性最先进的 Lua 插件</p>
</li>
<li>
<p>lLRuntime：纯 C# 实现的热更新插件</p>
</li>
</ul>
<p><strong>xLua</strong></p>
<p>​	接触一个新的 Lua 项目时，先要弄懂 Lua 的加载器规则，只有这样，才能弄懂项目的 Lua 执行流程。</p>
<p><strong>为什么要用 Lua 调用 C# 代码？</strong></p>
<p>​	C# 实现的系统，因为 Lua 可以调用，所以完全可以换成 Lua 实现，因为 Lua 可以即时更改，即时运行，所以游戏的代码逻辑就可以随时修改。</p>
<p><strong>实现和 C# 相同效果的系统，如何实现？</strong></p>
<p>​	Lua 调用 Unity 的各种 API，从而实现 C# 开发系统同样的效果。</p>
<p><strong>为什么要用 C# 调用 Lua 代码？</strong></p>
<p>​	Unity 是基于 C# 语言开发的，所有生命周期函数都是基于 C# 实现，xLua 本身是不存在 Unity 的相关生命周期函数的。如果希望 xLua 能够拥有生命周期函数，那么我们可以实现 C# 作为 Unity 原始调用，再使用 C# 调用 Lua 对应的方法。</p>
</div>
<p>从 <a target="_blank" rel="noopener" href="https://github.com/Tencent/xLua">Tencent/xLua: xLua is a lua programming solution for C# ( Unity, .Net, Mono) , it supports android, ios, windows, linux, osx, etc.</a> 获取 xLua 的代码放置到项目的 <code>Assets/</code> 下。</p>
<h3 id="24-xlua-%E5%9F%BA%E7%A1%80%E8%B0%83%E7%94%A8" tabindex="-1" id="24-xLua-基础调用">24 xLua 基础调用</h3>
<p>创建 <code>Assets/Scripts/Rookie/First.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;  <span class="hljs-comment">// 使用 xLUa</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">First</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-comment">// Start is called before the first frame update</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// Lua 是解释型语言，所以需要获得 Lua 的解析器</span><br>        <span class="hljs-comment">// XLua 解析器获得</span><br>        LuaEnv env = <span class="hljs-keyword">new</span> LuaEnv();<br><br>        <span class="hljs-comment">// 解释器运行 Lua 代码，把字符串当成 Lua 代码执行</span><br>        env.DoString(<span class="hljs-string">&quot;print(&#x27;Hello World!&#x27;)&quot;</span>);<br><br>        <span class="hljs-comment">// 关闭 Lua 解析器</span><br>        env.Dispose();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="20.webp" alt="webp"></p>
<p>创建 <code>Assets/Scripts/Rookie/DoString.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DoString</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-comment">// Start is called before the first frame update</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        LuaCallCSharpCode();<br>        LuaReturnData();<br>    &#125;<br><br>    <span class="hljs-comment">// 使用 Lua 调用 C# 代码</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LuaCallCSharpCode</span>()</span><br>    &#123;<br>        LuaEnv env = <span class="hljs-keyword">new</span> LuaEnv();<br>        <span class="hljs-comment">// Lua 调用 C# 代码（CS.命名空间.类名.方法名(参数)）</span><br>        env.DoString(<span class="hljs-string">&quot;CS.UnityEngine.Debug.Log(&#x27;From lua&#x27;)&quot;</span>);<br>        env.Dispose();<br>    &#125;<br><br>    <span class="hljs-comment">// Lua 返回值给 C#</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LuaReturnData</span>()</span><br>    &#123;<br>        LuaEnv env = <span class="hljs-keyword">new</span> LuaEnv();<br>        <span class="hljs-built_in">object</span>[] data = env.DoString(<span class="hljs-string">&quot;return 100, true&quot;</span>);<br><br>        Debug.Log(<span class="hljs-string">&quot;data[0] = &quot;</span> + data[<span class="hljs-number">0</span>]);<br>        Debug.Log(<span class="hljs-string">&quot;data[1] = &quot;</span> + data[<span class="hljs-number">1</span>]);<br><br>        env.Dispose();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="21.webp" alt="webp"></p>
<h3 id="25-xlua-%E7%8E%AF%E5%A2%83%E6%8E%A7%E5%88%B6" tabindex="-1" id="25-xLua-环境控制">25 xLua 环境控制</h3>
<p>创建 <code>Assets/Scripts/Rookie/Loader.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br><span class="hljs-comment">// Lua 是脚本语言，编写代码脚本是实现功能最重要的方式</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Loader</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        LuaEnv env = <span class="hljs-keyword">new</span> LuaEnv();<br>        <span class="hljs-comment">// 对应 test.lua</span><br>        <span class="hljs-comment">// 内置加载器会扫描预制的目录，查找是否存在 test.lua</span><br>        <span class="hljs-comment">// xLua 存在默认加载器，StreamingAssets 目录下可以加载文件</span><br>        env.DoString(<span class="hljs-string">&quot;require(&#x27;test&#x27;)&quot;</span>);<br>        env.Dispose();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>Assets/StreamingAssets/test.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello World!&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><img src="22.webp" alt="webp"></p>
<hr>
<p>要想修改加载 Lua 的目录：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.IO;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br><span class="hljs-comment">// Lua 是脚本语言，编写代码脚本是实现功能最重要的方式</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Loader</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        MyLoader();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyLoader</span>()</span><br>    &#123;<br>        LuaEnv env = <span class="hljs-keyword">new</span> LuaEnv();<br>        <span class="hljs-comment">// 自定义加载器，可以加载指定目录下的 lua 文件</span><br>        env.AddLoader(ProjectLoader);<br>        env.DoString(<span class="hljs-string">&quot;require(&#x27;test&#x27;)&quot;</span>);<br>        env.Dispose();<br>    &#125;<br><br>    <span class="hljs-comment">// 自定义加载器</span><br>    <span class="hljs-comment">// 当 Lua 代码执行 require() 函数时，自定义加载器会尝试获得文件的内容</span><br>    <span class="hljs-comment">// 参数：被加载 Lua 文件的路径</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">byte</span>[] <span class="hljs-title">ProjectLoader</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> <span class="hljs-built_in">string</span> filepath</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// filepath 来自于 Lua 的 require(“文件名&quot;)</span><br>        <span class="hljs-comment">// 构造路径，才能将 require 加载的文件指向我们想放 Lua 的路径下去</span><br>        <span class="hljs-built_in">string</span> path = Application.dataPath;<br>        path = path.Substring(<span class="hljs-number">0</span>, path.Length - <span class="hljs-number">7</span>) + <span class="hljs-string">&quot;/DataPath/Lua&quot;</span> + filepath + <span class="hljs-string">&quot;.lua&quot;</span>;<br>        Debug.Log(<span class="hljs-string">&quot;加载 Lua 文件：&quot;</span> + path);<br>        <span class="hljs-comment">// 将 Lua 文件读取为数组</span><br>        <span class="hljs-comment">// xLua 的解析环境，会执行我们自定义加载器返回的 Lua 代码</span><br><br>        <span class="hljs-keyword">return</span> File.ReadAllBytes(path);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="23.webp" alt="webp"></p>
<hr>
<p>全局控制 Lua 加载的路径：</p>
<p>创建 <code>Assets/Tool/xLuaEnv.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.IO;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">xLuaEnv</span><br>&#123;<br>    <span class="hljs-meta">#<span class="hljs-keyword">region</span> Singleton</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> xLuaEnv _Instance = <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-comment">// 单例的核心实现</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> xLuaEnv Instance<br>    &#123;<br>        <span class="hljs-keyword">get</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (_Instance == <span class="hljs-literal">null</span>)<br>            &#123;<br>                _Instance = <span class="hljs-keyword">new</span> xLuaEnv();<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> _Instance;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span><br><br>    <span class="hljs-meta">#<span class="hljs-keyword">region</span> Create LuaEnv</span><br><br>    <span class="hljs-keyword">private</span> LuaEnv _Env;<br><br>    <span class="hljs-comment">// 创建单例的时候，Lua 运行环境，会一起被创建</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">xLuaEnv</span>()</span><br>    &#123;<br>        _Env = <span class="hljs-keyword">new</span> LuaEnv();<br>        _Env.AddLoader(_ProjectLoader);<br>    &#125;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span><br><br>    <span class="hljs-meta">#<span class="hljs-keyword">region</span> Loader</span><br><br>    <span class="hljs-comment">// 创建自定义 Lua 加载器，这样就可以任意订制项目的 Lua 脚本的存储位置</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">byte</span>[] _ProjectLoader(<span class="hljs-keyword">ref</span> <span class="hljs-built_in">string</span> filepath)<br>    &#123;<br>        <span class="hljs-built_in">string</span> path = Application.dataPath;<br>        path = path.Substring(<span class="hljs-number">0</span>, path.Length - <span class="hljs-number">7</span>) + <span class="hljs-string">&quot;/DataPath/Lua/&quot;</span> + filepath + <span class="hljs-string">&quot;.lua&quot;</span>;<br>        Debug.Log(<span class="hljs-string">&quot;xLuaEnv: Load Lua file: &quot;</span> + path);<br><br>        <span class="hljs-keyword">if</span> (File.Exists(path))<br>        &#123;<br>            <span class="hljs-keyword">return</span> File.ReadAllBytes(path);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span><br><br>    <span class="hljs-meta">#<span class="hljs-keyword">region</span> Free LuaEnv</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Free</span>()</span><br>    &#123;<br>        <span class="hljs-comment">// 释放 LuaEnv，同时也释放单例对象，这样下次调单例对象，会再次产生 Lua 运行环境</span><br>        _Env.Dispose();<br>        _Instance = <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span><br><br>    <span class="hljs-meta">#<span class="hljs-keyword">region</span> Run Lua</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span>[] <span class="hljs-title">DoString</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> code</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> _Env.DoString(code);<br>    &#125;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/test2.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello World, I&#x27; m test2.lua&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>创建 <code>Scripts/Rookie/TestSingleton.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestSingleton</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;test2&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="24.webp" alt="webp"></p>
<h3 id="26-xlua-%E7%9A%84-lua-%E8%B0%83%E7%94%A8-c%23-1" tabindex="-1" id="26-xLua-的-Lua-调用-C-1">26 xLua 的 Lua 调用 C# 1</h3>
<p>创建 <code>Assets/Scripts/C2L/LuaCallStatic.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">HX</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestStatic</span><br>    &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> ID = <span class="hljs-number">99</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> Name<br>        &#123;<br>            <span class="hljs-keyword">get</span>;<br>            <span class="hljs-keyword">set</span>;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Output</span>()</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;static&quot;</span>;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Default</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> str = <span class="hljs-string">&quot;abc&quot;</span></span>)</span><br>        &#123;<br>            Debug.Log(str);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallStatic</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallStatic&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallStatic.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- Lua 调用静态类</span><br><br><span class="hljs-comment">-- 规则“CS.命名空间.类名称.成员变量”</span><br><span class="hljs-built_in">print</span>(CS.HX.TestStatic.ID)<br><br><span class="hljs-comment">-- 给静态属性赋值</span><br>CS.HX.TestStatic.Name = <span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-built_in">print</span>(CS.HX.TestStatic.Name)<br><br><span class="hljs-comment">-- 静态成员方法调用</span><br><span class="hljs-comment">-- 规则“CS.命名空间.类名.方法名.方法名()”</span><br><span class="hljs-built_in">print</span>(CS.HX.TestStatic.Output())<br><br><span class="hljs-comment">-- 使用默认值</span><br>CS.HX.TestStatic.Default();<br><br><span class="hljs-comment">-- 使用 Lua 传递的值</span><br>CS.HX.TestStatic.Default(<span class="hljs-string">&quot;def&quot;</span>);<br></code></pre></td></tr></table></figure>
<p><img src="25.webp" alt="webp"></p>
<h3 id="27-xlua-%E7%9A%84-lua-%E8%B0%83%E7%94%A8-c%23-2" tabindex="-1" id="27-xLua-的-Lua-调用-C-2">27 xLua 的 Lua 调用 C# 2</h3>
<p>创建 <code>Assets/Scripts/C2L/LuaCallObject.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Npc</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> HP<br>    &#123;<br>        <span class="hljs-keyword">get</span>;<br>        <span class="hljs-keyword">set</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Npc</span>()</span><br>    &#123;<br><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Npc</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span><br>    &#123;<br>        Name = name;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Output</span>()</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.Name;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallObject</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallObject&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallObject.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- Lua 实例化类</span><br><span class="hljs-comment">-- C# Npc obj = new Npc();</span><br><span class="hljs-comment">-- 通过调用构造函数创建对象</span><br><span class="hljs-keyword">local</span> obj = CS.Npc()<br>obj.HP = <span class="hljs-number">100</span><br><br><span class="hljs-built_in">print</span>(obj.HP)<br><br><span class="hljs-keyword">local</span> obj1 = CS.Npc(<span class="hljs-string">&quot;admin&quot;</span>)<br><span class="hljs-built_in">print</span>(obj1.Name)<br><br><span class="hljs-comment">-- 表方法希望调用表成员变量（表:函数()）</span><br><span class="hljs-built_in">print</span>(obj1:Output())<br><br><span class="hljs-comment">-- Lua 实例化 GameObject</span><br><span class="hljs-comment">-- C# GameObject obj = new GameObject(&quot;LuaCreateGO&quot;);</span><br><span class="hljs-keyword">local</span> go = CS.UnityEngine.GameObject(<span class="hljs-string">&quot;LuaCreateGO&quot;</span>)<br>go:AddComponent(typeof(CS.UnityEngine.BoxCollider))<br></code></pre></td></tr></table></figure>
<p><img src="26.webp" alt="webp"></p>
<hr>
<p>创建 <code>Assets/Scripts/C2L/LuaCallStruct.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> TestStruct<br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Output</span>()</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> Name;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallStruct</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallStruct&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallStruct.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 和对象调用保持一致</span><br><span class="hljs-keyword">local</span> obj = CS.TestStruct()<br><br>obj.Name = <span class="hljs-string">&quot;admin&quot;</span><br><br><span class="hljs-built_in">print</span>(obj.Name)<br></code></pre></td></tr></table></figure>
<p><img src="27.webp" alt="webp"></p>
<hr>
<p>创建 <code>Assets/Scripts/C2L/LuaCallEnum.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> TestEnum<br>&#123;<br>    LoL = <span class="hljs-number">0</span>,<br>    Dota2<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallEnum</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-comment">// Start is called before the first frame update</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallEnum&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallEnum.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- C# TestEnum.LOL</span><br><span class="hljs-comment">-- CS.命名空间.枚举名.枚举值</span><br><span class="hljs-built_in">print</span>(CS.TestEnum.LoL)<br><span class="hljs-built_in">print</span>(CS.TestEnum.Dota2)<br></code></pre></td></tr></table></figure>
<p><img src="28.webp" alt="webp"></p>
<h3 id="28-xlua-%E7%9A%84-lua-%E8%B0%83%E7%94%A8-c%23-3" tabindex="-1" id="28-xLua-的-Lua-调用-C-3">28 xLua 的 Lua 调用 C# 3</h3>
<p>创建 <code>Assets/Scripts/C2L/LuaCallOverload.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestOverload</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> id</span>)</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;数字类型：&quot;</span> + id);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;字符串类型：&quot;</span> + name);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> id, <span class="hljs-built_in">string</span> name</span>)</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;两个数值：&quot;</span> + id + <span class="hljs-string">&quot;，&quot;</span> + name);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallOverload</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallOverload&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallOverload.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua">CS.TestOverload.Test(<span class="hljs-number">99</span>)<br>CS.TestOverload.Test(<span class="hljs-string">&quot;admin&quot;</span>)<br>CS.TestOverload.Test(<span class="hljs-number">100</span>, <span class="hljs-string">&quot;root&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><img src="29.webp" alt="webp"></p>
<hr>
<p>创建 <code>Assets/Scripts/C2L/LuaCallBase.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Father</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name = <span class="hljs-string">&quot;father&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Talk</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;这是父类中的方法&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Override</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;这是父类中的虚方法&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Child</span> : <span class="hljs-title">Father</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Override</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;这是子类中的重写方法&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallBase</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallBase&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallOverload.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 调用 Father</span><br><span class="hljs-keyword">local</span> father = CS.Father()<br><span class="hljs-built_in">print</span>(father.Name)<br>father:Override()<br><br><span class="hljs-comment">-- 调用 Child</span><br><span class="hljs-keyword">local</span> child = CS.Child()<br><span class="hljs-built_in">print</span>(child.Name)<br>child:Talk()<br>child:Override()<br></code></pre></td></tr></table></figure>
<p><img src="30.webp" alt="webp"></p>
<hr>
<p>创建 <code>Assets/Scripts/C2L/LuaCallExtend.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestExtend</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Output</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;类本身带的方法&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 类扩展，需要给扩展方法编写的静态类添加 [LuaCallCSharp]，否则 Lua 无法调用到</span><br>[<span class="hljs-meta">LuaCallCSharp</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyExtend</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Show</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> TestExtend obj</span>)</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;类扩展实现的方法&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallExtend</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallExtend&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>这是 <strong>C# 的扩展方法（Extension Method）</strong> 写法，它允许你为已存在的类添加新方法，而无需修改该类的代码。</p>
<p><strong>代码解析：</strong></p>
<ol>
<li><strong><code>TestExtend</code> 类</strong>
<ul>
<li>这是一个普通的 C# 类，定义了一个 <code>Output</code> 方法。</li>
</ul>
</li>
<li><strong><code>MyExtend</code> 静态类</strong>
<ul>
<li>该类用于存放扩展方法。</li>
<li><code>Show</code> 方法是一个 <strong>扩展方法</strong>，它的第一个参数 <code>this TestExtend obj</code> 表示该方法是 <code>TestExtend</code> 类的扩展方法。</li>
</ul>
</li>
</ol>
</div>
<p>创建 <code>DataPath/Lua/C2L/LuaCallExtend.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 获取对象</span><br><span class="hljs-keyword">local</span> obj = CS.TestExtend()<br><br>obj:Output()<br><br>obj:Show()<br></code></pre></td></tr></table></figure>
<p><img src="31.webp" alt="webp"></p>
<hr>
<p>创建 <code>Assets/Scripts/C2L/LuaCallDelegate.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DelegateLua</span>()</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestDelegate</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DelegateLua Static;<br>    <span class="hljs-keyword">public</span> DelegateLua Dynamic;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">StaticFunc</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;C# 静态成员函数&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallDelegate</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallDelegate&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallDelegate.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- C# 给委托赋值</span><br><span class="hljs-comment">-- TestDelegate.Static = TestDelegate.StaticFunc</span><br><span class="hljs-comment">-- TestDelegate.Static += TestDelegate.StaticFunc</span><br><span class="hljs-comment">-- TestDelegate.Static -= TestDelegate.StaticFunc</span><br><span class="hljs-comment">-- TestDelegate.Static()</span><br><br>CS.TestDelegate.Static = CS.TestDelegate.StaticFunc<br>CS.TestDelegate.Static()<br><span class="hljs-comment">-- Lua 中如果添加了函数到静态委托变量中后，再委托不再使用后，记得释放添加的委托函数</span><br>CS.TestDelegate.Static = <span class="hljs-literal">nil</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-------------------&quot;</span>)<br><br><span class="hljs-comment">----------------------------------------------------</span><br><br><span class="hljs-keyword">local</span> func = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;这是 Lua 的函数&quot;</span>)<br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment">-- 覆盖添加委托</span><br>CS.TestDelegate.Static = func<br><span class="hljs-comment">-- 加减操作前一定要确定已经添加过回调函数</span><br>CS.TestDelegate.Static = CS.TestDelegate.Static + func<br>CS.TestDelegate.Static = CS.TestDelegate.Static - func<br><span class="hljs-comment">-- 调用以前应确定委托有值</span><br>CS.TestDelegate.Static()<br><br>CS.TestDelegate.Static = <span class="hljs-literal">nil</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-------------------&quot;</span>)<br><br><span class="hljs-comment">-----------------------------------------------------------</span><br><br><span class="hljs-comment">-- 调用前判定</span><br><span class="hljs-comment">--	if(CS.TestDelegate.Static ~= nil)</span><br><span class="hljs-comment">--	then</span><br><span class="hljs-comment">--		CS.TestDelegate.Static()</span><br><span class="hljs-comment">--	end</span><br><br><span class="hljs-comment">-- 根据委托判定赋值方法</span><br><span class="hljs-comment">--	if(CS.TestDelegate.Static == nil)</span><br><span class="hljs-comment">--	then</span><br><span class="hljs-comment">--		CS.TestDelegate.Static = func</span><br><span class="hljs-comment">--	else</span><br><span class="hljs-comment">--		CS.TestDelegate.Static = CS.TestDelegate.Static + func</span><br><span class="hljs-comment">--	end</span><br><br><span class="hljs-comment">-----------------------------------------------------------</span><br><br><span class="hljs-keyword">local</span> obj = CS.TestDelegate()<br>obj.Dynamic = func<br>obj.Dynamic()<br><br>obj.Dynamic = <span class="hljs-literal">nil</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-------------------&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><img src="32.webp" alt="webp"></p>
<hr>
<p>创建 <code>Assets/Scripts/C2L/LuaCallEvent.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EventLua</span>()</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestEvent</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">event</span> EventLua Static;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">StaticFunc</span>()</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;这是静态函数&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CallStatic</span>()</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (Static != <span class="hljs-literal">null</span>)<br>            Static();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventLua Dynamic;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CallDynamic</span>()</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (Dynamic != <span class="hljs-literal">null</span>)<br>            Dynamic();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallEvent</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallEvent&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallEvent.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- C# 添加事件 TestEvent.Static += TestEvent.StaticFunc;</span><br><br><span class="hljs-comment">-- Lua 添加事件</span><br>CS.TestEvent.Static(<span class="hljs-string">&quot;+&quot;</span>, CS.TestEvent.StaticFunc)<br>CS.TestEvent.CallStatic()<br>CS.TestEvent.Static(<span class="hljs-string">&quot;-&quot;</span>, CS.TestEvent.StaticFunc)<br><br><span class="hljs-comment">-- 添加动态成员变量</span><br><span class="hljs-keyword">local</span> func = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;来自于 Lua 的回调函数&quot;</span>)<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">local</span> obj = CS.TestEvent()<br>obj:Dynamic(<span class="hljs-string">&quot;+&quot;</span>, func)<br>obj:CallDynamic()<br>obj:Dynamic(<span class="hljs-string">&quot;-&quot;</span>, func)<br></code></pre></td></tr></table></figure>
<p><img src="33.webp" alt="webp"></p>
<h3 id="29-xlua-%E7%9A%84-lua-%E8%B0%83%E7%94%A8-c%23-4" tabindex="-1" id="29-xLua-的-Lua-调用-C-4">29 xLua 的 Lua 调用 C# 4</h3>
<p>创建 <code>Assets/Scripts/C2L/LuaCallGenericType.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestGenericType</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Output</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T data</span>)</span><br>    &#123;<br>        Debug.Log(<span class="hljs-string">&quot;泛型方法：&quot;</span> + data.ToString());<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Output</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> data</span>)</span><br>    &#123;<br>        Output&lt;<span class="hljs-built_in">int</span>&gt;(data);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Output</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> data</span>)</span><br>    &#123;<br>        Output&lt;<span class="hljs-built_in">string</span>&gt;(data);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallGenericType</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        gameObject.AddComponent&lt;BoxCollider&gt;();<br>        gameObject.AddComponent(<span class="hljs-keyword">typeof</span>(BoxCollider));<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallGenericType&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallGenericType.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> obj = CS.TestGenericType()<br><br>obj:Output(<span class="hljs-number">99</span>)<br>obj:Output(<span class="hljs-string">&quot;admin&quot;</span>)<br><br><span class="hljs-keyword">local</span> go = CS.UnityEngine.GameObject(<span class="hljs-string">&quot;LuaCreate&quot;</span>)<br>go:AddComponent(typeof(CS.UnityEngine.BoxCollider))<br></code></pre></td></tr></table></figure>
<p><img src="34.webp" alt="webp"></p>
<p><img src="35.webp" alt="webp"></p>
<hr>
<p>创建 <code>Assets/Scripts/C2L/LuaCallOutRef.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> UnityEngine;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestOurRef</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Func1</span>()</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Func1&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Func2</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> str1, <span class="hljs-keyword">out</span> <span class="hljs-built_in">string</span> str2</span>)</span><br>    &#123;<br>        str2 = <span class="hljs-string">&quot;Func2 out&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Func2&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Func3</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> str1, <span class="hljs-keyword">ref</span> <span class="hljs-built_in">string</span> str2</span>)</span><br>    &#123;<br>        str2 = <span class="hljs-string">&quot;Func3 Ref&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Func3&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Func4</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> <span class="hljs-built_in">string</span> str1, <span class="hljs-built_in">string</span> str2</span>)</span><br>    &#123;<br>        str1 = <span class="hljs-string">&quot;Func4 Ref&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Func4&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LuaCallOutRef</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;C2L/LuaCallOutRef&#x27;)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/C2L/LuaCallOutRef.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> r1 = CS.TestOutRef.Func1()<br><span class="hljs-built_in">print</span>(r1)<br><br><span class="hljs-comment">-- C# out 返回的变量，会赋值给 Lua 的第二接收返回值变量</span><br><span class="hljs-keyword">local</span> out2<br><span class="hljs-keyword">local</span> r2, out1 = CS.TestOutRef.Func2(<span class="hljs-string">&quot;admin&quot;</span>, out2)<br><span class="hljs-built_in">print</span>(r2, out1, out2)<br><br><span class="hljs-comment">-- C# ref 返回的变量，会赋值给 Lua 的第二个接受返回值变量</span><br><span class="hljs-keyword">local</span> ref2<br><span class="hljs-keyword">local</span> r3, ref1 = CS.TestOutRef.Func3(<span class="hljs-string">&quot;root&quot;</span>, ref2)<br><span class="hljs-built_in">print</span>(r2, ref1, ref2)<br><br><span class="hljs-comment">-- 即使 out ref 作为第一个参数，其结果依然会以 Lua 的多个返回值进行返回</span><br><span class="hljs-keyword">local</span> ref4<br><span class="hljs-keyword">local</span> r4, ref3 = CS.TestOutRef.Func4(ref4, <span class="hljs-string">&quot;test&quot;</span>)<br><span class="hljs-built_in">print</span>(r4, ref3, ref4)<br></code></pre></td></tr></table></figure>
<p><img src="36.webp" alt="webp"></p>
<h3 id="31-c%23-%E8%B0%83%E7%94%A8-lua-%E6%96%B9%E6%B3%95-1" tabindex="-1" id="31-C-调用-Lua-方法-1">31 C# 调用 Lua 方法 1</h3>
<p>编辑 <code>Assets/Scripts/Tool/xLuaEnv.lua</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CsharpCallVariable</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;L2C/CSharpCallVariable&#x27;)&quot;</span>);<br>        <span class="hljs-comment">// LuaEnv 提供了一个成员变量 Global，它可以用于 C# 获取的 Lua 全局变量</span><br>        <span class="hljs-comment">// Global 的数据类型是 C# 实现的 LuaTable，LuaTable 是 xLua 实现的 C# 和 Lua 中表对应的数据结构</span><br>        <span class="hljs-comment">// xLua 会将 Lua 中的全局变量以 Table 的方式全部存储在 Global 中</span><br>        <span class="hljs-comment">// 通过运行环境，导出全局变量，类型是 LuaTable</span><br>        LuaTable g = xLuaEnv.Instance.Global;<br><br>        <span class="hljs-comment">// 从 Lua 中，将全局变量提取出来</span><br>        <span class="hljs-comment">// 参数：Lua 中全局变量的名称</span><br>        <span class="hljs-comment">// 类型：Lua 中全局变量的名称所对应的类型</span><br>        <span class="hljs-comment">// 返回值：变量的值</span><br>        <span class="hljs-built_in">int</span> num = g.Get&lt;<span class="hljs-built_in">int</span>&gt;(<span class="hljs-string">&quot;num&quot;</span>);<br>        <span class="hljs-built_in">float</span> rate = g.Get&lt;<span class="hljs-built_in">float</span>&gt;(<span class="hljs-string">&quot;rate&quot;</span>);<br>        <span class="hljs-built_in">bool</span> isWoman = g.Get&lt;<span class="hljs-built_in">bool</span>&gt;(<span class="hljs-string">&quot;isWoman&quot;</span>);<br>        <span class="hljs-built_in">string</span> name = g.Get&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&quot;name&quot;</span>);<br><br>        Debug.Log(<span class="hljs-string">&quot;数字：&quot;</span> + num);<br>        Debug.Log(<span class="hljs-string">&quot;浮点数：&quot;</span> + rate);<br>        Debug.Log(<span class="hljs-string">&quot;布尔：&quot;</span> + isWoman);<br>        Debug.Log(<span class="hljs-string">&quot;字符串：&quot;</span> + name);<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>Assets/Scripts/L2C/CsharpCallVariable.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CsharpCallVariable</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;L2C/CSharpCallVariable&#x27;)&quot;</span>);<br>        <span class="hljs-comment">// LuaEnv 提供了一个成员变量 Global，它可以用于 C# 获取的 Lua 全局变量</span><br>        <span class="hljs-comment">// Global 的数据类型是 C# 实现的 LuaTable，LuaTable 是 xLua 实现的 C# 和 Lua 中表对应的数据结构</span><br>        <span class="hljs-comment">// xLua 会将 Lua 中的全局变量以 Table 的方式全部存储在 Global 中</span><br>        <span class="hljs-comment">// 通过运行环境，导出全局变量，类型是 LuaTable</span><br>        LuaTable g = xLuaEnv.Instance.Global;<br><br>        <span class="hljs-comment">// 从 Lua 中，将全局变量提取出来</span><br>        <span class="hljs-comment">// 参数：Lua 中全局变量的名称</span><br>        <span class="hljs-comment">// 类型：Lua 中全局变量的名称所对应的类型</span><br>        <span class="hljs-comment">// 返回值：变量的值</span><br>        <span class="hljs-built_in">int</span> num = g.Get&lt;<span class="hljs-built_in">int</span>&gt;(<span class="hljs-string">&quot;num&quot;</span>);<br>        <span class="hljs-built_in">float</span> rate = g.Get&lt;<span class="hljs-built_in">float</span>&gt;(<span class="hljs-string">&quot;rate&quot;</span>);<br>        <span class="hljs-built_in">bool</span> isWoman = g.Get&lt;<span class="hljs-built_in">bool</span>&gt;(<span class="hljs-string">&quot;isWoman&quot;</span>);<br>        <span class="hljs-built_in">string</span> name = g.Get&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&quot;name&quot;</span>);<br><br>        Debug.Log(<span class="hljs-string">&quot;数字：&quot;</span> + num);<br>        Debug.Log(<span class="hljs-string">&quot;浮点数：&quot;</span> + rate);<br>        Debug.Log(<span class="hljs-string">&quot;布尔：&quot;</span> + isWoman);<br>        Debug.Log(<span class="hljs-string">&quot;字符串：&quot;</span> + name);<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/L2C/CsharpCallVariable.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua">num = <span class="hljs-number">100</span><br>rate = <span class="hljs-number">99.99</span><br>isWoman = <span class="hljs-literal">false</span><br>name = <span class="hljs-string">&quot;admin&quot;</span><br></code></pre></td></tr></table></figure>
<p><img src="37.webp" alt="webp"></p>
<h3 id="32-c%23-%E8%B0%83%E7%94%A8-lua-%E6%96%B9%E6%B3%95-2" tabindex="-1" id="32-C-调用-Lua-方法-2">32 C# 调用 Lua 方法 2</h3>
<p>创建 <code>Assets/Scripts/L2C/CSharpCallFunction.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br>[<span class="hljs-meta">CSharpCallLua</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Func1</span>()</span>;<br>[<span class="hljs-meta">CSharpCallLua</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Func2</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span>;<br>[<span class="hljs-meta">CSharpCallLua</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Func3</span>()</span>;<br>[<span class="hljs-meta">CSharpCallLua</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Func4</span>(<span class="hljs-params"><span class="hljs-keyword">out</span> <span class="hljs-built_in">string</span> name, <span class="hljs-keyword">out</span> <span class="hljs-built_in">int</span> id</span>)</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CSharpCallFunction</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;L2C/CSharpCallFunction&#x27;)&quot;</span>);<br><br>        LuaTable g = xLuaEnv.Instance.Global;<br><br>        Func1 func1 = g.Get&lt;Func1&gt;(<span class="hljs-string">&quot;func1&quot;</span>);<br>        func1();<br><br>        Func2 func2 = g.Get&lt;Func2&gt;(<span class="hljs-string">&quot;func2&quot;</span>);<br>        func2(<span class="hljs-string">&quot;admin&quot;</span>);<br><br>        Func3 func3 = g.Get&lt;Func3&gt;(<span class="hljs-string">&quot;func3&quot;</span>);<br>        Debug.Log(func3() + <span class="hljs-string">&quot;，被 C# 打印&quot;</span>);<br><br>        <span class="hljs-comment">// 这里是关键</span><br>        Func4 func4 = g.Get&lt;Func4&gt;(<span class="hljs-string">&quot;func4&quot;</span>);<br><br>        <span class="hljs-built_in">string</span> name;<br>        <span class="hljs-built_in">int</span> id;<br>        func4(<span class="hljs-keyword">out</span> name, <span class="hljs-keyword">out</span> id);<br><br>        Debug.Log(name + <span class="hljs-string">&quot;, &quot;</span> + id);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/L2C/CSharpCallFunction.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs lua">func1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;这是 Lua 中的 func1&quot;</span>)<br><span class="hljs-keyword">end</span><br><br>func2 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;这是 Lua 中的 func2，参数是：&quot;</span>.. name)<br><span class="hljs-keyword">end</span><br><br>func3 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;这是 Lua 中的 func3&quot;</span>)<br><span class="hljs-keyword">end</span><br><br>func4 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;这是 Lua 中的 func4&quot;</span>, <span class="hljs-number">100</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<p>编译一下：</p>
<p><img src="38.webp" alt="webp"></p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p><strong>XLua 默认不会支持 <code>out</code> 参数的委托</strong>，必须手动标记 <code>[CSharpCallLua]</code>。</p>
<p><strong>运行 <code>XLua/Generate Code</code>，然后重启 Unity</strong>，让 XLua 重新生成绑定代码。</p>
<p><strong>如果你需要调用多个 Lua 方法，推荐使用接口</strong> 来管理，而不是单独获取每个方法。</p>
</div>
<p><img src="39.webp" alt="webp"></p>
<h3 id="33-c%23-%E8%B0%83%E7%94%A8-lua-%E6%96%B9%E6%B3%95-3" tabindex="-1" id="33-C-调用-Lua-方法-3">33 C# 调用 Lua 方法 3</h3>
<p>创建 <code>Assets/Scripts/L2C/CSharpCallTable.cs</code>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System.Collections;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> UnityEngine;<br><span class="hljs-keyword">using</span> XLua;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OneStringParams</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span>;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-built_in">string</span> <span class="hljs-title">OneStringReturn</span>()</span>;<br><span class="hljs-comment">// 针对结构体调用后添加</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TransSelf</span>(<span class="hljs-params">LuaTable table</span>)</span>;<br>[<span class="hljs-meta">CSharpCallLua</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TransMy</span>(<span class="hljs-params">LuaCore table</span>)</span>;<br><br><span class="hljs-comment">// Lua 的 table 导出到 C# 的结构体，可以实现 C# 运行时无 GC</span><br>[<span class="hljs-meta">GCOptimize</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> LuaCore<br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> ID;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsWoman;<br><br>    <span class="hljs-keyword">public</span> OneStringParams Func1;<br>    <span class="hljs-keyword">public</span> OneStringReturn Func2;<br>    <span class="hljs-keyword">public</span> TransMy Func3;<br>    <span class="hljs-keyword">public</span> TransMy Func4;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CsharpCallTable</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.DoString(<span class="hljs-string">&quot;require(&#x27;L2C/CsharpCallTable&#x27;)&quot;</span>);<br>        UseLuaTable();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UseLuaTable</span>()</span><br>    &#123;<br>        LuaTable g = xLuaEnv.Instance.Global;<br><br>        <span class="hljs-comment">// 获取的是全局变量 Core，因为它在 Lua 中是表，所以取出的是 LuaTable</span><br>        LuaTable core = g.Get&lt;LuaTable&gt;(<span class="hljs-string">&quot;Core&quot;</span>);<br>        <span class="hljs-comment">// 获取 Name</span><br>        <span class="hljs-comment">// 参数：table 中索引名</span><br>        <span class="hljs-comment">// 类型：索引对应值的类型</span><br>        Debug.Log(core.Get&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&quot;Name&quot;</span>));<br><br>        core.Set&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&quot;Name&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>);<br><br>        OneStringParams osp = core.Get&lt;OneStringParams&gt;(<span class="hljs-string">&quot;Func1&quot;</span>);<br>        osp(<span class="hljs-string">&quot;admin&quot;</span>);<br><br>        <span class="hljs-comment">// 调用 Func2（Lua 函数返回字符串）</span><br>        OneStringReturn func2 = core.Get&lt;OneStringReturn&gt;(<span class="hljs-string">&quot;Func2&quot;</span>);<br>        <span class="hljs-built_in">string</span> result = func2();  <span class="hljs-comment">// 调用 Lua 函数</span><br>        Debug.Log(<span class="hljs-string">&quot;Func2 返回: &quot;</span> + result);<br><br>        <span class="hljs-comment">// 调用 Func3（传递 LuaTable 作为 self 参数）</span><br>        TransSelf func3 = core.Get&lt;TransSelf&gt;(<span class="hljs-string">&quot;Func3&quot;</span>);<br>        func3(core); <span class="hljs-comment">// 传递 core 作为 self</span><br><br>        <span class="hljs-comment">// 相当于“:”调用</span><br>        TransSelf ts = core.Get&lt;TransSelf&gt;(<span class="hljs-string">&quot;Func4&quot;</span>);<br>        ts(core);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>()</span><br>    &#123;<br>        xLuaEnv.Instance.Free();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>创建 <code>DataPath/Lua/L2C/CSharpCallTable.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs lua">Core = &#123;&#125;<br><br>Core.ID = <span class="hljs-number">100</span><br>Core.Name = <span class="hljs-string">&quot;root&quot;</span><br>Core.IsWoman = <span class="hljs-literal">false</span><br><br>Core.Func1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;这是 Core 表的 Func1 函数，接收到 C# 数据&quot;</span> .. name)<br><span class="hljs-keyword">end</span><br><br>Core.Func2 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;这是 Core 表的 Func2 函数&quot;</span><br><span class="hljs-keyword">end</span><br><br>Core.Func3 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(self)</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;这是 Core 表的 Func3 函数，Core 表的成员变量 Name 是 &quot;</span> .. <span class="hljs-built_in">self</span>.Name)<br><span class="hljs-keyword">end</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Core:Func4</span><span class="hljs-params">()</span></span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;这是 Core 表的 Func4 方法，Core 表的成员变量 Name 是 &quot;</span> .. <span class="hljs-built_in">self</span>.Name)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<p>编译一下：</p>
<p><img src="38.webp" alt="webp"></p>
<p><img src="40.webp" alt="webp"></p>

            </article>
            
	<div class="rightside">
	
		<div class="rightside-button" id="js-aside">
			<span>
				<img no-lazy src="/images/icon/aside.png" class="rightside-button-icon" alt="Icon">
			</span>
		</div>
		<script>
			$("#js-aside").click(function () {
				onShowAsideButton();
			});
		</script>
	
	<div class="rightside-button" id="js-toggle_theme">
		<span>
			<img no-lazy src="/images/icon/toggle_theme.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	
<script src="/js/plugins/goto_position.js"></script>

	
	<div class="rightside-button" id="js-go_top">
		<span>
			<img no-lazy src="/images/icon/go_top.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>
	<div class="rightside-button" id="js-go_bottom">
		<span>
			<img no-lazy src="/images/icon/go_bottom.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	<script>
		setToggleThemeButtonListener();
	</script>
	<script>
		$('#js-go_top')
		.gotoPosition( {
			speed: 300,
			target: 'top',
		} );
		$('#js-go_bottom')
		.gotoPosition( {
			speed: 300,
			target: 'bottom',
		} );
	</script>
</div>


<div class="post-bottom">
    
        <div class="post-paging">     
            <div class="post-paging-last">
                
                    <a href="/posts/Js-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%20hexo-blog-encrypt/">
                        上一篇：Js-暴力破解 hexo-blog-encrypt
                    </a>
                
            </div>
            <div class="post-paging-next">
                
                    <a href="/posts/Diary-%E8%B1%AB%E4%BA%86/">
                        下一篇：Diary-豫了
                    </a>
                
            </div>
        </div>
    
    
    
        
            <div class="giscus comments"></div>
            <script>
                var scriptElement = document.createElement('script');
                scriptElement.src = 'https://giscus.app/client.js';
                scriptElement.setAttribute('data-repo', 'GZ-Metal-Cell/GZ-Metal-Cell.github.io');
                scriptElement.setAttribute('data-repo-id', 'R_kgDOIHLEOQ');
                scriptElement.setAttribute('data-category', 'Announcements');
                scriptElement.setAttribute('data-category-id', 'DIC_kwDOIHLEOc4CcVwP');
                scriptElement.setAttribute('data-mapping', 'title');
                scriptElement.setAttribute('data-strict', '1');
                scriptElement.setAttribute('data-reactions-enabled', '');
                scriptElement.setAttribute('data-emit-metadata', '0');
                scriptElement.setAttribute('data-input-position', 'bottom');
                scriptElement.setAttribute('data-theme', localStorage.getItem('theme') === 'light' ? 'light' : 'dark_high_contrast');
                scriptElement.setAttribute('data-lang', 'zh-CN');
                
                scriptElement.setAttribute('crossorigin', 'anonymous');
                scriptElement.async = true;
                document.head.appendChild(scriptElement);
            </script>
        
    
</div>
        </div>
    </main>
    
        <aside class="main-aside">
    
<script src="/js/widgets/aside.js"></script>

    <script>
        showAside();
    </script>

    <div class="aside-top">
        <div class="aside-top-about aside-card">
            <a href="/about" class="aside-top-about-portrait">
                <img no-lazy src="/about/portrait.png" alt="Q">
            </a>
            <div class="aside-top-about-info">
                <span class="author"> Zi-Zi</span>
                <span class="description">不以物喜，不以己悲。</span>
            </div>              
            <div class="aside-top-about-site">
                <a href="/categories" class="aside-top-about-site-item">
                    <span class="title">类别</span>
                    <span class="count">5</span>
                </a>
                <a href="/tags" class="aside-top-about-site-item">
                    <span class="title">标签</span>
                    <span class="count">122</span>
                </a>
                <a href="/archives" class="aside-top-about-site-item">
                    <span class="title">归档</span>
                    <span class="count">438</span>
                </a>
            </div>
            <div class="aside-top-about-contact">
                
                    
                        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
                            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
                            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
                            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
                            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
                        </a>
                    
                
            </div>
        </div> 

        
    </div>

    <div class="aside-bottom">
        
            <script>
                
                    const tocCollapsed = true;
                
                
                    const tocDepth = 6;
                
                var headerString = '';
                for (let i = 1; i <= tocDepth; i++) {
                    if (i === 1) {
                        headerString += 'h1';
                    } else {
                        headerString += ', h' + i;
                    }
                }
                hbeToc();
            </script>
            <div class="aside-bottom-toc aside-card">
                <div class="aside-bottom-toc-title">
                    <h1>目录</h1>
                    <span class="toc-percentage"></span>
                </div>
                <ol class="aside-bottom-toc-content"></ol>
            </div>
        
    </div>
</aside>
    
</div>
		<footer>
	<div class="content">
		
			<span>©2022-2025&nbsp;By&nbsp;<a href="/about">Zi-Zi</a>.</span>
		
		<span><a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> theme by <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell/hexo-theme-quieter">Quieter</a>.</span>
		
			<span style="display: flex;">
				<img no-lazy alt="icp" src="/images/icp_icon.png" style="width: 16px; height: 16px;">
				<a href="https://icp.gov.moe/?keyword=20241647" target="_blank">萌 ICP 备 20241647 号</a>
			</span>
		
	</div>

	
<script src="/js/plugins/ref.js"></script>

	
<script src="/js/plugins/highlight_tools.js"></script>

	<script>
		const  COPY_ICON = "/images/icon/copy.png";
		const CLOSE_CODE_BLOCK_ICON = "/images/icon/close_code_block.png";
		const HIGHLIGHT_SHRINK = "";
		const HIGHLIGHT_HEIGHT_LIMIT = "";
	</script>

	
	
	<!-- Analytics -->

    
        <!-- Busuanzi Analytics -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?e57cf62289f84322ebff116e8b3d343e";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    


	

	

    
		
<link rel="stylesheet" href="/css/plugins/textIndent.css">

		
<script src="/js/plugins/textIndent.js"></script>

	

	
	
	
		<script>
			if (typeof init === 'function') {
				init();
			}
		</script>
	

	
		
	

	

	<!--
		
<script src="/js/plugins/jquery.pjax.min.js"></script>

		<script>
			$(document).pjax('a[target!=_blank]', 'main', {
				fragment: 'main',
				timeout: 8000
			});

			$(document).on('pjax:complete', function() {
			});
		</script> 
	-->
	<script>
		console.log('\n %c Hexo-Quieter 主题 %c https://github.com/GZ-Metal-Cell/hexo-theme-quieter \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
	</script>
</footer>
	</body>

	<!-- Hexo-Quieter 主题  https://github.com/GZ-Metal-Cell/hexo-theme-quieter -->
</html>

