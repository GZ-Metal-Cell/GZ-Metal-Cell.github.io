<!DOCTYPE html>
<html lang=zh-CN data-theme="light">
	
<script src="/js/plugins/toggleTheme.js"></script>

	<script>
		setTheme();
	</script>
	<head>
		
<title>Shader-GLSL | Zi-Zi's Journey</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/images/icon/favicon.ico">
<link href="/css/plugins/print.css" media="print" rel="stylesheet" />

<link rel="stylesheet" href="/css/index.css">



<meta name="keywords" content="JavaScript,GLSL,Shader,">
<meta name="description" content="我要学习游戏特效技术！">



<script src="/js/plugins/jquery.min.js"></script>


<script src="/js/plugins/hljs.min.js"></script>


<script src="/js/plugins/init.js"></script>


<script src="/js/plugins/hide.js"></script>


<script src="/js/plugins/tabs.js"></script>



    



    
<script src="/js/plugins/alert-title.js"></script>

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-base.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-dark-class.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-light.css">




    
        
            <link href="/css/fontawesome/css/all.min.css" rel="stylesheet">
        
            <link rel="stylesheet" type="text/css" href="/css/codeFileTools.css">
        
            <link rel="stylesheet" href="/css/jsTreeList.css"/>
        
            <link rel="stylesheet" href="/js/jsTree/dist/themes/default/style.min.css"/>
        
            <link rel="stylesheet" href="/css/codeFileTree.css"/>
        
            <script src="/js/jsTree/dist/jstree.min.js"></script>
        
            <script src="/js/highlightjs.js"></script>
        
            <script src="/js/highlightjs-line-numbers.min.js"></script>
        
            <script src="/js/codeFile.js"></script>
        
            <script src="/js/codeFileTools.js"></script>
        
            <script src="/js/codeFileTree.js"></script>
        
    



    

	<meta name="generator" content="Hexo 6.1.0"></head>

	<body>
		<header class="sticky-header">
	<nav>
		<div class="nav-left">
			<a href="/" class="logo">
				<img no-lazy src="/images/headers_icon/logo.webp" alt="Quieter">
			</a>
			<ul class="breadcrumb" id="breadcrumb"></ul>
		</div>
		<div class="nav-right">
			<ul>
				
					<li>
						<a href="/">
						  主页
						</a>
					</li>
				
					<li>
						<a href="/categories">
						  类别
						</a>
					</li>
				
					<li>
						<a href="/tags">
						  标签
						</a>
					</li>
				
					<li>
						<a href="/archives">
						  归档
						</a>
					</li>
				
					<li>
						<a href="/galleries">
						  相册
						</a>
					</li>
				
					<li>
						<a href="/links">
						  链接
						</a>
					</li>
				
					<li>
						<a href="/about">
						  关于
						</a>
					</li>
								  
			</ul>
		</div>
		<div class="nav-right-close">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
				<path fill="none" d="M0 0h24v24H0z" />
				<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
			</svg>
		</div>

		<div class="sidebar">
    <div class="topo">
        <p>Zi-Zi's Journey</p>
    </div>
    <ul>
        
        <li>
            <a href="/">
                主页
            </a>
        </li>
        
        <li>
            <a href="/categories">
                类别
            </a>
        </li>
        
        <li>
            <a href="/tags">
                标签
            </a>
        </li>
        
        <li>
            <a href="/archives">
                归档
            </a>
        </li>
        
        <li>
            <a href="/galleries">
                相册
            </a>
        </li>
        
        <li>
            <a href="/links">
                链接
            </a>
        </li>
        
        <li>
            <a href="/about">
                关于
            </a>
        </li>
        
    </ul>
    <div class="sidebar-footer">
        
        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
        </a>
        
    </div>
</div>
<div class='shelter'>
    <script>
        $(function() {
            $('.nav-right-close > svg').click(function() {
                $('.sidebar').animate({
                    right: "0"
                }, 500);
                $('.shelter').fadeIn("slow");
            
                var element = $('.topo');
                element.addClass('custom-style');
            
                var links = null;
                if ("") {
                    links = "".split(',');
                } else {
                    links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
                }
            
                var randomLink = links[Math.floor(Math.random() * links.length)];
                element.css('background-image', "url('" + randomLink + "')");
            });
          
            $('.shelter').click(function(e) {
                $('.sidebar').animate({
                    right: "-100%"
                }, 500);
                $('.shelter').fadeOut("slow");
            });
        });      
    </script>
</div>
	</nav>

	
		<div class="header-background"></div>
	

	<script>
		const name = 'post';
		const ul = document.querySelectorAll('.nav-right ul')[0];
		const lis = ul.querySelectorAll('li');

		if (name == 'home') {
			lis[0].classList.add('select');
		} else {
			for (let i = 0; i < lis.length; i++) {
				const li = lis[i];
				const a = li.querySelector('a');
				if (name === a.href.split('/')[3]) {
					li.classList.add('select');
				}
			}
		}
	</script>
	
	<script>
		var element = document.querySelector('.header-background');
		if(element) {
			element.classList.add('custom-style');
			var links = null;
			if("")
			{
				links = "".split(',');
			} else
			{
				links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
			}
			var randomLink = links[Math.floor(Math.random() * links.length)];
			element.style.backgroundImage = "url('" + randomLink + "')";
		}
	</script>

	
<script src="/js/plugins/breadcrumb.js"></script>

	<script>
		var menus_title = [];
		
			menus_title.push({home: '主页'});
		
			menus_title.push({categories: '类别'});
		
			menus_title.push({tags: '标签'});
		
			menus_title.push({archives: '归档'});
		
			menus_title.push({galleries: '相册'});
		
			menus_title.push({links: '链接'});
		
			menus_title.push({about: '关于'});
		
		
			
				postsBreadcrumb(
					document.getElementById('breadcrumb'),
					"类别",
					"/categories",
					"学习",
					"/categories/学习",
					1
				);
			
		
	</script>
</header>

<div class="main-wrapper">
    <main class="post">
        <header class="main-header">
	
		
			
				
<link rel="stylesheet" href="/css/plugins/fancybox.css">

				
<script src="/js/plugins/fancybox.umd.js"></script>

				
<script src="/js/plugins/fancybox.js"></script>

			
			<div class="post-header-background-content">
				<ul class="post-header-tag">
					
						
							<li><a href="/tags/JavaScript"><span>JavaScript</span></a></li>
						
							<li><a href="/tags/GLSL"><span>GLSL</span></a></li>
						
							<li><a href="/tags/Shader"><span>Shader</span></a></li>
						
					
				</ul>
				
				<h1>Shader-GLSL</h1>
		
				
					<div class="post-header-desc">
						<svg t="1714702231661" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1154" xmlns:xlink="http://www.w3.org/1999/xlink"
						width="20" height="20">
						<path
							d="M778.24 117.76A46.08 46.08 0 0 1 824.32 163.84v430.08c0 8.4992-4.13696 16.01536-10.50624 20.6848l-0.24576 0.2048L587.5712 846.09024a35.84 35.84 0 0 1-61.48096-25.06752v-220.9792a46.08 46.08 0 0 1 46.08-46.08l200.94976-0.02048V168.96h-522.24v686.08H389.12c13.25056 0 24.1664 10.07616 25.47712 22.97856l0.12288 2.62144c0 14.1312-11.4688 25.6-25.6 25.6h-143.36A46.08 46.08 0 0 1 199.68 860.16V163.84A46.08 46.08 0 0 1 245.76 117.76h532.48z m-26.78784 487.38304h-174.16192v178.176l174.16192-178.176z m-45.19936-169.94304a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z m0-122.88a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z"
							fill="#ffffff" p-id="1155"></path>
						</svg>
						<p>我要学习游戏特效技术！</p>
					</div>
				
		
				<div class="post-header-info">
					<svg t="1604839279282" class="icon" viewBox="0 0 1024 1024" version="1.1"
					xmlns="http://www.w3.org/2000/svg" p-id="2901" width="20" height="20">
						<path
							d="M513 956.3c-247.7 0-448-200.3-448-448S265.3 66.2 513 66.2s448 200.3 448 448-200.3 442.1-448 442.1z m0-830.9c-212.2 0-388.8 170.7-388.8 388.8C124.2 726.3 294.9 903 513 903c212.2 0 388.8-170.7 388.8-388.8S725.2 125.4 513 125.4z m0 430.2c-94.2 0-170.7-76.5-170.7-170.7S418.8 207.8 513 207.8s170.7 76.5 170.7 170.7S607.2 555.6 513 555.6z m0-289.1c-64.6 0-112 52.8-112 112s47.4 117.9 112 117.9 112-52.8 112-112-47.4-117.9-112-117.9z m0 689.8c-135.7 0-259-58.7-341.9-158.9l-11.8-17.8 11.8-17.8c76.5-117.9 206.2-188.5 347.8-188.5 135.7 0 265 64.6 341.9 182.6l11.8 17.8-11.8 17.8C778 897.1 648.7 956.3 513 956.3zM230.3 773.2C300.9 849.7 406.9 897 513 897c112 0 218.1-47.4 288.6-129.8-70.5-88.2-170.7-135.6-282.7-135.6s-218.1 53.3-288.6 141.6z"
							p-id="2902" fill="#ffffff"></path>
					</svg>
					<div class="post-header-info-author">
						<a href="/about">Zi-Zi</a>
					</div>
					
						<div class="post-header-info-categories">
							
								<a href="/categories/学习">学习</a>
							
						</div>
					
					<time>2024/12/08 13:02:00</time>
				</div>
		
				
					<div class="post-header-stat">
						<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve" width="20" height="20">
							<path fill="#FFFFFF" d="M187.2,165.6c0,2.6-2.1,4.7-4.7,4.7H17.5c-2.6,0-4.7-2.1-4.7-4.7s2.1-4.7,4.7-4.7h165.1
								C185.2,160.9,187.2,163,187.2,165.6z"/>
							<path fill="#FFFFFF" d="M17.5,29.7c2.6,0,4.7,2.1,4.7,4.7v131.2c0,2.6-2.1,4.7-4.7,4.7s-4.7-2.1-4.7-4.7V34.4
								C12.8,31.8,14.9,29.7,17.5,29.7z M77.9,91.5c1.8,1.8,1.8,4.8,0,6.6l-39.8,39.8c-1.9,1.8-4.9,1.7-6.6-0.2c-1.7-1.8-1.7-4.6,0-6.4
								l39.8-39.8C73.1,89.6,76,89.6,77.9,91.5z M169.9,70.2c1.6,2.1,1.1,5-0.9,6.5c0,0,0,0,0,0l-64.2,48.2c-2.1,1.5-5,1.1-6.6-0.9
								c-1.6-2.1-1.1-5,0.9-6.5c0,0,0,0,0,0l64.2-48.2C165.4,67.7,168.3,68.1,169.9,70.2L169.9,70.2z"/>
							<path fill="#FFFFFF" d="M104.6,124.5c-1.8,1.8-4.8,1.8-6.6,0L71.6,98.1c-1.8-1.8-1.8-4.8,0-6.6c1.8-1.8,4.8-1.8,6.6,0l26.3,26.3
								C106.4,119.6,106.4,122.6,104.6,124.5C104.6,124.4,104.6,124.4,104.6,124.5z"/>
						</svg>
		
						
							
<script src="/js/plugins/wordCount.js"></script>

							<p class="post-count">文字数：---</p>
						
		
						
							<p id="busuanzi_container_page_pv" style='display:none;'>阅读数：<span id="busuanzi_value_page_pv"></span></p>
						
					</div>
				
			</div>
		
	
</header>
        <div class="post-content article-container">
            <article class="post-content-info">
                <h1 id="%E8%B5%84%E6%BA%90" tabindex="-1">资源</h1>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1kP4y1Y7MT/">从头开始学习 GLSL 着色器 Learn GLSL Shaders from Scratch_哔哩哔哩_bilibili</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://github.com/NikLever/GLSLfromScratch">NikLever/GLSLfromScratch: Resources for my Udemy course</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://codepen.io/collection/ngRMbq/">GLSL Shaders - a Collection by Nik Lever on CodePen</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Games/Techniques/3D_on_the_web/GLSL_Shaders">GLSL 着色器 - 游戏开发 | MDN</a></p>
</li>
</ul>
<h1 id="%E5%89%8D%E8%A8%80" tabindex="-1">前言</h1>
<p>​	<strong>Shader（着色器）</strong> 是用于图形渲染的程序，用于描述如何在 GPU（图形处理单元）上处理图形数据。着色器是现代图形学的重要组成部分，允许开发者对 3D 图形、动画和效果进行高效且灵活的控制。</p>
<h2 id="shader-%E7%9A%84%E5%88%86%E7%B1%BB" tabindex="-1" id="Shader-的分类">Shader 的分类</h2>
<p>​	根据执行阶段的不同，Shader 主要分为以下几类：</p>
<ol>
<li><strong>顶点着色器（Vertex Shader）</strong>
<ul>
<li>作用：处理顶点数据（如位置、法线、纹理坐标）。</li>
<li>功能：负责将顶点从模型空间变换到屏幕空间，同时可以传递数据给后续阶段（如纹理坐标等）。</li>
<li>示例用途：旋转、缩放、位移顶点。</li>
</ul>
</li>
<li><strong>片段着色器（Fragment Shader）</strong>
<ul>
<li>作用：处理屏幕上每个像素的颜色。</li>
<li>功能：负责计算像素的最终颜色值，可以应用光照、纹理、透明度等。</li>
<li>示例用途：实现材质效果、光照模型、后处理效果。</li>
</ul>
</li>
<li><strong>几何着色器（Geometry Shader）</strong>
<ul>
<li>作用：可以生成或修改几何体。</li>
<li>功能：处理图元（如点、线、三角形）的形状，可以创建额外的顶点或完全改变输入的图元。</li>
<li>示例用途：实现细节层次（LOD）、生成草丛或粒子系统。</li>
</ul>
</li>
<li><strong>计算着色器（Compute Shader）</strong>
<ul>
<li>作用：不限定于图形渲染，用于在 GPU 上执行通用计算任务。</li>
<li>功能：可以用于并行计算，如模拟物理效果、处理大规模数据。</li>
<li>示例用途：粒子系统模拟、图像处理。</li>
</ul>
</li>
<li><strong>曲面细分着色器（Tessellation Shader）</strong>
<ul>
<li>包括：
<ul>
<li><strong>细分控制着色器（Tessellation Control Shader）</strong></li>
<li><strong>细分评价着色器（Tessellation Evaluation Shader）</strong></li>
</ul>
</li>
<li>功能：用于细分曲面，增加几何体的细节。</li>
<li>示例用途：实现平滑曲面或动态细分网格。</li>
</ul>
</li>
<li><strong>着色器管线中的其他阶段</strong>
<ul>
<li><strong>裁剪着色器（Clipping Shader）</strong></li>
<li><strong>光线追踪着色器（Raytracing Shader）</strong> 等。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="shader-%E7%9A%84%E8%AF%AD%E8%A8%80" tabindex="-1" id="Shader-的语言">Shader 的语言</h2>
<p>​	Shader 通常使用专门的语言编写，这些语言被设计为能够高效地在 GPU 上运行。例如：</p>
<ul>
<li><strong>GLSL（OpenGL Shading Language）：</strong> 用于 OpenGL。</li>
<li><strong>HLSL（High-Level Shading Language）：</strong> 用于 DirectX。</li>
<li><strong>Cg（C for Graphics）：</strong> NVIDIA 推出的语言。</li>
<li><strong>ShaderLab（Unity）：</strong> Unity 的着色器语言，结合 HLSL 使用。</li>
</ul>
<h2 id="glsl-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" tabindex="-1" id="GLSL-的数据类型">GLSL 的数据类型</h2>
<p>​	GLSL 中的数据类型主要分为以下几类：</p>
<h3 id="1.-%E6%A0%87%E9%87%8F%E7%B1%BB%E5%9E%8B%EF%BC%88scalar-types%EF%BC%89" tabindex="-1" id="1-标量类型（Scalar-Types）">1. <strong>标量类型（Scalar Types）</strong></h3>
<p>​	标量类型表示单一的数值，常用的标量类型包括：</p>
<ul>
<li><strong><code>float</code></strong>：表示单精度浮点数，范围通常为 <code>±3.4 × 10^38</code>，精度为 6-9 位数字。</li>
<li><strong><code>int</code></strong>：表示整数，范围通常为 <code>-2,147,483,648</code> 到 <code>2,147,483,647</code>。</li>
<li><strong><code>bool</code></strong>：布尔类型，取值为 <code>true</code> 或 <code>false</code>。</li>
</ul>
<h3 id="2.-%E5%90%91%E9%87%8F%E7%B1%BB%E5%9E%8B%EF%BC%88vector-types%EF%BC%89" tabindex="-1" id="2-向量类型（Vector-Types）">2. <strong>向量类型（Vector Types）</strong></h3>
<p>​	向量类型用于存储多个标量值，通常表示颜色、位置、法线等。GLSL 中有以下几种向量类型：</p>
<ul>
<li><strong><code>vec2</code></strong>：包含两个浮点数或整数的向量，例如 <code>(x, y)</code>。</li>
<li><strong><code>vec3</code></strong>：包含三个浮点数或整数的向量，例如 <code>(x, y, z)</code>。</li>
<li><strong><code>vec4</code></strong>：包含四个浮点数或整数的向量，例如 <code>(x, y, z, w)</code>。</li>
</ul>
<p>​	向量的元素可以是 <code>float</code>、<code>int</code> 或 <code>bool</code>，例如 <code>ivec2</code> 表示两个整数的向量，<code>bvec4</code> 表示四个布尔值的向量。</p>
<h3 id="3.-%E7%9F%A9%E9%98%B5%E7%B1%BB%E5%9E%8B%EF%BC%88matrix-types%EF%BC%89" tabindex="-1" id="3-矩阵类型（Matrix-Types）">3. <strong>矩阵类型（Matrix Types）</strong></h3>
<p>​	矩阵类型用于表示线性变换，通常用于3D图形变换。GLSL支持以下矩阵类型：</p>
<ul>
<li><strong><code>mat2</code></strong>：2x2 的浮点矩阵。</li>
<li><strong><code>mat3</code></strong>：3x3 的浮点矩阵。</li>
<li><strong><code>mat4</code></strong>：4x4 的浮点矩阵。</li>
</ul>
<p>​	矩阵中的每个元素通常是<code>float</code>类型。矩阵在图形学中用于表示例如旋转、平移、缩放等变换。</p>
<h3 id="4.-%E9%87%87%E6%A0%B7%E5%99%A8%E7%B1%BB%E5%9E%8B%EF%BC%88sampler-types%EF%BC%89" tabindex="-1" id="4-采样器类型（Sampler-Types）">4. <strong>采样器类型（Sampler Types）</strong></h3>
<p>​	采样器类型用于表示纹理和其他图像数据的访问方式。常见的采样器类型有：</p>
<ul>
<li><strong><code>sampler2D</code></strong>：2D 纹理采样器，用于访问二维纹理图像。</li>
<li><strong><code>sampler3D</code></strong>：3D 纹理采样器，用于访问三维纹理图像。</li>
<li><strong><code>samplerCube</code></strong>：立方体纹理采样器，用于访问立方体纹理图像。</li>
</ul>
<h3 id="5.-%E7%89%B9%E6%AE%8A%E7%B1%BB%E5%9E%8B%EF%BC%88special-types%EF%BC%89" tabindex="-1" id="5-特殊类型（Special-Types）">5. <strong>特殊类型（Special Types）</strong></h3>
<ul>
<li><strong><code>void</code></strong>：表示没有返回值的类型，常用于函数的返回类型。</li>
</ul>
<h3 id="6.-%E7%BB%93%E6%9E%84%E4%BD%93%EF%BC%88structures%EF%BC%89" tabindex="-1" id="6-结构体（Structures）">6. <strong>结构体（Structures）</strong></h3>
<p>​	GLSL 支持自定义结构体，可以将不同类型的数据打包成一个结构体。例如：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs glsl">struct Material &#123;<br>    <span class="hljs-type">vec3</span> color;<br>    <span class="hljs-type">float</span> shininess;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>​	结构体可以包含标量、向量、矩阵等类型的成员。</p>
<h3 id="7.-%E6%95%B0%E7%BB%84%EF%BC%88arrays%EF%BC%89" tabindex="-1" id="7-数组（Arrays）">7. <strong>数组（Arrays）</strong></h3>
<p>​	GLSL 支持数组类型，允许存储多个相同类型的元素。例如：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">float</span> values[<span class="hljs-number">10</span>];<br><span class="hljs-type">vec3</span> positions[<span class="hljs-number">5</span>];<br></code></pre></td></tr></table></figure>
<p>​	数组的大小必须是常量表达式。</p>
<h2 id="glsl-%E7%9A%84%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F" tabindex="-1" id="GLSL-的内置变量">GLSL 的内置变量</h2>
<h3 id="%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8%E7%9A%84%E5%86%85%E5%BB%BA%E5%8F%98%E9%87%8F" tabindex="-1" id="顶点着色器的内建变量"><strong>顶点着色器的内建变量</strong></h3>
<p>​	顶点着色器用于处理每个顶点的数据，其内建变量用于传递信息到图形管线的后续阶段。</p>
<ol>
<li><strong>输入变量</strong>
<ul>
<li><code>gl_VertexID</code>：当前顶点的索引（整型）。</li>
<li><code>gl_InstanceID</code>：当前实例的索引（用于实例化绘制）。</li>
</ul>
</li>
<li><strong>输出变量</strong>
<ul>
<li><code>gl_Position</code>：顶点的裁剪空间坐标，必须由顶点着色器设置。</li>
<li><code>gl_PointSize</code>：绘制点图元时，指定点的大小（像素单位）。</li>
<li><code>gl_ClipDistance[]</code>：用户定义的剪裁平面距离，用于实现自定义剪裁逻辑。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="%E7%89%87%E6%AE%B5%E7%9D%80%E8%89%B2%E5%99%A8%E7%9A%84%E5%86%85%E5%BB%BA%E5%8F%98%E9%87%8F" tabindex="-1" id="片段着色器的内建变量"><strong>片段着色器的内建变量</strong></h3>
<p>​	片段着色器用于处理每个片段的数据，内建变量帮助与栅格化阶段交互。</p>
<ol>
<li><strong>输入变量</strong>
<ul>
<li><code>gl_FragCoord</code>：片段在窗口空间的坐标（<code>x, y</code> 为像素坐标，<code>z</code> 为深度值，<code>w</code> 为投影的倒数）。</li>
<li><code>gl_FrontFacing</code>：布尔值，指示当前片段是否属于正面（面向摄像机的多边形）。</li>
<li><code>gl_PointCoord</code>：在绘制点精灵时，提供片段在点图元中的归一化坐标。</li>
</ul>
</li>
<li><strong>输出变量</strong>
<ul>
<li><code>gl_FragDepth</code>：片段的深度值，可用于手动调整深度测试的行为。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="%E5%87%A0%E4%BD%95%E7%9D%80%E8%89%B2%E5%99%A8%E7%9A%84%E5%86%85%E5%BB%BA%E5%8F%98%E9%87%8F" tabindex="-1" id="几何着色器的内建变量"><strong>几何着色器的内建变量</strong></h3>
<p>​	几何着色器用于对图元（例如三角形或线段）进行操作，具有特殊的内建变量。</p>
<ol>
<li><strong>输入变量</strong>
<ul>
<li><code>gl_PrimitiveIDIn</code>：输入图元的索引。</li>
<li><code>gl_InvocationID</code>：当前几何着色器实例的索引。</li>
</ul>
</li>
<li><strong>输出变量</strong>
<ul>
<li><code>gl_Position</code>：输出顶点的裁剪空间坐标。</li>
<li><code>gl_PrimitiveID</code>：输出图元的索引。</li>
<li><code>gl_Layer</code>：指定输出图元的目标图层（用于多目标渲染）。</li>
<li><code>gl_ViewportIndex</code>：指定输出图元的目标视口。</li>
</ul>
</li>
</ol>
<h1 id="%E8%AF%BE%E7%A8%8B" tabindex="-1">课程</h1>
<h2 id="005-three.js-as-your-development-platform" tabindex="-1" id="005-THREE-js-as-your-development-platform">005 THREE.js as your development platform</h2>
<p>​	如此构建项目。</p>
<script>
    const N5_1 = new CodeFileTreeNode('node5_1', false, '005/css/style.css');
    const N5_2 = new CodeFileTreeNode('node5_2', true, 'css', [N5_1]);
    const N5_3 = new CodeFileTreeNode('node5_3', false, '005/js/index.js');
    const N5_4 = new CodeFileTreeNode('node5_4', true, 'js', [N5_3]);
    const N5_5 = new CodeFileTreeNode('node5_5', false, '005/index.html');
    const N5_6 = new CodeFileTreeNode('node5_6', true, '', [N5_5, N5_2, N5_4]);
    new CodeFileTree('tree5', N5_6, N5_3).render();
</script>
<p>​	这么做相当于在 Blender 中创建如下的场景：</p>
<p><img src="005.webp" alt="webp"></p>
<p>​	对于平面上的顶点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(x, y, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mclose">)</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>∈</mo><mo>[</mo><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">x\in[-1, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord">−</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>∈</mo><mo>[</mo><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">y\in[-1,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord">−</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span>，相机的视口刚好包括整个平面，不多不少。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> bpy<br><br><span class="hljs-comment"># 删除默认场景中的对象</span><br>bpy.ops.<span class="hljs-built_in">object</span>.select_all(action=<span class="hljs-string">&#x27;SELECT&#x27;</span>)<br>bpy.ops.<span class="hljs-built_in">object</span>.delete(use_global=<span class="hljs-literal">False</span>)<br><br><span class="hljs-comment"># 创建正交相机</span><br>camera_data = bpy.data.cameras.new(name=<span class="hljs-string">&quot;OrthographicCamera&quot;</span>)<br>camera_data.<span class="hljs-built_in">type</span> = <span class="hljs-string">&#x27;ORTHO&#x27;</span><br>camera_data.ortho_scale = <span class="hljs-number">2</span>  <span class="hljs-comment"># 设置正交视口范围（类似 Three.js 的 -1 到 1）</span><br>camera_data.clip_start = <span class="hljs-number">0.1</span><br>camera_data.clip_end = <span class="hljs-number">10</span><br><br>camera_object = bpy.data.objects.new(<span class="hljs-string">&quot;OrthographicCamera&quot;</span>, camera_data)<br>bpy.context.scene.collection.objects.link(camera_object)<br>camera_object.location = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)  <span class="hljs-comment"># 将相机放在 z 轴上</span><br>bpy.context.scene.camera = camera_object<br><br><span class="hljs-comment"># 创建平面</span><br>bpy.ops.mesh.primitive_plane_add(size=<span class="hljs-number">2</span>, location=(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))  <span class="hljs-comment"># 大小为 2x2 的平面</span><br>plane = bpy.context.<span class="hljs-built_in">object</span><br>plane.name = <span class="hljs-string">&quot;Plane&quot;</span><br><br><span class="hljs-comment"># 设置渲染器</span><br>bpy.context.scene.render.engine = <span class="hljs-string">&#x27;CYCLES&#x27;</span>  <span class="hljs-comment"># 或者&#x27;Eevee&#x27;</span><br>bpy.context.scene.render.resolution_x = <span class="hljs-number">1000</span><br>bpy.context.scene.render.resolution_y = <span class="hljs-number">1000</span><br></code></pre></td></tr></table></figure>
<h2 id="006-your-first-shader" tabindex="-1" id="006-Your-first-shader">006 Your first shader</h2>
<p>​	VSC 下安装 <code>WebGL GLSL Editor</code> 插件即可使得 <code>.hlsl</code> 可以高亮！</p>
<p>​	为了让 Shader 编写能够使用 VSC 的高亮，我决定修改项目的结构。</p>
<script>
    const N6_1 = new CodeFileTreeNode('node6_1', false, '005/css/style.css');
    const N6_2 = new CodeFileTreeNode('node6_2', true, 'css', [N6_1]);
    const N6_3 = new CodeFileTreeNode('node6_3', false, '006/js/index.js');
    const N6_4 = new CodeFileTreeNode('node6_4', true, 'js', [N6_3]);
    const N6_5 = new CodeFileTreeNode('node6_5', false, '005/index.html');
    const N6_6 = new CodeFileTreeNode('node6_6', false, '006/glsl/vertexShader.glsl');
    const N6_7 = new CodeFileTreeNode('node6_7', false, '006/glsl/fragmentShader.glsl');
    const N6_8 = new CodeFileTreeNode('node6_8', true, 'glsl', [N6_6, N6_7]);
    const N6_9 = new CodeFileTreeNode('node6_9', true, '', [N6_2, N6_4, N6_8, N6_5]);
    new CodeFileTree('tree6', N6_9, N6_3).render();
</script>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li>一个 Shader 由<b>顶点着色器（vertex shader）</b>和<b>片元着色器（fragment shader）</b>组成。</li>
<li>每个着色器文件必须包含函数 <code>void main()&#123;...&#125;</code></li>
</ul>
</div>
<p>​	如下代码将顶点着色器和片元着色器应用给 Shader 材质：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>(&#123; <span class="hljs-attr">vertexShader</span>: vShader, <span class="hljs-attr">fragmentShader</span>: fShader &#125;);  <span class="hljs-comment">// 应用顶点着色器和片元着色器</span><br></code></pre></td></tr></table></figure>
<p>​	对于<strong>顶点着色器</strong>：</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li>必须设置内置变量 <code>gl_Position</code>，从而处理 mesh 中的所有 vertex；
<ul>
<li>在 GLSL（OpenGL 着色语言）中，内置变量是一些特殊的变量，它们不需要声明即可使用。这些变量在着色器中扮演着重要的角色，作为硬件的输入和输出点。根据着色器的类型（顶点着色器或片元着色器），内置变量有所不同。</li>
</ul>
</li>
<li><code>gl_Position</code> 的类型为 <code>vec4</code>。</li>
</ul>
</div>
<p>​	在 GLSL 中，<code>modelViewMatrix</code> 和 <code>projectionMatrix</code> 通常作为 uniform 变量传递给着色器，并用于将顶点位置从物体坐标系转换到最终的屏幕坐标。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-built_in">gl_Position</span> = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>(position * <span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	<code>vec4(position * 0.5, 1.0)</code> 让视口只有全屏的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm">2</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span>。</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>vertex 在渲染中的变换过程：</p>
<ul>
<li>position - localcoordinate（<code>vertexPosition</code>，这里是 <code>vec4(position * 0.5, 1.0)</code>）</li>
<li>Move to world space（与 <code>modelViewMatrix</code> 相乘）</li>
<li>Move to camera view（与 <code>projectionMatrix</code> 相乘）</li>
<li>Project on to screen（返回 <code>gl_Position</code>）</li>
</ul>
</div>
<p>​	对于<strong>片元着色器</strong>：</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li>必须设置内置变量 <code>gl_FragColor</code>；</li>
<li><code>gl_FragColor</code> 的类型为 <code>vec4</code>，代表 RGBA，值 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∈</mo><mo>[</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mi mathvariant="normal">.</mi><mn>0</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">\in[0.0, 1.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">0</span><span class="mclose">]</span></span></span></span>；</li>
</ul>
</div>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	（无论什么顶点都返回粉紫色）</p>
<hr>
<p>​	最终效果：</p>
<p><img src="006.webp" alt="webp"></p>
<h2 id="007-the-vec-class" tabindex="-1" id="007-The-vec-class">007 The vec class</h2>
<script>
    const N7_1 = new CodeFileTreeNode('node7_1', false, '005/css/style.css');
    const N7_2 = new CodeFileTreeNode('node7_2', true, 'css', [N7_1]);
    const N7_3 = new CodeFileTreeNode('node7_3', false, '007/js/index.js');
    const N7_4 = new CodeFileTreeNode('node7_4', true, 'js', [N7_3]);
    const N7_5 = new CodeFileTreeNode('node7_5', false, '005/index.html');
    const N7_6 = new CodeFileTreeNode('node7_6', false, '007/glsl/vertexShader.glsl');
    const N7_7 = new CodeFileTreeNode('node7_7', false, '007/glsl/fragmentShader.glsl');
    const N7_8 = new CodeFileTreeNode('node7_8', true, 'glsl', [N7_6, N7_7]);
    const N7_9 = new CodeFileTreeNode('node7_9', true, '', [N7_2, N7_4, N7_8, N7_5]);
    new CodeFileTree('tree7', N7_9, N7_3).render();
</script>
<p>​	使用如下方法可以给着色器传参（使用 <code>uniforms</code>）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> uniforms = &#123; <span class="hljs-attr">u_color</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0x00FF00</span>) &#125; &#125;;  <span class="hljs-comment">// 定义 uniform 变量</span><br>material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>(&#123; <span class="hljs-attr">uniforms</span>: uniforms, <span class="hljs-attr">vertexShader</span>: vShader, <span class="hljs-attr">fragmentShader</span>: fShader &#125;);<br></code></pre></td></tr></table></figure>
<p>​	在片元着色器中，定义并接受这个参数（类型为 <code>vec3</code>）：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> u_color;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(u_color, <span class="hljs-number">1.0</span>).grba;  <span class="hljs-comment">// 表示切换颜色值的顺序，默认为 rgba</span><br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<p>​	最终效果：</p>
<p><img src="007.webp" alt="webp"></p>
<h2 id="008-changing-the-color-using-the-mouse" tabindex="-1" id="008-Changing-the-color-using-the-mouse">008 Changing the color using the mouse</h2>
<script>
    const N8_1 = new CodeFileTreeNode('node8_1', false, '005/css/style.css');
    const N8_2 = new CodeFileTreeNode('node8_2', true, 'css', [N8_1]);
    const N8_3 = new CodeFileTreeNode('node8_3', false, '008/js/index.js');
    const N8_4 = new CodeFileTreeNode('node8_4', true, 'js', [N8_3]);
    const N8_5 = new CodeFileTreeNode('node8_5', false, '005/index.html');
    const N8_6 = new CodeFileTreeNode('node8_6', false, '008/glsl/vertexShader.glsl');
    const N8_7 = new CodeFileTreeNode('node8_7', false, '008/glsl/fragmentShader.glsl');
    const N8_8 = new CodeFileTreeNode('node8_8', true, 'glsl', [N8_6, N8_7]);
    const N8_9 = new CodeFileTreeNode('node8_9', true, '', [N8_2, N8_4, N8_8, N8_5]);
    new CodeFileTree('tree8', N8_9, N8_3).render();
</script>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>​	当 <code>uniforms</code> 里的值被改变时，着色器渲染的结果也会随之改变。</p>
</div>
<p>​	定义 <code>uniforms</code>，让其中的值与鼠标坐标和屏幕大小挂钩：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">uniforms = &#123;<br>    <span class="hljs-attr">u_time</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">0.0</span> &#125;,<br>    <span class="hljs-attr">u_mouse</span>: &#123; <span class="hljs-attr">value</span>: &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0.0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0.0</span> &#125; &#125;,<br>    <span class="hljs-attr">u_resolution</span>: &#123; <span class="hljs-attr">value</span>: &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0.0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0.0</span> &#125; &#125;,<br>    <span class="hljs-attr">u_color</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0x00FF00</span>) &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>​	设置鼠标移动监听：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;ontouchstart&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;touch device detected&#x27;</span>);<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;touchmove&#x27;</span>, move);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;resize detected&#x27;</span>);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, onWindowResize, <span class="hljs-literal">false</span>);<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousemove&#x27;</span>, move)<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	设定 <code>uniforms.u_mouse.value.x</code> 和 <code>uniforms.u_mouse.value.y</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">evt</span>) &#123;<br>    uniforms.<span class="hljs-property">u_mouse</span>.<span class="hljs-property">value</span>.<span class="hljs-property">x</span> = (evt.<span class="hljs-property">touches</span> ? evt.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> : evt.<span class="hljs-property">clientX</span>);<br>    uniforms.<span class="hljs-property">u_mouse</span>.<span class="hljs-property">value</span>.<span class="hljs-property">y</span> = (evt.<span class="hljs-property">touches</span> ? evt.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> : evt.<span class="hljs-property">clientY</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">onWindowResize</span>(<span class="hljs-params">event</span>) &#123;<br>    <span class="hljs-keyword">const</span> aspectRatio = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;<br>    <span class="hljs-keyword">let</span> width, height;<br>    <span class="hljs-keyword">if</span> (aspectRatio &gt;= <span class="hljs-number">1</span>) &#123;<br>        width = <span class="hljs-number">1</span>;<br>        height = (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>) * width;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        width = aspectRatio;<br>        height = <span class="hljs-number">1</span>;<br>    &#125;<br>    camera.<span class="hljs-property">left</span> = -width;<br>    camera.<span class="hljs-property">right</span> = width;<br>    camera.<span class="hljs-property">top</span> = height;<br>    camera.<span class="hljs-property">bottom</span> = -height;<br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>();<br>    renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);<br><br>    <span class="hljs-keyword">if</span> (uniforms.<span class="hljs-property">u_resolution</span> !== <span class="hljs-literal">undefined</span>) &#123;<br>        uniforms.<span class="hljs-property">u_resolution</span>.<span class="hljs-property">value</span>.<span class="hljs-property">x</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>;<br>        uniforms.<span class="hljs-property">u_resolution</span>.<span class="hljs-property">value</span>.<span class="hljs-property">y</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	在片元着色器中接收参数：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec2</span> u_mouse;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec2</span> u_resolution;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(u_mouse.x / u_resolution.x, <span class="hljs-number">0.0</span>, u_mouse.y / u_resolution.y);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="009-changing-color-with-time" tabindex="-1" id="009-Changing-color-with-time">009 Changing color with time</h2>
<script>
    const N9_1 = new CodeFileTreeNode('node9_1', false, '005/css/style.css');
    const N9_2 = new CodeFileTreeNode('node9_2', true, 'css', [N9_1]);
    const N9_3 = new CodeFileTreeNode('node9_3', false, '009/js/index.js');
    const N9_4 = new CodeFileTreeNode('node9_4', true, 'js', [N9_3]);
    const N9_5 = new CodeFileTreeNode('node9_5', false, '005/index.html');
    const N9_6 = new CodeFileTreeNode('node9_6', false, '009/glsl/vertexShader.glsl');
    const N9_7 = new CodeFileTreeNode('node9_7', false, '009/glsl/fragmentShader.glsl');
    const N9_8 = new CodeFileTreeNode('node9_8', true, 'glsl', [N9_6, N9_7]);
    const N9_9 = new CodeFileTreeNode('node9_9', true, '', [N9_2, N9_4, N9_8, N9_5]);
    new CodeFileTree('tree9', N9_9, N9_3).render();
</script>
<p>​	让颜色与颜色挂钩，这么定义<code>uniforms</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">uniforms = &#123;<br>    <span class="hljs-attr">u_time</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">0.0</span> &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>​	在 <code>animate()</code> 中（相当于 Unity 中的 <code>FixUpdate()</code>，每帧执行一次，每秒执行 60 次），让 <code>uniforms.u_time.value</code> 的值不断随事件而递增。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">uniforms.<span class="hljs-property">u_time</span>.<span class="hljs-property">value</span> += clock.<span class="hljs-title function_">getDelta</span>();<br></code></pre></td></tr></table></figure>
<div class="markdown-alert markdown-alert-tip"><p class="markdown-alert-title"><svg class="octicon octicon-light-bulb mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p><p></p>
<ul>
<li><code>clock.getElapsedTime()</code> 是 Three.js 库中的一个方法，用于获取自时钟对象（<code>Clock</code>）创建以来经过的时间（以秒为单位）。（所以会越闪越快……）</li>
<li><code>clock.getDelta()</code> 是 Three.js 库中的一个方法，用于计算上一帧和当前帧之间经过的时间（以秒为单位）。</li>
</ul>
</div>
<p>​	设置片元着色器：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>((<span class="hljs-built_in">sin</span>(u_time) + <span class="hljs-number">1.0</span>) / <span class="hljs-number">2.0</span>, <span class="hljs-number">0.0</span>, (<span class="hljs-built_in">cos</span>(u_time) + <span class="hljs-number">1.0</span>) / <span class="hljs-number">2.0</span>);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="010-blending-colors" tabindex="-1" id="010-Blending-colors">010 Blending colors</h2>
<script>
    const N10_1 = new CodeFileTreeNode('node10_1', false, '005/css/style.css');
    const N10_2 = new CodeFileTreeNode('node10_2', true, 'css', [N10_1]);
    const N10_3 = new CodeFileTreeNode('node10_3', false, '010/js/index.js');
    const N10_4 = new CodeFileTreeNode('node10_4', true, 'js', [N10_3]);
    const N10_5 = new CodeFileTreeNode('node10_5', false, '005/index.html');
    const N10_6 = new CodeFileTreeNode('node10_6', false, '010/glsl/vertexShader.glsl');
    const N10_7 = new CodeFileTreeNode('node10_7', false, '010/glsl/fragmentShader.glsl');
    const N10_8 = new CodeFileTreeNode('node10_8', true, 'glsl', [N10_6, N10_7]);
    const N10_9 = new CodeFileTreeNode('node10_9', true, '', [N10_2, N10_4, N10_8, N10_5]);
    new CodeFileTree('tree10', N10_9, N10_7).render();
</script>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec2</span> u_resolution;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec2</span> uv = <span class="hljs-built_in">gl_FragCoord</span>.xy / u_resolution;<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-built_in">mix</span>(<span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>), <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>), uv.y);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li><code>gl_FragCoord</code>是一个内置变量，包含当前处理的片元（像素）的窗口坐标 <code>(x, y)</code>。通过将 <code>gl_FragCoord</code> 的坐标除以<code>u_resolution</code>，得到了一个归一化的坐标 <code>uv</code>，范围在 <code>(0,0)</code> 到 <code>(1,1)</code> 之间。这种归一化允许我们在着色器中使用相对坐标来处理画面中的颜色渐变或图案。</li>
<li><code>mix()</code>函数用于在两个颜色之间进行线性<strong>插值</strong>。<code>vec3(1.0, 0.0, 0.0)</code> 表示红色，<code>vec3(0.0, 0.0, 1.0)</code> 表示蓝色。通过对<code>uv.y</code>（归一化的 <code>y</code> 坐标，值在 <code>0</code> 到 <code>1</code> 之间）进行插值，<code>color</code> 将根据 <code>y</code> 坐标值从红色渐变到蓝色。即，<code>y = 0</code> 时颜色为红色，<code>y = 1</code> 时颜色为蓝色。</li>
</ul>
</div>
<p><img src="010.webp" alt="webp"></p>
<h2 id="011-uniforms-and-varyings" tabindex="-1" id="011-Uniforms-and-varyings">011 Uniforms and varyings</h2>
<script>
    const N11_1 = new CodeFileTreeNode('node11_1', false, '005/css/style.css');
    const N11_2 = new CodeFileTreeNode('node11_2', true, 'css', [N11_1]);
    const N11_3 = new CodeFileTreeNode('node11_3', false, '011/js/index.js');
    const N11_4 = new CodeFileTreeNode('node11_4', true, 'js', [N11_3]);
    const N11_5 = new CodeFileTreeNode('node11_5', false, '005/index.html');
    const N11_6 = new CodeFileTreeNode('node11_6', false, '011/glsl/vertexShader.glsl');
    const N11_7 = new CodeFileTreeNode('node11_7', false, '011/glsl/fragmentShader.glsl');
    const N11_8 = new CodeFileTreeNode('node11_8', true, 'glsl', [N11_6, N11_7]);
    const N11_9 = new CodeFileTreeNode('node11_9', true, '', [N11_2, N11_4, N11_8, N11_5]);
    new CodeFileTree('tree11', N11_9, N11_7).render();
</script>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li><code>varying</code> 变量用于在顶点着色器和片元着色器之间传递数据。</li>
<li>顶点着色器将顶点的位置赋值给 <code>v_position</code>，使得片元着色器可以访问这个值。</li>
</ul>
</div>
<p><img src="011.webp" alt="webp"></p>
<p>​	对于这个平面，<code>position</code> 的取值示意图：</p>
<p><img src="011_2.webp" alt="webp"></p>
<h2 id="012-using-clamp" tabindex="-1" id="012-Using-clamp">012 Using clamp</h2>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li><code>clamp(x, minVal, maxVal)</code> 是一个用于限制值范围的函数。它会返回 <code>x</code> 本身，如果 <code>x</code> 在 <code>minVal</code> 和 <code>maxVal</code> 之间；如果 <code>x</code> 小于 <code>minVal</code>，则返回 <code>minVal</code>；如果 <code>x</code> 大于 <code>maxVal</code>，则返回 <code>maxVal</code>。</li>
</ul>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">p</mi></mrow><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mo separator="true">,</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mo>)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mtext> </mtext></mtext><mi>x</mi><mo>&lt;</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></mrow></mtd></mtr><mtr><mtd><mrow><mi>x</mi></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mtext> </mtext></mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mo>≤</mo><mi>x</mi><mo>&lt;</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></mrow></mtd></mtr><mtr><mtd><mrow><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mtext> </mtext></mtext><mi>x</mi><mo>≥</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\mathrm{clamp}(x, \mathrm{minVal}, \mathrm{maxVal})=\begin{cases} \mathrm{minVal} &amp; \text{if } x &lt; \mathrm{minVal} \\ x &amp; \text{if } \mathrm{minVal} \leq x &lt; \mathrm{maxVal} \\ \mathrm{maxVal} &amp; \text{if } x \geq \mathrm{maxVal} \end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.41em;"></span><span class="strut bottom" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">c</span><span class="mord mathrm">l</span><span class="mord mathrm">a</span><span class="mord mathrm">m</span><span class="mord mathrm">p</span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9500099999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:0.9500099999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.000010000000000287557em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-1.1500100000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.4500200000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-1.4020000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span></span></span><span style="top:0.0379999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span></span></span><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-1.4020000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mspace"> </span></span><span class="mord mathit">x</span><span class="mrel">&lt;</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span></span></span><span style="top:0.0379999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mspace"> </span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span><span class="mrel">≤</span><span class="mord mathit">x</span><span class="mrel">&lt;</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span></span></span><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mspace"> </span></span><span class="mord mathit">x</span><span class="mrel">≥</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
</div>
<p>​	在上一节的基础上，编辑片元着色器，将值限制在 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span> 之间：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>);<br>    color.r = <span class="hljs-built_in">clamp</span>(v_position.x, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);<br>    color.g = <span class="hljs-built_in">clamp</span>(v_position.y, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="013-using-step-and-smoothstep" tabindex="-1" id="013-Using-step-and-smoothstep">013 Using step and smoothstep</h2>
<p>​	修改片元着色器：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>);<br>    color.r = <span class="hljs-built_in">step</span>(<span class="hljs-number">0.0</span>, v_position.x);<br>    color.g = <span class="hljs-built_in">step</span>(<span class="hljs-number">0.0</span>, v_position.y);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li><code>color.r = step(0.0, v_position.x);</code> 使用 <code>step</code> 函数对 <code>v_position.x</code> 进行处理。<code>step</code> 函数的作用是进行阈值判断，若 <code>v_position.x</code> 大于或等于 <code>0.0</code>，则返回 <code>1.0</code>，否则返回 <code>0.0</code>。</li>
</ul>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">p</mi></mrow><mo>(</mo><mi>t</mi><mo separator="true">,</mo><mi>x</mi><mo>)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mtext> </mtext></mtext><mi>x</mi><mo>&lt;</mo><mi>t</mi></mrow></mtd></mtr><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mtext> </mtext></mtext><mi>x</mi><mo>≥</mo><mi>t</mi></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\mathrm{step}(t,x)=\begin{cases}  0 &amp; \text{if } x &lt; t \\  1 &amp; \text{if } x \geq t \end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">s</span><span class="mord mathrm">t</span><span class="mord mathrm">e</span><span class="mord mathrm">p</span></span><span class="mopen">(</span><span class="mord mathit">t</span><span class="mpunct">,</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mspace"> </span></span><span class="mord mathit">x</span><span class="mrel">&lt;</span><span class="mord mathit">t</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mspace"> </span></span><span class="mord mathit">x</span><span class="mrel">≥</span><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
</div>
<p><img src="013.webp" alt="webp"></p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>);<br>    color.r = <span class="hljs-built_in">smoothstep</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.1</span>, v_position.x);<br>    color.g = <span class="hljs-built_in">smoothstep</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.1</span>, v_position.y);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li><code>smoothstep</code> 函数的数学表达式通常定义为：</li>
</ul>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext><mi mathvariant="normal">s</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">h</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">p</mi></mtext><mo>(</mo><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>0</mn><mo separator="true">,</mo><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>1</mn><mo separator="true">,</mo><mi>x</mi><mo>)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mtext> </mtext></mrow><mi>x</mi><mo>&lt;</mo><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mi mathvariant="normal">t</mi></mrow><mn>2</mn></msup><mo>⋅</mo><mo>(</mo><mn>3</mn><mo>−</mo><mn>2</mn><mo>⋅</mo><mrow><mi mathvariant="normal">t</mi></mrow><mo>)</mo></mrow></mtd><mtd><mrow><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mtext> </mtext></mrow><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>0</mn><mo>≤</mo><mi>x</mi><mo>&lt;</mo><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>1</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mtext> </mtext></mrow><mi>x</mi><mo>≥</mo><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>1</mn></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\text{smoothstep}(edge0,edge1,x)=\begin{cases}0 &amp; \mathrm{if\ } x &lt; edge0\\ \mathrm{t}^2\cdot(3-2\cdot\mathrm{t}) &amp; \mathrm{if\ }edge0\leq x &lt; edge1 \\ 1 &amp; \mathrm{if\ }x\geq edge1 &amp; &amp; \end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.41em;"></span><span class="strut bottom" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="base displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">s</span><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">o</span><span class="mord mathrm">t</span><span class="mord mathrm">h</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span><span class="mord mathrm">e</span><span class="mord mathrm">p</span></span><span class="mopen">(</span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9500099999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:0.9500099999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.000010000000000287557em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-1.1500100000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.4500200000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-1.4020000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:0.0379999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class=""><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">t</span></span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">⋅</span><span class="mopen">(</span><span class="mord mathrm">3</span><span class="mbin">−</span><span class="mord mathrm">2</span><span class="mbin">⋅</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">t</span></span><span class="mclose">)</span></span></span><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-1.4020000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mspace"> </span></span><span class="mord mathit">x</span><span class="mrel">&lt;</span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">0</span></span></span><span style="top:0.0379999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mspace"> </span></span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">0</span><span class="mrel">≤</span><span class="mord mathit">x</span><span class="mrel">&lt;</span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">1</span></span></span><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mspace"> </span></span><span class="mord mathit">x</span><span class="mrel">≥</span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<p>​	其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span> 的计算为：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>=</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>0</mn></mrow><mrow><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>1</mn><mo>−</mo><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>0</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">t = \frac{x - edge0}{edge1 - edge0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9322159999999999em;"></span><span class="strut bottom" style="height:1.4133239999999998em;vertical-align:-0.481108em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.44610799999999995em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">x</span><span class="mbin">−</span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">0</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></p>
</div>
<p><img src="013_2.webp" alt="webp"></p>
<hr>
<p>​	画一个圆（自己瞎画）：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>);<br>    color.r = <span class="hljs-built_in">smoothstep</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, v_position.x * v_position.x + v_position.y * v_position.y);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="013_3.webp" alt="webp"></p>
<h2 id="014-drawing-a-circle" tabindex="-1" id="014-Drawing-a-circle">014 Drawing a circle</h2>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">float</span> inCircle = <span class="hljs-number">1.0</span> - <span class="hljs-built_in">step</span>(<span class="hljs-number">0.5</span>, <span class="hljs-built_in">length</span>(v_position.xy));<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>) * inCircle;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li><code>length</code> 函数来计算向量（<code>v_position.xy</code>）的长度。<code>v_position</code> 是一个三维向量，在这里我们只取它的前两个分量 <code>x</code> 和 <code>y</code>，表示二维平面上的一个点。<code>length</code> 函数返回该点到原点 <code>(0, 0)</code> 的距离。</li>
</ul>
</div>
<p><img src="014.webp" alt="webp"></p>
<h2 id="015-drawing-a-square" tabindex="-1" id="015-Drawing-a-square">015 Drawing a square</h2>
<p>​	修改片元着色器，引入自定义函数 <code>rect()</code> 画一个矩形（长和宽均为 <code>0.2</code>，中心在原点）。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><br><span class="hljs-type">float</span> rect(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> size, <span class="hljs-type">vec2</span> center) &#123;<br>    <span class="hljs-type">vec2</span> p = pt - center;<br>    <span class="hljs-type">vec2</span> halfsize = size / <span class="hljs-number">2.0</span>;<br><br>    <span class="hljs-type">float</span> horz = <span class="hljs-built_in">step</span>(-halfsize.x, p.x) - <span class="hljs-built_in">step</span>(halfsize.x, p.x);<br>    <span class="hljs-type">float</span> vert = <span class="hljs-built_in">step</span>(-halfsize.y, p.y) - <span class="hljs-built_in">step</span>(halfsize.y, p.y);<br><br>    <span class="hljs-keyword">return</span> horz * vert;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">float</span> inRect = rect(v_position.xy, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.2</span>), <span class="hljs-type">vec2</span>(<span class="hljs-number">0.0</span>));<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>) * inRect;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="015.webp" alt="webp"></p>
<h2 id="016-moving-our-shape" tabindex="-1" id="016-Moving-our-shape">016 Moving our shape</h2>
<p>​	修改片元着色器，再画一个矩形。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><br><span class="hljs-type">float</span> rect(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> size, <span class="hljs-type">vec2</span> center) &#123;<br>    <span class="hljs-type">vec2</span> p = pt - center;<br>    <span class="hljs-type">vec2</span> halfsize = size / <span class="hljs-number">2.0</span>;<br><br>    <span class="hljs-type">float</span> horz = <span class="hljs-built_in">step</span>(-halfsize.x, p.x) - <span class="hljs-built_in">step</span>(halfsize.x, p.x);<br>    <span class="hljs-type">float</span> vert = <span class="hljs-built_in">step</span>(-halfsize.y, p.y) - <span class="hljs-built_in">step</span>(halfsize.y, p.y);<br><br>    <span class="hljs-keyword">return</span> horz * vert;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">float</span> square1 = rect(v_position.xy, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.3</span>), <span class="hljs-type">vec2</span>(<span class="hljs-number">-0.5</span>, <span class="hljs-number">0.0</span>));<br>    <span class="hljs-type">float</span> square2 = rect(v_position.xy, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.4</span>), <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>));<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>) * square1 + <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>) * square2;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="016.webp" alt="webp"></p>
<h2 id="017-moving-the-shape-over-time" tabindex="-1" id="017-Moving-the-shape-over-time">017 Moving the shape over time</h2>
<p>​	让矩形中心随时间不断变换，原理还是数学……极坐标方程。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>=</mo><mi>ρ</mi><mi>cos</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">x=\rho\cos t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">x</span><span class="mrel">=</span><span class="mord mathit">ρ</span><span class="mop">cos</span><span class="mord mathit">t</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>ρ</mi><mi>sin</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">y=\rho\sin t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.66786em;"></span><span class="strut bottom" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">=</span><span class="mord mathit">ρ</span><span class="mop">sin</span><span class="mord mathit">t</span></span></span></span></span></p>
<script>
    const N17_1 = new CodeFileTreeNode('node17_1', false, '005/css/style.css');
    const N17_2 = new CodeFileTreeNode('node17_2', true, 'css', [N17_1]);
    const N17_3 = new CodeFileTreeNode('node17_3', false, '017/js/index.js');
    const N17_4 = new CodeFileTreeNode('node17_4', true, 'js', [N17_3]);
    const N17_5 = new CodeFileTreeNode('node17_5', false, '005/index.html');
    const N17_6 = new CodeFileTreeNode('node17_6', false, '017/glsl/vertexShader.glsl');
    const N17_7 = new CodeFileTreeNode('node17_7', false, '017/glsl/fragmentShader.glsl');
    const N17_8 = new CodeFileTreeNode('node17_8', true, 'glsl', [N17_6, N17_7]);
    const N17_9 = new CodeFileTreeNode('node17_9', true, '', [N17_2, N17_4, N17_8, N17_5]);
    new CodeFileTree('tree17', N17_9, N17_7).render();
</script> 
<h2 id="018-rotating-the-shape" tabindex="-1" id="018-Rotating-the-shape">018 Rotating the shape</h2>
<p>​	下面这段代码将让矩形绕着 <code>center</code> 沿时间旋转，原理是让矩形平移回原点，乘以旋转矩阵，再平移回中心。</p>
<p>​	<code>mat2 getRoationMatrix()</code> 将计算出旋转矩阵：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>cos</mi><mo>(</mo><mi>θ</mi><mo>)</mo></mrow></mtd><mtd><mrow><mo>−</mo><mi>sin</mi><mo>(</mo><mi>θ</mi><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mrow><mi>sin</mi><mo>(</mo><mi>θ</mi><mo>)</mo></mrow></mtd><mtd><mrow><mi>cos</mi><mo>(</mo><mi>θ</mi><mo>)</mo></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} \cos(\theta) &amp; -\sin(\theta) \\  \sin(\theta) &amp; \cos(\theta)\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.45em;"></span><span class="strut bottom" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="base textstyle uncramped"><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord">−</span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span>。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><br><span class="hljs-type">mat2</span> getRoationMatrix(<span class="hljs-type">float</span> theta) &#123;<br>    <span class="hljs-type">float</span> s = <span class="hljs-built_in">sin</span>(theta);<br>    <span class="hljs-type">float</span> c = <span class="hljs-built_in">cos</span>(theta);<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">mat2</span>(c, -s, s, c);<br>&#125;<br><br><span class="hljs-type">float</span> rect(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> size, <span class="hljs-type">vec2</span> center) &#123;<br>    <span class="hljs-type">vec2</span> p = pt - center;<br>    <span class="hljs-type">vec2</span> halfsize = size / <span class="hljs-number">2.0</span>;<br><br>    <span class="hljs-type">float</span> horz = <span class="hljs-built_in">step</span>(-halfsize.x, p.x) - <span class="hljs-built_in">step</span>(halfsize.x, p.x);<br>    <span class="hljs-type">float</span> vert = <span class="hljs-built_in">step</span>(-halfsize.y, p.y) - <span class="hljs-built_in">step</span>(halfsize.y, p.y);<br><br>    <span class="hljs-keyword">return</span> horz * vert;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec2</span> center = <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>);<br>    <span class="hljs-type">mat2</span> mat = getRoationMatrix(u_time);<br>    <span class="hljs-type">vec2</span> pt = (mat * (v_position.xy - center)) + center;<br>    <span class="hljs-type">float</span> inRect = rect(pt, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), center);<br><br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>) * inRect;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="019-changing-the-rotation-centre" tabindex="-1" id="019-Changing-the-rotation-centre">019 Changing the rotation centre</h2>
<p>​	这段代码让矩形旋转的时候还缩放来缩放去：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> v_position;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><br><span class="hljs-type">mat2</span> getRoationMatrix(<span class="hljs-type">float</span> theta) &#123;<br>    <span class="hljs-type">float</span> s = <span class="hljs-built_in">sin</span>(theta);<br>    <span class="hljs-type">float</span> c = <span class="hljs-built_in">cos</span>(theta);<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">mat2</span>(c, -s, s, c);<br>&#125;<br><br><span class="hljs-type">mat2</span> getScaleMatrix(<span class="hljs-type">float</span> scale) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">mat2</span>(scale, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, scale);<br>&#125;<br><br><span class="hljs-type">float</span> rect(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> anchor, <span class="hljs-type">vec2</span> size, <span class="hljs-type">vec2</span> center) &#123;<br>    <span class="hljs-type">vec2</span> p = pt - center;<br>    <span class="hljs-type">vec2</span> halfsize = size / <span class="hljs-number">2.0</span>;<br><br>    <span class="hljs-type">float</span> horz = <span class="hljs-built_in">step</span>(-halfsize.x - anchor.x, p.x) - <span class="hljs-built_in">step</span>(halfsize.x - anchor.x, p.x);<br>    <span class="hljs-type">float</span> vert = <span class="hljs-built_in">step</span>(-halfsize.y - anchor.y, p.y) - <span class="hljs-built_in">step</span>(halfsize.y - anchor.y, p.y);<br><br>    <span class="hljs-keyword">return</span> horz * vert;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec2</span> center = <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>);<br>    <span class="hljs-type">mat2</span> matr = getRoationMatrix(u_time);<br>    <span class="hljs-type">mat2</span> mats = getScaleMatrix((<span class="hljs-built_in">sin</span>(u_time) + <span class="hljs-number">1.0</span>) / <span class="hljs-number">3.0</span> + <span class="hljs-number">0.5</span>);<br>    <span class="hljs-type">vec2</span> pt = (mats * matr * (v_position.xy - center)) + center;<br>    <span class="hljs-type">float</span> inRect = rect(pt, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.15</span>), <span class="hljs-type">vec2</span>(<span class="hljs-number">0.3</span>), center);<br><br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>) * inRect;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li><code>rect()</code> 中的 <code>anchor</code> 定义了锚点，实现矩形的平移。</li>
<li><code>getScaleMatrix(）</code> 定义了缩放矩阵：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>s</mi></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}s &amp; 0 \\ 0 &amp; s\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.45em;"></span><span class="strut bottom" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="base textstyle uncramped"><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit">s</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span>，实现了矩形的缩放。</li>
</ul>
</div>
<h2 id="020-tilling" tabindex="-1" id="020-Tilling">020 Tilling</h2>
<script>
    const N20_1 = new CodeFileTreeNode('node20_1', false, '005/css/style.css');
    const N20_2 = new CodeFileTreeNode('node20_2', true, 'css', [N20_1]);
    const N20_3 = new CodeFileTreeNode('node20_3', false, '020/js/index.js');
    const N20_4 = new CodeFileTreeNode('node20_4', true, 'js', [N20_3]);
    const N20_5 = new CodeFileTreeNode('node20_5', false, '005/index.html');
    const N20_6 = new CodeFileTreeNode('node20_6', false, '020/glsl/vertexShader.glsl');
    const N20_7 = new CodeFileTreeNode('node20_7', false, '020/glsl/fragmentShader.glsl');
    const N20_8 = new CodeFileTreeNode('node20_8', true, 'glsl', [N20_6, N20_7]);
    const N20_9 = new CodeFileTreeNode('node20_9', true, '', [N20_2, N20_4, N20_8, N20_5]);
    new CodeFileTree('tree20', N20_9, N20_7).render();
</script> 
<p>​	顶点着色器中，将 <code>uv</code> 信息传给片元着色器：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> v_uv;<br><br><span class="hljs-type">void</span> main() &#123;<br>    v_uv = uv;<br>    <span class="hljs-built_in">gl_Position</span> = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>(position, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	片元着色器中，使用 <code>float tilecount = 6.0;</code> 定义瓷砖数量，<code>fract</code> 函数用于提取输入参数的小数部分。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">float</span> tilecount = <span class="hljs-number">6.0</span>;<br>    <span class="hljs-type">vec2</span> center = <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>);<br>    <span class="hljs-type">mat2</span> mat = getRoationMatrix(u_time);<br>    <span class="hljs-type">vec2</span> p = <span class="hljs-built_in">fract</span>(v_uv * tilecount);<br>    <span class="hljs-type">vec2</span> pt = (mat * (p - center)) + center;<br>    <span class="hljs-type">float</span> inRect = rect(pt, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), center);<br><br>    <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>) * inRect;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="020.webp" alt="webp"></p>
<p>​	这说明 <code>uv</code> 的值 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∈</mo><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">\in[0, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span>。</p>
<h2 id="021-drawing-circles" tabindex="-1" id="021-Drawing-circles">021 Drawing circles</h2>
<p>​	glsl 支持函数重载。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> v_position;<br><br><span class="hljs-type">float</span> circle(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> center, <span class="hljs-type">float</span> radius, <span class="hljs-type">float</span> line_width) &#123;<br>    <span class="hljs-type">vec2</span> p = pt - center;<br>    <span class="hljs-type">float</span> len = <span class="hljs-built_in">length</span>(p);<br>    <span class="hljs-type">float</span> half_line_width = line_width / <span class="hljs-number">2.0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">step</span>(radius - half_line_width, len) - <span class="hljs-built_in">step</span>(radius + half_line_width, len);<br>&#125;<br><br><span class="hljs-type">float</span> circle(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> center, <span class="hljs-type">float</span> radius, <span class="hljs-type">bool</span> soften) &#123;<br>    <span class="hljs-type">vec2</span> p = pt - center;<br>    <span class="hljs-type">float</span> edge = (soften) ? radius * <span class="hljs-number">0.5</span> : <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span> - <span class="hljs-built_in">smoothstep</span>(radius - edge, radius + edge, <span class="hljs-built_in">length</span>(p));<br>&#125;<br><br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> circle1 = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>) * circle(v_position.xy, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.0</span>), <span class="hljs-number">0.2</span>, <span class="hljs-number">0.02</span>);<br>    <span class="hljs-type">vec3</span> circle2 = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>) * circle(v_position.xy, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">0.2</span>, <span class="hljs-literal">true</span>);<br>    <span class="hljs-type">vec3</span> color = circle1 + circle2;<br><br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="021.webp" alt="webp"></p>
<h2 id="022-drawing-lines" tabindex="-1" id="022-Drawing-lines">022 Drawing lines</h2>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#define PI 3.1415926</span><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> v_uv;<br><br><span class="hljs-type">float</span> line(<span class="hljs-type">float</span> a, <span class="hljs-type">float</span> b, <span class="hljs-type">float</span> line_width, <span class="hljs-type">float</span> edge_thickness) &#123;<br>    <span class="hljs-type">float</span> half_line_width = line_width / <span class="hljs-number">2.0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">smoothstep</span>(a - half_line_width - edge_thickness, a - half_line_width, b) - <br>           <span class="hljs-built_in">smoothstep</span>(a + half_line_width, a + half_line_width + edge_thickness, b);<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> line1 = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>) * line(v_uv.y, <span class="hljs-built_in">mix</span>(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.6</span>, (<span class="hljs-built_in">sin</span>(v_uv.x * <span class="hljs-number">2.0</span> * PI) + <span class="hljs-number">1.0</span>) / <span class="hljs-number">2.0</span>), <span class="hljs-number">0.02</span>, <span class="hljs-number">0.002</span>);<br>    <span class="hljs-type">vec2</span> uv = <span class="hljs-built_in">gl_FragCoord</span>.xy;<br>    <span class="hljs-type">vec3</span> line2 = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>) * line(uv.x, uv.y, <span class="hljs-number">0.02</span>, <span class="hljs-number">0.002</span>);<br>    <span class="hljs-type">vec3</span> color = line1 + line2;<br><br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="022.webp" alt="webp"></p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li>定义一个 <code>float line(float a, float b, float line_width, float edge_thickness)</code>：
<ul>
<li><code>a</code>：线条的中心位置（通常对应于一个坐标系的某个值）。</li>
<li><code>b</code>：当前像素的坐标值，通常用于比较以判断该像素是否位于线条上。</li>
<li><code>line_width</code>：线条的总宽度。</li>
<li><code>edge_thickness</code>：线条的边缘厚度，用于控制线条的模糊程度。</li>
</ul>
</li>
<li><code>mix(x, y, a);</code> ：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">x</mi></mtext><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>a</mi><mo>)</mo><mo>=</mo><mo>(</mo><mn>1</mn><mo>−</mo><mi>a</mi><mo>)</mo><mo>⋅</mo><mi>x</mi><mo>+</mo><mi>a</mi><mo>⋅</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">\text{mix}(x, y, a) = (1 - a) \cdot x + a \cdot y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">x</span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mord mathit">a</span><span class="mclose">)</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit">a</span><span class="mclose">)</span><span class="mbin">⋅</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord mathit">a</span><span class="mbin">⋅</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span></li>
</ul>
<hr>
<ul>
<li><code>line(v_uv.y, mix(0.3, 0.6, (sin(v_uv.x * 2.0 * PI) + 1.0) / 2.0), 0.02, 0.002);</code> 定义了曲线 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">x</mi></mrow><mrow><mo fence="true">(</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>3</mn><mo separator="true">,</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>6</mn><mo separator="true">,</mo><mfrac><mrow><mi>sin</mi><mo>(</mo><mn>2</mn><mi>π</mi><mi>x</mi><mo>)</mo><mo>+</mo><mn>1</mn><mi mathvariant="normal">.</mi><mn>0</mn></mrow><mrow><mn>2</mn><mi mathvariant="normal">.</mi><mn>0</mn></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">y=\mathrm{mix}\left(0.3, 0.6, \frac{\sin(2\pi x)+1.0}{2.0}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.15em;"></span><span class="strut bottom" style="height:1.80002em;vertical-align:-0.65002em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">=</span><span class="mord textstyle uncramped"><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">x</span></span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">3</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">6</span><span class="mpunct">,</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm">2</span><span class="mord mathrm">.</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.485em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.03588em;">π</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">0</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></li>
<li><code>line(uv.x, uv.y, 0.02, 0.002);</code> 绘制了曲线 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">y=x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">=</span><span class="mord mathit">x</span></span></span></span></li>
</ul>
</div>
<h2 id="023-combining-elements" tabindex="-1" id="023-Combining-elements">023 Combining elements</h2>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#define PI 3.1415926</span><br><span class="hljs-meta">#define PI2 6.2831853</span><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> v_uv;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><br><span class="hljs-type">float</span> sweep(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> center, <span class="hljs-type">float</span> radius, <span class="hljs-type">float</span> line_width, <span class="hljs-type">float</span> edge_thickness) &#123;<br>    <span class="hljs-type">vec2</span> d = pt - center;<br>    <span class="hljs-type">float</span> theta = u_time * <span class="hljs-number">2.0</span>;<br>    <span class="hljs-type">vec2</span> p = <span class="hljs-type">vec2</span>(<span class="hljs-built_in">cos</span>(theta), -<span class="hljs-built_in">sin</span>(theta)) * radius;  <span class="hljs-comment">// 直线上的点（极坐标转平面坐标）</span><br>    <span class="hljs-type">float</span> h = <span class="hljs-built_in">clamp</span>(<span class="hljs-built_in">dot</span>(d, p) / <span class="hljs-built_in">dot</span>(p, p), <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);  <span class="hljs-comment">// 计算投影</span><br>    <span class="hljs-type">float</span> l = <span class="hljs-built_in">length</span>(d - p * h);  <span class="hljs-comment">// 计算点 pt 到 p 方向投影的距离</span><br><br>    <span class="hljs-type">float</span> gradient = <span class="hljs-number">0.0</span>;<br>    <span class="hljs-comment">// 渐变范围为 0 ° 到 90°</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-type">float</span> gradient_angle = PI * <span class="hljs-number">0.5</span>;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">length</span>(d) &lt; radius) &#123;  <span class="hljs-comment">// 点 pt 在圆内</span><br>        <span class="hljs-comment">// 计算当前点与扫描线之间的夹角</span><br>        <span class="hljs-type">float</span> angle = <span class="hljs-built_in">mod</span>(theta + <span class="hljs-built_in">atan</span>(d.y, d.x), PI2);<br>        <span class="hljs-comment">// 夹角越小，投影颜色越深</span><br>        gradient = <span class="hljs-built_in">clamp</span>(gradient_angle - angle, <span class="hljs-number">0.0</span>, gradient_angle) / gradient_angle * <span class="hljs-number">0.5</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> gradient + <span class="hljs-number">1.0</span> - <span class="hljs-built_in">smoothstep</span>(line_width, line_width + edge_thickness, l);<br>&#125;<br><br><span class="hljs-type">float</span> circle(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> center, <span class="hljs-type">float</span> radius, <span class="hljs-type">float</span> line_width, <span class="hljs-type">float</span> edge_thickness) &#123;<br>    pt -= center;<br>    <span class="hljs-type">float</span> len = <span class="hljs-built_in">length</span>(pt);<br>    <span class="hljs-type">float</span> result = <span class="hljs-built_in">smoothstep</span>(radius - line_width / <span class="hljs-number">2.0</span> - edge_thickness, radius - line_width / <span class="hljs-number">2.0</span>, len) - <span class="hljs-built_in">smoothstep</span>(radius + line_width / <span class="hljs-number">2.0</span>, radius + line_width / <span class="hljs-number">2.0</span> + edge_thickness, len);<br><br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-type">float</span> line(<span class="hljs-type">float</span> a, <span class="hljs-type">float</span> b, <span class="hljs-type">float</span> line_width, <span class="hljs-type">float</span> edge_thickness) &#123;<br>    <span class="hljs-type">float</span> half_line_width = line_width / <span class="hljs-number">2.0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">smoothstep</span>(a - half_line_width - edge_thickness, a - half_line_width, b) -<br>        <span class="hljs-built_in">smoothstep</span>(a + half_line_width, a + half_line_width + edge_thickness, b);<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> axis_color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.8</span>);<br>    <span class="hljs-type">vec3</span> color = line(v_uv.y, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>    color += line(v_uv.x, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>    color += circle(v_uv, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">0.3</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>    color += circle(v_uv, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">0.2</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>    color += circle(v_uv, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">0.1</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>    color += sweep(v_uv, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">0.3</span>, <span class="hljs-number">0.003</span>, <span class="hljs-number">0.001</span>) * <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li>
<p>下面这段代码将画出雷达坐标轴，由两条直线和三个圆组成：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">vec3</span> axis_color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.8</span>);<br><span class="hljs-type">vec3</span> color = line(v_uv.y, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>color += line(v_uv.x, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>color += circle(v_uv, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">0.3</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>color += circle(v_uv, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">0.2</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>color += circle(v_uv, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">0.1</span>, <span class="hljs-number">0.002</span>, <span class="hljs-number">0.001</span>) * axis_color;<br>color += sweep(v_uv, <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">0.3</span>, <span class="hljs-number">0.003</span>, <span class="hljs-number">0.001</span>) * <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>定义 <code>float sweep(vec2 pt, vec2 center, float radius, float line_width, float edge_thickness)</code> 函数显示扫描效果。</p>
<ul>
<li><code>pt</code>：当前点的坐标（一个二维向量）。</li>
<li><code>center</code>：扇形的中心点坐标。</li>
<li><code>radius</code>：扇形的半径。</li>
<li><code>line_width</code>：描述扇形边缘粗细的线宽。</li>
<li><code>edge_thickness</code>：描述扇形边缘羽化的厚度。</li>
</ul>
</li>
</ul>
</div>
<p><img src="023.webp" alt="webp"></p>
<h2 id="024-showing-a-polygon" tabindex="-1" id="024-Showing-a-polygon">024 Showing a polygon</h2>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#define PI2 6.28318530718</span><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec2</span> u_resolution;<br><br><span class="hljs-type">float</span> circle(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> center, <span class="hljs-type">float</span> radius, <span class="hljs-type">float</span> line_width, <span class="hljs-type">float</span> edge_thickness) &#123;<br>    pt -= center;<br>    <span class="hljs-type">float</span> len = <span class="hljs-built_in">length</span>(pt);<br>    <span class="hljs-type">float</span> result = <span class="hljs-built_in">smoothstep</span>(radius - line_width / <span class="hljs-number">2.0</span> - edge_thickness, radius - line_width / <span class="hljs-number">2.0</span>, len) - <span class="hljs-built_in">smoothstep</span>(radius + line_width / <span class="hljs-number">2.0</span>, radius + line_width / <span class="hljs-number">2.0</span> + edge_thickness / <span class="hljs-number">2.0</span>, len);<br><br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-type">float</span> polygon(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">vec2</span> center, <span class="hljs-type">float</span> radius, <span class="hljs-type">int</span> sides, <span class="hljs-type">float</span> rotate, <span class="hljs-type">float</span> edge_thickness) &#123;<br>    pt -= center;<br><br>    <span class="hljs-comment">// Angle and radius from the current pixel</span><br>    <span class="hljs-type">float</span> theta = <span class="hljs-built_in">atan</span>(pt.y, pt.x) + rotate;<br>    <span class="hljs-type">float</span> rad = PI2 / <span class="hljs-type">float</span>(sides);<br><br>    <span class="hljs-comment">// Shaping function that modulate the distance</span><br>    <span class="hljs-comment">// 通过操作 theta，得到当前像素必须“最接近”哪个边，并通过 length(pt) 获取到该点距离中心的距离。</span><br>    <span class="hljs-type">float</span> d = <span class="hljs-built_in">cos</span>(<span class="hljs-built_in">floor</span>(theta / rad + <span class="hljs-number">0.5</span>) * rad - theta) * <span class="hljs-built_in">length</span>(pt);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span> - <span class="hljs-built_in">smoothstep</span>(radius, radius + edge_thickness, d);<br>&#125;<br><br><span class="hljs-type">void</span> main(<span class="hljs-type">void</span>) &#123;<br>    <span class="hljs-type">vec2</span> pt = <span class="hljs-built_in">gl_FragCoord</span>.xy;<br>    <span class="hljs-type">vec2</span> center = u_resolution / <span class="hljs-number">2.0</span>;<br>    <span class="hljs-type">float</span> radius = <span class="hljs-number">80.0</span>;<br>    <span class="hljs-type">vec3</span> color = polygon(pt, center, radius, <span class="hljs-number">3</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>) * <span class="hljs-type">vec3</span>(<span class="hljs-number">0.17</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>);<br>    color += circle(pt, center, radius, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) * <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="024.webp" alt="webp"></p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li>
<p>定义了一个画多边形的函数 <code>float polygon(vec2 pt, vec2 center, float radius, int sides, float rotate, float edge_thickness)</code>，通过计算：</p>
<ul>
<li><code>pt</code>: 当前像素的坐标（使用二维向量表示）。</li>
<li><code>center</code>: 多边形的中心位置（二维向量）。</li>
<li><code>radius</code>: 多边形的半径。</li>
<li><code>sides</code>: 多边形的边数（例如：3 代表三角形，4 代表正方形等）。</li>
<li><code>rotate</code>: 旋转角度，用于旋转多边形。</li>
<li><code>edge_thickness</code>：边缘厚度，用于控制多边形边缘的模糊程度。</li>
</ul>
<hr>
<ul>
<li>
<p><strong>定义参数</strong>：设点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">pt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">p</span><span class="mord mathit">t</span></span></span></span> 的坐标为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>，中心为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">center</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span>，边数为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">sides</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span>，旋转角度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">rotate</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">o</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">e</span></span></span></span>，边缘厚度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>c</mi><mi>k</mi><mi>n</mi><mi>e</mi><mi>s</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">edge\_thickness</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="base textstyle uncramped"><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mord mathit">i</span><span class="mord mathit">c</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathit">n</span><span class="mord mathit">e</span><span class="mord mathit">s</span><span class="mord mathit">s</span></span></span></span>。</p>
</li>
<li>
<p><strong>计算角度</strong>：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>θ</mi><mo>=</mo><mtext><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">n</mi></mtext><mo>(</mo><mi>y</mi><mo>−</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><msub><mi>r</mi><mi>y</mi></msub><mo separator="true">,</mo><mi>x</mi><mo>−</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><msub><mi>r</mi><mi>x</mi></msub><mo>)</mo><mo>+</mo><mi>r</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">\theta = \text{arctan}(y - center_y, x - center_x) + rotate</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mrel">=</span><span class="text mord textstyle uncramped"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm">c</span><span class="mord mathrm">t</span><span class="mord mathrm">a</span><span class="mord mathrm">n</span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">−</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathit">x</span><span class="mbin">−</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">o</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">e</span></span></span></span></p>
</li>
<li>
<p><strong>计算每个边的角度</strong>：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mi>a</mi><mi>d</mi><mo>=</mo><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mrow><mi>s</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">rad = \frac{2\pi}{sides}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.03588em;">π</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></p>
</li>
</ul>
</li>
<li>
<p><strong>计算到边界的距离模调函数</strong>：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>=</mo><mrow><mo fence="true">⌊</mo><mfrac><mrow><mi>θ</mi></mrow><mrow><mi>r</mi><mi>a</mi><mi>d</mi></mrow></mfrac><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo fence="true">⌋</mo></mrow></mrow><annotation encoding="application/x-tex">k = \left\lfloor \frac{\theta}{rad} + 0.5 \right\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8801079999999999em;"></span><span class="strut bottom" style="height:1.2301179999999998em;vertical-align:-0.35001em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mrel">=</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">⌊</span></span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">d</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">+</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">⌋</span></span></span></span></span></span></p>
</li>
<li>
<p><strong>计算距离 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">d</span></span></span></span></strong>：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mo>=</mo><mi>cos</mi><mo>(</mo><mi>k</mi><mo>⋅</mo><mi>r</mi><mi>a</mi><mi>d</mi><mo>−</mo><mi>θ</mi><mo>)</mo><mo>⋅</mo><msqrt><mrow><mo>(</mo><mi>x</mi><mo>−</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><msub><mi>r</mi><mi>x</mi></msub><msup><mo>)</mo><mn>2</mn></msup><mo>+</mo><mo>(</mo><mi>y</mi><mo>−</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><msub><mi>r</mi><mi>y</mi></msub><msup><mo>)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">d = \cos(k \cdot rad - \theta) \cdot \sqrt{(x - center_x)^2 + (y - center_y)^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9169510000000001em;"></span><span class="strut bottom" style="height:1.24001em;vertical-align:-0.32305899999999993em;"></span><span class="base textstyle uncramped"><span class="mord mathit">d</span><span class="mrel">=</span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">⋅</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mbin">⋅</span><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.026951000000000058em;"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">√</span></span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">−</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.289em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">−</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.289em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:-0.836951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span></span></span></span></p>
</li>
</ul>
</div>
<h2 id="025-a-brick-pattern" tabindex="-1" id="025-A-brick-pattern">025 A brick pattern</h2>
<p>​	下面的代码将画一个砖缝图案：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> v_uv;<br><br><span class="hljs-type">float</span> line(<span class="hljs-type">float</span> x, <span class="hljs-type">float</span> y, <span class="hljs-type">float</span> line_width, <span class="hljs-type">float</span> edge_thickness) &#123;<br>    <span class="hljs-type">float</span> half_line_width = line_width * <span class="hljs-number">0.5</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">smoothstep</span>(x - half_line_width - edge_thickness, x - half_line_width, y) - <span class="hljs-built_in">smoothstep</span>(x + half_line_width, x + half_line_width + edge_thickness, y);<br>&#125;<br><br><span class="hljs-type">float</span> brick(<span class="hljs-type">vec2</span> pt, <span class="hljs-type">float</span> mortar_height, <span class="hljs-type">float</span> edge_thickness) &#123;<br>    <span class="hljs-type">float</span> result = line(pt.y, <span class="hljs-number">0.0</span>, mortar_height, edge_thickness);<br>    result += line(pt.y, <span class="hljs-number">0.5</span>, mortar_height, edge_thickness);<br>    result += line(pt.y, <span class="hljs-number">1.0</span>, mortar_height, edge_thickness);<br>    <span class="hljs-keyword">if</span>(pt.y &gt; <span class="hljs-number">0.5</span>)<br>        pt.x = <span class="hljs-built_in">fract</span>(pt.x + <span class="hljs-number">0.5</span>);<br>    result += line(pt.x, <span class="hljs-number">0.5</span>, mortar_height, edge_thickness);<br><br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-type">void</span> main(<span class="hljs-type">void</span>) &#123;<br>    <span class="hljs-type">vec2</span> uv = <span class="hljs-built_in">fract</span>(v_uv * <span class="hljs-number">1.0</span>);<br>    <span class="hljs-type">vec3</span> color = <span class="hljs-built_in">mix</span>(<span class="hljs-type">vec3</span>(<span class="hljs-number">0.75</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.25</span>), <span class="hljs-type">vec3</span>(<span class="hljs-number">0.75</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">0.75</span>), brick(uv, <span class="hljs-number">0.05</span>, <span class="hljs-number">0.001</span>));<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="025.webp" alt="webp"></p>
<p>​	通过修改 <code>vec2 uv = fract(v_uv * 10.0);</code>，生成平铺图案：</p>
<p><img src="025_2.webp" alt="webp"></p>
<h2 id="026-whats-all-that-noise" tabindex="-1" id="026-Whats-all-that-noise">026 Whats all that noise</h2>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<ul>
<li>噪音是给 shader 添加真实感的好方法。</li>
</ul>
</div>
<p>​	下面这段代码将模拟电视机的噪声。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> v_uv;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><br><span class="hljs-type">float</span> random (<span class="hljs-type">vec2</span> st, <span class="hljs-type">float</span> seed) &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-type">float</span> a = <span class="hljs-number">12.9898</span>;<br>    <span class="hljs-keyword">const</span> <span class="hljs-type">float</span> b = <span class="hljs-number">78.233</span>;<br>    <span class="hljs-keyword">const</span> <span class="hljs-type">float</span> c = <span class="hljs-number">43758.543123</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">fract</span>(<span class="hljs-built_in">sin</span>(<span class="hljs-built_in">dot</span>(st, <span class="hljs-type">vec2</span>(a, b)) + seed) * c);<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec3</span> color = random(v_uv, u_time) * <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>);<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="026.webp" alt="webp"></p>
<div class="markdown-alert markdown-alert-tip"><p class="markdown-alert-title"><svg class="octicon octicon-light-bulb mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p><p></p>
<p>​	如果将 <code>a</code>、<code>b</code> 设成 0 或是将 <code>c</code> 设成较小的数字，可能出现奇怪的规则图案。</p>
</div>
<p>​	下面的噪声生成算法将生成格子形的噪声。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> v_uv;<br><br><span class="hljs-type">float</span> random(<span class="hljs-type">vec2</span> st) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">fract</span>(<span class="hljs-built_in">sin</span>(<span class="hljs-built_in">dot</span>(st, <span class="hljs-type">vec2</span>(<span class="hljs-number">12.9898</span>, <span class="hljs-number">78.233</span>))) * <span class="hljs-number">43758.5453123</span>);<br>&#125;<br><br><span class="hljs-type">float</span> noise(<span class="hljs-type">vec2</span> st) &#123;<br>    <span class="hljs-type">vec2</span> i = <span class="hljs-built_in">floor</span>(st);<br>    <span class="hljs-type">vec2</span> f = <span class="hljs-built_in">fract</span>(st);<br><br>    <span class="hljs-comment">// Four corners in 2D of a tile</span><br>    <span class="hljs-type">float</span> a = random(i);<br>    <span class="hljs-type">float</span> b = random(i + <span class="hljs-type">vec2</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>));<br>    <span class="hljs-type">float</span> c = random(i + <span class="hljs-type">vec2</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>));<br>    <span class="hljs-type">float</span> d = random(i + <span class="hljs-type">vec2</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>));<br><br>    <span class="hljs-comment">// Smooth Interpolation</span><br><br>    <span class="hljs-comment">// Cubic Hermine Curve.  Same as SmoothStep()</span><br>    <span class="hljs-type">vec2</span> u = f * f * (<span class="hljs-number">3.0</span> - <span class="hljs-number">2.0</span> * f);<br>    <span class="hljs-comment">// u = smoothstep(0.,1.,f);</span><br><br>    <span class="hljs-comment">// Mix 4 coorners percentages</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">mix</span>(a, b, u.x) +<br>        (c - a) * u.y * (<span class="hljs-number">1.0</span> - u.x) +<br>        (d - b) * u.x * u.y;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec2</span> st = v_uv;<br>    <span class="hljs-type">vec2</span> pos = <span class="hljs-type">vec2</span>(st * <span class="hljs-number">88.0</span>);<br>    <span class="hljs-type">float</span> n = noise(pos);<br><br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(<span class="hljs-type">vec3</span>(n), <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="026_2.webp" alt="webp"></p>
<h2 id="027-using-noise-to-create-a-fire-shader" tabindex="-1" id="027-Using-noise-to-create-a-fire-shader">027 Using noise to create a fire shader</h2>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>​	设计火焰 Shader 的步骤：</p>
<ul>
<li>
<p>A simple noise function</p>
<p>一个简单的噪声函数</p>
</li>
<li>
<p>Move the noise in the y direction over time</p>
<p>随时间沿 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> 方向移动噪声</p>
</li>
<li>
<p>Layer multiple passes of the noise function</p>
<p>对噪声函数的多个通道进行分层</p>
</li>
<li>
<p>Add an alpha layer to crop the result</p>
<p>添加 Alpha 图层以裁剪结果</p>
</li>
</ul>
</div>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/bZYpOv">GLSL Shaders - 30</a> 让噪声图随时间向上平移</li>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/LaOZrz">GLSL Shaders - 31</a> 给噪声图添加颜色</li>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/QoaLPr">GLSL Shaders - 32</a> 创建四种噪声图</li>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/jJYOpo">GLSL Shaders - 33</a> 让这四种噪声图分别移动</li>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/pGMBbo">GLSL Shaders - 35</a> 混合这四种噪声图</li>
</ul>
<script>
    const N27_1 = new CodeFileTreeNode('node27_1', false, '005/css/style.css');
    const N27_2 = new CodeFileTreeNode('node27_2', true, 'css', [N27_1]);
    const N27_3 = new CodeFileTreeNode('node27_3', false, '027/js/index.js');
    const N27_4 = new CodeFileTreeNode('node27_4', true, 'js', [N27_3]);
    const N27_5 = new CodeFileTreeNode('node27_5', false, '005/index.html');
    const N27_6 = new CodeFileTreeNode('node27_6', false, '027/glsl/vertexShader.glsl');
    const N27_7 = new CodeFileTreeNode('node27_7', false, '027/glsl/fragmentShader.glsl');
    const N27_8 = new CodeFileTreeNode('node27_8', true, 'glsl', [N27_6, N27_7]);
    const N27_9 = new CodeFileTreeNode('node27_9', true, '', [N27_2, N27_4, N27_8, N27_5]);
    new CodeFileTree('tree27', N27_9, N27_7).render();
</script> 
<p><img src="027.webp" alt="webp"></p>
<h2 id="028-using-noise-to-create-wood-and-marble" tabindex="-1" id="028-Using-noise-to-create-wood-and-marble">028 Using noise to create wood and marble</h2>
<p>​	这里调整了结构，把 <code>uniform</code> 的信息存到了一个 <code>json</code> 文件中。</p>
<script>
    const N28_1 = new CodeFileTreeNode('node28_1', false, '005/css/style.css');
    const N28_2 = new CodeFileTreeNode('node28_2', true, 'css', [N28_1]);
    const N28_3 = new CodeFileTreeNode('node28_3', false, '028/js/index.js');
    const N28_4 = new CodeFileTreeNode('node28_4', true, 'js', [N28_3]);
    const N28_5 = new CodeFileTreeNode('node28_5', false, '005/index.html');
    const N28_6 = new CodeFileTreeNode('node28_6', false, '028/glsl/vertexShader.glsl');
    const N28_7 = new CodeFileTreeNode('node28_7', false, '028/glsl/fragmentShader.glsl');
    const N28_8 = new CodeFileTreeNode('node28_8', false, '028/glsl/noise.glsl');
    const N28_9 = new CodeFileTreeNode('node28_9', true, 'glsl', [N28_6, N28_7, N28_8]);
    const N28_10 = new CodeFileTreeNode('node28_10', false, '028/json/uniforms.json');
    const N28_11 = new CodeFileTreeNode('node28_11', true, 'json', [N28_10]);
    const N28_12 = new CodeFileTreeNode('node28_12', true, '', [N28_2, N28_4, N28_9, N28_11, N28_5]);
    new CodeFileTree('tree28', N28_12, N28_7).render();
</script> 
<p>​	从 <a target="_blank" rel="noopener" href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/MyShaderChunks.js">s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/MyShaderChunks.js</a> 中可以得到 <code>noise.glsl</code>，使用 <code>THREE.ShaderChunk</code> 扩展已有材质，这样就可以在其它 <code>.glsl</code> 文件中引入：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#include &lt;noise&gt;</span><br></code></pre></td></tr></table></figure>
<p>​	使用里面的噪声函数，生成一个木质纹理：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/pYpvbg">GLSL Shaders - 36</a></li>
</ul>
<p><img src="028.webp" alt="webp"></p>
<p>​	如果使用以下的 <code>fragmentShader.glsl</code>：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/gEoaez">GLSL Shaders - 37</a></li>
</ul>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vPosition;<br><br><span class="hljs-meta">#include &lt;noise&gt;</span><br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">vec2</span> p = vPosition.xy;<br>    <span class="hljs-type">float</span> scale = <span class="hljs-number">800.0</span>;<br>    <span class="hljs-type">vec3</span> color;<br>    <span class="hljs-type">bool</span> marble = <span class="hljs-literal">true</span>;<br><br>    p *= scale;<br><br>    <span class="hljs-keyword">if</span>(marble) &#123;<br>        <span class="hljs-type">float</span> d = perlin(p.x, p.y) * scale;<br>        <span class="hljs-type">float</span> u = p.x + d;<br>        <span class="hljs-type">float</span> v = p.y + d;<br>        d = perlin(u, v) * scale;<br>        <span class="hljs-type">float</span> noise = perlin(p.x + d, p.y + d);<br>        color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.6</span> * (<span class="hljs-type">vec3</span>(<span class="hljs-number">2.0</span> * noise) - <span class="hljs-type">vec3</span>(noise * <span class="hljs-number">0.1</span>, noise * <span class="hljs-number">0.2</span> - <span class="hljs-built_in">sin</span>(u / <span class="hljs-number">30.0</span>) * <span class="hljs-number">0.1</span>, noise * <span class="hljs-number">0.3</span> + <span class="hljs-built_in">sin</span>(v / <span class="hljs-number">40.0</span>) * <span class="hljs-number">0.2</span>)));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        color = <span class="hljs-type">vec3</span>(perlin(p.x, p.y));<br>    &#125;<br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	将得到大理石纹理：</p>
<p><img src="028_2.webp" alt="webp"></p>
<h2 id="029-a-simple-use-of-a-texture-image" tabindex="-1" id="029-A-simple-use-of-a-texture-image">029 A simple use of a texture image</h2>
<p>​	下面的代码将纹理贴图不断自旋：</p>
<script>
    const N29_1 = new CodeFileTreeNode('node29_1', false, '005/css/style.css');
    const N29_2 = new CodeFileTreeNode('node29_2', true, 'css', [N27_1]);
    const N29_3 = new CodeFileTreeNode('node29_3', false, '029/js/index.js');
    const N29_4 = new CodeFileTreeNode('node29_4', true, 'js', [N29_3]);
    const N29_5 = new CodeFileTreeNode('node29_5', false, '005/index.html');
    const N29_6 = new CodeFileTreeNode('node29_6', false, '029/glsl/vertexShader.glsl');
    const N29_7 = new CodeFileTreeNode('node29_7', false, '029/glsl/fragmentShader.glsl');
    const N29_8 = new CodeFileTreeNode('node29_8', false, '029/glsl/noise.glsl');
    const N29_9 = new CodeFileTreeNode('node29_9', true, 'glsl', [N29_6, N29_7, N29_8]);
    const N29_10 = new CodeFileTreeNode('node29_10', false, '029/json/uniforms.json');
    const N29_11 = new CodeFileTreeNode('node29_11', true, 'json', [N29_10]);
    const N29_12 = new CodeFileTreeNode('node29_12', true, '', [N29_2, N29_4, N29_9, N29_11, N29_5]);
    new CodeFileTree('tree29', N29_12, N29_7).render();
</script> 
<p><img src="029.webp" alt="webp"></p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>​	在 THREE.js 中，可通过如下语句给 Shader 传递一个 2D 纹理贴图：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">uniforms.<span class="hljs-property">u_tex</span>.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>().<span class="hljs-title function_">load</span>(<span class="hljs-string">&quot;XXX&quot;</span>);<br></code></pre></td></tr></table></figure>
<p><strong>sampler2D</strong></p>
<ul>
<li><strong>定义</strong>：<code>sampler2D</code> 是一种数据类型，用于表示一个二维纹理的采样器。</li>
<li><strong>功能</strong>：它可以存储纹理对象的引用，并且允许在着色器中对该纹理进行采样。通过 <code>sampler2D</code> 类型的变量，可以使用纹理相关函数（如 <code>texture2D</code>）来获取纹理上的颜色值。</li>
<li><strong>声明</strong>：通常在着色器的 <code>uniform</code> 变量中声明。例如，<code>uniform sampler2D u_tex;</code> 表示一个名为 <code>u_tex</code> 的二维纹理采样器。</li>
</ul>
<p><strong>texture2D</strong></p>
<ul>
<li><strong>定义</strong>：<code>texture2D</code> 是一个函数，用于从一个 <code>sampler2D</code> 类型的纹理中获取颜色值。</li>
<li>参数：这个函数通常接受两个参数：
<ol>
<li><code>sampler2D</code> 变量（例如：<code>u_tex</code>），指明要采样的纹理。</li>
<li>纹理坐标（<code>vec2</code>）表示要从纹理中获取颜色的具体位置。</li>
</ol>
</li>
<li><strong>返回值</strong>：<code>texture2D</code> 返回一个颜色向量，通常是 <code>vec4</code> 类型，表示纹理中指定位置的颜色（包含 RGB 颜色和 alpha 透明度值）。</li>
</ul>
</div>
<h2 id="030-ripple-the-image" tabindex="-1" id="030-Ripple-the-image">030 Ripple the image</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/OdKQyV">GLSL Shaders - 40</a></li>
</ul>
<p>​	在图像中心产生波动效果。</p>
<script>
    const N30_1 = new CodeFileTreeNode('node30_1', false, '005/css/style.css');
    const N30_2 = new CodeFileTreeNode('node30_2', true, 'css', [N27_1]);
    const N30_3 = new CodeFileTreeNode('node30_3', false, '030/js/index.js');
    const N30_4 = new CodeFileTreeNode('node30_4', true, 'js', [N30_3]);
    const N30_5 = new CodeFileTreeNode('node30_5', false, '005/index.html');
    const N30_6 = new CodeFileTreeNode('node30_6', false, '030/glsl/vertexShader.glsl');
    const N30_7 = new CodeFileTreeNode('node30_7', false, '030/glsl/fragmentShader.glsl');
    const N30_9 = new CodeFileTreeNode('node30_9', true, 'glsl', [N30_6, N30_7]);
    const N30_10 = new CodeFileTreeNode('node30_10', false, '030/json/uniforms.json');
    const N30_11 = new CodeFileTreeNode('node30_11', true, 'json', [N30_10]);
    const N30_12 = new CodeFileTreeNode('node30_12', true, '', [N30_2, N30_4, N30_9, N30_11, N30_5]);
    new CodeFileTree('tree30', N30_12, N30_7).render();
</script>
<p><img src="030.webp" alt="webp"></p>
<h2 id="031-blend-between-images" tabindex="-1" id="031-Blend-between-images">031 Blend between images</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/PVMQbP">GLSL Shaders - 41</a></li>
</ul>
<script>
    const N31_1 = new CodeFileTreeNode('node31_1', false, '031/css/style.css');
    const N31_2 = new CodeFileTreeNode('node31_2', true, 'css', [N31_1]);
    const N31_3 = new CodeFileTreeNode('node31_3', false, '031/js/index.js');
    const N31_4 = new CodeFileTreeNode('node31_4', true, 'js', [N31_3]);
    const N31_5 = new CodeFileTreeNode('node31_5', false, '031/index.html');
    const N31_6 = new CodeFileTreeNode('node31_6', false, '031/glsl/vertexShader.glsl');
    const N31_7 = new CodeFileTreeNode('node31_7', false, '031/glsl/fragmentShader.glsl');
    const N31_8 = new CodeFileTreeNode('node31_8', true, 'glsl', [N31_6, N31_7]);
    const N31_9 = new CodeFileTreeNode('node31_9', true, '', [N31_2, N31_4, N31_8, N31_5]);
    new CodeFileTree('tree31', N31_9, N31_3).render();
</script>
<p>​	点击箭头按钮（<code>&lt;div id=&quot;prev&quot;&gt;</code> 和 <code>&lt;div id=&quot;next&quot;&gt;</code>）即可波动地展示下一张图片。</p>
<p><img src="031.webp" alt="webp"></p>
<h2 id="032-create-a-texture-from-text" tabindex="-1" id="032-Create-a-texture-from-text">032 Create a texture from text</h2>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>​	这里项目引入了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/toon3d.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>​	看样子是基于 THREE.js 的一个插件。</p>
<p>​	一个 <code>CanvasText</code> 类包含 4 个参数：</p>
<ul>
<li>A THREE.js scene</li>
<li>A text string</li>
<li>A config object</li>
<li>A material</li>
</ul>
</div>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/ZwgrRR">GLSL Shaders - 42</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/PVMRXa">GLSL Shaders - 43</a> 让文字也有扭曲效果。</p>
</li>
</ul>
<p>​	给 <code>CanvasText</code>上材质：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> uniforms2 = &#123;<br>  <span class="hljs-attr">u_time</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">0.0</span> &#125;,<br>  <span class="hljs-attr">u_duration</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">2.0</span> &#125;,<br>  <span class="hljs-attr">u_twirls</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">7</span> &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> material2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>( &#123;<br>  <span class="hljs-attr">uniforms</span>: uniforms2,<br>  <span class="hljs-attr">vertexShader</span>: vshader,<br>  <span class="hljs-attr">fragmentShader</span>: fshader2,<br>  <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span><br>&#125; );<br><br><span class="hljs-keyword">const</span> canvasText = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasText</span>(scene, info[<span class="hljs-number">1</span>], config, material2);<br></code></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> u_tex;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_duration;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_twirls;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> vUv;<br><br><span class="hljs-type">vec4</span> twirl(<span class="hljs-type">sampler2D</span> tex, <span class="hljs-type">vec2</span> uv, <span class="hljs-type">float</span> time) &#123;<br>    <span class="hljs-keyword">if</span> (time &lt; <span class="hljs-number">0.0</span>) time = <span class="hljs-number">0.0</span>;<br><br>    <span class="hljs-type">vec2</span> center = <span class="hljs-type">vec2</span>(<span class="hljs-number">0.5</span>);<br>    <span class="hljs-type">vec2</span> tc = uv - center;<br>    <span class="hljs-type">float</span> dist = <span class="hljs-built_in">length</span>(tc);<br><br>    <span class="hljs-keyword">if</span> (dist &lt; <span class="hljs-number">0.5</span>) &#123;<br>        <span class="hljs-type">float</span> delta = (<span class="hljs-number">0.5</span> - dist) / <span class="hljs-number">0.5</span>;<br>        <span class="hljs-type">float</span> theta = delta * delta * time * u_twirls;<br>        <span class="hljs-type">float</span> s = <span class="hljs-built_in">sin</span>(theta);<br>        <span class="hljs-type">float</span> c = <span class="hljs-built_in">cos</span>(theta);<br>        <span class="hljs-type">mat2</span> mat = <span class="hljs-type">mat2</span>(c, s, -s, c);<br>        tc = mat * tc;<br>        <span class="hljs-comment">// tc = vec2(dot(tc, vec2(c, -s)), dot(tc, vec2(s, c)));</span><br>    &#125;<br><br>    tc += center;<br>    <span class="hljs-type">vec4</span> color = <span class="hljs-built_in">texture2D</span>(tex, tc);<br>    color.a = <span class="hljs-built_in">mix</span>(<span class="hljs-number">0.0</span>, color.a, <span class="hljs-built_in">min</span>(u_time, <span class="hljs-number">1.0</span>));<br>    <span class="hljs-keyword">return</span> color;<br>&#125;<br><br><span class="hljs-type">void</span> main(<span class="hljs-type">void</span>)&#123;<br>	<span class="hljs-built_in">gl_FragColor</span> = twirl(u_tex, vUv, u_duration - u_time);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="032.webp" alt="webp"></p>
<h2 id="033-turning-a-box-into-a-sphere" tabindex="-1" id="033-Turning-a-box-into-a-sphere">033 Turning a box into a sphere</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/oNvRxBZ">GLSL Shaders - 44 - start</a></li>
</ul>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>​	顶点着色器用于修改模型顶点的位置，这是通过将模型视图矩阵和投影矩阵应用到齐次坐标（三位观察的过程，设置 <code>gl_Position</code>）来实现的。</p>
</div>
<p><img src="033.webp" alt="webp"></p>
<script>
    const N33_1 = new CodeFileTreeNode('node33_1', false, '033/css/style.css');
    const N33_2 = new CodeFileTreeNode('node33_2', true, 'css', [N33_1]);
    const N33_3 = new CodeFileTreeNode('node33_3', false, '033/js/index.js');
    const N33_4 = new CodeFileTreeNode('node33_4', true, 'js', [N33_3]);
    const N33_5 = new CodeFileTreeNode('node33_5', false, '033/index.html');
    const N33_6 = new CodeFileTreeNode('node33_6', false, '033/glsl/vertexShader.glsl');
    const N33_7 = new CodeFileTreeNode('node33_7', false, '033/glsl/fragmentShader.glsl');
    const N33_8 = new CodeFileTreeNode('node33_8', true, 'glsl', [N33_6, N33_7]);
    const N33_9 = new CodeFileTreeNode('node33_9', true, '', [N33_2, N33_4, N33_8, N33_5]);
    new CodeFileTree('tree33', N33_9, N33_3).render();
</script>
<p>​	创建一个正方体：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">30</span>, <span class="hljs-number">30</span>, <span class="hljs-number">30</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure>
<p>​	编辑顶点着色器：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_radius;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">float</span> delta = ((<span class="hljs-built_in">sin</span>(u_time) + <span class="hljs-number">1.0</span>) / <span class="hljs-number">2.0</span>);<br><br>    <span class="hljs-type">vec3</span> v = <span class="hljs-built_in">normalize</span>(position) * u_radius;  <span class="hljs-comment">// 变成球</span><br>    <span class="hljs-type">vec3</span> pos = <span class="hljs-built_in">mix</span>(position, v, delta);<br><br>    <span class="hljs-built_in">gl_Position</span> = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>(pos, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="034-using-the-three.js-lighting-chunks" tabindex="-1" id="034-Using-the-THREE-js-lighting-chunks">034 Using the THREE.js lighting chunks</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/MxgBVL">GLSL Shaders - 45</a></li>
</ul>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p><strong>Adding lighting -cheatsheet 添加灯光–操作手册</strong></p>
<ul>
<li>
<p>Make sure to add at least one light to your scene</p>
<p>确保在场景中至少添加一个灯光</p>
</li>
<li>
<p>Add the <code>THREE.UniformsLib</code> uniforms, common and lights</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> uniforms = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">UniformsUtils</span>.<span class="hljs-title function_">merge</span>( [<br>  <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">UniformsLib</span>[ <span class="hljs-string">&quot;common&quot;</span> ],<br>  <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">UniformsLib</span>[ <span class="hljs-string">&quot;lights&quot;</span> ]<br>]); <br></code></pre></td></tr></table></figure>
</li>
<li>
<p>Make sure <code>lights: true</code> is added to the ShaderMaterial properties</p>
<p>确保在着色器材质属性中添加 <code>lights: true</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>( &#123;<br>  <span class="hljs-attr">uniforms</span>: uniforms,<br>  <span class="hljs-attr">vertexShader</span>: vshader,<br>  <span class="hljs-attr">fragmentShader</span>: fshader,<br>  <span class="hljs-attr">lights</span>: <span class="hljs-literal">true</span><br>&#125; );<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>In the vertex shader include the chunks <code>common</code> and <code>lights_pars</code> begin</p>
<p>在顶点着色器中加入 <code>common</code> 和 <code>lights_pars</code> 开始块</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#include &lt;common&gt;</span><br><span class="hljs-meta">#include &lt;lights_pars_begin&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>In the main function include the relevant chunks</p>
<p>在主函数中包含相关块</p>
</li>
<li>
<p>Use the values <code>vlightFront</code>, <code>vlightBack</code> and <code>ambientlightColor</code> passing these to the fragment shader</p>
<p>使用 <code>vlightFront</code>、<code>vlightBack</code> 和 <code>ambientlightColor</code> 值，并将这些值传递给片段着色器</p>
</li>
</ul>
</div>
<p>​	通过下面的代码可以引入 THREE.js 的光照 shader chunk：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">ShaderChunk</span>.<span class="hljs-property">simple_lambert_vertex</span> = <span class="hljs-string">`</span><br><span class="hljs-string">	vec3 vLightFront, vLightBack;</span><br><span class="hljs-string">	#include &lt;beginnormal_vertex&gt;</span><br><span class="hljs-string">	#include &lt;defaultnormal_vertex&gt;</span><br><span class="hljs-string">	#include &lt;begin_vertex&gt;</span><br><span class="hljs-string">	#include &lt;project_vertex&gt;</span><br><span class="hljs-string">	#include &lt;lights_lambert_vertex&gt;</span><br><span class="hljs-string">`</span><br></code></pre></td></tr></table></figure>
<p>​	下面的代码创建灯光：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> ambient = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">HemisphereLight</span>(<span class="hljs-number">0x444444</span>, <span class="hljs-number">0x111111</span>, <span class="hljs-number">1</span>);<br><span class="hljs-keyword">const</span> light = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xcccccc</span>, <span class="hljs-number">0.8</span>);<br>light.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">2</span>);<br>scene.<span class="hljs-title function_">add</span>(ambient);<br>scene.<span class="hljs-title function_">add</span>(light);<br></code></pre></td></tr></table></figure>
<p>​	在顶点着色器获取光照情况：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#include &lt;common&gt;</span><br><span class="hljs-meta">#include &lt;lights_pars_begin&gt;</span><br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_radius;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vPosition;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vLightIntensity;<br><br><span class="hljs-type">float</span> getDelta()&#123;<br>  <span class="hljs-keyword">return</span> ((<span class="hljs-built_in">sin</span>(u_time)+<span class="hljs-number">1.0</span>)/<span class="hljs-number">2.0</span>);<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>  <span class="hljs-type">float</span> delta = getDelta();<br>  <span class="hljs-type">vec3</span> vLightFront;<br>  <span class="hljs-type">vec3</span> objectNormal = delta * normal + (<span class="hljs-number">1.0</span> - delta) * <span class="hljs-built_in">normalize</span>(position);<br><br>  <span class="hljs-meta">#include &lt;defaultnormal_vertex&gt;</span><br>  <span class="hljs-meta">#include &lt;begin_vertex&gt;</span><br>  <span class="hljs-meta">#include &lt;project_vertex&gt;</span><br>  <span class="hljs-meta">#include &lt;lights_lambert_vertex&gt;</span><br><br>  vLightIntensity = vLightFront + ambientLightColor;<br>  vPosition = position;<br><br>  <span class="hljs-type">vec3</span> v = <span class="hljs-built_in">normalize</span>(position) * u_radius;<br>  <span class="hljs-type">vec3</span> pos = delta * position + (<span class="hljs-number">1.0</span> - delta) * v;<br><br>  <span class="hljs-built_in">gl_Position</span> = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>( pos, <span class="hljs-number">1.0</span> );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	在片元着色器中应用光照：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vLightIntensity;<br><br><span class="hljs-type">void</span> main()<br>&#123;<br>  <span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.5</span>);<br>  <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(vLightIntensity * color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="035-creating-an-explosion" tabindex="-1" id="035-Creating-an-explosion">035 Creating an explosion</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/bzXyEE">GLSL Shaders - 46</a></li>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/PLYRWm">GLSL Shaders - 49</a></li>
</ul>
<p>​	创建一个 20 面体：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">IcosahedronGeometry</span>( <span class="hljs-number">20</span>, <span class="hljs-number">4</span> );<br></code></pre></td></tr></table></figure>
<p>​	如下设置参数，<code>u_tex</code> 是一张 9x128 的贴图。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> uniforms = &#123;<br>  <span class="hljs-attr">u_time</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">0.0</span> &#125;,<br>  <span class="hljs-attr">u_mouse</span>: &#123; <span class="hljs-attr">value</span>:&#123; <span class="hljs-attr">x</span>:<span class="hljs-number">0.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">0.0</span> &#125;&#125;,<br>  <span class="hljs-attr">u_resolution</span>: &#123; <span class="hljs-attr">value</span>:&#123; <span class="hljs-attr">x</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">0</span> &#125;&#125;,<br>  <span class="hljs-attr">u_tex</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>().<span class="hljs-title function_">load</span>(<span class="hljs-string">&quot;https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/explosion.png&quot;</span>)&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	修改顶点着色器使其不断翻滚：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#include &lt;noise&gt;</span><br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> vUv;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">float</span> vNoise;<br><br><span class="hljs-type">void</span> main() &#123;	<br>  <span class="hljs-type">float</span> time = u_time * <span class="hljs-number">1.0</span>;<br>  <span class="hljs-type">float</span> displacement;<br>  <span class="hljs-type">float</span> b;<br><br>  vUv = uv;<br>  <br>  <span class="hljs-comment">// add time to the noise parameters so it&#x27;s animated</span><br>  vNoise = <span class="hljs-number">10.0</span> *  <span class="hljs-number">-.10</span> * turbulence( <span class="hljs-number">.5</span> * normal + time );<br>  b = <span class="hljs-number">5.0</span> * pnoise( <span class="hljs-number">0.05</span> * position + <span class="hljs-type">vec3</span>( <span class="hljs-number">2.0</span> * time ), <span class="hljs-type">vec3</span>( <span class="hljs-number">100.0</span> ) );<br>  displacement = - <span class="hljs-number">10.</span> * vNoise + b;<br><br>  <span class="hljs-comment">// move the position along the normal and transform it</span><br>  <span class="hljs-type">vec3</span> newPosition = position + normal * displacement;<br>  <span class="hljs-built_in">gl_Position</span> = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>( newPosition, <span class="hljs-number">1.0</span> );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	随机设置其 uv 贴图坐标：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#define PI 3.141592653589</span><br><span class="hljs-meta">#define PI2 6.28318530718</span><br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec2</span> u_mouse;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec2</span> u_resolution;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_time;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> u_tex;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> vUv;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">float</span> vNoise;<br><br><span class="hljs-comment">// &lt;https://www.shadertoy.com/view/4dS3Wd&gt;</span><br><span class="hljs-comment">// By Morgan McGuire @morgan3d, http://graphicscodex.com</span><br><br><span class="hljs-comment">// https://www.clicktorelease.com/blog/vertex-displacement-noise-3d-webgl-glsl-three-js/</span><br><br><span class="hljs-type">float</span> random( <span class="hljs-type">vec3</span> pt, <span class="hljs-type">float</span> seed )&#123;<br>  <span class="hljs-type">vec3</span> scale = <span class="hljs-type">vec3</span>( <span class="hljs-number">12.9898</span>, <span class="hljs-number">78.233</span>, <span class="hljs-number">151.7182</span> );<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">fract</span>( <span class="hljs-built_in">sin</span>( <span class="hljs-built_in">dot</span>( pt + seed, scale ) ) * <span class="hljs-number">43758.5453</span> + seed ) ;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br><br>  <span class="hljs-comment">// get a random offset</span><br>  <span class="hljs-type">float</span> r = <span class="hljs-number">.01</span> * random( <span class="hljs-built_in">gl_FragCoord</span>.xyz, <span class="hljs-number">0.0</span> );<br>  <span class="hljs-comment">// lookup vertically in the texture, using noise and offset</span><br>  <span class="hljs-comment">// to get the right RGB colour</span><br>  <span class="hljs-type">vec2</span> uv = <span class="hljs-type">vec2</span>( <span class="hljs-number">0</span>, <span class="hljs-number">1.3</span> * vNoise + r );<br>  <span class="hljs-type">vec3</span> color = <span class="hljs-built_in">texture2D</span>( u_tex, uv ).rgb;<br><br>  <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>( color, <span class="hljs-number">1.0</span> );<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="036-fresnel-shading" tabindex="-1" id="036-Fresnel-shading">036 Fresnel shading</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/LaYbpd">GLSL Shaders - 50</a></li>
</ul>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>​	人们在菲涅耳效果中的着色器中常用的效果。使用菲涅耳，您可以使对象的轮廓变暗、变亮或着色，从而增加深度感。</p>
</div>
<p>​	创建一个三面环形纽结：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TorusKnotGeometry</span>( <span class="hljs-number">1</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">100</span>, <span class="hljs-number">16</span> );	<br></code></pre></td></tr></table></figure>
<p>​	设置材质参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>( &#123;<br>  <span class="hljs-attr">uniforms</span>: uniforms,<br>  <span class="hljs-attr">vertexShader</span>: vshader,<br>  <span class="hljs-attr">fragmentShader</span>: fshader,<br>  <span class="hljs-attr">wireframe</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">lights</span>: <span class="hljs-literal">true</span><br>&#125; );<br></code></pre></td></tr></table></figure>
<p>​	顶点着色器。向片元着色器传递顶点位置、模型矩阵、世界法线和光照。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#include &lt;common&gt;</span><br><span class="hljs-meta">#include &lt;lights_pars_begin&gt;</span><br><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vPosition;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">mat4</span> vModelMatrix;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vWorldNormal;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vLightIntensity;<br><br><span class="hljs-type">void</span> main() &#123;<br>  <span class="hljs-meta">#include &lt;simple_lambert_vertex&gt;</span><br><br>  vLightIntensity = vLightFront + ambientLightColor;<br><br>  vWorldNormal = <span class="hljs-built_in">normalize</span>((modelMatrix * <span class="hljs-type">vec4</span>(normal, <span class="hljs-number">0.0</span>)).xyz);<br>  vPosition = position;<br>  vModelMatrix = modelMatrix;<br><br>  <span class="hljs-built_in">gl_Position</span> = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>( position, <span class="hljs-number">1.0</span> );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	片元着色器中一阵计算：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> u_color;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> u_light_position;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> u_rim_color;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_rim_strength;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> u_rim_width;<br><br><span class="hljs-comment">// Example varyings passed from the vertex shader</span><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vPosition;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vWorldNormal;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">mat4</span> vModelMatrix;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vLightIntensity;<br><br><span class="hljs-type">void</span> main()<br>&#123;<br>  <span class="hljs-type">vec3</span> worldPosition = ( vModelMatrix * <span class="hljs-type">vec4</span>( vPosition, <span class="hljs-number">1.0</span> )).xyz;<br>  <span class="hljs-type">vec3</span> lightVector = <span class="hljs-built_in">normalize</span>( u_light_position - worldPosition );<br>  <span class="hljs-type">vec3</span> viewVector = <span class="hljs-built_in">normalize</span>(cameraPosition - worldPosition);<br>  <span class="hljs-type">float</span> rimndotv =  <span class="hljs-built_in">max</span>(<span class="hljs-number">0.0</span>, u_rim_width - <span class="hljs-built_in">clamp</span>(<span class="hljs-built_in">dot</span>(vWorldNormal, viewVector), <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>));<br>  <span class="hljs-type">vec3</span> rimLight = rimndotv * u_rim_color * u_rim_strength;<br>  <span class="hljs-type">vec3</span> color = vLightIntensity * u_color + rimLight;<br><br>  <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>( color, <span class="hljs-number">1.0</span> );<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="037-environment-mapping" tabindex="-1" id="037-Environment-mapping">037 Environment mapping</h2>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p><strong>Environment mapping tips 环境贴图技巧</strong></p>
<ul>
<li>
<p>An environment map, usually a CubeTexture, defined using 6 images</p>
<p>环境贴图（通常是立方体贴图）由 6 幅图像定义</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> envmap = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CubeTextureLoader</span>()<br>  .<span class="hljs-title function_">setPath</span>( <span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/&#x27;</span> )<br>  .<span class="hljs-title function_">load</span>( [<br>    <span class="hljs-string">&#x27;skybox2_px.jpg&#x27;</span>,<br>    <span class="hljs-string">&#x27;skybox2_nx.jpg&#x27;</span>,<br>    <span class="hljs-string">&#x27;skybox2_py.jpg&#x27;</span>,<br>    <span class="hljs-string">&#x27;skybox2_ny.jpg&#x27;</span>,<br>    <span class="hljs-string">&#x27;skybox2_pz.jpg&#x27;</span>,<br>    <span class="hljs-string">&#x27;skybox2_nz.jpg&#x27;</span><br>  ] );<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>A normalized view vector</p>
<p>归一化视图向量</p>
</li>
<li>
<p>Use the GLSL function reflect to get the reflected vector.</p>
<p>使用 GLSL 函数 reflect 获取反射矢量。</p>
</li>
<li>
<p>Use the vec3 from step 3 with the textureCube function.</p>
<p>将步骤 3 中的 vec3 与纹理立方体函数结合使用。</p>
</li>
<li>
<p>Use a uniform to set the reflection strength.</p>
<p>使用均匀设置反射强度。</p>
</li>
<li>
<p>Use the texel from step 4 with the strength uniform in the color calculation</p>
<p>在颜色计算中使用步骤 4 中的 texel 和均匀强度</p>
</li>
</ul>
</div>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/xxKNVvX">GLSL Shaders - 51 - start</a></li>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/JzjwmW">GLSL Shaders - 52</a></li>
</ul>
<p>​	从 <a target="_blank" rel="noopener" href="https://shaderfrog.com/app/editor">Editor - ShaderFrog.com</a> 这个网站可以编写 Shader（以代码或 Shader Graph）并导出 THREE.js 和 Unity 支持的格式！</p>
<p><img src="037.webp" alt="webp"></p>
<p>​	之后载入这个 json：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">runtime.<span class="hljs-title function_">load</span>( <span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/Electronic_knot.json&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"> shaderData </span>) &#123;<br>    ...<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>​	片元着色器：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#define PI 3.1415926535897932384626433832795</span><br><br><span class="hljs-keyword">precision</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">float</span>;<br><span class="hljs-keyword">precision</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">int</span>;<br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> time;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> resolution;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> intensity;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> speed;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> lightColor;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> baseColor;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> mirrorReflection;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">samplerCube</span> reflectionSampler;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> vUv;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vPosition;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vReflect;<br><br><span class="hljs-type">vec2</span> circuit(<span class="hljs-type">vec2</span> p) &#123;<br>    p = <span class="hljs-built_in">fract</span>(p);<br>    <span class="hljs-type">float</span> r = <span class="hljs-number">0.3</span>;<br>    <span class="hljs-type">float</span> v = <span class="hljs-number">0.0</span>, g = <span class="hljs-number">1.0</span>;<br>    <span class="hljs-type">float</span> d;<br>    <span class="hljs-keyword">const</span> <span class="hljs-type">int</span> iter = <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; iter; i++) &#123;<br>        d = p.x - r;<br>        g += <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">clamp</span>(<span class="hljs-number">1.0</span> - <span class="hljs-built_in">abs</span>(d), <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>), <span class="hljs-number">200.0</span>);<br>        <span class="hljs-keyword">if</span> (d &gt; <span class="hljs-number">0.0</span>) &#123;<br>            p.x = (p.x - r) / (<span class="hljs-number">1.8</span> - r);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            p.x = p.x;<br>        &#125;<br>        p = p.yx;<br>    &#125;<br>    v /= <span class="hljs-type">float</span>(iter);<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">vec2</span>(g, v);<br>&#125;<br><br><span class="hljs-type">vec4</span> Circuit_Grid1542300119956_44_main() &#123;<br>    <span class="hljs-type">vec4</span> Circuit_Grid1542300119956_44_gl_FragColor = <span class="hljs-type">vec4</span>(<span class="hljs-number">0.0</span>);<br>    <span class="hljs-type">vec2</span> uv = (vUv.xy + <span class="hljs-number">0.5</span>) * resolution;<br>    <span class="hljs-type">vec2</span> cid2 = <span class="hljs-built_in">floor</span>(uv);<br>    <span class="hljs-type">float</span> cid = (cid2.y + cid2.x);<br>    <span class="hljs-type">vec2</span> dg = circuit(uv);<br>    <span class="hljs-type">float</span> d = dg.x;<br>    <span class="hljs-type">vec3</span> col1 = (<span class="hljs-number">0.2</span> - <span class="hljs-type">vec3</span>(<span class="hljs-built_in">max</span>(<span class="hljs-built_in">min</span>(d, <span class="hljs-number">2.0</span>) - <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>))) * baseColor;<br>    <span class="hljs-type">vec3</span> col2 = <span class="hljs-type">vec3</span>(<span class="hljs-built_in">max</span>(d - <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>)) * lightColor;<br>    <span class="hljs-type">float</span> f = <span class="hljs-built_in">max</span>(<span class="hljs-number">0.4</span> - <span class="hljs-built_in">mod</span>(uv.y - uv.x + (time * speed) + (dg.y * <span class="hljs-number">0.2</span>), <span class="hljs-number">2.5</span>), <span class="hljs-number">0.0</span>) * intensity;<br>    col2 *= f;<br>    Circuit_Grid1542300119956_44_gl_FragColor = <span class="hljs-type">vec4</span>(col1 + col2, <span class="hljs-number">1.0</span>);<br>    <span class="hljs-keyword">return</span> Circuit_Grid1542300119956_44_gl_FragColor *= <span class="hljs-number">1.0</span>;<br>&#125;<br><br><span class="hljs-type">vec4</span> Reflection_Cube_Map1542300154764_58_main() &#123;<br>    <span class="hljs-type">vec4</span> Reflection_Cube_Map1542300154764_58_gl_FragColor = <span class="hljs-type">vec4</span>(<span class="hljs-number">0.0</span>);<br>    <span class="hljs-type">vec4</span> cubeColor = <span class="hljs-built_in">textureCube</span>(reflectionSampler, <span class="hljs-type">vec3</span>(mirrorReflection * vReflect.x, vReflect.yz));<br>    cubeColor.w = <span class="hljs-number">1.0</span>;<br>    Reflection_Cube_Map1542300154764_58_gl_FragColor = cubeColor;<br>    <span class="hljs-keyword">return</span> Reflection_Cube_Map1542300154764_58_gl_FragColor *= <span class="hljs-number">1.0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-built_in">gl_FragColor</span> = (Circuit_Grid1542300119956_44_main() + Reflection_Cube_Map1542300154764_58_main());<br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	顶点着色器：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">precision</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">float</span>;<br><span class="hljs-keyword">precision</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">int</span>;<br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> modelMatrix;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> modelViewMatrix;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> projectionMatrix;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> viewMatrix;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat3</span> normalMatrix;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> cameraPosition;<br><br><span class="hljs-keyword">attribute</span> <span class="hljs-type">vec3</span> position;<br><span class="hljs-keyword">attribute</span> <span class="hljs-type">vec3</span> normal;<br><span class="hljs-keyword">attribute</span> <span class="hljs-type">vec2</span> uv;<br><span class="hljs-keyword">attribute</span> <span class="hljs-type">vec2</span> uv2;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> vUv;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vPosition;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vReflect;<br><br><span class="hljs-type">vec4</span> Circuit_Grid1542300119956_44_main() &#123;<br>    <span class="hljs-type">vec4</span> Circuit_Grid1542300119956_44_gl_Position = <span class="hljs-type">vec4</span>(<span class="hljs-number">0.0</span>);<br>    vUv = uv;<br>    vPosition = position;<br>    Circuit_Grid1542300119956_44_gl_Position = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>(position, <span class="hljs-number">1.0</span>);<br>    <span class="hljs-keyword">return</span> Circuit_Grid1542300119956_44_gl_Position *= <span class="hljs-number">1.0</span>;<br>&#125;<br><br><span class="hljs-type">vec4</span> Reflection_Cube_Map1542300154764_58_main() &#123;<br>    <span class="hljs-type">vec4</span> Reflection_Cube_Map1542300154764_58_gl_Position = <span class="hljs-type">vec4</span>(<span class="hljs-number">0.0</span>);<br>    <span class="hljs-type">vec3</span> worldPosition = (modelMatrix * <span class="hljs-type">vec4</span>(position, <span class="hljs-number">1.0</span>)).xyz;<br>    <span class="hljs-type">vec3</span> cameraToVertex = <span class="hljs-built_in">normalize</span>(worldPosition - cameraPosition);<br>    <span class="hljs-type">vec3</span> worldNormal = <span class="hljs-built_in">normalize</span>(<span class="hljs-type">mat3</span>(modelMatrix[<span class="hljs-number">0</span>].xyz, modelMatrix[<span class="hljs-number">1</span>].xyz, modelMatrix[<span class="hljs-number">2</span>].xyz) * normal);<br>    vReflect = <span class="hljs-built_in">reflect</span>(cameraToVertex, worldNormal);<br>    Reflection_Cube_Map1542300154764_58_gl_Position = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>(position, <span class="hljs-number">1.0</span>);<br>    <span class="hljs-keyword">return</span> Reflection_Cube_Map1542300154764_58_gl_Position *= <span class="hljs-number">1.0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-built_in">gl_Position</span> = Circuit_Grid1542300119956_44_main() + Reflection_Cube_Map1542300154764_58_main();<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="038-bump-mapping" tabindex="-1" id="038-Bump-mapping">038 Bump mapping</h2>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p></p>
<p>​	对于法线贴图来说：</p>
<ul>
<li>
<p>红色通道存 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span> 方向反射角</p>
</li>
<li>
<p>绿色通道存 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> 方向反射角</p>
</li>
<li>
<p>蓝色通道存 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span></span> 方向反射角</p>
</li>
</ul>
<p>​	由于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span></span> 方向反射角一般都是 1，所以法线贴图一般呈蓝色。</p>
</div>
<ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/nik-lever/pen/PLRpze">GLSL Shaders - 53</a></li>
</ul>
<p>​	引入漫反射贴图和法线贴图：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">uniforms.<span class="hljs-property">u_diffuse_map</span> = &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>().<span class="hljs-title function_">load</span>(<span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/bricks-diffuse3.png&#x27;</span>) &#125;;<br>uniforms.<span class="hljs-property">u_normal_map</span> = &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>().<span class="hljs-title function_">load</span>(<span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/bricks-normal3.png&#x27;</span>) &#125;;<br></code></pre></td></tr></table></figure>
<p>​	顶点着色器传递法线信息：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vNormal;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> vUv;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">mat4</span> vModelMatrix;<br><br><span class="hljs-type">void</span> main() &#123;<br>  vUv = uv;<br>  vNormal = normal;<br>  vModelMatrix = modelMatrix;<br><br>  <span class="hljs-built_in">gl_Position</span> = projectionMatrix * modelViewMatrix * <span class="hljs-type">vec4</span>( position, <span class="hljs-number">1.0</span> );  <br>&#125;<br></code></pre></td></tr></table></figure>
<p>​	片元着色器中接受法线信息，修改反射角：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">varying</span> <span class="hljs-type">vec2</span> vUv;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">vec3</span> vNormal;<br><span class="hljs-keyword">varying</span> <span class="hljs-type">mat4</span> vModelMatrix;<br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> u_light;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec2</span> u_resolution;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> u_color;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> u_diffuse_map;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> u_normal_map;<br><br><span class="hljs-type">void</span> main()&#123;<br>  <span class="hljs-type">vec3</span> lightVector = <span class="hljs-built_in">normalize</span>(u_light);<br>  <span class="hljs-type">vec4</span> normal = <span class="hljs-built_in">texture2D</span>(u_normal_map, vUv);<br>  <span class="hljs-type">vec3</span> normalVector = <span class="hljs-built_in">normalize</span>((vModelMatrix * (normal + <span class="hljs-type">vec4</span>(vNormal, <span class="hljs-number">1.0</span>))).xyz);<br>  <span class="hljs-type">float</span> lightIntensity = <span class="hljs-built_in">clamp</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-built_in">dot</span>(lightVector, normalVector)) + <span class="hljs-number">0.2</span>;<br>  <span class="hljs-type">vec3</span> texel = <span class="hljs-built_in">texture2D</span>(u_diffuse_map, vUv).rgb;<br>  <span class="hljs-type">vec3</span> color = lightIntensity * texel;<br><br>	<span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="039-conclusion" tabindex="-1" id="039-Conclusion">039 Conclusion</h2>
<p>​	一些 Shader 的神奇小网站：</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://shaderfrog.com/app">Browse - ShaderFrog.com</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://github.com/patriciogonzalezvivo/glslViewer">patriciogonzalezvivo/glslViewer: Console-based GLSL Sandbox for 2D/3D shaders</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://glslsandbox.com/">GLSL Sandbox Gallery</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://thebookofshaders.com/">The Book of Shaders</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://www.shadertoy.com/">Shadertoy BETA</a></p>
</li>
</ul>
<h2 id="040-bonus-lecture" tabindex="-1" id="040-Bonus-Lecture">040 Bonus Lecture</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/@NikLever">Unity Tutorial: Creating a Low-Poly Swamp (w/ Polaris, Crest, Synty, Enviro, Vegetation Studio Pro)</a> 这个作者还教点别的，这一方面，老外的教学资源还是更丰富一些。</li>
</ul>

            </article>
            
	<div class="rightside">
	
		<div class="rightside-button" id="js-aside">
			<span>
				<img no-lazy src="/images/icon/aside.png" class="rightside-button-icon" alt="Icon">
			</span>
		</div>
		<script>
			$("#js-aside").click(function () {
				onShowAsideButton();
			});
		</script>
	
	<div class="rightside-button" id="js-toggle_theme">
		<span>
			<img no-lazy src="/images/icon/toggle_theme.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	
<script src="/js/plugins/goto_position.js"></script>

	
	<div class="rightside-button" id="js-go_top">
		<span>
			<img no-lazy src="/images/icon/go_top.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>
	<div class="rightside-button" id="js-go_bottom">
		<span>
			<img no-lazy src="/images/icon/go_bottom.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	<script>
		setToggleThemeButtonListener();
	</script>
	<script>
		$('#js-go_top')
		.gotoPosition( {
			speed: 300,
			target: 'top',
		} );
		$('#js-go_bottom')
		.gotoPosition( {
			speed: 300,
			target: 'bottom',
		} );
	</script>
</div>


<div class="post-bottom">
    
        <div class="post-paging">     
            <div class="post-paging-last">
                
                    <a href="/posts/Hexo-%E6%8F%92%E4%BB%B6/">
                        上一篇：Hexo-插件
                    </a>
                
            </div>
            <div class="post-paging-next">
                
                    <a href="/posts/PL-TypeScript/">
                        下一篇：PL-TypeScript
                    </a>
                
            </div>
        </div>
    
    
    
        
            <div class="giscus comments"></div>
            <script>
                var scriptElement = document.createElement('script');
                scriptElement.src = 'https://giscus.app/client.js';
                scriptElement.setAttribute('data-repo', 'GZ-Metal-Cell/GZ-Metal-Cell.github.io');
                scriptElement.setAttribute('data-repo-id', 'R_kgDOIHLEOQ');
                scriptElement.setAttribute('data-category', 'Announcements');
                scriptElement.setAttribute('data-category-id', 'DIC_kwDOIHLEOc4CcVwP');
                scriptElement.setAttribute('data-mapping', 'title');
                scriptElement.setAttribute('data-strict', '1');
                scriptElement.setAttribute('data-reactions-enabled', '');
                scriptElement.setAttribute('data-emit-metadata', '0');
                scriptElement.setAttribute('data-input-position', 'bottom');
                scriptElement.setAttribute('data-theme', localStorage.getItem('theme') === 'light' ? 'light' : 'dark_high_contrast');
                scriptElement.setAttribute('data-lang', 'zh-CN');
                
                scriptElement.setAttribute('crossorigin', 'anonymous');
                scriptElement.async = true;
                document.head.appendChild(scriptElement);
            </script>
        
    
</div>
        </div>
    </main>
    
        <aside class="main-aside">
    
<script src="/js/widgets/aside.js"></script>

    <script>
        showAside();
    </script>

    <div class="aside-top">
        <div class="aside-top-about aside-card">
            <a href="/about" class="aside-top-about-portrait">
                <img no-lazy src="/about/portrait.png" alt="Q">
            </a>
            <div class="aside-top-about-info">
                <span class="author"> Zi-Zi</span>
                <span class="description">不以物喜，不以己悲。</span>
            </div>              
            <div class="aside-top-about-site">
                <a href="/categories" class="aside-top-about-site-item">
                    <span class="title">类别</span>
                    <span class="count">5</span>
                </a>
                <a href="/tags" class="aside-top-about-site-item">
                    <span class="title">标签</span>
                    <span class="count">121</span>
                </a>
                <a href="/archives" class="aside-top-about-site-item">
                    <span class="title">归档</span>
                    <span class="count">436</span>
                </a>
            </div>
            <div class="aside-top-about-contact">
                
                    
                        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
                            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
                            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
                            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
                            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
                        </a>
                    
                
            </div>
        </div> 

        
    </div>

    <div class="aside-bottom">
        
            <script>
                
                    const tocCollapsed = true;
                
                
                    const tocDepth = 6;
                
                var headerString = '';
                for (let i = 1; i <= tocDepth; i++) {
                    if (i === 1) {
                        headerString += 'h1';
                    } else {
                        headerString += ', h' + i;
                    }
                }
                hbeToc();
            </script>
            <div class="aside-bottom-toc aside-card">
                <div class="aside-bottom-toc-title">
                    <h1>目录</h1>
                    <span class="toc-percentage"></span>
                </div>
                <ol class="aside-bottom-toc-content"></ol>
            </div>
        
    </div>
</aside>
    
</div>
		<footer>
	<div class="content">
		
			<span>©2022-2025&nbsp;By&nbsp;<a href="/about">Zi-Zi</a>.</span>
		
		<span><a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> theme by <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell/hexo-theme-quieter">Quieter</a>.</span>
		
			<span style="display: flex;">
				<img no-lazy alt="icp" src="/images/icp_icon.png" style="width: 16px; height: 16px;">
				<a href="https://icp.gov.moe/?keyword=20241647" target="_blank">萌 ICP 备 20241647 号</a>
			</span>
		
	</div>

	
<script src="/js/plugins/ref.js"></script>

	
<script src="/js/plugins/highlight_tools.js"></script>

	<script>
		const  COPY_ICON = "/images/icon/copy.png";
		const CLOSE_CODE_BLOCK_ICON = "/images/icon/close_code_block.png";
		const HIGHLIGHT_SHRINK = "";
		const HIGHLIGHT_HEIGHT_LIMIT = "";
	</script>

	
	
	<!-- Analytics -->

    
        <!-- Busuanzi Analytics -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?e57cf62289f84322ebff116e8b3d343e";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    


	

	
		
			
				<link rel="stylesheet" href="/css/plugins/katex/katex.min.css">
				<script src="/js/plugins/copy-tex.js"></script>
			
		
	

    
		
<link rel="stylesheet" href="/css/plugins/textIndent.css">

		
<script src="/js/plugins/textIndent.js"></script>

	

	
	
	
		<script>
			if (typeof init === 'function') {
				init();
			}
		</script>
	

	
		
	

	
		
	

	<!--
		
<script src="/js/plugins/jquery.pjax.min.js"></script>

		<script>
			$(document).pjax('a[target!=_blank]', 'main', {
				fragment: 'main',
				timeout: 8000
			});

			$(document).on('pjax:complete', function() {
			});
		</script> 
	-->
	<script>
		console.log('\n %c Hexo-Quieter 主题 %c https://github.com/GZ-Metal-Cell/hexo-theme-quieter \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
	</script>
</footer>
	</body>

	<!-- Hexo-Quieter 主题  https://github.com/GZ-Metal-Cell/hexo-theme-quieter -->
</html>

