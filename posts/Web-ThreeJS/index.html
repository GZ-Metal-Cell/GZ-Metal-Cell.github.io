<!DOCTYPE html>
<html lang=zh-CN data-theme="light">
	
<script src="/js/plugins/toggleTheme.js"></script>

	<script>
		setTheme();
	</script>
	<head>
		
<title>Web-ThreeJS | Zi-Zi's Journey</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/images/icon/favicon.ico">
<link href="/css/plugins/print.css" media="print" rel="stylesheet" />

<link rel="stylesheet" href="/css/index.css">



<meta name="keywords" content="JavaScript,前端,Canvas,">
<meta name="description" content="给网页整点牛逼的！">



<script src="/js/plugins/jquery.min.js"></script>


<script src="/js/plugins/hljs.min.js"></script>


<script src="/js/plugins/init.js"></script>


<script src="/js/plugins/hide.js"></script>


<script src="/js/plugins/tabs.js"></script>



    



    
<script src="/js/plugins/alert-title.js"></script>

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-base.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-dark-class.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-light.css">






    

	<meta name="generator" content="Hexo 6.1.0"></head>

	<body>
		<header class="sticky-header">
	<nav>
		<div class="nav-left">
			<a href="/" class="logo">
				<img no-lazy src="/images/headers_icon/logo.webp" alt="Quieter">
			</a>
			<ul class="breadcrumb" id="breadcrumb"></ul>
		</div>
		<div class="nav-right">
			<ul>
				
					<li>
						<a href="/">
						  主页
						</a>
					</li>
				
					<li>
						<a href="/categories">
						  类别
						</a>
					</li>
				
					<li>
						<a href="/tags">
						  标签
						</a>
					</li>
				
					<li>
						<a href="/archives">
						  归档
						</a>
					</li>
				
					<li>
						<a href="/galleries">
						  相册
						</a>
					</li>
				
					<li>
						<a href="/links">
						  链接
						</a>
					</li>
				
					<li>
						<a href="/about">
						  关于
						</a>
					</li>
								  
			</ul>
		</div>
		<div class="nav-right-close">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
				<path fill="none" d="M0 0h24v24H0z" />
				<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
			</svg>
		</div>

		<div class="sidebar">
    <div class="topo">
        <p>Zi-Zi's Journey</p>
    </div>
    <ul>
        
        <li>
            <a href="/">
                主页
            </a>
        </li>
        
        <li>
            <a href="/categories">
                类别
            </a>
        </li>
        
        <li>
            <a href="/tags">
                标签
            </a>
        </li>
        
        <li>
            <a href="/archives">
                归档
            </a>
        </li>
        
        <li>
            <a href="/galleries">
                相册
            </a>
        </li>
        
        <li>
            <a href="/links">
                链接
            </a>
        </li>
        
        <li>
            <a href="/about">
                关于
            </a>
        </li>
        
    </ul>
    <div class="sidebar-footer">
        
        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
        </a>
        
    </div>
</div>
<div class='shelter'>
    <script>
        $(function() {
            $('.nav-right-close > svg').click(function() {
                $('.sidebar').animate({
                    right: "0"
                }, 500);
                $('.shelter').fadeIn("slow");
            
                var element = $('.topo');
                element.addClass('custom-style');
            
                var links = null;
                if ("") {
                    links = "".split(',');
                } else {
                    links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
                }
            
                var randomLink = links[Math.floor(Math.random() * links.length)];
                element.css('background-image', "url('" + randomLink + "')");
            });
          
            $('.shelter').click(function(e) {
                $('.sidebar').animate({
                    right: "-100%"
                }, 500);
                $('.shelter').fadeOut("slow");
            });
        });      
    </script>
</div>
	</nav>

	
		<div class="header-background"></div>
	

	<script>
		const name = 'post';
		const ul = document.querySelectorAll('.nav-right ul')[0];
		const lis = ul.querySelectorAll('li');

		if (name == 'home') {
			lis[0].classList.add('select');
		} else {
			for (let i = 0; i < lis.length; i++) {
				const li = lis[i];
				const a = li.querySelector('a');
				if (name === a.href.split('/')[3]) {
					li.classList.add('select');
				}
			}
		}
	</script>
	
	<script>
		var element = document.querySelector('.header-background');
		if(element) {
			element.classList.add('custom-style');
			var links = null;
			if("")
			{
				links = "".split(',');
			} else
			{
				links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
			}
			var randomLink = links[Math.floor(Math.random() * links.length)];
			element.style.backgroundImage = "url('" + randomLink + "')";
		}
	</script>

	
<script src="/js/plugins/breadcrumb.js"></script>

	<script>
		var menus_title = [];
		
			menus_title.push({home: '主页'});
		
			menus_title.push({categories: '类别'});
		
			menus_title.push({tags: '标签'});
		
			menus_title.push({archives: '归档'});
		
			menus_title.push({galleries: '相册'});
		
			menus_title.push({links: '链接'});
		
			menus_title.push({about: '关于'});
		
		
			
				postsBreadcrumb(
					document.getElementById('breadcrumb'),
					"类别",
					"/categories",
					"学习",
					"/categories/学习",
					1
				);
			
		
	</script>
</header>

<div class="main-wrapper">
    <main class="post">
        <header class="main-header">
	
		
			
				
<link rel="stylesheet" href="/css/plugins/fancybox.css">

				
<script src="/js/plugins/fancybox.umd.js"></script>

				
<script src="/js/plugins/fancybox.js"></script>

			
			<div class="post-header-background-content">
				<ul class="post-header-tag">
					
						
							<li><a href="/tags/JavaScript"><span>JavaScript</span></a></li>
						
							<li><a href="/tags/前端"><span>前端</span></a></li>
						
							<li><a href="/tags/Canvas"><span>Canvas</span></a></li>
						
					
				</ul>
				
				<h1>Web-ThreeJS</h1>
		
				
					<div class="post-header-desc">
						<svg t="1714702231661" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1154" xmlns:xlink="http://www.w3.org/1999/xlink"
						width="20" height="20">
						<path
							d="M778.24 117.76A46.08 46.08 0 0 1 824.32 163.84v430.08c0 8.4992-4.13696 16.01536-10.50624 20.6848l-0.24576 0.2048L587.5712 846.09024a35.84 35.84 0 0 1-61.48096-25.06752v-220.9792a46.08 46.08 0 0 1 46.08-46.08l200.94976-0.02048V168.96h-522.24v686.08H389.12c13.25056 0 24.1664 10.07616 25.47712 22.97856l0.12288 2.62144c0 14.1312-11.4688 25.6-25.6 25.6h-143.36A46.08 46.08 0 0 1 199.68 860.16V163.84A46.08 46.08 0 0 1 245.76 117.76h532.48z m-26.78784 487.38304h-174.16192v178.176l174.16192-178.176z m-45.19936-169.94304a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z m0-122.88a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z"
							fill="#ffffff" p-id="1155"></path>
						</svg>
						<p>给网页整点牛逼的！</p>
					</div>
				
		
				<div class="post-header-info">
					<svg t="1604839279282" class="icon" viewBox="0 0 1024 1024" version="1.1"
					xmlns="http://www.w3.org/2000/svg" p-id="2901" width="20" height="20">
						<path
							d="M513 956.3c-247.7 0-448-200.3-448-448S265.3 66.2 513 66.2s448 200.3 448 448-200.3 442.1-448 442.1z m0-830.9c-212.2 0-388.8 170.7-388.8 388.8C124.2 726.3 294.9 903 513 903c212.2 0 388.8-170.7 388.8-388.8S725.2 125.4 513 125.4z m0 430.2c-94.2 0-170.7-76.5-170.7-170.7S418.8 207.8 513 207.8s170.7 76.5 170.7 170.7S607.2 555.6 513 555.6z m0-289.1c-64.6 0-112 52.8-112 112s47.4 117.9 112 117.9 112-52.8 112-112-47.4-117.9-112-117.9z m0 689.8c-135.7 0-259-58.7-341.9-158.9l-11.8-17.8 11.8-17.8c76.5-117.9 206.2-188.5 347.8-188.5 135.7 0 265 64.6 341.9 182.6l11.8 17.8-11.8 17.8C778 897.1 648.7 956.3 513 956.3zM230.3 773.2C300.9 849.7 406.9 897 513 897c112 0 218.1-47.4 288.6-129.8-70.5-88.2-170.7-135.6-282.7-135.6s-218.1 53.3-288.6 141.6z"
							p-id="2902" fill="#ffffff"></path>
					</svg>
					<div class="post-header-info-author">
						<a href="/about">Zi-Zi</a>
					</div>
					
						<div class="post-header-info-categories">
							
								<a href="/categories/学习">学习</a>
							
						</div>
					
					<time>2024/02/04 14:34:00</time>
				</div>
		
				
					<div class="post-header-stat">
						<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve" width="20" height="20">
							<path fill="#FFFFFF" d="M187.2,165.6c0,2.6-2.1,4.7-4.7,4.7H17.5c-2.6,0-4.7-2.1-4.7-4.7s2.1-4.7,4.7-4.7h165.1
								C185.2,160.9,187.2,163,187.2,165.6z"/>
							<path fill="#FFFFFF" d="M17.5,29.7c2.6,0,4.7,2.1,4.7,4.7v131.2c0,2.6-2.1,4.7-4.7,4.7s-4.7-2.1-4.7-4.7V34.4
								C12.8,31.8,14.9,29.7,17.5,29.7z M77.9,91.5c1.8,1.8,1.8,4.8,0,6.6l-39.8,39.8c-1.9,1.8-4.9,1.7-6.6-0.2c-1.7-1.8-1.7-4.6,0-6.4
								l39.8-39.8C73.1,89.6,76,89.6,77.9,91.5z M169.9,70.2c1.6,2.1,1.1,5-0.9,6.5c0,0,0,0,0,0l-64.2,48.2c-2.1,1.5-5,1.1-6.6-0.9
								c-1.6-2.1-1.1-5,0.9-6.5c0,0,0,0,0,0l64.2-48.2C165.4,67.7,168.3,68.1,169.9,70.2L169.9,70.2z"/>
							<path fill="#FFFFFF" d="M104.6,124.5c-1.8,1.8-4.8,1.8-6.6,0L71.6,98.1c-1.8-1.8-1.8-4.8,0-6.6c1.8-1.8,4.8-1.8,6.6,0l26.3,26.3
								C106.4,119.6,106.4,122.6,104.6,124.5C104.6,124.4,104.6,124.4,104.6,124.5z"/>
						</svg>
		
						
							
<script src="/js/plugins/wordCount.js"></script>

							<p class="post-count">文字数：---</p>
						
		
						
							<p id="busuanzi_container_page_pv" style='display:none;'>阅读数：<span id="busuanzi_value_page_pv"></span></p>
						
					</div>
				
			</div>
		
	
</header>
        <div class="post-content article-container">
            <article class="post-content-info">
                <h1 id="%E8%B5%84%E6%BA%90" tabindex="-1">资源</h1>
<ul>
<li>
<p>官网：<a target="_blank" rel="noopener" href="https://threejs.org/">Three.js – JavaScript 3D Library (threejs.org)</a></p>
</li>
<li>
<p>three.js 中文网：<a target="_blank" rel="noopener" href="http://www.webgl3d.cn/">Three.js 中文网 (webgl3d.cn)</a></p>
</li>
<li>
<p>电子书：<a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/">《探索 three.js》(discoverthreejs.com)</a></p>
</li>
<li>
<p>GitHub：<a target="_blank" rel="noopener" href="https://github.com/mrdoob/three.js">mrdoob/three.js: JavaScript 3D Library. (github.com)</a></p>
</li>
</ul>
<h1 id="0" tabindex="-1">0</h1>
<h2 id="0.4-github-%E4%B8%8A%E7%9A%84-three.js---%E9%AD%94%E6%B3%95%E5%87%BA%E7%8E%B0%E7%9A%84%E5%9C%B0%E6%96%B9" tabindex="-1" id="0-4-GitHub-上的-three-js-魔法出现的地方">0.4 GitHub 上的 three.js - 魔法出现的地方</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/introduction/github-repo/">GitHub 上的 three.js - 魔法出现的地方 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/mrdoob/three.js">mrdoob/three.js: JavaScript 3D Library. (github.com)</a> 中：</p>
<ul>
<li><code>build/three.module.js</code> 是运行所需的文件。</li>
<li><code>examples/</code> 代码示例。</li>
<li><code>src/</code> 源代码。</li>
</ul>
<h2 id="0.5-%E5%A6%82%E4%BD%95%E5%9C%A8%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BC%95%E5%85%A5-three.js" tabindex="-1" id="0-5-如何在你的项目中引入-three-js">0.5 如何在你的项目中引入 three.js</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/introduction/get-threejs/">如何在你的项目中引入 three.js | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<div class="tabs" id="install"><div class="nav-tabs"><button type="button" class="tab active" data-href="install-1">Node.js</button><button type="button" class="tab" data-href="install-2">直接导入</button></div><div class="tab-contents"><div class="tab-item-content active" id="install-1"><p>在项目文件夹中，初始化 npm：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm init<br></code></pre></td></tr></table></figure>
<p>安装 three.js:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save three<br></code></pre></td></tr></table></figure>
<p>导入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<span class="hljs-variable constant_">XXX</span>, <span class="hljs-variable constant_">XXX</span>, <span class="hljs-variable constant_">XXX</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/build/three.module.js&#x27;</span>;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="install-2"><p>直接从 <a target="_blank" rel="noopener" href="https://github.com/mrdoob/three.js">mrdoob/three.js: JavaScript 3D Library. (github.com)</a> 里下载 <code>build/three.module.js</code></p>
<p>要引入的话，直接：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;three.module.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></div></div></div>
<h1 id="1-%E5%85%A5%E9%97%A8%EF%BC%9A%E7%9C%9F%E6%AD%A3%E7%9A%84%E4%B9%90%E8%B6%A3%E4%BB%8E%E8%BF%99%E9%87%8C%E5%BC%80%E5%A7%8B%EF%BC%81" tabindex="-1">1-入门：真正的乐趣从这里开始！</h1>
<h2 id="1.1-three.js-%E5%BA%94%E7%94%A8%E7%9A%84%E7%BB%93%E6%9E%84" tabindex="-1" id="1-1-Three-js-应用的结构">1.1 Three.js 应用的结构</h2>
<ul>
<li>如果按<a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/app-structure/">Three.js 应用的结构 | Discover three.js (discoverthreejs.com)</a>所规定（为了保证这篇博客的结构，我在这里并没有完全按照它来做）：</li>
</ul>
<div class="tabs" id="construction"><div class="nav-tabs"><button type="button" class="tab active" data-href="construction-1">index.html</button><button type="button" class="tab" data-href="construction-2">main.css</button><button type="button" class="tab" data-href="construction-3">main.js</button><button type="button" class="tab" data-href="construction-4">vendor/</button><button type="button" class="tab" data-href="construction-5">assets</button></div><div class="tab-contents"><div class="tab-item-content active" id="construction-1"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./styles/main.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scene-container&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Our &lt;canvas&gt; will be inserted here --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./src/main.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="construction-2"><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>    <span class="hljs-comment">/* remove margins and scroll bars */</span><br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">overflow</span>: hidden;<br><br>    <span class="hljs-comment">/* style text */</span><br>    <span class="hljs-attribute">text-align</span>: center;<br>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;<br>    <span class="hljs-attribute">font-family</span>: Sans-Serif;<br><br>    <span class="hljs-comment">/* color text */</span><br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#444</span>;<br>&#125;<br><br><span class="hljs-selector-tag">h1</span> &#123;<br>    <span class="hljs-comment">/* position the heading */</span><br>    <span class="hljs-attribute">position</span>: absolute;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br><br>    <span class="hljs-comment">/* make sure that the heading is drawn on top */</span><br>    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-selector-id">#scene-container</span> &#123;<br>    <span class="hljs-comment">/* tell our scene container to take up the full page */</span><br>    <span class="hljs-attribute">position</span>: absolute;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br><br>    <span class="hljs-comment">/* Set the container&#x27;s background color to the same as the scene&#x27;s background to prevent flashing on load */</span><br>    <span class="hljs-attribute">background-color</span>: skyblue;<br>&#125;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="construction-3"><p>npm 方式导入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<br><span class="hljs-title class_">Camera</span>,<br><span class="hljs-title class_">Group</span>,<br><span class="hljs-title class_">Scene</span>,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">GLTFLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/GLTFLoader.js&#x27;</span>;<br></code></pre></td></tr></table></figure>
<hr>
<p>cdn 方式导入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Camera</span>, <span class="hljs-title class_">Group</span>, <span class="hljs-title class_">Scene</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://cdn.skypack.dev/three@0.132.2&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://cdn.skypack.dev/three@0.132.2/examples/jsm/controls/OrbitControls.js?module&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">GLTFLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://cdn.skypack.dev/three@0.132.2/examples/jsm/loaders/GLTFLoader.js?module&quot;</span>;<br></code></pre></td></tr></table></figure>
<hr>
<p>直接从 <a target="_blank" rel="noopener" href="https://github.com/mrdoob/three.js">mrdoob/three.js: JavaScript 3D Library. (github.com)</a> 里下载 <code>build/three.module.js</code>，放在<code>vendor/three/build/</code> 下，本地导入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 导入 Three.js 模块</span><br><span class="hljs-keyword">import</span> &#123;<br>	<span class="hljs-variable constant_">XXX</span>,<br>    <span class="hljs-variable constant_">XXX</span><br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../vendor/three/build/three.module.js&#x27;</span>;<br><br>...自由操作...<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="construction-4"><p>放置<strong>其他人</strong>编写的 JS 文件的地方。</p></div><div class="tab-item-content" id="construction-5"><p><strong>使用的任何非 HTML、CSS 或 JavaScript 的东西都在这里</strong>：纹理、3D 模型、字体、声音等等。</p></div></div></div>
<h2 id="1.2-%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-three.js-%E5%9C%BA%E6%99%AF%EF%BC%9A%E4%BD%A0%E5%A5%BD%EF%BC%8C%E7%AB%8B%E6%96%B9%E4%BD%93%EF%BC%81" tabindex="-1" id="1-2-你的第一个-three-js-场景：你好，立方体！">1.2 你的第一个 three.js 场景：你好，立方体！</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/first-scene/">你的第一个 three.js 场景：你好，立方体！| Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p>编写 <code>main.js</code>：</p>
<ul>
<li>导入模块：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 导入 Three.js 模块</span><br><span class="hljs-keyword">import</span> &#123;<br>    <span class="hljs-title class_">Scene</span>,<br>    <span class="hljs-title class_">PerspectiveCamera</span>,<br>    <span class="hljs-title class_">WebGLRenderer</span>,<br>    <span class="hljs-title class_">BoxGeometry</span>,<br>    <span class="hljs-title class_">MeshBasicMaterial</span>,<br>    <span class="hljs-title class_">Mesh</span>,<br>    <span class="hljs-title class_">Color</span><br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../vendor/three/build/three.module.js&#x27;</span>;<br></code></pre></td></tr></table></figure>
<ul>
<li>获取画布所在容器：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#scene-container&#x27;</span>);<br></code></pre></td></tr></table></figure>
<ul>
<li>创建一个新的场景：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scene</span>();<br></code></pre></td></tr></table></figure>
<ul>
<li>设置背景为天蓝色：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>(<span class="hljs-string">&#x27;skyblue&#x27;</span>);<br></code></pre></td></tr></table></figure>
<ul>
<li>定义一个透视相机：
<ul>
<li><code>fov</code>：视野范围</li>
<li><code>aspect</code>：摄影机宽高比（容器的宽高比）</li>
<li><code>near</code>：近裁剪面的距离。只有在这个距离之后的物体才会被摄像机捕捉到，太近的物体会被忽略。这个值应该设置为正数，并且尽可能小以避免裁剪近处的重要细节，但过小的值可能会导致深度缓冲问题。</li>
<li><code>far</code>：远裁剪面的距离。任何在这个距离之外的物体都不会被摄像机捕捉到。这个值决定了摄像机可以看到多远的场景，设置得过大可能会影响渲染性能和深度缓冲的精度。</li>
</ul>
</li>
<li>定义好后，放在场景的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mn>0</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(0, 0, 10)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mclose">)</span></span></span></span> 处。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> fov = <span class="hljs-number">35</span>; <span class="hljs-comment">// AKA Field of View</span><br><span class="hljs-keyword">const</span> aspect = container.<span class="hljs-property">clientWidth</span> / container.<span class="hljs-property">clientHeight</span>;<br><span class="hljs-keyword">const</span> near = <span class="hljs-number">0.1</span>; <span class="hljs-comment">// the near clipping plane</span><br><span class="hljs-keyword">const</span> far = <span class="hljs-number">100</span>; <span class="hljs-comment">// the far clipping plane</span><br><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerspectiveCamera</span>(fov, aspect, near, far);<br>camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure>
<ul>
<li>定义一个立方体网格，尺寸设为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>2</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>2</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(2, 2, 2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">2</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mclose">)</span></span></span></span>：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 注意这里使用的是 BoxGeometry</span><br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure>
<ul>
<li>定义材质：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x44aa88</span> &#125;);<br></code></pre></td></tr></table></figure>
<ul>
<li>一个 Mesh 对象——由网格和材质组成：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, material);<br></code></pre></td></tr></table></figure>
<ul>
<li>往场景中添加这个立方体：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">scene.<span class="hljs-title function_">add</span>(cube);<br></code></pre></td></tr></table></figure>
<ul>
<li>
<p>接下来是渲染操作：</p>
<ul>
<li>
<p><code>const renderer = new WebGLRenderer();</code>：创建了一个新的 <code>WebGLRenderer</code> 实例。</p>
<p><code>WebGLRenderer </code>是 Three.js 中用于在网页上渲染 3D 图形的渲染器。它使用 WebGL API 来绘制场景和模型。默认情况下，这个渲染器会创建一个 <code>&lt;canvas&gt;</code> 元素，用于显示渲染的 3D 图形。</p>
<ul>
<li>
<p><code>renderer.setSize(container.clientWidth, container.clientHeight);</code>：使用<code>setSize</code>方法设置渲染器的大小，以适应容器（通常是某个 HTML 元素）的尺寸。</p>
<p><code>container.clientWidth</code> 和 <code>container.clientHeight</code> 分别获取容器的宽度和高度，确保渲染的 3D 场景能够充满整个容器，不会出现拉伸或压缩的情况。</p>
</li>
<li>
<p><code>renderer.setPixelRatio(window.devicePixelRatio);</code>：</p>
<p>通过 <code>setPixelRatio</code> 方法设置渲染器的像素比，使用 <code>window.devicePixelRatio</code> 来适配不同设备的屏幕分辨率。这样可以确保在具有高像素密度的显示屏（如 Retina 屏幕）上也能获得清晰的渲染效果。</p>
</li>
<li>
<p><code>container.appendChild(renderer.domElement);</code>：</p>
<p>渲染器创建的 <code>&lt;canvas&gt;</code> 元素可以通过 <code>renderer.domElement</code> 访问。这行代码将这个 <code>&lt;canvas&gt;</code> 元素添加到之前指定的 HTML 容器中，使得渲染的 3D 场景能够显示在网页上的该容器内。</p>
</li>
<li>
<p><code>renderer.render(scene, camera);</code>：</p>
<p>最后，使用 <code>render</code> 方法渲染场景。这个方法接受两个参数：<code>scene</code>（场景）和 <code>camera</code>（摄像机）。场景包含了所有要渲染的 3D 对象，而摄像机定义了观察场景的视角。调用这个方法时，Three.js 会根据提供的场景和摄像机参数，计算并绘制最终的图像到 <code>&lt;canvas&gt;</code> 元素上。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebGLRenderer</span>();<br>renderer.<span class="hljs-title function_">setSize</span>(container.<span class="hljs-property">clientWidth</span>, container.<span class="hljs-property">clientHeight</span>);<br>renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>);<br><br>container.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>renderer.<span class="hljs-title function_">render</span>(scene, camera);<br></code></pre></td></tr></table></figure>
<p>​    <a href="pages/01_1" target="_blank"><b>演示</b></a></p>
<p>我想，这段代码在 Blender 里的实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> bpy<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># 删除默认场景中的所有物体</span><br>bpy.ops.<span class="hljs-built_in">object</span>.select_all(action=<span class="hljs-string">&#x27;SELECT&#x27;</span>)<br>bpy.ops.<span class="hljs-built_in">object</span>.delete(use_global=<span class="hljs-literal">False</span>)<br><br><span class="hljs-comment"># 设置使用 Cycles 渲染引擎，也可以设置为&#x27;Eevee&#x27;</span><br>bpy.context.scene.render.engine = <span class="hljs-string">&#x27;CYCLES&#x27;</span><br><br><span class="hljs-comment"># 获取当前世界</span><br>world = bpy.data.worlds[<span class="hljs-string">&#x27;World&#x27;</span>]<br><span class="hljs-comment"># 确保使用节点</span><br>world.use_nodes = <span class="hljs-literal">True</span><br><span class="hljs-comment"># 获取节点树和节点</span><br>nodes = world.node_tree.nodes<br><span class="hljs-comment"># 清除所有现有节点</span><br>nodes.clear()<br><span class="hljs-comment"># 创建一个新的背景节点</span><br>bg_node = nodes.new(<span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;ShaderNodeBackground&#x27;</span>)<br><span class="hljs-comment"># 设置背景颜色为天蓝色</span><br>bg_node.inputs[<span class="hljs-number">0</span>].default_value = (<span class="hljs-number">135</span>/<span class="hljs-number">255</span>, <span class="hljs-number">206</span>/<span class="hljs-number">235</span>, <span class="hljs-number">235</span>/<span class="hljs-number">255</span>, <span class="hljs-number">1</span>)  <span class="hljs-comment"># RGBA</span><br><span class="hljs-comment"># 创建一个世界输出节点</span><br>world_output_node = nodes.new(<span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;ShaderNodeOutputWorld&#x27;</span>)<br><span class="hljs-comment"># 链接背景节点到世界输出节点</span><br>links = world.node_tree.links<br>link = links.new(bg_node.outputs[<span class="hljs-number">0</span>], world_output_node.inputs[<span class="hljs-number">0</span>])<br><br><span class="hljs-comment"># 创建一个立方体</span><br>bpy.ops.mesh.primitive_cube_add(size=<span class="hljs-number">2</span>, location=(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))<br><span class="hljs-comment"># 获取刚刚添加的立方体对象</span><br>cube = bpy.context.<span class="hljs-built_in">object</span><br><span class="hljs-comment"># 创建一个新的材质</span><br>mat = bpy.data.materials.new(name=<span class="hljs-string">&quot;CubeMaterial&quot;</span>)<br><span class="hljs-comment"># 设置材质的基础颜色</span><br>mat.diffuse_color = (<span class="hljs-number">68</span>/<span class="hljs-number">255</span>, <span class="hljs-number">170</span>/<span class="hljs-number">255</span>, <span class="hljs-number">136</span>/<span class="hljs-number">255</span>, <span class="hljs-number">1</span>)  <span class="hljs-comment"># RGB + Alpha</span><br><span class="hljs-comment"># 将材质分配给立方体</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cube.data.materials:<br>    cube.data.materials.append(mat)<br><span class="hljs-keyword">else</span>:<br>    cube.data.materials[<span class="hljs-number">0</span>] = mat<br><br><span class="hljs-comment"># 添加摄像机并直接获取引用</span><br>bpy.ops.<span class="hljs-built_in">object</span>.camera_add(location=(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>))<br>camera = bpy.context.<span class="hljs-built_in">object</span>  <span class="hljs-comment"># 获取刚刚添加的摄像机对象</span><br><br><span class="hljs-comment"># 设置摄像机的 fov, near 和 far 参数</span><br>camera.data.angle = <span class="hljs-number">35</span> * (np.pi / <span class="hljs-number">180</span>)  <span class="hljs-comment"># Blender 中使用弧度，Three.js 使用度</span><br>camera.data.clip_start = <span class="hljs-number">0.1</span><br>camera.data.clip_end = <span class="hljs-number">100</span><br><br><span class="hljs-comment"># 摄像机位置已经在添加时设置，这里不需要重复设置</span><br><span class="hljs-comment"># camera.location = (0, 0, 10)</span><br><br><span class="hljs-comment"># 设置渲染分辨率</span><br>bpy.context.scene.render.resolution_x = <span class="hljs-number">1848</span><br>bpy.context.scene.render.resolution_y = <span class="hljs-number">1206</span><br>bpy.context.scene.render.resolution_percentage = <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure>
<p><img src="images/01_2.png" alt="Blender"></p>
<h2 id="1.3-%E4%BB%8B%E7%BB%8D%E4%B8%96%E7%95%8C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" tabindex="-1" id="1-3-介绍世界应用程序">1.3 介绍世界应用程序</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/world-app/">介绍世界应用程序 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p>这章主要是将之前的代码模块化。</p>
<p><img src="images/01_3.png" alt="模块化"></p>
<div class="tabs" id="moudle"><div class="nav-tabs"><button type="button" class="tab active" data-href="moudle-1">main.js</button><button type="button" class="tab" data-href="moudle-2">world.js</button><button type="button" class="tab" data-href="moudle-3">renderer.js</button><button type="button" class="tab" data-href="moudle-4">scene.js</button><button type="button" class="tab" data-href="moudle-5">camera.js</button><button type="button" class="tab" data-href="moudle-6">cube.js</button><button type="button" class="tab" data-href="moudle-7">resizer.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="moudle-1"><p>获取 <code>container</code>，导入 <code>World.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">World</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./World/world.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// Get a reference to the container element</span><br>    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#scene-container&#x27;</span>);<br><br>    <span class="hljs-comment">// 1. Create an instance of the World app</span><br>    <span class="hljs-keyword">const</span> world = <span class="hljs-keyword">new</span> <span class="hljs-title class_">World</span>(container);<br><br>    <span class="hljs-comment">// 2. Render the scene</span><br>    world.<span class="hljs-title function_">render</span>();<br>&#125;<br><br><span class="hljs-comment">// call main to start the app</span><br><span class="hljs-title function_">main</span>();<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="moudle-2"><p>把之前定义摄像机、创建立方体、设置场景环境、渲染器、窗口适应之类的全扔进去。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCube &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/cube.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/resizer.js&#x27;</span>;<br><br><span class="hljs-comment">// These variables are module-scoped: we cannot access them</span><br><span class="hljs-comment">// from outside the module</span><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> cube = <span class="hljs-title function_">createCube</span>();<br><br>        scene.<span class="hljs-title function_">add</span>(cube);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// draw a single frame</span><br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="moudle-3"><p>渲染器系统：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">WebGLRenderer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createRenderer</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebGLRenderer</span>();<br><br>    <span class="hljs-keyword">return</span> renderer;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createRenderer &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="moudle-4"><p>场景组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Color</span>, <span class="hljs-title class_">Scene</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createScene</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scene</span>();<br><br>    scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>(<span class="hljs-string">&#x27;skyblue&#x27;</span>);<br><br>    <span class="hljs-keyword">return</span> scene;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createScene &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="moudle-5"><p>相机组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">PerspectiveCamera</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCamera</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerspectiveCamera</span>(<br>        <span class="hljs-number">35</span>, <span class="hljs-comment">// fov = Field Of View</span><br>        <span class="hljs-number">1</span>, <span class="hljs-comment">// aspect ratio (dummy value)</span><br>        <span class="hljs-number">0.1</span>, <span class="hljs-comment">// near clipping plane</span><br>        <span class="hljs-number">100</span>, <span class="hljs-comment">// far clipping plane</span><br>    );<br><br>    <span class="hljs-comment">// move the camera back so we can view the scene</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<br><br>    <span class="hljs-keyword">return</span> camera;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createCamera &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="moudle-6"><p>立方体组件，它包括创建 几何体、材质和 网格。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BoxBufferGeometry</span>, <span class="hljs-title class_">Mesh</span>, <span class="hljs-title class_">MeshBasicMaterial</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCube</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// create a geometry</span><br>    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoxBufferGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br><br>    <span class="hljs-comment">// create a default (white) Basic material</span><br>    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshBasicMaterial</span>();<br><br>    <span class="hljs-comment">// create a Mesh containing the geometry and material</span><br>    <span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, material);<br><br>    <span class="hljs-keyword">return</span> cube;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createCube &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="moudle-7"><p>使得场景可以占据整个窗口的大小：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Resizer</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container, camera, renderer</span>) &#123;<br>    <span class="hljs-comment">// Set the camera&#x27;s aspect ratio</span><br>    camera.<span class="hljs-property">aspect</span> = container.<span class="hljs-property">clientWidth</span> / container.<span class="hljs-property">clientHeight</span>;<br><br>    <span class="hljs-comment">// update the camera&#x27;s frustum</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>();<br><br>    <span class="hljs-comment">// update the size of the renderer AND the canvas</span><br>    renderer.<span class="hljs-title function_">setSize</span>(container.<span class="hljs-property">clientWidth</span>, container.<span class="hljs-property">clientHeight</span>);<br><br>    <span class="hljs-comment">// set the pixel ratio (for mobile devices)</span><br>    renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></div></div></div>
<h2 id="1.4-%E5%9F%BA%E4%BA%8E%E7%89%A9%E7%90%86%E7%9A%84%E6%B8%B2%E6%9F%93%E5%92%8C%E7%85%A7%E6%98%8E" tabindex="-1" id="1-4-基于物理的渲染和照明">1.4 基于物理的渲染和照明</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/physically-based-rendering/">基于物理的渲染和照明 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p>three.js 也是使用**基于物理的渲染 (PBR)**的。</p>
<p>根据之前模块化后的程序，继续修改：</p>
<div class="tabs" id="light"><div class="nav-tabs"><button type="button" class="tab active" data-href="light-1">renderer.js</button><button type="button" class="tab" data-href="light-2">light.js</button><button type="button" class="tab" data-href="light-3">World.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="light-1"><p>告诉渲染器启动基于物理的渲染。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createRenderer</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebGLRenderer</span>(&#123; <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span> &#125;);<br><br>    renderer.<span class="hljs-property">physicallyCorrectLights</span> = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-keyword">return</span> renderer;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createRenderer &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="light-2"><p>定义一个灯光：</p>
<ul>
<li>光强设为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">8</span></span></span></span></li>
<li>位置在 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>1</mn><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mn>0</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(10, 10, 10)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mclose">)</span></span></span></span>，照向原点</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">DirectionalLight</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createLights</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// Create a directional light</span><br>    <span class="hljs-keyword">const</span> light = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-string">&#x27;white&#x27;</span>, <span class="hljs-number">8</span>);<br><br>    <span class="hljs-comment">// move the light right, up, and towards us</span><br>    light.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);<br><br>    <span class="hljs-keyword">return</span> light;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createLights &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="light-3"><p><code>scene.add()</code> 里给场景添加光源！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCube &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/cube.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/resizer.js&#x27;</span>;<br><br><span class="hljs-comment">// These variables are module-scoped: we cannot access them</span><br><span class="hljs-comment">// from outside the module</span><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> cube = <span class="hljs-title function_">createCube</span>();<br>        <span class="hljs-keyword">const</span> light = <span class="hljs-title function_">createLights</span>();<br><br>        scene.<span class="hljs-title function_">add</span>(cube, light);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// draw a single frame</span><br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_4" target="_blank"><b>演示</b></a></p>
<h2 id="1.5-%E5%8F%98%E6%8D%A2%E3%80%81%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C%E5%9C%BA%E6%99%AF%E5%9B%BE" tabindex="-1" id="1-5-变换、坐标系和场景图">1.5 变换、坐标系和场景图</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/transformations/">变换和坐标系 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p>emmm 跟 Unity 里差不多吧。</p>
<p><code>cube.js</code> 中可以修改 cube 的 <code>position</code>、<code>rotation</code> 和 <code>scale</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<br>    <span class="hljs-title class_">BoxBufferGeometry</span>,<br>    <span class="hljs-title class_">MathUtils</span>,<br>    <span class="hljs-title class_">Mesh</span>,<br>    <span class="hljs-title class_">MeshStandardMaterial</span>,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCube</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoxBufferGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br><br>    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshStandardMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;purple&#x27;</span> &#125;);<br><br>    <span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, material);<br><br>    cube.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">0.5</span>;<br>    cube.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = -<span class="hljs-number">0.1</span>;<br>    cube.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// equivalent to:</span><br>    <span class="hljs-comment">// cube.position.set(-0.5, -0.1, 1);</span><br><br>    cube.<span class="hljs-property">scale</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1.25</span>;<br>    cube.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.25</span>;<br>    cube.<span class="hljs-property">scale</span>.<span class="hljs-property">z</span> = <span class="hljs-number">0.5</span>;<br><br>    <span class="hljs-comment">// equivalent to:</span><br>    <span class="hljs-comment">// cube.scale.set(1.25, 0.25, 0.5);</span><br><br>    <span class="hljs-comment">// to rotate using degrees, they must</span><br>    <span class="hljs-comment">// first be converted to radians</span><br>    cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">degToRad</span>(-<span class="hljs-number">60</span>);<br>    cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">degToRad</span>(-<span class="hljs-number">45</span>);<br>    cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">degToRad</span>(<span class="hljs-number">60</span>);<br><br>    <span class="hljs-keyword">return</span> cube;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createCube &#125;;<br></code></pre></td></tr></table></figure>
<p>还可以把对象放在其他对象中，作其子对象：</p>
<p><img src="images/01_5.svg" alt="套娃！"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript">scene.<span class="hljs-title function_">add</span>(mesh);<br><br><span class="hljs-comment">// the children array contains the mesh we added</span><br>scene.<span class="hljs-property">children</span>; <span class="hljs-comment">// -&gt; [mesh]</span><br><br><span class="hljs-comment">// now, add a light:</span><br>scene.<span class="hljs-title function_">add</span>(light);<br><br><span class="hljs-comment">// the children array now contains both the mesh and the light</span><br>scene.<span class="hljs-property">children</span>; <span class="hljs-comment">// -&gt; [mesh, light];</span><br><br><span class="hljs-comment">// now you can access the mesh and light using array indices</span><br>scene.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>]; <span class="hljs-comment">// -&gt; mesh</span><br>scene.<span class="hljs-property">children</span>[<span class="hljs-number">1</span>]; <span class="hljs-comment">// -&gt; light</span><br></code></pre></td></tr></table></figure>
<h2 id="1.6-%E4%BD%BF%E6%88%91%E4%BB%AC%E7%9A%84%E5%9C%BA%E6%99%AF%E5%85%B7%E6%9C%89%E5%93%8D%E5%BA%94%E6%80%A7%EF%BC%88%E4%BB%A5%E5%8F%8A%E5%A4%84%E7%90%86-jaggies%EF%BC%89" tabindex="-1" id="1-6-使我们的场景具有响应性（以及处理-Jaggies）">1.6 使我们的场景具有响应性（以及处理 Jaggies）</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/responsive-design/">使我们的场景具有响应性（以及处理锯齿）| Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p><strong>抗锯齿</strong></p>
<p><code>renderer.js</code> 中启用抗锯齿：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebGLRenderer</span>(&#123; <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span> &#125;);<br></code></pre></td></tr></table></figure>
<p><strong>无缝处理浏览器窗口大小变化</strong></p>
<p>修改 <code>resizer.js</code>：</p>
<ul>
<li>将 <code>setSize</code> 封装成一个函数，当用户改变窗口大小（触发 <code>window.addEventListener('resize', () =&gt; &#123;&#125;);</code>）时，重新 <code>setSize()</code></li>
<li>定义一个 <code>onResize()</code> 函数，便于引用的时候重写它。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">setSize</span> = (<span class="hljs-params">container, camera, renderer</span>) =&gt; &#123;<br>    camera.<span class="hljs-property">aspect</span> = container.<span class="hljs-property">clientWidth</span> / container.<span class="hljs-property">clientHeight</span>;<br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>();<br><br>    renderer.<span class="hljs-title function_">setSize</span>(container.<span class="hljs-property">clientWidth</span>, container.<span class="hljs-property">clientHeight</span>);<br>    renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>);<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Resizer</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container, camera, renderer</span>) &#123;<br>        <span class="hljs-comment">// set initial size on load</span><br>        <span class="hljs-title function_">setSize</span>(container, camera, renderer);<br><br>        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-comment">// set the size again if a resize occurs</span><br>            <span class="hljs-title function_">setSize</span>(container, camera, renderer);<br>            <span class="hljs-comment">// perform any custom actions</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onResize</span>();<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-title function_">onResize</span>(<span class="hljs-params"></span>) &#123; &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Resizer</span> &#125;;<br></code></pre></td></tr></table></figure>
<p>修改 <code>World.js</code>：</p>
<ul>
<li>重写 <code>onResize()</code> 的逻辑，窗口变换时，重新渲染画面：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCube &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/cube.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/resizer.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> cube = <span class="hljs-title function_">createCube</span>();<br>        <span class="hljs-keyword">const</span> light = <span class="hljs-title function_">createLights</span>();<br><br>        scene.<span class="hljs-title function_">add</span>(cube, light);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>        resizer.<span class="hljs-property">onResize</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// draw a single frame</span><br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure>
<p>​    <a href="pages/01_6" target="_blank"><b>演示</b></a></p>
<h2 id="1.7-%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF" tabindex="-1" id="1-7-动画循环">1.7 动画循环</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/animation-loop/">动画循环 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<div class="tabs" id="animation"><div class="nav-tabs"><button type="button" class="tab active" data-href="animation-1">systems/Loops.js</button><button type="button" class="tab" data-href="animation-2">World.js</button><button type="button" class="tab" data-href="animation-3">main.js</button><button type="button" class="tab" data-href="animation-4">cube.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="animation-1"><p>创建一个 <code>Loops.js</code> 用于循环：</p>
<ul>
<li><code>constructor()</code> 构造函数：
<ul>
<li><code>camera</code> 摄像机。</li>
<li><code>scene</code> 场景。</li>
<li><code>renderer</code> 渲染器。</li>
<li><code>updatables</code> 要在循环中更新的对象的列表。</li>
</ul>
</li>
<li><code>start()</code>  使用 <code>this.renderer.setAnimationLoop(() =&gt; {});</code>  开启循环。
<ul>
<li><code>this.tick();</code> 开启计时器。</li>
<li><code>this.renderer.render(this.scene, this.camera);</code> 循环中不断渲染帧。</li>
</ul>
</li>
<li><code>stop()</code> 清空循环：<code>this.renderer.setAnimationLoop(null);</code></li>
<li><code>tick()</code>：
<ul>
<li><code>const delta = clock.getDelta();</code>  用于衡量渲染渲染一帧花了多少时间（单位：秒）。</li>
<li>随后调用 <code>this.updatables</code> 里物体的 <code>tick()</code>（类似 Unity 里的 <code>Update()</code>）。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Clock</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;three&quot;</span>;<br><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Clock</span>();<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Loop</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">camera, scene, renderer</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span> = camera;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span> = scene;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span> = renderer;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">updatables</span> = [];<br>    &#125;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-title function_">setAnimationLoop</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-comment">// tell every animated object to tick forward one frame</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">tick</span>();<br><br>            <span class="hljs-comment">// render a frame</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-title function_">render</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>);<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-title function_">setAnimationLoop</span>(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-title function_">tick</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// only call the getDelta function once per frame!</span><br>        <span class="hljs-keyword">const</span> delta = clock.<span class="hljs-title function_">getDelta</span>();<br><br>        <span class="hljs-comment">// console.log(</span><br>        <span class="hljs-comment">//   `The last frame rendered in $&#123;delta * 1000&#125; milliseconds`,</span><br>        <span class="hljs-comment">// );</span><br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> object <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">updatables</span>) &#123;<br>            object.<span class="hljs-title function_">tick</span>(delta);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Loop</span> &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="animation-2"><ul>
<li><code>import { Loop } from './systems/Loop.js';</code> 导入相应 JS。</li>
<li><code>let loop;</code> 和 <code>loop = new Loop(camera, scene, renderer);</code> 将循环创建为<strong>模块作用域变量</strong>，如 <code>camera</code>、<code>renderer</code> 和 <code>scene</code> 一样，因为我们不希望从 <code>World</code> 类外部访问它。</li>
<li><code>loop.updatables.push(cube);</code>  将 <code>cube</code> 压入 <code>loop.updatables</code> 中，使其可以循环。</li>
<li><code>start()</code> 和 <code>stop()</code> 分别就是 <code>loop</code> 中的 <code>start()</code> 和 <code>stop()</code>。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCube &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/cube.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Resizer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Loop</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Loop.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><span class="hljs-keyword">let</span> loop;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        loop = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Loop</span>(camera, scene, renderer);<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> cube = <span class="hljs-title function_">createCube</span>();<br>        <span class="hljs-keyword">const</span> light = <span class="hljs-title function_">createLights</span>();<br><br>        loop.<span class="hljs-property">updatables</span>.<span class="hljs-title function_">push</span>(cube);<br><br>        scene.<span class="hljs-title function_">add</span>(cube, light);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// draw a single frame</span><br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">start</span>();<br>    &#125;<br><br>    <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">stop</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="animation-3"><p>渲染的入口改为 <code>world.start();</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">World</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./World/World.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// Get a reference to the container element</span><br>  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#scene-container&#x27;</span>);<br><br>  <span class="hljs-comment">// create a new world</span><br>  <span class="hljs-keyword">const</span> world = <span class="hljs-keyword">new</span> <span class="hljs-title class_">World</span>(container);<br><br>  <span class="hljs-comment">// draw the scene</span><br>  world.<span class="hljs-title function_">start</span>();<br>&#125;<br><br><span class="hljs-title function_">main</span>();<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="animation-4"><p>定义 <code>cube.tick</code>：每秒旋转 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><msup><mn>0</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">30^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.674115em;"></span><span class="strut bottom" style="height:0.674115em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span><span class="mord"><span class="mord mathrm">0</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">∘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BoxGeometry</span>, <span class="hljs-title class_">Mesh</span>, <span class="hljs-title class_">MeshStandardMaterial</span>, <span class="hljs-title class_">MathUtils</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCube</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// create a geometry</span><br>    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br><br>    <span class="hljs-comment">// create a default (white) Basic material</span><br>    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshStandardMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;purple&quot;</span> &#125;);<br><br>    <span class="hljs-comment">// create a Mesh containing the geometry and material</span><br>    <span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, material);<br><br>    cube.<span class="hljs-property">rotation</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">0.5</span>, -<span class="hljs-number">0.1</span>, <span class="hljs-number">0.8</span>);<br><br>    <span class="hljs-keyword">const</span> radiansPerSecond = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">degToRad</span>(<span class="hljs-number">30</span>);<br>    <span class="hljs-comment">// this method will be called once per frame</span><br>    cube.<span class="hljs-property">tick</span> = <span class="hljs-function">(<span class="hljs-params">delta</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// increase the cube&#x27;s rotation each frame</span><br>        cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> += radiansPerSecond * delta;<br>        cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += radiansPerSecond * delta;<br>        cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += radiansPerSecond * delta;<br>    &#125;;<br><br>    <span class="hljs-keyword">return</span> cube;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createCube &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_7" target="_blank"><b>演示</b></a></p>
<h2 id="1.8-%E7%BA%B9%E7%90%86%E6%98%A0%E5%B0%84" tabindex="-1" id="1-8-纹理映射">1.8 纹理映射</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/textures-intro/">纹理映射简介 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p>给立方体贴图：</p>
<p><img src="pages/01_8/assets/textures/uv-test-bw.png" alt="立方体贴图"></p>
<p>修改 <code>components/cube.js</code>：</p>
<ul>
<li>定义 <code>createMaterial()</code>，将控制物体材质的代码移到另一个函数中。
<ul>
<li><code>const textureLoader = new TextureLoader();</code> 定义一个加载纹理贴图的类。</li>
<li><code>const texture = textureLoader.load('./assets/textures/uv-test-bw.png',);</code>  加载贴图，使其转换成能材质类读取的形式。</li>
<li><code>const material = new MeshStandardMaterial(&#123;map: texture,&#125;);</code> 定义材质。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BoxGeometry</span>, <span class="hljs-title class_">Mesh</span>, <span class="hljs-title class_">MeshStandardMaterial</span>, <span class="hljs-title class_">MathUtils</span>, <span class="hljs-title class_">TextureLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createMaterial</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// create a texture loader.</span><br>    <span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextureLoader</span>();<br>    <span class="hljs-comment">// load a texture</span><br>    <span class="hljs-keyword">const</span> texture = textureLoader.<span class="hljs-title function_">load</span>(<br>        <span class="hljs-string">&#x27;./assets/textures/uv-test-bw.png&#x27;</span>,<br>    );<br>    <span class="hljs-comment">// create a &quot;standard&quot; material using</span><br>    <span class="hljs-comment">// the texture we just loaded as a color map</span><br>    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>        <span class="hljs-attr">map</span>: texture,<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> material;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCube</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// create a geometry</span><br>    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br><br>    <span class="hljs-comment">// create a default (white) Basic material</span><br>    <span class="hljs-keyword">const</span> material = <span class="hljs-title function_">createMaterial</span>();<br><br>    <span class="hljs-comment">// create a Mesh containing the geometry and material</span><br>    <span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, material);<br><br>    cube.<span class="hljs-property">rotation</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">0.5</span>, -<span class="hljs-number">0.1</span>, <span class="hljs-number">0.8</span>);<br><br>    <span class="hljs-keyword">const</span> radiansPerSecond = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">degToRad</span>(<span class="hljs-number">30</span>);<br>    <span class="hljs-comment">// this method will be called once per frame</span><br>    cube.<span class="hljs-property">tick</span> = <span class="hljs-function">(<span class="hljs-params">delta</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// increase the cube&#x27;s rotation each frame</span><br>        cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> += radiansPerSecond * delta;<br>        cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += radiansPerSecond * delta;<br>        cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += radiansPerSecond * delta;<br>    &#125;;<br><br>    <span class="hljs-keyword">return</span> cube;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createCube &#125;;<br></code></pre></td></tr></table></figure>
<p>​    <a href="pages/01_8" target="_blank"><b>演示</b></a></p>
<h2 id="1.9-%E4%BD%BF%E7%94%A8%E7%9B%B8%E6%9C%BA%E6%8E%A7%E5%88%B6%E6%8F%92%E4%BB%B6%E6%89%A9%E5%B1%95-three.js" tabindex="-1" id="1-9-使用相机控制插件扩展-three-js">1.9 使用相机控制插件扩展 three.js</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/camera-controls/">使用相机控制插件扩展 three.js | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p>本节将使用新插件：<code>three/examples/jsm/controls/OrbitControls.js</code>！</p>
<blockquote>
<p>OrbitControls 是 Three.js 库中的一个辅助控制器，允许用户通过鼠标操作来旋转、缩放和平移场景中的相机，从而实现对场景的交互式查看。</p>
</blockquote>
<p><img src="images/01_9.png" alt="新插件！"></p>
<p>如果是本地加载的，还要修改一下 <code>OrbitControls.js</code> 里的导入逻辑：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<br>	<span class="hljs-title class_">EventDispatcher</span>,<br>	<span class="hljs-variable constant_">MOUSE</span>,<br>	<span class="hljs-title class_">Quaternion</span>,<br>	<span class="hljs-title class_">Spherical</span>,<br>	<span class="hljs-variable constant_">TOUCH</span>,<br>	<span class="hljs-title class_">Vector2</span>,<br>	<span class="hljs-title class_">Vector3</span>,<br>	<span class="hljs-title class_">Plane</span>,<br>	<span class="hljs-title class_">Ray</span>,<br>	<span class="hljs-title class_">MathUtils</span><br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../build/three.module.js&#x27;</span>;<br></code></pre></td></tr></table></figure>
<div class="tabs" id="animation"><div class="nav-tabs"><button type="button" class="tab active" data-href="animation-1">controls.js</button><button type="button" class="tab" data-href="animation-2">World.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="animation-1"><ul>
<li><code>const controls = new OrbitControls(camera, canvas);</code>：通过传入相机（<code>camera</code>）和 canvas 元素（<code>canvas</code>），创建了一个新的 <code>OrbitControls</code> 实例。</li>
<li><code>controls.enableDamping = true;</code>：启用阻尼效果（惯性），使相机移动更加平滑自然。阻尼效果需要在动画循环中不断更新控制器状态。</li>
<li><code>controls.tick = () =&gt; controls.update();</code>：在控制器上添加了一个名为<code>tick</code>的方法，这个方法简单地调用了<code>controls.update()</code>。这是因为当启用阻尼或自动旋转时，需要在每一帧更新控制器的状态以获得平滑的动画效果。在主动画循环中调用此<code>tick</code>方法可以达到这个目的。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createControls</span>(<span class="hljs-params">camera, canvas</span>) &#123;<br>    <span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, canvas);<br><br>    <span class="hljs-comment">// damping and auto rotation require</span><br>    <span class="hljs-comment">// the controls to be updated each frame</span><br><br>    <span class="hljs-comment">// this.controls.autoRotate = true;</span><br>    controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span>;<br><br>    controls.<span class="hljs-property">tick</span> = <span class="hljs-function">() =&gt;</span> controls.<span class="hljs-title function_">update</span>();<br><br>    <span class="hljs-keyword">return</span> controls;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createControls &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="animation-2"><ul>
<li><code>import { createControls } from './systems/controls.js';</code> 导入 <code>controls.js</code>。</li>
<li><code>const controls = createControls(camera, renderer.domElement);</code> 将参数传给 <code>createControls()</code> 以激活辅助控制器。</li>
<li><code>loop.updatables.push(controls);</code> 使得场景能够更新。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCube &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/cube.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createControls &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/controls.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Resizer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Loop</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Loop.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><span class="hljs-keyword">let</span> loop;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        loop = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Loop</span>(camera, scene, renderer);<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> controls = <span class="hljs-title function_">createControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> cube = <span class="hljs-title function_">createCube</span>();<br>        <span class="hljs-keyword">const</span> light = <span class="hljs-title function_">createLights</span>();<br><br>        loop.<span class="hljs-property">updatables</span>.<span class="hljs-title function_">push</span>(controls);<br><br>        <span class="hljs-comment">// stop the cube&#x27;s animation</span><br>        <span class="hljs-comment">// loop.updatables.push(cube);</span><br><br>        scene.<span class="hljs-title function_">add</span>(cube, light);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// draw a single frame</span><br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">start</span>();<br>    &#125;<br><br>    <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">stop</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_9" target="_blank"><b>演示</b></a></p>
<p><strong>按需渲染</strong></p>
<p>如果只使用相机控制插件，而不使用任何动画，那么使用按需渲染可以节约资源。</p>
<div class="tabs" id="render_on_demand"><div class="nav-tabs"><button type="button" class="tab active" data-href="render_on_demand-1">World.js</button><button type="button" class="tab" data-href="render_on_demand-2">main.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="render_on_demand-1"><ul>
<li><code>controls.addEventListener('change', () =&gt; {renderer.render(scene, camera);});</code> 设置事件监听，当用户控制相机时，重新渲染画面（而不是循环渲染画面）。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCube &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/cube.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createControls &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/controls.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Resizer.js&#x27;</span>;<br><span class="hljs-comment">// import &#123; Loop &#125; from &#x27;./systems/Loop.js&#x27;;</span><br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><span class="hljs-comment">// let loop;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        <span class="hljs-comment">// loop = new Loop(camera, scene, renderer);</span><br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> controls = <span class="hljs-title function_">createControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);<br>        controls.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>            renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>        &#125;);<br><br>        <span class="hljs-keyword">const</span> cube = <span class="hljs-title function_">createCube</span>();<br>        <span class="hljs-keyword">const</span> light = <span class="hljs-title function_">createLights</span>();<br><br>        <span class="hljs-comment">// loop.updatables.push(controls);</span><br><br>        <span class="hljs-comment">// stop the cube&#x27;s animation</span><br>        <span class="hljs-comment">// loop.updatables.push(cube);</span><br><br>        scene.<span class="hljs-title function_">add</span>(cube, light);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// draw a single frame</span><br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br><br>    <span class="hljs-comment">// start() &#123;</span><br>    <span class="hljs-comment">//     loop.start();</span><br>    <span class="hljs-comment">// &#125;</span><br><br>    <span class="hljs-comment">// stop() &#123;</span><br>    <span class="hljs-comment">//     loop.stop();</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="render_on_demand-2"><p>取消动画循环：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">World</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./World/World.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// Get a reference to the container element</span><br>  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#scene-container&#x27;</span>);<br><br>  <span class="hljs-comment">// create a new world</span><br>  <span class="hljs-keyword">const</span> world = <span class="hljs-keyword">new</span> <span class="hljs-title class_">World</span>(container);<br><br>  <span class="hljs-comment">// draw the scene</span><br>  world.<span class="hljs-title function_">render</span>();<br>&#125;<br><br><span class="hljs-title function_">main</span>();<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_9_2" target="_blank"><b>演示</b></a></p>
<p><strong>OrbitControls 配置</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#examples/zh/controls/OrbitControls">OrbitControls – three.js docs (threejs.org)</a></li>
</ul>
<p>可以通过设置参数以配置 OrbitControls 的功能：<a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/camera-controls/#%E5%90%AF%E7%94%A8%E6%88%96%E7%A6%81%E7%94%A8%E6%8E%A7%E4%BB%B6">使用相机控制插件扩展 three.js | Discover three.js (discoverthreejs.com)</a></p>
<h2 id="1.10-%E7%8E%AF%E5%A2%83%E5%85%89%EF%BC%9A%E6%9D%A5%E8%87%AA%E5%90%84%E4%B8%AA%E6%96%B9%E5%90%91%E7%9A%84%E5%85%89%E7%85%A7" tabindex="-1" id="1-10-环境光：来自各个方向的光照">1.10 环境光：来自各个方向的光照</h2>
<p>之前的立方体背面完全是黑色，这是因为缺少环境光。</p>
<div class="tabs" id="ambient_light"><div class="nav-tabs"><button type="button" class="tab active" data-href="ambient_light-1">light.js</button><button type="button" class="tab" data-href="ambient_light-2">World.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="ambient_light-1"><blockquote>
<p><a target="_blank" rel="noopener" href="https://threejs.org/docs/#api/en/lights/AmbientLight"><code>AmbientLight</code></a>是在 three.js 中伪造间接照明的最廉价的方法。这种类型的光会从各个方向向场景中的每个对象添加恒定数量的光照。</p>
</blockquote>
<ul>
<li><code>const ambientLight = new AmbientLight('white', 2);</code></li>
</ul>
<blockquote>
<p>来自 <a target="_blank" rel="noopener" href="https://threejs.org/docs/#api/en/lights/HemisphereLight"><code>HemisphereLight</code></a>的光在场景顶部的天空颜色和场景底部的地面颜色之间渐变。与<code>AmbientLight</code>一样，此灯不尝试物理精度。相反，<code>HemisphereLight</code>是在观察到在您发现人类的许多情况下创建的，最亮的光来自场景的顶部，而来自地面的光通常不太亮。</p>
</blockquote>
<ul>
<li><code>const ambientLight = new HemisphereLight('white', 'darkslategrey', 5, );</code> 创建一个 <code>HemisphereLight</code> 作为环境光
<ul>
<li>天空颜色：<code>white</code></li>
<li>地面颜色：<code>darkslategrey</code></li>
<li>强度：<code>5</code></li>
</ul>
</li>
<li><code>return { ambientLight, mainLight };</code> 返回场景光与主光源。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AmbientLight</span>, <span class="hljs-title class_">DirectionalLight</span>, <span class="hljs-title class_">HemisphereLight</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createLights</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HemisphereLight</span>(<br>        <span class="hljs-string">&#x27;white&#x27;</span>, <span class="hljs-comment">// bright sky color</span><br>        <span class="hljs-string">&#x27;darkslategrey&#x27;</span>, <span class="hljs-comment">// dim ground color</span><br>        <span class="hljs-number">5</span>, <span class="hljs-comment">// intensity</span><br>    );<br><br>    <span class="hljs-keyword">const</span> mainLight = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-string">&#x27;white&#x27;</span>, <span class="hljs-number">5</span>);<br>    mainLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);<br><br>    <span class="hljs-keyword">return</span> &#123; ambientLight, mainLight &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createLights &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="ambient_light-2"><ul>
<li><code>const { ambientLight, mainLight } = createLights();</code>：获取函数返回的光源对象。（是否可以修改成列表以减少耦合性？）</li>
<li><code>scene.add(ambientLight, mainLight, cube);</code>：将这些光源和立方体对象加入场景。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCube &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/cube.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createControls &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/controls.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Resizer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Loop</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Loop.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><span class="hljs-keyword">let</span> loop;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        loop = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Loop</span>(camera, scene, renderer);<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> controls = <span class="hljs-title function_">createControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> cube = <span class="hljs-title function_">createCube</span>();<br>        <span class="hljs-keyword">const</span> &#123; ambientLight, mainLight &#125; = <span class="hljs-title function_">createLights</span>();<br><br>        loop.<span class="hljs-property">updatables</span>.<span class="hljs-title function_">push</span>(controls);<br>        scene.<span class="hljs-title function_">add</span>(ambientLight, mainLight, cube);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// draw a single frame</span><br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">start</span>();<br>    &#125;<br><br>    <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">stop</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_10" target="_blank"><b>演示</b></a></p>
<h2 id="1.11-%E7%BB%84%E7%BB%87%E4%BD%A0%E7%9A%84%E5%9C%BA%E6%99%AF" tabindex="-1" id="1-11-组织你的场景">1.11 组织你的场景</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/organizing-with-group/">组织你的场景 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<div class="tabs" id="mesh_group"><div class="nav-tabs"><button type="button" class="tab active" data-href="mesh_group-1">meshGroup.js</button><button type="button" class="tab" data-href="mesh_group-2">World.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="mesh_group-1"><blockquote>
<p>源教程使用的是 <code>SphereBufferGeometry</code> 在我这里似乎已经过期，应该改成 <code>SphereGeometry</code>。（用于创建球体形状的几何体）</p>
</blockquote>
<ul>
<li>
<p><code>const group = new Group();</code> 使用 <code>Group</code> 类创建一个新的组合对象 <code>group</code>。这个组合将用来容纳所有的球体，但它自身是不可见的。</p>
</li>
<li>
<p><code>const geometry = new SphereGeometry(0.25, 16, 16);</code> 使用 <code>Group </code>类创建一个新的组合对象 <code>group</code>。这个组合将用来容纳所有的球体，但它自身是不可见的。（就是个空节点）</p>
</li>
<li>
<p><code>group.add(protoSphere);</code> 将这个 <code>const protoSphere = new Mesh(geometry, material);</code> 作为 <code>group</code> 的子对象。</p>
</li>
<li>
<p><code>for (let i = 0; i &lt; 1; i += 0.05) {}</code>：创建更多球体。</p>
<ul>
<li>
<p><code>const sphere = protoSphere.clone();</code> 克隆球体 <code>protoSphere</code>，克隆的对象将具有与原始对象相同的位置、旋转和缩放。</p>
<blockquote>
<p><strong>几何体和材质不是克隆的，它们是共享的</strong>。如果我们对共享材质进行任何更改，例如，更改其颜色，<strong>所有克隆的网格将与原始网格一起更改</strong>。如果您对几何体进行任何更改，这同样适用。（这跟 Unity 也可像）</p>
<p>您可以给一个克隆一个全新的材料，而原来的材料不会受到影响。</p>
</blockquote>
</li>
<li>
<p>变换新的几何体的 transform</p>
</li>
<li>
<p><code>group.add(sphere);</code> 将最后得到的几何体加入 <code>group</code> 中。</p>
</li>
</ul>
</li>
<li>
<p><code>group.scale.multiplyScalar(2);</code>：将整个组合的大小放大两倍。</p>
</li>
</ul>
<hr>
<ul>
<li><code>const radiansPerSecond = MathUtils.degToRad(30);</code> 尝试将整个 <code>group</code> 每秒旋转 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><msup><mn>0</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">30^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.674115em;"></span><span class="strut bottom" style="height:0.674115em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span><span class="mord"><span class="mord mathrm">0</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">∘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>。</li>
<li><code>group.tick = (delta) =&gt; {group.rotation.z -= delta * radiansPerSecond;};</code>：应用动画。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<br>    <span class="hljs-title class_">SphereGeometry</span>,<br>    <span class="hljs-title class_">Group</span>,<br>    <span class="hljs-title class_">MathUtils</span>,<br>    <span class="hljs-title class_">Mesh</span>,<br>    <span class="hljs-title class_">MeshStandardMaterial</span>,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createMeshGroup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// a group holds other objects</span><br>    <span class="hljs-comment">// but cannot be seen itself</span><br>    <span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Group</span>();<br><br>    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">0.25</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>);<br><br>    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>        <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;indigo&#x27;</span>,<br>    &#125;);<br><br>    <span class="hljs-keyword">const</span> protoSphere = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, material);<br><br>    <span class="hljs-comment">// add the protoSphere to the group</span><br>    group.<span class="hljs-title function_">add</span>(protoSphere);<br><br>    <span class="hljs-comment">// create twenty clones of the protoSphere</span><br>    <span class="hljs-comment">// and add each to the group</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1</span>; i += <span class="hljs-number">0.05</span>) &#123;<br>        <span class="hljs-keyword">const</span> sphere = protoSphere.<span class="hljs-title function_">clone</span>();<br><br>        <span class="hljs-comment">// position the spheres on around a circle</span><br>        sphere.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * i);<br>        sphere.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * i);<br><br>        sphere.<span class="hljs-property">scale</span>.<span class="hljs-title function_">multiplyScalar</span>(<span class="hljs-number">0.01</span> + i);<br><br>        group.<span class="hljs-title function_">add</span>(sphere);<br>    &#125;<br><br>    <span class="hljs-comment">// every sphere inside the group will be scaled</span><br>    group.<span class="hljs-property">scale</span>.<span class="hljs-title function_">multiplyScalar</span>(<span class="hljs-number">2</span>);<br><br>    <span class="hljs-keyword">const</span> radiansPerSecond = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">degToRad</span>(<span class="hljs-number">30</span>);<br><br>    <span class="hljs-comment">// each frame, rotate the entire group of spheres</span><br>    group.<span class="hljs-property">tick</span> = <span class="hljs-function">(<span class="hljs-params">delta</span>) =&gt;</span> &#123;<br>        group.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> -= delta * radiansPerSecond;<br>    &#125;;<br><br>    <span class="hljs-keyword">return</span> group;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createMeshGroup &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="mesh_group-2"><p>把之前的 <code>cube</code> 换成了 <code>meshGroup</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createMeshGroup &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/meshGroup.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createControls &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/controls.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Resizer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Loop</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Loop.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><span class="hljs-keyword">let</span> loop;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        loop = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Loop</span>(camera, scene, renderer);<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> controls = <span class="hljs-title function_">createControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);<br>        <span class="hljs-keyword">const</span> &#123; ambientLight, mainLight &#125; = <span class="hljs-title function_">createLights</span>();<br>        <span class="hljs-keyword">const</span> meshGroup = <span class="hljs-title function_">createMeshGroup</span>();<br><br>        loop.<span class="hljs-property">updatables</span>.<span class="hljs-title function_">push</span>(controls, meshGroup);<br>        scene.<span class="hljs-title function_">add</span>(ambientLight, mainLight, meshGroup);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">start</span>();<br>    &#125;<br><br>    <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">stop</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_11" target="_blank"><b>演示</b></a></p>
<h2 id="1.12-%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E5%87%A0%E4%BD%95%E4%BD%93%E8%8E%B7%E5%BE%97%E5%88%9B%E6%84%8F" tabindex="-1" id="1-12-使用内置几何体获得创意">1.12 使用内置几何体获得创意</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/built-in-geometries/">内置几何体 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p>文件组织结构如下：</p>
<ul>
<li><code>components/Train/</code>：创建一个火车类
<ul>
<li><code>Train.js</code>：组装火车，并设置轮子移动动画。</li>
<li><code>geometries.js</code>：定义构成火车的组件。</li>
<li><code>materials.js</code>：定义火车的材质。</li>
<li><code>meshes.js</code>：设置火车的组建的 transform。</li>
</ul>
</li>
<li><code>components/helpers.js</code>：在场景中显示坐标系。</li>
</ul>
<p><img src="images/01_12.png" alt="文件结构"></p>
<div class="tabs" id="train1"><div class="nav-tabs"><button type="button" class="tab active" data-href="train1-1">World.js</button><button type="button" class="tab" data-href="train1-2">helpers.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="train1-1"><ul>
<li><code>import {createAxesHelper, createGridHelper,} from './components/helpers.js';</code> 和 <code>import { Train } from './components/Train/Train.js';</code>：导入相关库。</li>
<li><code> const train = new Train();</code>、<code>loop.updatables.push(controls, train);</code>、<code>scene.add(ambientLight, mainLight, train);</code>：定义火车类，加载动画并放置在场景中。</li>
<li><code>scene.add(createAxesHelper(), createGridHelper());</code>：在场景中显示坐标轴。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123;<br>    createAxesHelper,<br>    createGridHelper,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/helpers.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Train</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/Train/Train.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createControls &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/controls.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Resizer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Loop</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Loop.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><span class="hljs-keyword">let</span> loop;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        loop = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Loop</span>(camera, scene, renderer);<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> controls = <span class="hljs-title function_">createControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);<br>        <span class="hljs-keyword">const</span> &#123; ambientLight, mainLight &#125; = <span class="hljs-title function_">createLights</span>();<br>        <span class="hljs-keyword">const</span> train = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Train</span>();<br><br>        loop.<span class="hljs-property">updatables</span>.<span class="hljs-title function_">push</span>(controls, train);<br>        scene.<span class="hljs-title function_">add</span>(ambientLight, mainLight, train);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br><br>        scene.<span class="hljs-title function_">add</span>(<span class="hljs-title function_">createAxesHelper</span>(), <span class="hljs-title function_">createGridHelper</span>());<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">start</span>();<br>    &#125;<br><br>    <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">stop</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="train1-2"><ul>
<li><code>function createAxesHelper() {}</code>：创建坐标轴。
<ul>
<li><code>const helper = new AxesHelper(3);</code>：显示的坐标轴长度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span>。</li>
<li><code>helper.position.set(-3.5, 0, -3.5);</code>：将坐标轴放置在 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mo>−</mo><mn>3</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mo>−</mo><mn>3</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(-3.5, 0, -3.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord">−</span><span class="mord mathrm">3</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord">−</span><span class="mord mathrm">3</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="mclose">)</span></span></span></span> 的位置。</li>
</ul>
</li>
<li><code>function createGridHelper() {}</code>：创建网格。
<ul>
<li><code>const helper = new GridHelper(6);</code>：在 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mi>O</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">xOz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span></span> 平面创建 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn><mo>×</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">6 \times 6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">6</span><span class="mbin">×</span><span class="mord mathrm">6</span></span></span></span> 的网格，大小为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span>。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AxesHelper</span>, <span class="hljs-title class_">GridHelper</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createAxesHelper</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> helper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">3</span>);<br>    helper.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">3.5</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">3.5</span>);<br>    <span class="hljs-keyword">return</span> helper;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createGridHelper</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> helper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridHelper</span>(<span class="hljs-number">6</span>);<br>    <span class="hljs-keyword">return</span> helper;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createAxesHelper, createGridHelper &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<hr>
<div class="tabs" id="train2"><div class="nav-tabs"><button type="button" class="tab active" data-href="train2-1">Train.js</button><button type="button" class="tab" data-href="train2-2">geometries.js</button><button type="button" class="tab" data-href="train2-3">materials.js</button><button type="button" class="tab" data-href="train2-4">meshes.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="train2-1"><ul>
<li>从 <code>./meshes.js</code> 导入 <code>createMeshes</code>，将这些 <code>meshes</code> 放在自己节点下。</li>
<li><code>tick(delta) {}</code> 让车轮以每秒 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><msup><mn>4</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">24^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.674115em;"></span><span class="strut bottom" style="height:0.674115em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathrm">4</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">∘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 的速度旋转。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Group</span>, <span class="hljs-title class_">MathUtils</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createMeshes &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./meshes.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> wheelSpeed = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">degToRad</span>(<span class="hljs-number">24</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Train</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Group</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">super</span>();<br><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span> = <span class="hljs-title function_">createMeshes</span>();<br><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>(<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">nose</span>,<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">cabin</span>,<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">chimney</span>,<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">smallWheelRear</span>,<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">smallWheelCenter</span>,<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">smallWheelFront</span>,<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">bigWheel</span>,<br>        );<br>    &#125;<br><br>    <span class="hljs-title function_">tick</span>(<span class="hljs-params">delta</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">bigWheel</span>.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += wheelSpeed * delta;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">smallWheelRear</span>.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += wheelSpeed * delta;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">smallWheelCenter</span>.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += wheelSpeed * delta;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">meshes</span>.<span class="hljs-property">smallWheelFront</span>.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += wheelSpeed * delta;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Train</span> &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="train2-2"><blockquote>
<p>原教程使用的是 <code>BoxGeometry</code> 和 <code>CylinderBufferGeometry</code>，这似乎已弃用，应分别改为 <code>BoxGeometry,</code> 和 <code>CylinderGeometry</code>。</p>
</blockquote>
<ul>
<li><code>const cabin = new BoxGeometry(2, 2.25, 1.5);</code>：创建一个立方体几何体，参数<code>2</code>, <code>2.25</code>, <code>1.5</code>分别对应立方体的宽度、高度和深度。</li>
<li><code>const wheel = new CylinderGeometry(0.4, 0.4, 1.75, 16);</code>：创建一个圆柱形几何体。
<ul>
<li>第一个和第二个参数<code>0.75</code>, <code>0.75</code>分别是圆柱的顶部半径和底部半径。</li>
<li>第三个参数<code>3</code>是圆柱的高度。</li>
<li>第四个参数<code>12</code>定义了圆柱周围的面数，更高的值会使圆柱看起来更加圆滑。</li>
<li><code>const chimney = new CylinderGeometry(0.3, 0.1, 0.5);</code> 同理。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BoxGeometry</span>, <span class="hljs-title class_">CylinderGeometry</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createGeometries</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> cabin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1.5</span>);<br><br>    <span class="hljs-keyword">const</span> nose = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CylinderGeometry</span>(<span class="hljs-number">0.75</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">3</span>, <span class="hljs-number">12</span>);<br><br>    <span class="hljs-comment">// we can reuse a single cylinder geometry for all 4 wheels</span><br>    <span class="hljs-keyword">const</span> wheel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CylinderGeometry</span>(<span class="hljs-number">0.4</span>, <span class="hljs-number">0.4</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">16</span>);<br><br>    <span class="hljs-comment">// different values for the top and bottom radius creates a cone shape</span><br>    <span class="hljs-keyword">const</span> chimney = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CylinderGeometry</span>(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.5</span>);<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        cabin,<br>        nose,<br>        wheel,<br>        chimney,<br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createGeometries &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="train2-3"><ul>
<li><code>new MeshStandardMaterial({});</code> 创建一个标准材质。
<ul>
<li><code>flatShading: true,</code>：开启平滑着色。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">MeshStandardMaterial</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createMaterials</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>        <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;firebrick&#x27;</span>,<br>        <span class="hljs-attr">flatShading</span>: <span class="hljs-literal">true</span>,<br>    &#125;);<br><br>    <span class="hljs-keyword">const</span> detail = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>        <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;darkslategray&#x27;</span>,<br>        <span class="hljs-attr">flatShading</span>: <span class="hljs-literal">true</span>,<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> &#123; body, detail &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createMaterials &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="train2-4"><ul>
<li><code>function createMeshes() {}</code>：根据 <code>import { createGeometries } from './geometries.js';</code> 和 <code>import { createMaterials } from './materials.js';</code>，调整各组件的 transform，组装成小火车。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Mesh</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createGeometries &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./geometries.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createMaterials &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./materials.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createMeshes</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> geometries = <span class="hljs-title function_">createGeometries</span>();<br>    <span class="hljs-keyword">const</span> materials = <span class="hljs-title function_">createMaterials</span>();<br><br>    <span class="hljs-keyword">const</span> cabin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometries.<span class="hljs-property">cabin</span>, materials.<span class="hljs-property">body</span>);<br>    cabin.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1.5</span>, <span class="hljs-number">1.4</span>, <span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">const</span> chimney = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometries.<span class="hljs-property">chimney</span>, materials.<span class="hljs-property">detail</span>);<br>    chimney.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">2</span>, <span class="hljs-number">1.9</span>, <span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">const</span> nose = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometries.<span class="hljs-property">nose</span>, materials.<span class="hljs-property">body</span>);<br>    nose.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>    nose.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>;<br><br>    <span class="hljs-keyword">const</span> smallWheelRear = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometries.<span class="hljs-property">wheel</span>, materials.<span class="hljs-property">detail</span>);<br>    smallWheelRear.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.5</span>;<br>    smallWheelRear.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>;<br><br>    <span class="hljs-keyword">const</span> smallWheelCenter = smallWheelRear.<span class="hljs-title function_">clone</span>();<br>    smallWheelCenter.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">const</span> smallWheelFront = smallWheelRear.<span class="hljs-title function_">clone</span>();<br>    smallWheelFront.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span>;<br><br>    <span class="hljs-keyword">const</span> bigWheel = smallWheelRear.<span class="hljs-title function_">clone</span>();<br>    bigWheel.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1.5</span>, <span class="hljs-number">0.9</span>, <span class="hljs-number">0</span>);<br>    bigWheel.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1.25</span>, <span class="hljs-number">2</span>);<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        nose,<br>        cabin,<br>        chimney,<br>        smallWheelRear,<br>        smallWheelCenter,<br>        smallWheelFront,<br>        bigWheel,<br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; createMeshes &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_12" target="_blank"><b>演示</b></a></p>
<h2 id="1.13-%E4%BB%A5-gltf-%E6%A0%BC%E5%BC%8F%E5%8A%A0%E8%BD%BD-3d-%E6%A8%A1%E5%9E%8B" tabindex="-1" id="1-13-以-glTF-格式加载-3D-模型">1.13 以 glTF 格式加载 3D 模型</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/load-models/">以 glTF 格式加载 3D 模型 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<blockquote>
<p>在过去三十年左右的时间里，人们在创建标准 3D <strong>资源交换格式</strong>方面进行了许多尝试。直到最近，<a target="_blank" rel="noopener" href="https://threejs.org/examples/webgl_loader_fbx.html">FBX</a>、<a target="_blank" rel="noopener" href="https://threejs.org/examples/#webgl_loader_obj_mtl">OBJ (Wavefront)</a> 和 <a target="_blank" rel="noopener" href="https://threejs.org/examples/?q=collada#webgl_loader_collada_skinning">DAE (Collada)</a> 格式仍然是其中最受欢迎的格式，尽管它们都存在阻碍其广泛采用的问题。比如 OBJ 不支持动画，FBX 是属于 Autodesk 的封闭格式，Collada 规范过于复杂，导致大文件难以加载。</p>
<p>然而，最近，一个名为 <strong>glTF</strong> 的新成员已成为在网络上交换 3D 资源的事实上的标准格式。<a target="_blank" rel="noopener" href="https://www.khronos.org/gltf/">glTF</a>（<strong>GL 传输格式</strong>），有时被称为 <em>3D 中的 JPEG</em>，由 <a target="_blank" rel="noopener" href="https://www.khronos.org/">Kronos Group </a>创建，他们负责 WebGL、OpenGL 和一大堆其他图形 API。glTF 最初于 2017 年发布，现在是在网络和许多其他领域交换 3D 资源的最佳格式。<strong>在本书中，我们将始终使用 glTF，如果可能，您也应该这样做</strong>。它专为在网络上共享模型而设计，因此文件大小尽可能小，并且您的模型将快速加载。</p>
<p>但是，由于 glTF 相对较新，您最喜欢的应用程序可能还没有导出器。在这种情况下，您可以在使用模型之前将它们转换为 glTF，或者使用其他加载器，例如 <code>FBXLoaderor</code> 或者 <code>OBJLoader</code>。所有 three.js 加载器的工作方式相同，因此如果您确实需要使用另一个加载器，本章中的所有内容仍然适用，只有细微差别。</p>
</blockquote>
<p>原文极力推荐 <code>.glb</code> 格式，好吧，依他。</p>
<p><img src="images/01_13_1.png" alt="Loader"></p>
<p>可以看到 three.js 支持好多种格式的文件，我们使用 <code>GLTFLoader.js</code>，它还需要依赖项 <code>'../utils/BufferGeometryUtils.js'</code>。</p>
<p>如果是本地加载，还应修改其相对地址：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<span class="hljs-variable constant_">XXX</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../build/three.module.js&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>文件组织结构如下：</p>
<ul>
<li><code>assets/models</code>：存放着 3D 模型（<code>.glb</code> 格式）。</li>
<li><code>src/World/components/birds/</code>：
<ul>
<li><code>birds.js</code>：导入模型，创建鸟对象。</li>
<li><code>setupModel.js</code>：处理加载的数据。</li>
</ul>
</li>
</ul>
<p><img src="images/01_13_2.png" alt="文件结构"></p>
<div class="tabs" id="gitf"><div class="nav-tabs"><button type="button" class="tab active" data-href="gitf-1">main.js</button><button type="button" class="tab" data-href="gitf-2">World.js</button><button type="button" class="tab" data-href="gitf-3">setupModel.js</button><button type="button" class="tab" data-href="gitf-4">birds.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="gitf-1"><ul>
<li><code>await world.init();</code>：等待模型加载完毕，才开始渲染。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">World</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./World/World.js&#x27;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// Get a reference to the container element</span><br>    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#scene-container&#x27;</span>);<br><br>    <span class="hljs-comment">// create a new world</span><br>    <span class="hljs-keyword">const</span> world = <span class="hljs-keyword">new</span> <span class="hljs-title class_">World</span>(container);<br><br>    <span class="hljs-comment">// complete async tasks</span><br>    <span class="hljs-keyword">await</span> world.<span class="hljs-title function_">init</span>();<br><br>    <span class="hljs-comment">// start the animation loop</span><br>    world.<span class="hljs-title function_">start</span>();<br>&#125;<br><br><span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);<br>&#125;);<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="gitf-2"><ul>
<li><code>async init() {}</code>：等待模型加载完毕，才开始渲染。
<ul>
<li><code>const { parrot, flamingo, stork } = await loadBirds();</code> 异步加载模型。</li>
<li><code>controls.target.copy(parrot.position);</code>：将场景控制的目标位置设置为 <code>parrot</code> 模型的位置。这通常用于确保相机能够围绕指定的点进行旋转或焦点对准，从而使用户的视角集中在这个点上。</li>
<li><code>scene.add(parrot, flamingo, stork);</code> 将三只鸟加入场景。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; loadBirds &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/birds/birds.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createControls &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/controls.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Resizer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Loop</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Loop.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> controls;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><span class="hljs-keyword">let</span> loop;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        loop = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Loop</span>(camera, scene, renderer);<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br>        controls = <span class="hljs-title function_">createControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> &#123; ambientLight, mainLight &#125; = <span class="hljs-title function_">createLights</span>();<br><br>        loop.<span class="hljs-property">updatables</span>.<span class="hljs-title function_">push</span>(controls);<br>        scene.<span class="hljs-title function_">add</span>(ambientLight, mainLight);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123; parrot, flamingo, stork &#125; = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadBirds</span>();<br><br>        <span class="hljs-comment">// move the target to the center of the front bird</span><br>        controls.<span class="hljs-property">target</span>.<span class="hljs-title function_">copy</span>(parrot.<span class="hljs-property">position</span>);<br><br>        scene.<span class="hljs-title function_">add</span>(parrot, flamingo, stork);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">start</span>();<br>    &#125;<br><br>    <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">stop</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="gitf-3"><p><img src="images/01_13_3.png" alt="火烈鸟"></p>
<p>Blender 打开这个 <code>.glb</code> 模型，可以看到 <code>Mesh_0</code> 节点在 <code>Object_0</code> 下面，我们只需要 <code>Mesh_0</code> 这个节点，把它选取出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setupModel</span>(<span class="hljs-params">data</span>) &#123;<br>    <span class="hljs-keyword">const</span> model = data.<span class="hljs-property">scene</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];<br><br>    <span class="hljs-keyword">return</span> model;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; setupModel &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="gitf-4"><ul>
<li>
<p><code>async function loadBirds() {}</code>：异步加载。</p>
<ul>
<li>
<p><code>const loader = new GLTFLoader();</code>：使得程序具有加载 <code>.glb</code> 文件的能力。</p>
</li>
<li>
<p><code>const [parrotData, flamingoData, storkData] = await Promise.all([...]);</code>：异步加载模型。</p>
</li>
<li>
<p><code>const parrot = setupModel(parrotData);</code>：生成 <code>parrot</code> 对象。</p>
</li>
<li>
<p><code>parrot.position.set(0, 0, 2.5);</code>：设置对象位置。</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">GLTFLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/GLTFLoader.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; setupModel &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./setupModel.js&#x27;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadBirds</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();<br><br>    <span class="hljs-keyword">const</span> [parrotData, flamingoData, storkData] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<br>        loader.<span class="hljs-title function_">loadAsync</span>(<span class="hljs-string">&#x27;assets/models/Parrot.glb&#x27;</span>),<br>        loader.<span class="hljs-title function_">loadAsync</span>(<span class="hljs-string">&#x27;assets/models/Flamingo.glb&#x27;</span>),<br>        loader.<span class="hljs-title function_">loadAsync</span>(<span class="hljs-string">&#x27;assets/models/Stork.glb&#x27;</span>),<br>    ]);<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Squaaawk!&#x27;</span>, parrotData);<br><br>    <span class="hljs-keyword">const</span> parrot = <span class="hljs-title function_">setupModel</span>(parrotData);<br>    parrot.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2.5</span>);<br><br>    <span class="hljs-keyword">const</span> flamingo = <span class="hljs-title function_">setupModel</span>(flamingoData);<br>    flamingo.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">7.5</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">10</span>);<br><br>    <span class="hljs-keyword">const</span> stork = <span class="hljs-title function_">setupModel</span>(storkData);<br>    stork.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">2.5</span>, -<span class="hljs-number">10</span>);<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        parrot,<br>        flamingo,<br>        stork,<br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; loadBirds &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_13_1" target="_blank"><b>演示</b></a></p>
<p>试试自己的模型：</p>
<p>blender 把自己之前创建的模型导出成 <code>.glb</code> 格式：</p>
<p><img src="images/01_13_4.png" alt="戴珍珠耳环的女孩"></p>
<p>代码就照葫芦画瓢了！</p>
<p>​    <a href="pages/01_13_2" target="_blank"><b>演示</b></a></p>
<h2 id="1.14-three.js-%E5%8A%A8%E7%94%BB%E7%B3%BB%E7%BB%9F" tabindex="-1" id="1-14-three-js-动画系统">1.14 three.js 动画系统</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://discoverthreejs.com/zh/book/first-steps/animation-system/">three.js 动画系统 | Discover three.js (discoverthreejs.com)</a></li>
</ul>
<p>创建动画涉及三个元素：关键帧、<code>KeyframeTrack</code>和<code>AnimationClip</code>。</p>
<div class="tabs" id="animation3"><div class="nav-tabs"><button type="button" class="tab active" data-href="animation3-1">关键帧</button><button type="button" class="tab" data-href="animation3-2">KeyframeTrack</button><button type="button" class="tab" data-href="animation3-3">AnimationClip</button></div><div class="tab-contents"><div class="tab-item-content active" id="animation3-1"><blockquote>
<p>动画系统中最底层的概念级别是<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Key_frame">关键帧</a>。每个关键帧由三部分信息组成：时间 <em><strong>time</strong></em>、属性 <em><strong>property</strong></em> 和值 <em><strong>value</strong></em>。</p>
</blockquote></div><div class="tab-item-content" id="animation3-2"><blockquote>
<p>没有代表单个关键帧的类。相反，<strong>关键帧是存储在两个数组中的原始数据</strong>，<em>时间</em>和<em>值</em>，在 <a target="_blank" rel="noopener" href="https://threejs.org/docs/#api/en/animation/KeyframeTrack"><code>KeyframeTrack</code></a>中。</p>
</blockquote>
<p style="text-align: right;">创建一个代表<b>不透明度</b>的数字关键帧轨迹，包含五个关键帧</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NumberKeyframeTrack</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;three&quot;</span>;<br><br><span class="hljs-keyword">const</span> times = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];<br><span class="hljs-keyword">const</span> values = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>];<br><br><span class="hljs-keyword">const</span> opacityKF = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberKeyframeTrack</span>(<span class="hljs-string">&quot;.material.opacity&quot;</span>, times, values);<br></code></pre></td></tr></table></figure>
<p style="text-align: right;">创建一个表示<b>位置</b>的矢量关键帧轨迹，包含三个关键帧</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">VectorKeyframeTrack</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;three&quot;</span>;<br><br><span class="hljs-keyword">const</span> times = [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>];<br><span class="hljs-keyword">const</span> values = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];<br><br><span class="hljs-keyword">const</span> positionKF = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VectorKeyframeTrack</span>(<span class="hljs-string">&quot;.position&quot;</span>, times, values);<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="animation3-3"><p>动画剪辑是附加到单个对象的<strong>任意数量的关键帧</strong>的集合，表示剪辑的类是 <a target="_blank" rel="noopener" href="https://threejs.org/docs/#api/en/animation/AnimationClip"><code>AnimationClip</code></a>。</p>
<p style="text-align: right;">动画位置和不透明度的剪辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AnimationClip</span>, <span class="hljs-title class_">NumberKeyframeTrack</span>, <span class="hljs-title class_">VectorKeyframeTrack</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;three&quot;</span>;<br><br><span class="hljs-keyword">const</span> positionKF = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VectorKeyframeTrack</span>(<br>  <span class="hljs-string">&quot;.position&quot;</span>,<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>],<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br>);<br><br><span class="hljs-keyword">const</span> opacityKF = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberKeyframeTrack</span>(<br>  <span class="hljs-string">&quot;.material.opacity&quot;</span>,<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>],<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>);<br><br><span class="hljs-keyword">const</span> moveBlinkClip = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnimationClip</span>(<span class="hljs-string">&quot;move-n-blink&quot;</span>, -<span class="hljs-number">1</span>, [<br>  positionKF,<br>  opacityKF,<br>]);<br></code></pre></td></tr></table></figure></div></div></div>
<hr>
<div class="tabs" id="animation3"><div class="nav-tabs"><button type="button" class="tab active" data-href="animation3-1">World.js</button><button type="button" class="tab" data-href="animation3-2">setupModel.js</button></div><div class="tab-contents"><div class="tab-item-content active" id="animation3-1"><ul>
<li><code>loop.updatables.push(parrot, flamingo, stork);</code>：将 <code>parrot</code>、<code>flamingo</code> 和 <code>stork</code> 加入 Loop 中以播放动画。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; loadBirds &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/birds/birds.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/camera.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createLights &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/lights.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createScene &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/scene.js&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; createControls &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/controls.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRenderer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/renderer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Resizer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Resizer.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Loop</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./systems/Loop.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> camera;<br><span class="hljs-keyword">let</span> controls;<br><span class="hljs-keyword">let</span> renderer;<br><span class="hljs-keyword">let</span> scene;<br><span class="hljs-keyword">let</span> loop;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) &#123;<br>        camera = <span class="hljs-title function_">createCamera</span>();<br>        renderer = <span class="hljs-title function_">createRenderer</span>();<br>        scene = <span class="hljs-title function_">createScene</span>();<br>        loop = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Loop</span>(camera, scene, renderer);<br>        container.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);<br>        controls = <span class="hljs-title function_">createControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);<br><br>        <span class="hljs-keyword">const</span> &#123; ambientLight, mainLight &#125; = <span class="hljs-title function_">createLights</span>();<br><br>        loop.<span class="hljs-property">updatables</span>.<span class="hljs-title function_">push</span>(controls);<br>        scene.<span class="hljs-title function_">add</span>(ambientLight, mainLight);<br><br>        <span class="hljs-keyword">const</span> resizer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resizer</span>(container, camera, renderer);<br>    &#125;<br><br>    <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123; parrot, flamingo, stork &#125; = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadBirds</span>();<br><br>        <span class="hljs-comment">// move the target to the center of the front bird</span><br>        controls.<span class="hljs-property">target</span>.<span class="hljs-title function_">copy</span>(parrot.<span class="hljs-property">position</span>);<br><br>        loop.<span class="hljs-property">updatables</span>.<span class="hljs-title function_">push</span>(parrot, flamingo, stork);<br>        scene.<span class="hljs-title function_">add</span>(parrot, flamingo, stork);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        renderer.<span class="hljs-title function_">render</span>(scene, camera);<br>    &#125;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">start</span>();<br>    &#125;<br><br>    <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;<br>        loop.<span class="hljs-title function_">stop</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">World</span> &#125;;<br></code></pre></td></tr></table></figure></div><div class="tab-item-content" id="animation3-2"><ul>
<li><code>const clip = data.animations[0];</code>：获取 <code>data</code> 中的第一个动画（<code>animations[0]</code>），存储在变量 <code>clip</code> 中。</li>
<li><code>const mixer = new AnimationMixer(model);</code>：使用刚刚获取的模型(<code>model</code>)创建一个<code>AnimationMixer</code>实例。这个实例将用于管理模型的动画。</li>
<li><code>const action = mixer.clipAction(clip);</code>：使用 <code>mixer.clipAction(clip)</code> 创建一个针对特定动画片段（<code>clip</code>）的动画操作（<code>action</code>）。</li>
<li><code>action.play();</code>：开始播放这个动画。</li>
<li><code>model.tick = (delta) =&gt; mixer.update(delta);</code>：更新动画。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AnimationMixer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">setupModel</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-keyword">const</span> model = data.<span class="hljs-property">scene</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">const</span> clip = data.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>];<br><br>  <span class="hljs-keyword">const</span> mixer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnimationMixer</span>(model);<br>  <span class="hljs-keyword">const</span> action = mixer.<span class="hljs-title function_">clipAction</span>(clip);<br>  action.<span class="hljs-title function_">play</span>();<br><br>  model.<span class="hljs-property">tick</span> = <span class="hljs-function">(<span class="hljs-params">delta</span>) =&gt;</span> mixer.<span class="hljs-title function_">update</span>(delta);<br><br>  <span class="hljs-keyword">return</span> model;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; setupModel &#125;;<br></code></pre></td></tr></table></figure></div></div></div>
<p>​    <a href="pages/01_14" target="_blank"><b>演示</b></a></p>

            </article>
            
	<div class="rightside">
	
		<div class="rightside-button" id="js-aside">
			<span>
				<img no-lazy src="/images/icon/aside.png" class="rightside-button-icon" alt="Icon">
			</span>
		</div>
		<script>
			$("#js-aside").click(function () {
				onShowAsideButton();
			});
		</script>
	
	<div class="rightside-button" id="js-toggle_theme">
		<span>
			<img no-lazy src="/images/icon/toggle_theme.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	
<script src="/js/plugins/goto_position.js"></script>

	
	<div class="rightside-button" id="js-go_top">
		<span>
			<img no-lazy src="/images/icon/go_top.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>
	<div class="rightside-button" id="js-go_bottom">
		<span>
			<img no-lazy src="/images/icon/go_bottom.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	<script>
		setToggleThemeButtonListener();
	</script>
	<script>
		$('#js-go_top')
		.gotoPosition( {
			speed: 300,
			target: 'top',
		} );
		$('#js-go_bottom')
		.gotoPosition( {
			speed: 300,
			target: 'bottom',
		} );
	</script>
</div>


<div class="post-bottom">
    
        <div class="post-paging">     
            <div class="post-paging-last">
                
                    <a href="/posts/Web-turn.js/">
                        上一篇：Web-turn.js
                    </a>
                
            </div>
            <div class="post-paging-next">
                
                    <a href="/posts/Web-PixiJS/">
                        下一篇：Web-PixiJS
                    </a>
                
            </div>
        </div>
    
    
    
        
            <div class="giscus comments"></div>
            <script>
                var scriptElement = document.createElement('script');
                scriptElement.src = 'https://giscus.app/client.js';
                scriptElement.setAttribute('data-repo', 'GZ-Metal-Cell/GZ-Metal-Cell.github.io');
                scriptElement.setAttribute('data-repo-id', 'R_kgDOIHLEOQ');
                scriptElement.setAttribute('data-category', 'Announcements');
                scriptElement.setAttribute('data-category-id', 'DIC_kwDOIHLEOc4CcVwP');
                scriptElement.setAttribute('data-mapping', 'title');
                scriptElement.setAttribute('data-strict', '1');
                scriptElement.setAttribute('data-reactions-enabled', '');
                scriptElement.setAttribute('data-emit-metadata', '0');
                scriptElement.setAttribute('data-input-position', 'bottom');
                scriptElement.setAttribute('data-theme', localStorage.getItem('theme') === 'light' ? 'light' : 'dark_high_contrast');
                scriptElement.setAttribute('data-lang', 'zh-CN');
                
                scriptElement.setAttribute('crossorigin', 'anonymous');
                scriptElement.async = true;
                document.head.appendChild(scriptElement);
            </script>
        
    
</div>
        </div>
    </main>
    
        <aside class="main-aside">
    
<script src="/js/widgets/aside.js"></script>

    <script>
        showAside();
    </script>

    <div class="aside-top">
        <div class="aside-top-about aside-card">
            <a href="/about" class="aside-top-about-portrait">
                <img no-lazy src="/about/portrait.png" alt="Q">
            </a>
            <div class="aside-top-about-info">
                <span class="author"> Zi-Zi</span>
                <span class="description">不以物喜，不以己悲。</span>
            </div>              
            <div class="aside-top-about-site">
                <a href="/categories" class="aside-top-about-site-item">
                    <span class="title">类别</span>
                    <span class="count">5</span>
                </a>
                <a href="/tags" class="aside-top-about-site-item">
                    <span class="title">标签</span>
                    <span class="count">120</span>
                </a>
                <a href="/archives" class="aside-top-about-site-item">
                    <span class="title">归档</span>
                    <span class="count">434</span>
                </a>
            </div>
            <div class="aside-top-about-contact">
                
                    
                        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
                            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
                            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
                            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
                            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
                        </a>
                    
                
            </div>
        </div> 

        
    </div>

    <div class="aside-bottom">
        
            <script>
                
                    const tocCollapsed = true;
                
                
                    const tocDepth = 6;
                
                var headerString = '';
                for (let i = 1; i <= tocDepth; i++) {
                    if (i === 1) {
                        headerString += 'h1';
                    } else {
                        headerString += ', h' + i;
                    }
                }
                hbeToc();
            </script>
            <div class="aside-bottom-toc aside-card">
                <div class="aside-bottom-toc-title">
                    <h1>目录</h1>
                    <span class="toc-percentage"></span>
                </div>
                <ol class="aside-bottom-toc-content"></ol>
            </div>
        
    </div>
</aside>
    
</div>
		<footer>
	<div class="content">
		
			<span>©2022-2025&nbsp;By&nbsp;<a href="/about">Zi-Zi</a>.</span>
		
		<span><a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> theme by <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell/hexo-theme-quieter">Quieter</a>.</span>
		
			<span style="display: flex;">
				<img no-lazy alt="icp" src="/images/icp_icon.png" style="width: 16px; height: 16px;">
				<a href="https://icp.gov.moe/?keyword=20241647" target="_blank">萌 ICP 备 20241647 号</a>
			</span>
		
	</div>

	
<script src="/js/plugins/ref.js"></script>

	
<script src="/js/plugins/highlight_tools.js"></script>

	<script>
		const  COPY_ICON = "/images/icon/copy.png";
		const CLOSE_CODE_BLOCK_ICON = "/images/icon/close_code_block.png";
		const HIGHLIGHT_SHRINK = "";
		const HIGHLIGHT_HEIGHT_LIMIT = "360px";
	</script>

	
	
	<!-- Analytics -->

    
        <!-- Busuanzi Analytics -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?e57cf62289f84322ebff116e8b3d343e";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    


	

	
		
			
				<link rel="stylesheet" href="/css/plugins/katex/katex.min.css">
				<script src="/js/plugins/copy-tex.js"></script>
			
		
	

    
		
<link rel="stylesheet" href="/css/plugins/textIndent.css">

		
<script src="/js/plugins/textIndent.js"></script>

	

	
	
	
		<script>
			if (typeof init === 'function') {
				init();
			}
		</script>
	

	
		
	

	

	<!--
		
<script src="/js/plugins/jquery.pjax.min.js"></script>

		<script>
			$(document).pjax('a[target!=_blank]', 'main', {
				fragment: 'main',
				timeout: 8000
			});

			$(document).on('pjax:complete', function() {
			});
		</script> 
	-->
	<script>
		console.log('\n %c Hexo-Quieter 主题 %c https://github.com/GZ-Metal-Cell/hexo-theme-quieter \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
	</script>
</footer>
	</body>

	<!-- Hexo-Quieter 主题  https://github.com/GZ-Metal-Cell/hexo-theme-quieter -->
</html>

