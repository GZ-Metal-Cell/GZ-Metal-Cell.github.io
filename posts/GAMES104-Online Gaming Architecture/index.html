<!DOCTYPE html>
<html lang=zh-CN data-theme="light">
	
<script src="/js/plugins/toggleTheme.js"></script>

	<script>
		setTheme();
	</script>
	<head>
		
<title>GAMES104-Online Gaming Architecture | Zi-Zi's Journey</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/images/icon/favicon.ico">
<link href="/css/plugins/print.css" media="print" rel="stylesheet" />

<link rel="stylesheet" href="/css/index.css">



<meta name="keywords" content="游戏引擎架构,GAMES104,">
<meta name="description" content="王希-GAMES104-现代游戏引擎：从入门到实践。">



<script src="/js/plugins/jquery.min.js"></script>


<script src="/js/plugins/hljs.min.js"></script>


<script src="/js/plugins/init.js"></script>


<script src="/js/plugins/hide.js"></script>


<script src="/js/plugins/tabs.js"></script>



    



    
<script src="/js/plugins/alert-title.js"></script>

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-base.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-dark-class.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-light.css">




    
        
            <link rel="stylesheet" type="text/css" href="/css/subfields.css">
        
    



    

	<meta name="generator" content="Hexo 6.1.0"></head>

	<body>
		<header class="sticky-header">
	<nav>
		<div class="nav-left">
			<a href="/" class="logo">
				<img no-lazy src="/images/headers_icon/logo.webp" alt="Quieter">
			</a>
			<ul class="breadcrumb" id="breadcrumb"></ul>
		</div>
		<div class="nav-right">
			<ul>
				
					<li>
						<a href="/">
						  主页
						</a>
					</li>
				
					<li>
						<a href="/categories">
						  类别
						</a>
					</li>
				
					<li>
						<a href="/tags">
						  标签
						</a>
					</li>
				
					<li>
						<a href="/archives">
						  归档
						</a>
					</li>
				
					<li>
						<a href="/galleries">
						  相册
						</a>
					</li>
				
					<li>
						<a href="/links">
						  链接
						</a>
					</li>
				
					<li>
						<a href="/about">
						  关于
						</a>
					</li>
								  
			</ul>
		</div>
		<div class="nav-right-close">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
				<path fill="none" d="M0 0h24v24H0z" />
				<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
			</svg>
		</div>

		<div class="sidebar">
    <div class="topo">
        <p>Zi-Zi's Journey</p>
    </div>
    <ul>
        
        <li>
            <a href="/">
                主页
            </a>
        </li>
        
        <li>
            <a href="/categories">
                类别
            </a>
        </li>
        
        <li>
            <a href="/tags">
                标签
            </a>
        </li>
        
        <li>
            <a href="/archives">
                归档
            </a>
        </li>
        
        <li>
            <a href="/galleries">
                相册
            </a>
        </li>
        
        <li>
            <a href="/links">
                链接
            </a>
        </li>
        
        <li>
            <a href="/about">
                关于
            </a>
        </li>
        
    </ul>
    <div class="sidebar-footer">
        
        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
        </a>
        
    </div>
</div>
<div class='shelter'>
    <script>
        $(function() {
            $('.nav-right-close > svg').click(function() {
                $('.sidebar').animate({
                    right: "0"
                }, 500);
                $('.shelter').fadeIn("slow");
            
                var element = $('.topo');
                element.addClass('custom-style');
            
                var links = null;
                if ("") {
                    links = "".split(',');
                } else {
                    links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
                }
            
                var randomLink = links[Math.floor(Math.random() * links.length)];
                element.css('background-image', "url('" + randomLink + "')");
            });
          
            $('.shelter').click(function(e) {
                $('.sidebar').animate({
                    right: "-100%"
                }, 500);
                $('.shelter').fadeOut("slow");
            });
        });      
    </script>
</div>
	</nav>

	
		<div class="header-background"></div>
	

	<script>
		const name = 'post';
		const ul = document.querySelectorAll('.nav-right ul')[0];
		const lis = ul.querySelectorAll('li');

		if (name == 'home') {
			lis[0].classList.add('select');
		} else {
			for (let i = 0; i < lis.length; i++) {
				const li = lis[i];
				const a = li.querySelector('a');
				if (name === a.href.split('/')[3]) {
					li.classList.add('select');
				}
			}
		}
	</script>
	
	<script>
		var element = document.querySelector('.header-background');
		if(element) {
			element.classList.add('custom-style');
			var links = null;
			if("")
			{
				links = "".split(',');
			} else
			{
				links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
			}
			var randomLink = links[Math.floor(Math.random() * links.length)];
			element.style.backgroundImage = "url('" + randomLink + "')";
		}
	</script>

	
<script src="/js/plugins/breadcrumb.js"></script>

	<script>
		var menus_title = [];
		
			menus_title.push({home: '主页'});
		
			menus_title.push({categories: '类别'});
		
			menus_title.push({tags: '标签'});
		
			menus_title.push({archives: '归档'});
		
			menus_title.push({galleries: '相册'});
		
			menus_title.push({links: '链接'});
		
			menus_title.push({about: '关于'});
		
		
			
				postsBreadcrumb(
					document.getElementById('breadcrumb'),
					"类别",
					"/categories",
					"学习",
					"/categories/学习",
					1
				);
			
		
	</script>
</header>

<div class="main-wrapper">
    <main class="post">
        <header class="main-header">
	
		
			
				
<link rel="stylesheet" href="/css/plugins/fancybox.css">

				
<script src="/js/plugins/fancybox.umd.js"></script>

				
<script src="/js/plugins/fancybox.js"></script>

			
			<div class="post-header-background-content">
				<ul class="post-header-tag">
					
						
							<li><a href="/tags/游戏引擎架构"><span>游戏引擎架构</span></a></li>
						
							<li><a href="/tags/GAMES104"><span>GAMES104</span></a></li>
						
					
				</ul>
				
				<h1>GAMES<b><font color="#0FF">104</font></b>-Online Gaming Architecture</h1>
		
				
					<div class="post-header-desc">
						<svg t="1714702231661" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1154" xmlns:xlink="http://www.w3.org/1999/xlink"
						width="20" height="20">
						<path
							d="M778.24 117.76A46.08 46.08 0 0 1 824.32 163.84v430.08c0 8.4992-4.13696 16.01536-10.50624 20.6848l-0.24576 0.2048L587.5712 846.09024a35.84 35.84 0 0 1-61.48096-25.06752v-220.9792a46.08 46.08 0 0 1 46.08-46.08l200.94976-0.02048V168.96h-522.24v686.08H389.12c13.25056 0 24.1664 10.07616 25.47712 22.97856l0.12288 2.62144c0 14.1312-11.4688 25.6-25.6 25.6h-143.36A46.08 46.08 0 0 1 199.68 860.16V163.84A46.08 46.08 0 0 1 245.76 117.76h532.48z m-26.78784 487.38304h-174.16192v178.176l174.16192-178.176z m-45.19936-169.94304a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z m0-122.88a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z"
							fill="#ffffff" p-id="1155"></path>
						</svg>
						<p>王希-GAMES104-现代游戏引擎：从入门到实践。</p>
					</div>
				
		
				<div class="post-header-info">
					<svg t="1604839279282" class="icon" viewBox="0 0 1024 1024" version="1.1"
					xmlns="http://www.w3.org/2000/svg" p-id="2901" width="20" height="20">
						<path
							d="M513 956.3c-247.7 0-448-200.3-448-448S265.3 66.2 513 66.2s448 200.3 448 448-200.3 442.1-448 442.1z m0-830.9c-212.2 0-388.8 170.7-388.8 388.8C124.2 726.3 294.9 903 513 903c212.2 0 388.8-170.7 388.8-388.8S725.2 125.4 513 125.4z m0 430.2c-94.2 0-170.7-76.5-170.7-170.7S418.8 207.8 513 207.8s170.7 76.5 170.7 170.7S607.2 555.6 513 555.6z m0-289.1c-64.6 0-112 52.8-112 112s47.4 117.9 112 117.9 112-52.8 112-112-47.4-117.9-112-117.9z m0 689.8c-135.7 0-259-58.7-341.9-158.9l-11.8-17.8 11.8-17.8c76.5-117.9 206.2-188.5 347.8-188.5 135.7 0 265 64.6 341.9 182.6l11.8 17.8-11.8 17.8C778 897.1 648.7 956.3 513 956.3zM230.3 773.2C300.9 849.7 406.9 897 513 897c112 0 218.1-47.4 288.6-129.8-70.5-88.2-170.7-135.6-282.7-135.6s-218.1 53.3-288.6 141.6z"
							p-id="2902" fill="#ffffff"></path>
					</svg>
					<div class="post-header-info-author">
						<a href="/about">Zi-Zi</a>
					</div>
					
						<div class="post-header-info-categories">
							
								<a href="/categories/学习">学习</a>
							
						</div>
					
					<time>2024/08/12 17:37:00</time>
				</div>
		
				
					<div class="post-header-stat">
						<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve" width="20" height="20">
							<path fill="#FFFFFF" d="M187.2,165.6c0,2.6-2.1,4.7-4.7,4.7H17.5c-2.6,0-4.7-2.1-4.7-4.7s2.1-4.7,4.7-4.7h165.1
								C185.2,160.9,187.2,163,187.2,165.6z"/>
							<path fill="#FFFFFF" d="M17.5,29.7c2.6,0,4.7,2.1,4.7,4.7v131.2c0,2.6-2.1,4.7-4.7,4.7s-4.7-2.1-4.7-4.7V34.4
								C12.8,31.8,14.9,29.7,17.5,29.7z M77.9,91.5c1.8,1.8,1.8,4.8,0,6.6l-39.8,39.8c-1.9,1.8-4.9,1.7-6.6-0.2c-1.7-1.8-1.7-4.6,0-6.4
								l39.8-39.8C73.1,89.6,76,89.6,77.9,91.5z M169.9,70.2c1.6,2.1,1.1,5-0.9,6.5c0,0,0,0,0,0l-64.2,48.2c-2.1,1.5-5,1.1-6.6-0.9
								c-1.6-2.1-1.1-5,0.9-6.5c0,0,0,0,0,0l64.2-48.2C165.4,67.7,168.3,68.1,169.9,70.2L169.9,70.2z"/>
							<path fill="#FFFFFF" d="M104.6,124.5c-1.8,1.8-4.8,1.8-6.6,0L71.6,98.1c-1.8-1.8-1.8-4.8,0-6.6c1.8-1.8,4.8-1.8,6.6,0l26.3,26.3
								C106.4,119.6,106.4,122.6,104.6,124.5C104.6,124.4,104.6,124.4,104.6,124.5z"/>
						</svg>
		
						
							
<script src="/js/plugins/wordCount.js"></script>

							<p class="post-count">文字数：---</p>
						
		
						
							<p id="busuanzi_container_page_pv" style='display:none;'>阅读数：<span id="busuanzi_value_page_pv"></span></p>
						
					</div>
				
			</div>
		
	
</header>
        <div class="post-content article-container">
            <article class="post-content-info">
                <h1 id="%E8%B5%84%E6%BA%90" tabindex="-1">资源</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1oU4y1R7Km/">GAMES104-现代游戏引擎：从入门到实践_哔哩哔哩_bilibili</a></li>
<li><a target="_blank" rel="noopener" href="https://games104.boomingtech.com/sc/">GAMES104 - 现代游戏引擎入门必修课 (boomingtech.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.piccoloengine.com/topics/node/feed/all">Piccolo 社区 - 游戏引擎爱好者的新家园 (piccoloengine.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/BoomingTech/Piccolo">BoomingTech/Piccolo: Piccolo (formerly Pilot) – mini game engine for games104 (github.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/597024196">GAMES104：现代游戏引擎，从理论到实践 - 知乎 (zhihu.com)</a></li>
</ul>
<h1 id="%E8%AF%BE%E7%A8%8B" tabindex="-1">课程</h1>
<h2 id="%E7%AC%AC%E5%8D%81%E5%85%AB%E8%8A%82%EF%BC%9A%E7%BD%91%E7%BB%9C%E6%B8%B8%E6%88%8F%E7%9A%84%E6%9E%B6%E6%9E%84%E5%9F%BA%E7%A1%80" tabindex="-1" id="第十八节：网络游戏的架构基础">第十八节：网络游戏的架构基础</h2>
<h3 id="online-gaming-architecture%3A-fundamentals" tabindex="-1" id="Online-Gaming-Architecture-Fundamentals">Online Gaming Architecture: Fundamentals</h3>
<p>网络游戏架构</p>
<h4 id="play-anywhere-with-anyone" tabindex="-1" id="PLAY-ANYWHERE-WITH-ANYONE">PLAY ANYWHERE WITH ANYONE</h4>
<p>与任何人随时随地玩游戏</p>
<p>Game developers have never stopped exploring multiplayer online gaming</p>
<p>游戏开发商从未停止探索多人在线游戏</p>
<h4 id="challenges-in-multiplayer-online-gaming" tabindex="-1" id="Challenges-in-Multiplayer-Online-Gaming">Challenges in Multiplayer Online Gaming</h4>
<p>多人联机游戏的挑战</p>
<p><strong>Consistency</strong></p>
<p><strong>一致性</strong></p>
<ul>
<li>
<p>Network Synchronization</p>
<p>网络同步</p>
</li>
</ul>
<p><strong>Reliability</strong></p>
<p><strong>可靠性</strong></p>
<ul>
<li>
<p>Network Latency</p>
<p>网络延迟</p>
</li>
<li>
<p>Drop and Reconnect</p>
<p>断线重连</p>
</li>
</ul>
<p><strong>Security</strong></p>
<p><strong>安全性</strong></p>
<ul>
<li>
<p>Cheats</p>
<p>作弊</p>
</li>
<li>
<p>Accounts Hacked</p>
<p>账户被黑客攻击</p>
</li>
</ul>
<p><strong>Diversities</strong></p>
<p><strong>多样性</strong></p>
<ul>
<li>
<p>Cross-Play</p>
<p>交叉游戏</p>
</li>
<li>
<p>Rapid iteration</p>
<p>快速迭代</p>
</li>
<li>
<p>Multiple Game Systems</p>
<p>多游戏系统</p>
</li>
</ul>
<p><strong>Complexities</strong></p>
<p><strong>复杂性</strong></p>
<ul>
<li>
<p>High Concurrency</p>
<p>高并发性</p>
</li>
<li>
<p>High Availability</p>
<p>高可用性</p>
</li>
<li>
<p>High Performance</p>
<p>高性能</p>
</li>
</ul>
<h3 id="network-protocols" tabindex="-1" id="Network-Protocols">Network Protocols</h3>
<p>网络协议</p>
<h4 id="the-founding-fathers-of-the-internet" tabindex="-1" id="The-Founding-Fathers-of-the-Internet">The Founding Fathers of the Internet</h4>
<p>互联网的创始人（一开始用于军事用途）</p>
<p>Designed the TCP/lP protocols andthe internet architecture.</p>
<p>设计了 TCP/IP 协议和互联网架构。</p>
<p>In 1977 Cerf and Kahn will link three networks (packet radio, satellite, and the ARPANET) and prove the efficacy of their TCP/lP protocol in a dramatic round-the-world transmission from a moving vehicle, the SRl Packet RadioResearch van.</p>
<p>1977 年，Cerf 和 Kahn 将连接三个网络（分组无线电、卫星和 ARPANET），并证明他们的 TCP/lP 协议在移动车辆 SRl 分组无线电研究车的戏剧性环球传输中的有效性。</p>
<h4 id="how-to-communication-between-two-pcs" tabindex="-1" id="How-to-communication-between-two-PCs">How to communication between two PCs</h4>
<ul>
<li>
<p>A and B must agree on the meaning of the bits being sent and received at many different levels, including</p>
<p>A 和 B 必须就在许多不同级别发送和接收的比特的含义达成一致，包括</p>
<ul>
<li>
<p>How many volts represents a 0 bit, and for a 1 bit?</p>
<p>多少伏特代表 0 位，多少伏特代表 1 位？</p>
</li>
<li>
<p>How does receiver know which is the last bit?</p>
<p>接收器如何知道哪个是最后一位？</p>
</li>
<li>
<p>How many bits long is a number?</p>
<p>一个数字有多少位长？</p>
</li>
</ul>
</li>
</ul>
<p><img src="18.1.webp" alt="webp"></p>
<h4 id="the-problem-of-communication" tabindex="-1" id="The-Problem-of-Communication">The Problem of Communication</h4>
<p>沟通问题</p>
<p><img src="18.2.webp" alt="webp"></p>
<ul>
<li>
<p><strong>Re-implement every application</strong> for every new underlying transmission medium?</p>
<p>为每个新的底层传输介质<strong>重新实施每个应用程序</strong>？</p>
</li>
<li>
<p><strong>Change every application</strong> on any change to an underlying transmission medium?</p>
<p>在更改基础传输介质时<strong>更改每个应用程序</strong>？</p>
</li>
<li>
<p>No! But how does the Internet design avoid this?</p>
<p>不！但是，互联网设计是如何避免这种情况的呢？</p>
</li>
</ul>
<h4 id="solution%3A-layering" tabindex="-1" id="Solution-Layering">Solution: Layering</h4>
<p>解决方法：分层</p>
<p><img src="18.3.webp" alt="webp"></p>
<ul>
<li>
<p>Intermediate <strong>layers</strong> provide a set of abstractions for applications and media</p>
<p>中间<strong>层</strong>为应用程序和媒体提供了一组抽象</p>
</li>
<li>
<p>New applications or media only need implementation for intermediate layer’s interface</p>
<p>新的应用程序或媒体只需要实现中间层的接口</p>
</li>
</ul>
<h4 id="layering-in-the-internet---osi-model" tabindex="-1" id="Layering-in-the-internet-OSI-Model">Layering in the internet - OSI Model</h4>
<p>互联网分层——OSI 模型</p>
<p>Application 应用层</p>
<ul>
<li>Provides functions to users 为用户提供功能</li>
</ul>
<p>Presentation 表示层</p>
<ul>
<li>Converts different representations 转换不同的表示形式</li>
</ul>
<p>Session 会话层</p>
<ul>
<li>Manages task dialogs 管理任务对话框</li>
</ul>
<p>Transport 传输层</p>
<ul>
<li>Provides end-to-end delivery 提供端到端交付</li>
</ul>
<p>Network 网络层</p>
<ul>
<li>Sends packets over multiple links 通过多个链路发送数据包</li>
</ul>
<p>Data Link 数据链路层</p>
<ul>
<li>Sends frames of information 发送信息帧</li>
</ul>
<p>Physical 物理层</p>
<ul>
<li>Sends bits as signals 以信号形式发送比特</li>
</ul>
<p><img src="18.4.webp" alt="webp"></p>
<h4 id="network-socket-based-communication" tabindex="-1" id="Network-Socket-based-Communication">Network Socket-based Communication</h4>
<p>基于网络套接字的通信</p>
<p><img src="18.5.webp" alt="webp"></p>
<h4 id="socket" tabindex="-1" id="Socket">Socket</h4>
<p>套接字</p>
<p>A software structure within a network node of a computer network that serves as an endpoint for sending and receiving data across the network.</p>
<p>计算机网络的网络节点内的软件结构，用作通过网络发送和接收数据的端点。</p>
<p>A Socket is combination of an lP Address and a Port Number.</p>
<p>Socket 是 IP 地址和端口号的组合。</p>
<p><img src="18.6.webp" alt="webp"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// server side</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> saddr, caddr;<br><span class="hljs-type">int</span> sockfd, clen, isock;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> port = <span class="hljs-number">80</span>;<br><br><span class="hljs-keyword">if</span> ((sockfd=<span class="hljs-built_in">Socket</span>(AF INET,SOCK STREAM,<span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error creating socket\n&quot;</span>);<br>    ...<br>&#125;<br>    <br><span class="hljs-built_in">memset</span>(&amp;saddr, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-built_in">sizeof</span>(saddr));  <span class="hljs-comment">// zero structure out</span><br>saddr.sin family = AF INET;  <span class="hljs-comment">// match the socket() call</span><br>saddr.sin addr.s addr = <span class="hljs-built_in">htonl</span>(INADDR ANY); <span class="hljs-comment">// bind to any local addresss</span><br>addr.sin port = <span class="hljs-built_in">htons</span>(port);  <span class="hljs-comment">// specify port to listen on</span><br><br><span class="hljs-keyword">if</span>((<span class="hljs-built_in">bind</span>(sockfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;saddr, <span class="hljs-built_in">sizeof</span>(saddr)) &lt; <span class="hljs-number">8</span>) &#123; <span class="hljs-comment">// bind</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error binding\n&quot;</span>);<br>    ...<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">listen</span>(sockfd, <span class="hljs-number">5</span>) &lt; <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">// listen for incoming connections</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error listening\n&quot;</span>);<br>    ...<br>&#125;<br><br>clen=<span class="hljs-built_in">sizeof</span>(caddr)<br><span class="hljs-keyword">if</span>((isock=<span class="hljs-built_in">accept</span>(sockfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;caddr, &amp;clen)) &lt; <span class="hljs-number">8</span>) &#123; <span class="hljs-comment">// accept one</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error accepting\n&quot;</span>);<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="setup-socket" tabindex="-1" id="Setup-Socket">Setup Socket</h4>
<p>安装套接字</p>
<p>Both client and server need to setup the socket</p>
<p>客户端和服务器都需要设置套接字</p>
<ul>
<li>
<p>Function
<code>int socket(int domain, int type, int protocol)</code></p>
<ul>
<li>
<p>domain</p>
<ul>
<li>
<p><code>AF_INET</code> – IPV4</p>
</li>
<li>
<p><code>AF_INET6</code> – IPV6</p>
<p>…</p>
</li>
<li>
<p>type</p>
<ul>
<li>
<p><code>SOCK_STREAM</code> – TCP</p>
</li>
<li>
<p><code>SOCK_DGRAM</code> – UDP</p>
<p>…</p>
</li>
</ul>
</li>
<li>
<p>protocol</p>
<ul>
<li>0</li>
</ul>
</li>
</ul>
</li>
<li>
<p>E0
<code>int sockfd = socket(AF_INET, SOCK_STREAM, 0)</code></p>
</li>
</ul>
</li>
</ul>
<h4 id="transmission-control-protocol-(tcp)" tabindex="-1" id="Transmission-Control-Protocol-TCP">Transmission Control Protocol (TCP)</h4>
<p>传输控制协议（TCP）</p>
<ul>
<li>
<p>Connection-Oriented</p>
<p>面向连接</p>
</li>
<li>
<p>Reliable and Ordered</p>
<p>可靠且有序</p>
</li>
<li>
<p>Flow Control</p>
<p>流量控制</p>
</li>
<li>
<p>Congestion Control</p>
<p>拥堵控制</p>
</li>
</ul>
<p><img src="18.7.webp" alt="webp"></p>
<h4 id="tcp-retransmission-mechanisms" tabindex="-1" id="TCP-Retransmission-Mechanisms">TCP Retransmission Mechanisms</h4>
<p>TCP 重传机制</p>
<p>Duplicate ACKs</p>
<p>重复 ACK</p>
<ul>
<li>
<p>Senders sends packets and seqnos</p>
<p>发送方发送数据包和序列号</p>
<ul>
<li>1,2, 3, 4, 5, 6, 7, 8</li>
</ul>
</li>
<li>
<p>Assume 5th packet (seqno 5) is lost, Streamof ACKs will be</p>
<p>假设第 5 个数据包（序列号 5）丢失，则 ACK 流将</p>
<ul>
<li>1, 2, 3, 4, 4, 4, 4</li>
</ul>
</li>
</ul>
<p><img src="18.8.webp" alt="webp"></p>
<h4 id="tcp-congestion-control" tabindex="-1" id="TCP-congestion-control">TCP congestion control</h4>
<p>TCP 拥塞控制</p>
<ul>
<li>
<p>The congestion window (CWND) of TCP starts to grow from a small value</p>
<p>TCP 的拥塞窗口（CWND）从一个小值开始增长</p>
</li>
<li>
<p>When congestion occurs, packet loss or timeout, CWND will be reduced according to a certain algorithm</p>
<p>当发生拥塞、丢包或超时时，CWND 将根据特定算法减少</p>
</li>
<li>
<p>This leads to high delay and cause delay jitter</p>
<p>这会导致高延迟并导致延迟抖动</p>
</li>
</ul>
<p><img src="18.9.webp" alt="webp"></p>
<p>As the main transmission protocol on the lnternet, TCP congestion control is necessary, otherwise it will cause congestion collapse. TCP congestion control is the main congestion control measure on the Internet, and it is also the main cause of TCP performance problems.</p>
<p>作为互联网上的主要传输协议，TCP 拥塞控制是必要的，否则会导致拥塞崩溃。TCP 拥塞控制是互联网上主要的拥塞控制措施，也是 TCP 性能问题的主要原因。</p>
<h4 id="user-datagram-protocol-(udp)" tabindex="-1" id="User-Datagram-Protocol-UDP">User Datagram Protocol (UDP)</h4>
<p>用户数据报协议（UDP）</p>
<p>David P. Reed</p>
<p>He was involved in the early developmentof TCP/lP, and was the designer of the <strong>User Datagram Protocol (UDP)</strong>, thoughhe finds this title “a little embarrassing”.</p>
<p>他参与了 TCP/lP 的早期开发，是**用户数据报协议（UDP）**的设计者，尽管他觉得这个头衔“有点尴尬”。</p>
<p>He was also one of the authors of theoriginal paper about the end-to-end principle, <strong>End-to-end arguments insystem design</strong>, published in 1984.</p>
<p>他也是 1984 年发表的关于端到端原理<strong>系统设计中的端到端论证</strong>的原始论文的作者之一。</p>
<h4 id="udp-features" tabindex="-1" id="UDP-Features">UDP Features</h4>
<p>UDP 功能</p>
<p><strong>UDP (User Datagram Protocol)</strong></p>
<p>UDP（用户数据报协议）</p>
<ul>
<li>
<p>Connectionless</p>
<p>无连接</p>
</li>
<li>
<p>UnReliable and Unordered</p>
<p>不可靠和无序</p>
</li>
<li>
<p>NO Flow Control</p>
<p>无流量控制</p>
</li>
<li>
<p>NO Congerstion Control</p>
<p>无堵塞控制</p>
</li>
</ul>
<p><img src="18.10.webp" alt="webp"></p>
<h4 id="network-protocols-usage-in-game" tabindex="-1" id="Network-Protocols-Usage-in-Game">Network Protocols Usage in Game</h4>
<p>Game suitable for use</p>
<ul>
<li>
<p>TCP</p>
<p>炉石</p>
</li>
<li>
<p>UDP</p>
<p>守望先锋、CSGO</p>
</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>TCP</th>
<th>UDP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Structure<br/>结构</td>
<td>Segments<br/>部分</td>
<td>Datagrams<br/>数据报</td>
</tr>
<tr>
<td>Connection Model<br/>连接模型</td>
<td>Connection-Oriented<br/>面向连接的</td>
<td>Connectionless<br/>无连接的</td>
</tr>
<tr>
<td>Speed<br/>速度</td>
<td>Slow<br/>慢</td>
<td>Fast<br/>快</td>
</tr>
<tr>
<td>Reliability<br/>可靠性</td>
<td>Reliable<br/>可靠</td>
<td>Unreliable<br/>不可靠</td>
</tr>
<tr>
<td>Header<br/>标头</td>
<td>20 Bytes<br/></td>
<td>8 Bytes<br/></td>
</tr>
<tr>
<td>Data Transfer<br/>数据传输</td>
<td>Ordered<br/>有序的</td>
<td>Unordered<br/>无序的</td>
</tr>
<tr>
<td>Control<br/>控制</td>
<td>Flow Control<br/>流量控制</td>
<td>NO Flow Control<br/>无流量控制</td>
</tr>
</tbody>
</table>
<h3 id="reliable-udp" tabindex="-1" id="Reliable-UDP">Reliable UDP</h3>
<p>可靠 UDP，在 UDP 的基础上加以改进。</p>
<h4 id="tcp-is-not-time-critical" tabindex="-1" id="TCP-is-Not-Time-Critical">TCP is Not Time Critical</h4>
<p>TCP 不重视及时性</p>
<ul>
<li>
<p>TCP is the complex and heavyweight protocol. lt provides reliable delivery and advanced features, but it has more overhead.</p>
<p>TCP 是复杂而重量级的协议。它提供可靠的交付和高级功能，但开销更大。</p>
</li>
<li>
<p>TCP is a fair, traffic oriented protocol designed to improve bandwidth utilization. But it’s not designed for speed.</p>
<p>TCP 是一种公平的、面向流量的协议，旨在提高带宽利用率。但它不是为速度而设计的。</p>
</li>
<li>
<p>So Why TCP is slow?</p>
<p>为什么 TCP 很慢？</p>
</li>
</ul>
<h4 id="udp-is-fast-but-unreliable" tabindex="-1" id="UDP-is-Fast-but-Unreliable">UDP is Fast but Unreliable</h4>
<p>UDP 速度快但不可靠</p>
<ul>
<li>
<p>UDP is lightweight and fast but unreliable, packet loss and disorder will occur.</p>
<p>UDP 是轻量级和快速的，但不可靠，会发生数据包丢失和混乱。</p>
</li>
<li>
<p>How to achieve reliable and real-time communication?</p>
<p>如何实现可靠和实时的通信？</p>
</li>
</ul>
<h4 id="why-we-need-to-customize-protocol" tabindex="-1" id="Why-We-Need-to-Customize-Protocol">Why We Need to Customize Protocol</h4>
<p>为什么我们需要定制协议</p>
<ul>
<li>
<p>Game Server</p>
<p>游戏服务器</p>
<ul>
<li>
<p>Keep-alived connection (TCP)</p>
<p>保持有效连接（TCP）</p>
</li>
<li>
<p>Need keep logic consistency in “order” (TCP)</p>
<p>需要保持“顺序”（TCP）中的逻辑一致性</p>
</li>
<li>
<p>High responsive &amp; low latency (UDP)</p>
<p>高响应和低延迟（UDP）</p>
</li>
<li>
<p>Broadcast commonly used (UDP)</p>
<p>常用广播（UDP）</p>
</li>
</ul>
</li>
<li>
<p>Web Server</p>
<p>Web 服务器</p>
<ul>
<li>
<p>Handles the HTTP protocol</p>
<p>处理 HTTP 协议</p>
</li>
<li>
<p>Delivers static web content e.g., HTML pages, files, images, video.</p>
<p>提供静态网络内容，例如 HTML 页面、文件、图像、视频。</p>
</li>
</ul>
</li>
</ul>
<h4 id="acknowledgement-%26-sequence-number" tabindex="-1" id="Acknowledgement-Sequence-Number">Acknowledgement &amp; Sequence Number</h4>
<p>确认和序列号</p>
<ul>
<li>
<p><strong>Positive acknowledgment (ACK)</strong> is a signal that is passed between communicating processes, computers, or devices to signify acknowledgment, or receipt of message</p>
<p>**肯定应答（ACK）**是在通信进程、计算机或设备之间传递的信号，表示确认或收到消息</p>
</li>
<li>
<p><strong>Negative ACK (NACK or NAK)</strong> is a signal that is sent to reject a previously receivedmessage or to indicate some kind of error</p>
<p>**否定 ACK（NACK 或 NAK）**是一种信号，用于拒绝之前接收到的消息或指示某种错误</p>
</li>
<li>
<p><strong>Sequence number (SEQ)</strong> is a counter used to keep track of every byte sent outward bya host</p>
<p>**序列号（SEQ）**是一个计数器，用于跟踪主机向外发送的每个字节</p>
</li>
<li>
<p><strong>Timeouts</strong> specified periods of time allowed to elapse before an acknowledgment is tobe received</p>
<p><strong>超时</strong>在收到确认之前允许经过的特定时间段</p>
</li>
</ul>
<h4 id="automatic-repeat-request-(arq)" tabindex="-1" id="Automatic-Repeat-Request-ARQ">Automatic Repeat Request (ARQ)</h4>
<p>自动重复请求（ARQ）</p>
<p>An error-control method for data transmission that uses ACK and timeouts to achieve reliable data transmission over an unreliable communication channel.</p>
<p>一种用于数据传输的错误控制方法，该方法使用 ACK 和超时来在不可靠的通信信道上实现可靠的数据传输。</p>
<p>If the sender does not receive an acknowledgment before the timeout, it re-transmits thepacket until it receives an acknowledgment or exceeds a predefined number of retransmissions.</p>
<p>如果发送方在超时之前没有收到确认，它会重新发送数据包，直到收到确认或超过预定义的重新传输次数。</p>
<ul>
<li>
<p>Sliding window protocol</p>
<p>滑动窗口协议</p>
<ul>
<li>
<p>Stop-and-Wait ARQ</p>
<p>停止并等待 ARQ</p>
</li>
<li>
<p>Go-Back-N ARQ</p>
</li>
<li>
<p>Selective Repeat ARQ</p>
<p>选择性重复 ARQ</p>
</li>
</ul>
</li>
</ul>
<h4 id="sliding-window-protocol" tabindex="-1" id="Sliding-Window-Protocol">Sliding Window Protocol</h4>
<p>滑动窗口协议</p>
<ul>
<li>
<p>Send mutilple frames at a time, number of frames to be sent is based on <strong>Window size</strong></p>
<p>一次发送多个帧，要发送的帧数基于<strong>窗口大小</strong></p>
</li>
<li>
<p>Each frame is numbered by Sequence number</p>
<p>每帧按序列号编号</p>
</li>
<li>
<p>When the frame at the front of the window is received, the window slides</p>
<p>当收到窗户前部的框架时，窗户会滑动</p>
</li>
</ul>
<p><img src="18.11.webp" alt="webp"></p>
<p><img src="18.12.webp" alt="webp"></p>
<h4 id="stop-and-wait-arq" tabindex="-1" id="Stop-and-Wait-ARQ">Stop-and-Wait ARQ</h4>
<p>停止并等待 ARQ</p>
<ul>
<li>
<p>Windows size = 1</p>
<p>窗口大小 = 1</p>
</li>
<li>
<p>After transmitting one frame, the sender waits for an ACK before transmitting the next frame</p>
<p>发送一帧后，发送方在发送下一帧之前等待 ACK</p>
</li>
<li>
<p>If the ACK does not arrive after a certain time, the sender times out and retransmits the original frame</p>
<p>如果 ACK 在特定时间后未到达，则发送方超时并重新传输原始帧</p>
</li>
<li>
<p>Poor utilization of bandwidth, poor performance</p>
<p>带宽利用率低，性能差</p>
</li>
</ul>
<p><img src="18.13.webp" alt="webp"></p>
<h4 id="go-back-n-arq" tabindex="-1" id="Go-Back-N-ARQ">Go-Back-N ARQ</h4>
<ul>
<li>
<p>N is Sender’s Windows Size</p>
<p>N 是发件人的窗口大小</p>
</li>
<li>
<p>The Receiver only sends cumulative ACK</p>
<p>接收器仅发送累积 ACK</p>
</li>
<li>
<p>If an ACK is not received within an agreed-upon time period, all frames in the current window are transmitted</p>
<p>如果在商定的时间段内未收到 ACK，则传输当前窗口中的所有帧</p>
</li>
</ul>
<p><img src="18.14.webp" alt="webp"></p>
<h4 id="selective-repeat-arq" tabindex="-1" id="Selective-Repeat-ARQ">Selective Repeat ARQ</h4>
<p>选择性重复 ARQ</p>
<ul>
<li>
<p>In Selective Repeat ARQ, only the damaged or lost frames are retransmitted</p>
<p>在选择性重复 ARQ 中，只有损坏或丢失的帧会被重新传输</p>
</li>
<li>
<p>The receiver sends the ack of each frame, and the sender maintains the timeout time of each frame</p>
<p>接收方发送每帧的 ack，发送方保持每帧的超时时间</p>
</li>
<li>
<p>When receiver receive damaged packet, it willsend a NACK, The sender will send/retransmitframe for which NACK is received</p>
<p>当接收方收到损坏的数据包时，它将发送一个 NACK。发送方将发送/重新发送收到 NACK 的帧</p>
</li>
</ul>
<p><img src="18.15.webp" alt="webp"></p>
<h4 id="make-udp-reliable-in-packet-loss-scenario" tabindex="-1" id="Make-UDP-Reliable-in-Packet-Loss-Scenario">Make UDP Reliable in Packet Loss Scenario</h4>
<p>在丢包情况下使 UDP 可靠</p>
<p>With the increase of packet loss rate and delay, the reliable UDP can not meet the transmission requirements <a target="_blank" rel="noopener" href="http://gradually.eg">gradually.eg</a>. lf packet loss rate increase to 20%, use reliable UDP is still with high delay.</p>
<p>随着丢包率和延迟的增加，可靠的 UDP 逐渐无法满足传输要求。例如，如果丢包率增加到 20%，使用可靠的 UDP 仍然具有高延迟。</p>
<p><img src="18.16.webp" alt="webp"></p>
<h4 id="forward-error-correction-(fec)" tabindex="-1" id="Forward-Error-Correction-FEC">Forward Error Correction (FEC)</h4>
<p>前向纠错（FEC）</p>
<ul>
<li>
<p>The transmission of enough additiona, redundant information with the primary data stream to reconstruct lost lP packets up to a certain extent</p>
<p>与主数据流一起传输足够的附加、冗余信息，以在一定程度上重建丢失的 IP 数据包</p>
</li>
</ul>
<p><img src="18.17.webp" alt="webp"></p>
<h4 id="xor-fec" tabindex="-1" id="XOR-FEC">XOR-FEC</h4>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>A XOR B</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Law 律</th>
<th>Desc 描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Law of identity 同一律</td>
<td>A xor 0 = A</td>
</tr>
<tr>
<td>Zeroing law 零律</td>
<td>A xor A = 0</td>
</tr>
<tr>
<td>Commutative law 交换律</td>
<td>A xor B = B xor A</td>
</tr>
<tr>
<td>Associative law 结合律</td>
<td>A xor (B xor C) = (A xor B) xor C</td>
</tr>
</tbody>
</table>
<p>C = A xor B</p>
<p>A = A xor (B xor B) = (A xor B) xor B = C xor B</p>
<p>B = (A xor A) xor B = A xor C</p>
<ul>
<li>There are four packets A, B, C, D
<ul>
<li>Let E = XOR (A, B, C, D)</li>
<li>A = XOR (B, C, D, E)</li>
<li>B = XOR (A, C, D, E)</li>
<li>C = XOR (A, B, D, E)</li>
<li>D = XOR (A, B, C, E)</li>
</ul>
</li>
</ul>
<p><img src="18.18.webp" alt="webp"></p>
<p>If any packet is lost, it can be recovered with the other four packets.</p>
<p>如果任何一个数据包丢失，可以用其他四个数据包恢复。</p>
<p>Only one packet can be lost in continuous data. lf <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> are lost at the same time, the algorithm cannot recover.</p>
<p>连续数据中只能丢失一个数据包。如果 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> 同时丢失，则算法无法恢复。</p>
<h4 id="reed-solomon-codes" tabindex="-1" id="Reed-Solomon-Codes">Reed-Solomon Codes</h4>
<p>里德-所罗门码</p>
<p>There are <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> valid data, and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> FEC data are expected to be generated</p>
<p>有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> 个有效数据，预计将生成 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> 个 FEC 数据</p>
<ul>
<li>
<p>Form <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> valid data into a unit vector <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span></p>
<p>将 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> 个有效数据转换为单位向量 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span></p>
</li>
<li>
<p>Generate a transformation matrix <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span>: it is composed of a <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span>-order identity matrix and a <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mo>∗</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">N * M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mbin">∗</span><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> Vandemode matrix (The matrix composed of any n rows of
matrix <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> is reversible)</p>
<p>生成一个变换矩阵 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span>：它由一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> 阶恒等式矩阵和一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mo>∗</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">N * M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mbin">∗</span><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> Vandemode 矩阵组成（该矩阵由以下任意 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> 行组成矩阵 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> 是可逆的）</p>
</li>
<li>
<p>The matrix <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">G</span></span></span></span> obtained by multiplying the matrix <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> and Vector <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span> contains <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> redundant FEC data</p>
<p>通过将矩阵带向量 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span> 相乘获得的矩阵 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">G</span></span></span></span> 包含 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> 个冗余 FEC 数据</p>
</li>
</ul>
<p><img src="18.19.webp" alt="webp"></p>
<p>Assume <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">D1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathrm">1</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">D4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathrm">4</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">C2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mord mathrm">2</span></span></span></span> are lost</p>
<p>假设 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">D1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathrm">1</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">D4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathrm">4</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">C2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mord mathrm">2</span></span></span></span> 丢失</p>
<ul>
<li>
<p>The <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> matrix also needs to delete the corresponding <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> rows to obtain a deformation matrix of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>B</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow><annotation encoding="application/x-tex">B&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.751892em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> 矩阵还需要删除相应的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> 行，以获得 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>B</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow><annotation encoding="application/x-tex">B&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.751892em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 的变形矩阵</p>
</li>
</ul>
<p><img src="18.20.webp" alt="webp"></p>
<ul>
<li>
<p>Inverse matrix <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>B</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow><annotation encoding="application/x-tex">B&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.751892em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> get <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>B</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">B^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p>逆矩阵 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>B</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow><annotation encoding="application/x-tex">B&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.751892em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 得到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>B</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">B^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
</li>
<li>
<p>Multiply B'^{-1} on both sides to recover the original data</p>
<p>将两侧的 B'^{-1} 相乘以恢复原始数据</p>
</li>
</ul>
<p><img src="18.21.webp" alt="webp"></p>
<h4 id="customize-your-udp-based-on-arq-and-fec" tabindex="-1" id="Customize-Your-UDP-based-on-ARQ-and-FEC">Customize Your UDP based on ARQ and FEC</h4>
<p>基于 ARQ 和 FEC 自定义 UDP</p>
<p><strong>Reliability</strong></p>
<p><strong>可靠性</strong></p>
<ul>
<li>
<p>Use Selective Repeat ARQ</p>
<p>使用选择性重复 ARQ</p>
</li>
</ul>
<p><strong>Hybrid ARQ and FEC</strong></p>
<p><strong>混合 ARQ 和 FEC</strong></p>
<ul>
<li>
<p>Before ARQ, FEC is used for error correction</p>
<p>在 ARQ 之前，FEC 用于纠错</p>
</li>
</ul>
<p><strong>Real-time</strong></p>
<p><strong>实时</strong></p>
<ul>
<li>
<p>Smaller RTO growth</p>
<p>RTO 增长较小</p>
</li>
<li>
<p>No congestion control</p>
<p>无拥堵控制</p>
</li>
<li>
<p>Fast retransmission mechanism</p>
<p>快速重传机制</p>
</li>
<li>
<p>No delay ACK</p>
<p>无延迟确认</p>
</li>
</ul>
<p><strong>Flexibility</strong></p>
<p><strong>灵活性</strong></p>
<ul>
<li>
<p>Design protocol for speed</p>
<p>速度设计协议</p>
</li>
<li>
<p>Support both reliable and unreliable transmission</p>
<p>支持可靠和不可靠的传输</p>
</li>
</ul>
<h3 id="clock-synchronization" tabindex="-1" id="Clock-Synchronization">Clock Synchronization</h3>
<p>时钟同步</p>
<h4 id="rtt" tabindex="-1" id="RTT">RTT</h4>
<p><strong>Round-Trip Time</strong></p>
<p><strong>往返时间</strong></p>
<ul>
<li>
<p>Send/Recv delay</p>
<p>发送/接收延迟</p>
</li>
<li>
<p>Propagation delay</p>
<p>传播延迟</p>
</li>
<li>
<p>Response time of the origin server</p>
<p>源服务器的响应时间</p>
</li>
</ul>
<p><strong>RTT vs. Ping</strong></p>
<ul>
<li>
<p>Ping tests are usually performed within a transport protocol that uses lCMP packets</p>
<p>Ping 测试通常在使用 lCMP 数据包的传输协议中执行</p>
</li>
<li>
<p>RTT is measured at the application layer</p>
<p>RTT 在应用层进行测量</p>
</li>
</ul>
<p><strong>RTT vs. Latency</strong></p>
<ul>
<li>
<p>Latency is the time required for a data packet to travel from the sending endpoint to the receivingend point (only one trip)</p>
<p>延迟是数据包从发送端点传输到接收点所需的时间（仅一次行程）</p>
</li>
</ul>
<p><img src="18.22.webp" alt="webp"></p>
<h4 id="network-time-protocol-(ntp)" tabindex="-1" id="Network-Time-Protocol-NTP">Network Time Protocol (NTP)</h4>
<p>网络时间协议（NTP）</p>
<p><strong>Network lime Protocol</strong> is an internet protocol used tosynchronize with computer clock time sources in a network.</p>
<p><strong>网络时间协议</strong>是一种用于与网络中的计算机时钟时间源同步的互联网协议。</p>
<ul>
<li>
<p>Reference clock</p>
<p>参考时钟</p>
<ul>
<li>
<p>GPS clock or radio ransmiiting station</p>
<p>GPS 时钟或无线电传输站</p>
</li>
<li>
<p>Amazinglly precise timekeeping devices such as atomic clocks</p>
<p>令人惊叹的精确计时设备，如原子钟</p>
</li>
<li>
<p><strong>Not connected to the internet</strong></p>
<p><strong>未连接到互联网</strong></p>
</li>
<li>
<p>Send their time through radio or optical fiber</p>
<p>通过无线电或光纤发送他们的时间</p>
</li>
</ul>
</li>
</ul>
<h4 id="time-server-stratums" tabindex="-1" id="Time-Server-Stratums">Time Server Stratums</h4>
<p>时间服务器层</p>
<p><strong>Stratum Values</strong></p>
<ul>
<li>
<p>Degrees of separation from the reference clock</p>
<p>与参考时钟的分离程度</p>
</li>
<li>
<p>Reference clock has <strong>stratum value of 0</strong></p>
<p>参考时钟的<strong>层值为 0</strong></p>
</li>
<li>
<p>Servers with stratum value 1 is called primary time servers</p>
<p>层值为 1 的服务器称为主时间服务器</p>
</li>
<li>
<p>If a device’s stratum value is <strong>over 15</strong>, its time is not trustworthy</p>
<p>如果设备的层值<strong>超过 15</strong>，则其时间不可信</p>
</li>
<li>
<p>Device will choose server with less stratum value automatically when correcting time</p>
<p>设备在校正时间时会自动选择层值较小的服务器</p>
</li>
</ul>
<p><img src="18.23.webp" alt="webp"></p>
<h4 id="ntp-algorithm" tabindex="-1" id="NTP-Algorithm">NTP Algorithm</h4>
<p>NTP 算法</p>
<p>Use NTP is quite simple, just like this</p>
<p>使用 NTP 非常简单，就像这样</p>
<ul>
<li>
<p>Client ask time server for time</p>
<p>客户端向时间服务器请求时间</p>
</li>
<li>
<p>Server receives the request and reply</p>
<p>服务器接收请求和回复</p>
</li>
<li>
<p>Client receives the reply</p>
<p>客户端收到回复</p>
</li>
</ul>
<p>But we have to do something with the Delay!</p>
<p>但我们必须对延迟做点什么！</p>
<p><img src="18.24.webp" alt="webp"></p>
<p>We recordes 4 timestamps as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>t</mi><mn>0</mn><mi>c</mi></msubsup><mo separator="true">,</mo><msubsup><mi>t</mi><mn>1</mn><mi>s</mi></msubsup><mo separator="true">,</mo><msubsup><mi>t</mi><mn>2</mn><mi>s</mi></msubsup><mo separator="true">,</mo><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup></mrow><annotation encoding="application/x-tex">t^c_0, t^s_1, t^s_2, t^c_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.9125em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p><img src="18.25.webp" alt="webp"></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">d</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">p</mi><mtext> </mtext><mi mathvariant="normal">D</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">y</mi></mrow><mo>=</mo><mo>(</mo><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup><mo>−</mo><msubsup><mi>t</mi><mn>0</mn><mi>c</mi></msubsup><mo>)</mo><mo>−</mo><mo>(</mo><msubsup><mi>t</mi><mn>2</mn><mi>s</mi></msubsup><mo>−</mo><msubsup><mi>t</mi><mn>1</mn><mi>s</mi></msubsup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathrm{Round\ Trip\ Delay}=(t^c_3-t^c_0)-(t^s_2-t^s_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">R</span><span class="mord mathrm">o</span><span class="mord mathrm">u</span><span class="mord mathrm">n</span><span class="mord mathrm">d</span><span class="mord mspace"> </span><span class="mord mathrm">T</span><span class="mord mathrm">r</span><span class="mord mathrm">i</span><span class="mord mathrm">p</span><span class="mord mspace"> </span><span class="mord mathrm">D</span><span class="mord mathrm">e</span><span class="mord mathrm">l</span><span class="mord mathrm">a</span><span class="mord mathrm" style="margin-right:0.01389em;">y</span></span><span class="mrel">=</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">−</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">O</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi></mrow><mo>=</mo><mfrac><mrow><mo>(</mo><msubsup><mi>t</mi><mn>1</mn><mi>s</mi></msubsup><mo>−</mo><msubsup><mi>t</mi><mn>0</mn><mi>c</mi></msubsup><mo>+</mo><msubsup><mi>t</mi><mn>2</mn><mi>s</mi></msubsup><mo>−</mo><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup><mo>)</mo></mrow><mrow><mn>2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathrm{Offset}=\frac{(t^s_1-t^c_0+t^s_2-t^c_3)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.01512em;"></span><span class="strut bottom" style="height:1.36012em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">O</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span><span class="mord mathrm">t</span></span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm">2</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.49012em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mopen">(</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.2573142857142857em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">1</span></span></span><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.2573142857142857em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.2573142857142857em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">2</span></span></span><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.2573142857142857em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></p>
<p>The implicit assumption that the one way delay is statistically half the roundtrip delay</p>
<p>单向延迟在统计上是往返延迟的一半的隐含假设</p>
<p>Local-clock correction is computed from the offset data by.</p>
<p>根据偏移数据计算本地时钟校正。</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup><mo>+</mo><mrow><mi mathvariant="normal">O</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi></mrow></mrow><annotation encoding="application/x-tex">t^c_3 + \mathrm{Offset}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.9425479999999999em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord textstyle uncramped"><span class="mord mathrm">O</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span><span class="mord mathrm">t</span></span></span></span></span></li>
</ul>
<p>*The delay and clock-offset samples obtained can be filtered using maximum-likelihood technigues</p>
<p>*获得的延迟和时钟偏移样本可以使用最大似然技术进行滤波</p>
<p><strong>Let’s take an example:</strong></p>
<p><strong>让我们举一个例子：</strong></p>
<p>It’s 17:01:00 on the client</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>t</mi><mn>0</mn><mi>c</mi></msubsup></mrow><annotation encoding="application/x-tex">t^c_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.9125em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> is 17:01:00</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>t</mi><mn>1</mn><mi>s</mi></msubsup></mrow><annotation encoding="application/x-tex">t^s_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.9125em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> is 17:01:32</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>t</mi><mn>2</mn><mi>s</mi></msubsup></mrow><annotation encoding="application/x-tex">t^s_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.9125em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> is 17:01:33</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup></mrow><annotation encoding="application/x-tex">t^c_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.9125em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> is 17:01:05</li>
</ul>
<p>It’s 17:01:30 on the server</p>
<p>(17:01:30)</p>
<p>(17:01:32)</p>
<p>(17:01:33)</p>
<p>(17:01:35)</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">d</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">p</mi><mtext> </mtext><mi mathvariant="normal">D</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">y</mi></mrow><mo>=</mo><mo>(</mo><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup><mo>−</mo><msubsup><mi>t</mi><mn>0</mn><mi>c</mi></msubsup><mo>)</mo><mo>−</mo><mo>(</mo><msubsup><mi>t</mi><mn>2</mn><mi>s</mi></msubsup><mo>−</mo><msubsup><mi>t</mi><mn>1</mn><mi>s</mi></msubsup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathrm{Round\ Trip\ Delay}=(t^c_3-t^c_0)-(t^s_2-t^s_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">R</span><span class="mord mathrm">o</span><span class="mord mathrm">u</span><span class="mord mathrm">n</span><span class="mord mathrm">d</span><span class="mord mspace"> </span><span class="mord mathrm">T</span><span class="mord mathrm">r</span><span class="mord mathrm">i</span><span class="mord mathrm">p</span><span class="mord mspace"> </span><span class="mord mathrm">D</span><span class="mord mathrm">e</span><span class="mord mathrm">l</span><span class="mord mathrm">a</span><span class="mord mathrm" style="margin-right:0.01389em;">y</span></span><span class="mrel">=</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">−</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">O</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi></mrow><mo>=</mo><mfrac><mrow><mo>(</mo><msubsup><mi>t</mi><mn>1</mn><mi>s</mi></msubsup><mo>−</mo><msubsup><mi>t</mi><mn>0</mn><mi>c</mi></msubsup><mo>+</mo><msubsup><mi>t</mi><mn>2</mn><mi>s</mi></msubsup><mo>−</mo><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup><mo>)</mo></mrow><mrow><mn>2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathrm{Offset}=\frac{(t^s_1-t^c_0+t^s_2-t^c_3)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.01512em;"></span><span class="strut bottom" style="height:1.36012em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">O</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span><span class="mord mathrm">t</span></span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm">2</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.49012em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mopen">(</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.2573142857142857em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">1</span></span></span><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.2573142857142857em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.2573142857142857em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">2</span></span></span><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.2573142857142857em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></p>
<hr>
<p>Round Trip Delay = (05 - 00) - (33 - 32) = 4s</p>
<p>Offset = (32 - 00 + 33 - 05) / 2 = 30s</p>
<p>So at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup></mrow><annotation encoding="application/x-tex">t^c_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.9125em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> client’s time is corrected to:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>t</mi><mn>3</mn><mi>c</mi></msubsup><mo>+</mo><mrow><mi mathvariant="normal">O</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi></mrow><mo>=</mo><mn>1</mn><mn>7</mn><mo>:</mo><mn>0</mn><mn>1</mn><mo>:</mo><mn>3</mn><mn>5</mn></mrow><annotation encoding="application/x-tex">t^c_3 + \mathrm{Offset}= 17:01:35</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.9425479999999999em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">3</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">c</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord textstyle uncramped"><span class="mord mathrm">O</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span><span class="mord mathrm">t</span></span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mord mathrm">7</span><span class="mrel">:</span><span class="mord mathrm">0</span><span class="mord mathrm">1</span><span class="mrel">:</span><span class="mord mathrm">3</span><span class="mord mathrm">5</span></span></span></span></li>
</ul>
<h4 id="stream-based-time-synchronization-with-elimination-of-higher-order-modes" tabindex="-1" id="Stream-Based-Time-Synchronization-with-Elimination-of-Higher-Order-Modes">Stream-Based Time Synchronization with Elimination of Higher Order Modes</h4>
<p>基于流的时间同步，消除高阶模式</p>
<p>1. Client stamps current <strong>local time</strong> on a “time request” packet and sends to server</p>
<p>​	客户端在“时间请求”数据包上标记当前<strong>本地时间</strong>并发送到服务器</p>
<p>2. Upon receipt by server, server stamps server-time and returns</p>
<p>​	服务器收到后，服务器标记服务器时间并返回</p>
<p>3. Upon receipt by client, a time delta is calculated by delta = (current Time-sent Time) / 2</p>
<p>​	客户端收到后，通过 delta=（当前发送时间）/2 计算时间增量</p>
<p>So far this algorithm is very like to NTP</p>
<p>到目前为止，该算法与 NTP 非常相似</p>
<p>4. The first result should immediately be used toupdate the clock</p>
<p>​	第一个结果应立即用于更新时钟</p>
<p>5. The client repeats Steps 1-3 (NTP-like process), five or more times</p>
<p>​	客户端重复步骤1-3（类似 NTP 的过程）五次或更多次</p>
<p>6. The results of the packet receipts are accumulatedand sorted in ascending order by latency</p>
<p>​	数据包接收的结果按延迟升序累积和排序</p>
<p>7. All samples above that are approximately 1.5 times the median are discarded, and the remaining samples are averaged using an arithmetic mean</p>
<p>​	丢弃上述约为中位数 1.5 倍的所有样本，并使用算术平均值对剩余样本进行平均</p>
<p><img src="18.26.webp" alt="webp"></p>
<h3 id="remote-procedure-call-(rpc)" tabindex="-1" id="Remote-Procedure-Call-RPc">Remote Procedure Call (RPc)</h3>
<p>远程过程调用（RPC）</p>
<h4 id="socket-programming%3A-still-not-great" tabindex="-1" id="Socket-Programming-Still-not-Great">Socket Programming: Still not Great</h4>
<p>Socket 编程：仍然不太好</p>
<ul>
<li>
<p>Lots for the programmer to deal with every time</p>
<p>程序员每次都要处理很多事情</p>
<ul>
<li>
<p>How to separate different requests on the same connection?</p>
<p>如何在同一连接上分离不同的请求？</p>
</li>
<li>
<p>How to write bytes to the network/read bytes from the network?</p>
<p>如何向网络写入字节/从网络读取字节？</p>
</li>
<li>
<p>What if Host A’s process is written in Go and Host B’s process is in C++?</p>
<p>如果主机 A 的进程是用 Go 编写的，而主机 B 的进程是 C++ 编写的呢？</p>
</li>
<li>
<p>What to do with those bytes?</p>
<p>如何处理这些字节？</p>
</li>
</ul>
</li>
<li>
<p>Still pretty painful… have to worry a lot about the network</p>
<p>仍然很痛苦…不得不非常担心网络</p>
<ul>
<li>
<p>Have you received the message?</p>
<p>你收到消息了吗？</p>
</li>
</ul>
</li>
</ul>
<h4 id="communication-with-messages" tabindex="-1" id="Communication-with-Messages">Communication with Messages</h4>
<p>消息通信</p>
<p><img src="18.27.webp" alt="webp"></p>
<h4 id="communication-way" tabindex="-1" id="Communication-Way">Communication Way</h4>
<p>沟通方式</p>
<p>Initially, people “hand-coded” messages to send requests and responses</p>
<p>最初，人们“手工编码”消息以发送请求和响应</p>
<ul>
<li>
<p>Message is a stream of bytes-“op codes” and operands</p>
<p>消息是字节流-“操作码”和操作数</p>
</li>
</ul>
<p>Lots of drawbacks</p>
<p>很多缺点</p>
<ul>
<li>
<p>Need to worry about message format</p>
<p>需要担心消息格式</p>
</li>
<li>
<p>Have to pack and unpack data from messages</p>
<p>必须从消息中打包和解包数据</p>
</li>
<li>
<p>Servers have to decode messages and dispatch them to handlers</p>
<p>服务器必须解码消息并将其分派给处理程序</p>
</li>
<li>
<p>Messages are often asynchronous</p>
<p>消息通常是异步的</p>
<ul>
<li>
<p>After sending one, what do you do until the response comes back?</p>
<p>发送一个后，在收到回复之前，你会做什么？</p>
</li>
</ul>
</li>
<li>
<p>Messages aren’t a natural programming mode</p>
<p>消息不是一种自然的编程模式</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">foomsg</span> &#123;<br>    uint32 <span class="hljs-type">_t</span> len;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">send_foo</span><span class="hljs-params">(<span class="hljs-type">char</span> *contents)</span> </span>&#123;<br>    <span class="hljs-type">int</span> msglen = <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">struct</span> foomsg) + <span class="hljs-built_in">strlen</span>(contents);<br>    <span class="hljs-type">char</span> buf = <span class="hljs-built_in">malloc</span>(msglen);<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">foomsg</span> *fm = (<span class="hljs-keyword">struct</span> foomsg *)buf;<br>    fm-&gt;len = <span class="hljs-built_in">htonl</span>(<span class="hljs-built_in">strlen</span>(contents));<br>    <span class="hljs-built_in">memcpy</span>(buf + <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">struct</span> foomsg), contents, <span class="hljs-built_in">strlen</span>(contents));<br>    <span class="hljs-built_in">write</span>(outsock,buf, msglen);<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="more-challenges-on-logic-communication" tabindex="-1" id="More-Challenges-on-Logic-Communication">More Challenges on Logic Communication</h4>
<p>逻辑通信面临更多挑战</p>
<ul>
<li>
<p>For a remote procedure call, a remote machine may:</p>
<p>对于远程过程调用，远程机器可以：</p>
<ul>
<li>
<p>Run process written in a <strong>different language</strong></p>
<p>运行用其他语言编写的进程</p>
</li>
<li>
<p>Represent data types using <strong>different sizes</strong></p>
<p>使用不同大小表示数据类型</p>
</li>
<li>
<p>Use a <strong>different byte ordering</strong> (endianness)</p>
<p>使用不同的字节顺序（字节序）</p>
</li>
<li>
<p>Represent floating point numbers <strong>differently</strong></p>
<p>以不同的方式表示浮点数</p>
</li>
<li>
<p>Have <strong>different data alignment</strong> requirements</p>
<p>有不同的数据对齐要求</p>
<p>e.g., 4-byte type begins only on 4-byte memory boundary</p>
<p>例如，4 字节类型仅在 4 字节内存边界上开始</p>
</li>
</ul>
</li>
</ul>
<h4 id="remote-procedure-call-(rpc)-1" tabindex="-1" id="Remote-Procedure-Call-RPC">Remote Procedure Call (RPC)</h4>
<p>远程过程调用（RPC）</p>
<ul>
<li>
<p>RPC is a reguest-response protocol. An RPC is initiated by the cient, which sends a reguest message to a known remote server to execute a specified procedure with supplied parameters</p>
<p>RPC 是一种规范的响应协议。RPC 由 cient 发起，它向已知的远程服务器发送一条规则消息，以使用提供的参数执行指定的过程</p>
</li>
<li>
<p>Goals</p>
<p>目标</p>
<ul>
<li>
<p>Ease of programming</p>
<p>易于编程</p>
</li>
<li>
<p>Hide complexity</p>
<p>隐藏复杂性</p>
</li>
<li>
<p>Familiar model for programmers (just make a function call)</p>
<p>程序员熟悉的模型（只需进行函数调用）</p>
</li>
</ul>
</li>
</ul>
<p><img src="18.28.webp" alt="webp"></p>
<h4 id="rpc-example" tabindex="-1" id="RPC-example">RPC example</h4>
<ul>
<li>Go language</li>
</ul>
<p><img src="18.29.webp" alt="webp"></p>
<ul>
<li>
<p>Output</p>
<p>Hello World</p>
</li>
</ul>
<h4 id="why-rpc%3F" tabindex="-1" id="Why-RPC">Why RPC?</h4>
<p>为什么选择 RPC？</p>
<ul>
<li>
<p>Goal: Easy-to-program network communication that makes client-server communication transparent</p>
<p>目标：易于编程的网络通信，使客户端-服务器通信透明</p>
<ul>
<li>
<p>Retains the “feel” of writing centralized code</p>
<p>保留编写集中式代码的“感觉”</p>
</li>
<li>
<p>Programmers needn’t think about the network</p>
<p>程序员不必考虑网络</p>
</li>
<li>
<p>Make communication appear like a local procedure call</p>
<p>使通信看起来像本地过程调用</p>
</li>
</ul>
</li>
<li>
<p>Don’t need to worry about serialization/deserialization for network</p>
<p>无需担心网络的序列化/反序列化</p>
</li>
<li>
<p>Don’t need to worry about complexities of network</p>
<p>无需担心网络的复杂性</p>
</li>
</ul>
<h4 id="interface-definition-language" tabindex="-1" id="Interface-Definition-Language">Interface Definition Language</h4>
<p>接口定义语言</p>
<ul>
<li>
<p>A server defines the service interface using an interface definition language (lDL)</p>
<p>服务器使用接口定义语言（lDL）定义服务接口</p>
<p>The lDL specifies the names, parameters, and types for allclient-callable server procedures</p>
<p>lDL 指定了所有客户端可调用服务器过程的名称、参数和类型</p>
<ul>
<li>
<p>example: ASN.1 in the OSI reference model</p>
<p>示例：OSI 参考模型中的 ASN.1</p>
</li>
<li>
<p>example: Protobuf (Google’s data interchange format)</p>
<p>示例：Protobuf（谷歌的数据交换格式）</p>
</li>
<li>
<p>…</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-comment">//polyline.proto</span><br>syntax =<span class="hljs-string">&quot;proto2&quot;</span>;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">Point</span> &#123;<br>    <span class="hljs-keyword">required</span> <span class="hljs-type">int32</span> x = <span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">required</span> <span class="hljs-type">int32</span> y = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">optional</span> <span class="hljs-type">string</span> label = <span class="hljs-number">3</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">Line</span> &#123;<br>    <span class="hljs-keyword">required</span> Point start = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">required</span> Point end = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">optional</span> <span class="hljs-type">string</span> label = <span class="hljs-number">3</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">Polyline</span> &#123;<br>    <span class="hljs-keyword">repeated</span> Point point = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">optional</span> <span class="hljs-type">string</span> label = <span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="rpc-stubs" tabindex="-1" id="RPC-Stubs">RPC Stubs</h4>
<ul>
<li>
<p>A client-side stub is a procedure that looks to the client as if it were a callable server procedure</p>
<p>客户端存根是一个过程，它在客户端看起来就像是一个可调用的服务器过程</p>
<ul>
<li>
<p>The client program thinks it’s invoking the server butit’s calling into the client-side stub</p>
<p>客户端程序认为它正在调用服务器，但它正在调用客户端存根</p>
</li>
</ul>
</li>
<li>
<p>Aserver-side stub looks like a caller to the server</p>
<p>服务器端存根看起来像是服务器的调用者</p>
<ul>
<li>
<p>The server program thinks it’s called by the client but it’s really called by the server-side stub</p>
<p>服务器程序认为它是由客户端调用的，但实际上是由服务器端存根调用的</p>
</li>
</ul>
</li>
<li>
<p>The stubs send messages to each other to make the RPC happen transparently</p>
<p>存根相互发送消息，使 RPC 透明地发生</p>
</li>
</ul>
<p><img src="18.30.webp" alt="webp"></p>
<h4 id="stub-compiler" tabindex="-1" id="Stub-compiler">Stub compiler</h4>
<ul>
<li>
<p>A “stub compiler” reads the IDL declarations and produces two stub procedures for each server procedure</p>
<p>“存根编译器”读取 IDL 声明，并为每个服务器过程生成两个存根过程</p>
<ul>
<li>
<p>The server programmer implements the service’s procedures and links them with the server-side stubs</p>
<p>服务器程序员实现服务的过程，并将其与服务器端存根链接起来</p>
</li>
<li>
<p>The client programmer implements the client program and links it with the client-side stubs</p>
<p>客户端程序员实现客户端程序并将其与客户端存根链接</p>
</li>
<li>
<p>The stubs manage all of the details of remote communication between client and server</p>
<p>存根管理客户端和服务器之间远程通信的所有细节</p>
</li>
</ul>
</li>
</ul>
<h4 id="real-rpc-package-vourney" tabindex="-1" id="Real-RPC-Package-vourney">Real RPC Package vourney</h4>
<p>真实 RPC 包凭证</p>
<p><img src="18.31.webp" alt="webp"></p>
<h3 id="network-topology" tabindex="-1" id="Network-Topology">Network Topology</h3>
<p>网络拓扑</p>
<h4 id="original-peer-to-peer-(p2p)" tabindex="-1" id="Original-Peer-to-Peer-P2P">Original Peer-to-Peer (P2P)</h4>
<p>原始点对点（P2P）</p>
<ul>
<li>
<p>Each client broadcasts game event to the al others</p>
<p>每个客户端向其他客户端广播游戏事件</p>
</li>
<li>
<p>Robustness</p>
<p>稳健性</p>
</li>
<li>
<p>Cheating is much easier</p>
<p>作弊要容易得多</p>
</li>
<li>
<p>Synchronization is required among all nodesto maintain the consistency of the distributed game state</p>
<p>所有节点之间需要同步，以保持分布式游戏状态的一致性</p>
</li>
</ul>
<p><img src="18.32.webp" alt="webp"></p>
<h4 id="p2p-with-host-server" tabindex="-1" id="P2P-with-Host-Server">P2P with Host Server</h4>
<p>P2P 与主机服务器（如 CS）</p>
<ul>
<li>
<p>A player can act as “server”, known as host</p>
<p>玩家可以充当“服务器”，即主机</p>
</li>
<li>
<p>If host disconnected, the game may end</p>
<p>如果主机断开连接，游戏可能会结束</p>
</li>
<li>
<p>The host need to handle game actor that cannot be controled by players, such as bot</p>
<p>主机需要处理玩家无法控制的游戏角色，如机器人</p>
</li>
</ul>
<p><img src="18.33.webp" alt="webp"></p>
<h4 id="p2p-games" tabindex="-1" id="P2P-Games">P2P Games</h4>
<p>P2P 游戏</p>
<ul>
<li>
<p>No rely on server</p>
<p>不依赖服务器</p>
</li>
<li>
<p>Used in Lan commonly</p>
<p>常用于局域网</p>
</li>
<li>
<p>The “Host”is basically in control of the sessions</p>
<p>“主持人”基本上控制着会话</p>
</li>
<li>
<p>A limited number of players at once</p>
<p>一次玩家数量有限</p>
</li>
</ul>
<p><img src="18.34.webp" alt="webp"></p>
<h4 id="dedicated-server" tabindex="-1" id="Dedicated-Server">Dedicated Server</h4>
<p>专用服务器</p>
<ul>
<li>
<p>Authority</p>
<p>权威机构</p>
</li>
<li>
<p>Simulate game world</p>
<p>模拟游戏世界</p>
</li>
<li>
<p>Dispatch data to players</p>
<p>向玩家发送数据</p>
</li>
<li>
<p>High performance requirements</p>
<p>高性能要求</p>
</li>
</ul>
<p><img src="18.35.webp" alt="webp"></p>
<h4 id="p2p-vs-dedicated-server" tabindex="-1" id="P2P-vs-Dedicated-Server">P2P vs Dedicated Server</h4>
<p>P2P 与专用服务器</p>
<table>
<thead>
<tr>
<th></th>
<th>P2P</th>
<th>Dedicated Server</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pros</td>
<td>1. Robustness<br/>稳健性<br/>2. Removes the “server issues” problem in multiplayer sessions.<br/>消除多人游戏会话中的“服务器问题”问题<br/>3. No extra cost on server<br/>服务器无需额外付费</td>
<td>1. Easy to maintain as well as cheating avoidance<br/>易于维护，避免作弊<br/>2. Can handle massive game world<br/>可以处理大型游戏世界<br/>3. Responsiveness of the game is not relay on the network conditions of each individual client<br/>游戏的响应性并不取决于每个客户端的网络状况</td>
</tr>
<tr>
<td>Cons</td>
<td>1. Cheating is much easier<br/>作弊要容易得多<br/>2. Every player needs a decent network connection for game to function properly<br/>每个玩家都需要一个像样的网络连接，游戏才能正常运行<br/>3. Can only handle a limited number of players<br/>只能处理有限数量的玩家</td>
<td>1. High cost on server<br/>服务器成本高<br/>2. Much more work on server side program<br/>在服务器端程序上还有更多的工作要做<br/>3. Single point of failure<br/>单点故障</td>
</tr>
</tbody>
</table>
<h4 id="when-rtt-is-too-high" tabindex="-1" id="When-RTT-is-too-high">When RTT is too high</h4>
<p>RTT 过高时</p>
<ul>
<li>
<p>When players are in different countries, far away, or when the network environment is complex</p>
<p>当玩家身处不同的国家、遥远的地方，或者网络环境复杂时</p>
</li>
<li>
<p>Use dedicated line and edge gateway to reduce latency</p>
<p>使用专用线路和边缘网关来减少延迟</p>
</li>
</ul>
<p><img src="18.36.webp" alt="webp"></p>
<h3 id="game-synchronization" tabindex="-1" id="Game-Synchronization">Game Synchronization</h3>
<p>游戏同步</p>
<h4 id="single-player-gaming" tabindex="-1" id="Single-Player-Gaming">Single-Player Gaming</h4>
<p>Game Tick</p>
<ul>
<li>
<p>Player inputs</p>
<p>玩家输入</p>
</li>
<li>
<p>Convert to game commands</p>
<p>转换为游戏命令</p>
</li>
<li>
<p>Game logic</p>
<p>游戏逻辑</p>
</li>
<li>
<p>Game render</p>
<p>游戏渲染</p>
</li>
</ul>
<p>For Player</p>
<p>对于玩家</p>
<ul>
<li>
<p>Player inputs</p>
<p>玩家输入</p>
</li>
<li>
<p>Consistency in each other</p>
<p>彼此的一致性</p>
</li>
</ul>
<p><img src="18.37.webp" alt="webp"></p>
<h4 id="online-gaming" tabindex="-1" id="Online-Gaming">Online Gaming</h4>
<p>在线游戏</p>
<p>For Player</p>
<p>对于玩家</p>
<ul>
<li>
<p>Player inputs</p>
<p>玩家输入</p>
</li>
<li>
<p>Consistency in each other</p>
<p>彼此的一致性</p>
</li>
</ul>
<p>How to play together at different terminals?</p>
<p>如何在不同的终端上一起玩？</p>
<ul>
<li>
<p>Game commands</p>
<p>游戏命令</p>
</li>
<li>
<p>Game Logic</p>
<p>游戏逻辑</p>
</li>
</ul>
<p><img src="18.38.webp" alt="webp"></p>
<h4 id="game-synchronization-1" tabindex="-1" id="Game-Synchronization-2">Game Synchronization</h4>
<p>游戏同步</p>
<p>To answer the demand for responsive strategies, the synchronization rule is designed to solve the delay and consistency of all destination.</p>
<p>为了满足对响应策略的需求，设计了同步规则来解决所有目的地的延迟和一致性问题。</p>
<h4 id="synchronization-methods" tabindex="-1" id="Synchronization-Methods">Synchronization Methods</h4>
<p>同步方法</p>
<p><img src="18.39.webp" alt="webp"></p>
<table>
<thead>
<tr>
<th>Snapshot 快照</th>
<th>Lockstep 锁步</th>
<th>State Synchornization 状态同步</th>
</tr>
</thead>
<tbody>
<tr>
<td>Quake</td>
<td>Honor of Kings 王者荣耀</td>
<td>Counter Strike 反恐精英</td>
</tr>
</tbody>
</table>
<h4 id="snapshot-synchronization" tabindex="-1" id="Snapshot-Synchronization">Snapshot Synchronization</h4>
<p>快照同步</p>
<p><img src="18.40.webp" alt="webp"></p>
<ul>
<li>
<p>Client sends inputs to server</p>
<p>客户端向服务器发送输入</p>
</li>
<li>
<p>Server simulates the game world</p>
<p>服务器模拟游戏世界</p>
</li>
<li>
<p>Generates whole game statesnapshots</p>
<p>生成整个游戏状态快照</p>
</li>
<li>
<p>Sends them down to clients</p>
<p>将它们发送给客户</p>
</li>
<li>
<p>Client updates the display according to the snapshot</p>
<p>客户端根据快照更新显示</p>
</li>
</ul>
<h4 id="snapshot-synchronization---jitter-and-hitches" tabindex="-1" id="Snapshot-Synchronization-Jitter-and-Hitches">Snapshot Synchronization - Jitter and Hitches</h4>
<p>快照同步-抖动和挂接</p>
<ul>
<li>
<p>Server tick rate is limited</p>
<p>服务器时间速率有限</p>
</li>
<li>
<p>Performance</p>
<p>性能</p>
</li>
<li>
<p>Bandwidth</p>
<p>带宽</p>
</li>
</ul>
<h4 id="snapshot-interpolation" tabindex="-1" id="Snapshot-Interpolation">Snapshot Interpolation</h4>
<p>快照插值</p>
<ul>
<li>
<p>Not rendering immediately after snapshot recevied</p>
<p>收到快照后不立即渲染</p>
</li>
<li>
<p>Keep an interpolation buffer</p>
<p>保留插值缓冲区</p>
</li>
<li>
<p>Interpolation between the two delayed snapshots</p>
<p>两个延迟快照之间的插值</p>
</li>
</ul>
<h4 id="delta-compression" tabindex="-1" id="Delta-Compression">Delta Compression</h4>
<p>德尔塔压缩</p>
<ul>
<li>
<p>Only sync snapshot delta to client</p>
<p>仅将快照增量同步到客户端</p>
</li>
<li>
<p>Example Quake3</p>
</li>
</ul>
<p><img src="18.41.webp" alt="webp"></p>
<p>Snapshot Synchorization</p>
<p>快照同步</p>
<ul>
<li>
<p>60HZ</p>
</li>
<li>
<p>Max Bandwidth 4.5 mbps</p>
<p>最大带宽 4.5mbps</p>
</li>
</ul>
<p>Delta Compression</p>
<p>德尔塔压缩</p>
<ul>
<li>
<p>60HZ</p>
</li>
<li>
<p>Max Bandwidth 676 kbps</p>
<p>最大带宽 676 kbps</p>
</li>
</ul>
<h4 id="synchronizing-snapshot" tabindex="-1" id="Synchronizing-Snapshot">Synchronizing Snapshot</h4>
<p>正在同步快照</p>
<ul>
<li>
<p>Client performance is wasted</p>
<p>客户端性能被浪费</p>
</li>
<li>
<p>High server pressure</p>
<p>服务器压力高</p>
</li>
<li>
<p>High data volume and high bandwidth requirements</p>
<p>高数据量和高带宽要求</p>
</li>
<li>
<p>As games get more complex, snapshots get bigger</p>
<p>随着游戏变得越来越复杂，快照也越来越大</p>
</li>
</ul>
<h3 id="lockstep-synchronization" tabindex="-1" id="Lockstep-Synchronization">Lockstep Synchronization</h3>
<p>锁步同步</p>
<h4 id="lockstep-origin" tabindex="-1" id="Lockstep-Origin">Lockstep Origin</h4>
<p>锁步原点</p>
<p>Lockstep synchronization, used in military simulation, is by far the simplest techique to ensure consistency</p>
<p>用于军事模拟的锁步同步是迄今为止确保一致性的最简单技术。</p>
<ul>
<li>
<p>Same Result</p>
<p>相同的结果</p>
</li>
<li>
<p>Same time</p>
<p>同一时间</p>
</li>
<li>
<p>Same action</p>
<p>同样的行动</p>
</li>
</ul>
<p>No member is allowed to advance its simulation clock until all others members have acknowledged that they are done.</p>
<p>在所有其他成员确认完成之前，任何成员都不允许提前其模拟时钟。</p>
<p><img src="18.42.webp" alt="webp"></p>
<p>In particular, it is clear that a totally ordered delivery is a sufficient condition to ensure game state consistency across different nodes, as it guarantees that all generated events are reliably delivered according to the same unique order.</p>
<p>特别是，很明显，完全有序的交付是确保不同节点之间游戏状态一致性的充分条件，因为它保证了所有生成的事件都按照相同的唯一顺序可靠地交付。</p>
<h4 id="lockstep-in-online-game" tabindex="-1" id="Lockstep-in-Online-Game">Lockstep in Online Game</h4>
<p>网络游戏中的锁步</p>
<p>Lockstep Principle.</p>
<p>锁步原理。</p>
<p><img src="18.43.webp" alt="webp"></p>
<h4 id="first-game-used-lockstep" tabindex="-1" id="First-Game-Used-Lockstep">First Game Used Lockstep</h4>
<p>第一个游戏使用锁步</p>
<ul>
<li>
<p>The network synchronization methodof DOOM (1994) was pointed out in a 2006 paper</p>
<p>2006 年的一篇论文指出了 DOOM（1994）的网络同步方法</p>
</li>
<li>
<p>Lockstep is not mentioned in the paper, but it is now generally accepted that Doom (1994) was the first multiplayer FPS online game to use this type of synchronization</p>
<p>论文中没有提到锁步，但现在人们普遍认为《毁灭战士》（1994）是第一款使用这种同步的多人 FPS 在线游戏</p>
</li>
<li>
<p>It uses P2P architecture</p>
<p>它使用 P2P 架构</p>
</li>
</ul>
<p><img src="18.44.webp" alt="webp"></p>
<h4 id="lockstep-initialization" tabindex="-1" id="Lockstep-initialization">Lockstep initialization</h4>
<p>锁步初始化</p>
<p>Loading…</p>
<p>加载…</p>
<ul>
<li>
<p>Ensure that the initial data of each client is deterministic</p>
<p>确保每个客户端的初始数据是确定的</p>
<ul>
<li>
<p>Game model</p>
<p>游戏模型</p>
</li>
<li>
<p>Static data</p>
<p>静态数据</p>
</li>
<li>
<p>…</p>
</li>
</ul>
</li>
<li>
<p>Synchronize clock</p>
<p>同步时钟</p>
</li>
</ul>
<h4 id="deterministic-lockstep" tabindex="-1" id="Deterministic-Lockstep">Deterministic Lockstep</h4>
<p>确定性锁步</p>
<ul>
<li>
<p>Client sends inputs to Server</p>
<p>客户端向服务器发送输入</p>
</li>
<li>
<p>Server receives and sorts</p>
<p>服务器接收和排序</p>
</li>
<li>
<p>Wait for input from all clients before forwarding</p>
<p>转发前等待所有客户端的输入</p>
</li>
<li>
<p>After receiving data from the server, the client executes the game logic</p>
<p>在从服务器接收到数据后，客户端执行游戏逻辑</p>
</li>
</ul>
<p><img src="18.45.webp" alt="webp"></p>
<p>If Player B’s message B2 arrives later? (The dotted line B2 in the figure)</p>
<p>如果玩家 B 的消息 B2 稍后到达？（图中虚线 B2）</p>
<ul>
<li>
<p>Disadvantages</p>
<p>缺点</p>
<ul>
<li>
<p>Game progress depends on slowest player</p>
<p>游戏进度取决于最慢的玩家</p>
</li>
<li>
<p>The delay of the game is notfixed, the experience is not good</p>
<p>游戏的延迟不是固定的，体验不好</p>
</li>
<li>
<p>All the players will wait if a player offline</p>
<p>如果有玩家离线，所有玩家都会等待</p>
</li>
</ul>
</li>
</ul>
<p><img src="18.46.webp" alt="webp"></p>
<h4 id="player-offline-in-deterministic-lockstep" tabindex="-1" id="Player-Offline-in-Deterministic-Lockstep">Player Offline in Deterministic Lockstep</h4>
<p>确定性锁步中的玩家离线</p>
<p>Waiting for players…</p>
<p>正在等待玩家…</p>
<p><img src="18.47.webp" alt="webp"></p>
<h4 id="bucket-synchronization" tabindex="-1" id="Bucket-Synchronization">Bucket Synchronization</h4>
<p>Bucket 同步</p>
<ul>
<li>
<p>Bucket: a fixed time period</p>
<p>Bucket：固定时间段</p>
</li>
<li>
<p>Each bucket</p>
<p>每个水桶</p>
<ul>
<li>
<p>Colect all instructions</p>
<p>整理所有说明</p>
</li>
<li>
<p>Broadcast to all players</p>
<p>向所有玩家广播</p>
</li>
</ul>
</li>
<li>
<p>There is no need to wait for all players’ commands to be received before forwarding</p>
<p>转发前无需等待收到所有玩家的命令</p>
</li>
</ul>
<p><img src="18.48.webp" alt="webp"></p>
<h4 id="a-good-trade-off-between-consistency-and-interactivity-maintenance" tabindex="-1" id="A-Good-Trade-off-between-Consistency-and-Interactivity-Maintenance">A Good Trade-off between Consistency and Interactivity Maintenance</h4>
<p>一致性和交互性维护之间的良好权衡</p>
<p>So we need to find a basis balance between them.</p>
<p>因此，我们需要在它们之间找到一个基本的平衡点。</p>
<p><strong>The threshold:</strong></p>
<p><strong>阈值：</strong></p>
<p>As soon as the measured interactivity degree decreases below a given thresholdtake some procedure skips processing obsolete game events withthe aim of bringing back a satisfactory interactivity level.</p>
<p>一旦测量的交互性降低到给定的阈值以下，一些程序就会跳过处理过时的游戏事件，以恢复令人满意的交互性水平。</p>
<p><img src="18.49.webp" alt="webp"></p>
<h4 id="deterministic-difficulties" tabindex="-1" id="Deterministic-Difficulties">Deterministic Difficulties</h4>
<p>确定性难题</p>
<ul>
<li>
<p>Deterministic</p>
<p>确定性</p>
<ul>
<li>
<p>The same input sequence need to produce the same game state on all machines</p>
<p>相同的输入序列需要在所有机器上产生相同的游戏状态</p>
</li>
</ul>
</li>
<li>
<p>Deterministic is Hard</p>
<p>确定性很难</p>
<ul>
<li>
<p>Floating point</p>
<p>浮点型</p>
</li>
<li>
<p>Random number</p>
<p>随机数</p>
</li>
<li>
<p>Containers and algorithms (sort, add, remove, etc.)</p>
<p>容器和算法（排序、添加、删除等）</p>
</li>
<li>
<p>Math tools (vectors, quaternions, etc)</p>
<p>数学工具（向量、四元数等）</p>
</li>
<li>
<p>Physics simulation (very difficult)</p>
<p>物理模拟（非常困难）</p>
</li>
<li>
<p>Code logic execution order</p>
<p>代码逻辑执行顺序</p>
</li>
</ul>
</li>
</ul>
<p><img src="18.50.webp" alt="webp"></p>
<h4 id="floating-point-numbers" tabindex="-1" id="Floating-Point-Numbers">Floating Point Numbers</h4>
<p>浮点数</p>
<ul>
<li>
<p>Because of the computer binary, Thesenumbers can be accurately represented</p>
<p>由于计算机二进制，这些数字可以被精确地表示出来</p>
<ul>
<li>0.5 = 1/2</li>
<li>0.25 = 1/4</li>
<li>0.75 = 1/2 + 1/4</li>
<li>0.875 = 1/2 + 1/4 + 1/8</li>
</ul>
</li>
<li>
<p>Such numbers can only be approximated</p>
<p>这些数字只能近似表示</p>
<ul>
<li>2/3 ≈ 0.66…7</li>
</ul>
</li>
</ul>
<p><img src="18.51.webp" alt="webp"></p>
<ul>
<li>
<p>Floating point numbers must comply with the lEEE 754 standard</p>
<p>浮点数必须符合 lEEE 754 标准</p>
</li>
</ul>
<hr>
<ul>
<li>
<p>Floating point numbers conform to the lEEE 754standard</p>
<p>浮点数符合 lEEE 754 标准</p>
</li>
<li>
<p>But different platforms may have different behavior</p>
<p>但不同的平台可能有不同的行为</p>
</li>
</ul>
<hr>
<p><strong>Floating Point Hardware &amp; OS Behaviour</strong></p>
<p><strong>浮点硬件和操作系统行为</strong></p>
<ul>
<li>
<p>Intel / Amd</p>
</li>
<li>
<p>PS / Xbox</p>
</li>
<li>
<p>Windows / linux</p>
</li>
<li>
<p>Android / IOS</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<hr>
<p><strong>Floating Point Compilers Behaviour</strong></p>
<p><strong>浮点编译器行为</strong></p>
<ul>
<li>
<p>Math Library(sin、cosin、tan、exp、pow …)</p>
<p>数学库（sin、cosin、tan、exp、pow…）</p>
</li>
<li>
<p>Third party components</p>
<p>第三方组件</p>
</li>
<li>
<p>Different platforms</p>
<p>不同的平台</p>
</li>
<li>
<p>Different versions</p>
<p>不同版本</p>
</li>
<li>
<p>Different languages</p>
<p>不同的语言</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<hr>
<p>Idea: Avoid problems on the precision boundary, customize the precision</p>
<p>理念：避免精度边界问题，定制精度</p>
<ul>
<li>
<p>Fixed-point math library</p>
<p>定点数学库</p>
</li>
<li>
<p>Look-up table (trigonometric functions, etc.)</p>
<p>查找表（三角函数等）</p>
</li>
<li>
<p>Amplification and truncation</p>
<p>放大和截断</p>
</li>
</ul>
<p>Simple method</p>
<p>简单的方法</p>
<ul>
<li>
<p>Multiply by 1000, then divide by 1000, there is an overflow risk</p>
<p>乘以 1000，然后除以 1000，存在溢出风险</p>
</li>
<li>
<p>The numerator and denominator are represented by fixed-point numbers (2/3)</p>
<p>分子和分母由定点数（2/3）表示</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<hr>
<p><strong>One Solution: Fixed point math</strong></p>
<p><strong>一种解决方案：定点数</strong></p>
<p>A fixed-point number can be split into three parts</p>
<p>一个定点数可以分成三部分</p>
<ul>
<li>
<p>An optional sign bit</p>
<p>可选符号位</p>
</li>
<li>
<p>An integer</p>
<p>一个整数</p>
</li>
<li>
<p>A fractional part</p>
<p>分数部分</p>
</li>
<li>
<p>Need to implement addition, subtraction, multiplication and division etd.</p>
<p>需要实现加、减、乘、除等运算</p>
</li>
<li>
<p>Implement class, class methods</p>
<p>实现类、类方法</p>
</li>
<li>
<p>Performance needs to be considered</p>
<p>需要考虑性能</p>
</li>
</ul>
<p><img src="18.52.webp" alt="webp"></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mo>=</mo><mo>(</mo><mo>−</mo><mn>1</mn><msup><mo>)</mo><mrow><msub><mi>b</mi><mrow><mi>f</mi><mo>+</mo><mi>i</mi></mrow></msub></mrow></msup><mo>(</mo><msubsup><mo>∑</mo><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>i</mi></mrow></msubsup><msup><mn>2</mn><mrow><mi>n</mi></mrow></msup><msub><mi>b</mi><mrow><mi>n</mi><mo>+</mo><mi>f</mi></mrow></msub><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>f</mi></mrow></msubsup><msup><mn>2</mn><mrow><mo>−</mo><mi>m</mi></mrow></msup><msub><mi>b</mi><mrow><mi>f</mi><mo>−</mo><mi>m</mi></mrow></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">V=(-1)^{b_{f+i}}(\sum_{n=0}^{i}2^{n}b_{n+f}+\sum_{m=1}^{f}2^{-m}b_{f-m})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.8832210000000003em;"></span><span class="strut bottom" style="height:3.150334em;vertical-align:-1.267113em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathrm">1</span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord"><span class="mord mathit">b</span><span class="vlist"><span style="top:0.15122857142857138em;margin-right:0.07142857142857144em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord scriptscriptstyle cramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mbin">+</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1671129999999998em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">b</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1671129999999998em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">m</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2971130000000002em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord">−</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">b</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mbin">−</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></span></p>
<h4 id="random-number" tabindex="-1" id="Random-Number">Random Number</h4>
<p>随机数</p>
<ul>
<li>
<p>Random problems in the game</p>
<p>游戏中的随机问题</p>
<ul>
<li>
<p>Trigger of random events, npc random birthplace</p>
<p>随机事件触发，NPC 随机出生地</p>
</li>
<li>
<p>A random attribute of the attack, e.g. critical strike chance</p>
<p>攻击的随机属性，例如暴击机会</p>
</li>
<li>
<p>…</p>
</li>
</ul>
</li>
<li>
<p>These logics are generally implemented with random numbers</p>
<p>这些逻辑通常用随机数实现</p>
</li>
<li>
<p>How to implement random logic that is completely consistent for multiple players</p>
<p>如何为多个玩家实现完全一致的随机逻辑</p>
</li>
</ul>
<p><img src="18.53.webp" alt="webp"></p>
<ul>
<li>
<p>Random numbers are pseudorandom</p>
<p>随机数是伪随机的</p>
</li>
<li>
<p>Before the game starts, initialize the random number seed</p>
<p>在游戏开始之前，初始化随机数种子</p>
</li>
<li>
<p>For different players’ clients, the number of random function calls is fixed, and the generated random numbers are the same</p>
<p>对于不同玩家的客户端，随机函数调用的数量是固定的，生成的随机数是相同的</p>
</li>
</ul>
<p><img src="18.54.webp" alt="webp"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	std::<span class="hljs-keyword">default</span> random engine e;<br>    <span class="hljs-function">std::uniform <span class="hljs-type">int</span> distribution&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">u</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>)</span></span>;<br>    e.<span class="hljs-built_in">seed</span>(<span class="hljs-number">80</span>);<br>    <br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;<br>        std::cout &lt;&lt; <span class="hljs-built_in">u</span>(e) &lt;&lt; std::endl;<br>    &#125;<br>    <br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="deterministic-solution" tabindex="-1" id="Deterministic-Solution">Deterministic Solution</h4>
<p>确定性解</p>
<ul>
<li>
<p>Fixed-point numbers represent floating-point numbers in critical game logic</p>
<p>定点数表示关键游戏逻辑中的浮点数</p>
</li>
<li>
<p>Deterministic random algorithm</p>
<p>确定性随机算法</p>
</li>
<li>
<p>Deterministic containers and algorithms (sort, add, remove, etc.)</p>
<p>确定性容器和算法（排序、添加、删除等）</p>
</li>
<li>
<p>Deterministic math tools (vectors, quaternions, etc.)</p>
<p>确定性数学工具（向量、四元数等）</p>
</li>
<li>
<p>Deterministic physics simulation (very difficult)</p>
<p>确定性物理模拟（非常困难）</p>
</li>
<li>
<p>Deterministic execution order</p>
<p>确定性执行顺序</p>
</li>
</ul>
<p><img src="18.55.webp" alt="webp"></p>
<h4 id="tracing-and-debugging" tabindex="-1" id="Tracing-and-Debugging">Tracing and Debugging</h4>
<p>跟踪和调试</p>
<p><strong>Method of get checksum</strong></p>
<p><strong>获取校验和的方法</strong></p>
<ul>
<li>
<p>All data checksum</p>
<p>所有数据校验和</p>
</li>
<li>
<p>Key data checksum</p>
<p>关键数据校验和</p>
</li>
<li>
<p>Other methods</p>
<p>其他方法</p>
</li>
</ul>
<p><strong>Automatically locate BUG</strong></p>
<p><strong>自动定位 BUG</strong></p>
<ul>
<li>
<p>Server compares different client’s checksums</p>
<p>服务器比较不同客户端的校验和</p>
</li>
<li>
<p>Client uploads 50 frames of full logs</p>
<p>客户端上传 50 帧完整日志</p>
</li>
<li>
<p>Find inconsistencies in the compared logs</p>
<p>查找比较日志中的不一致之处</p>
</li>
</ul>
<p><img src="18.56.webp" alt="webp"></p>
<h4 id="lag-and-delay" tabindex="-1" id="Lag-and-Delay">Lag and Delay</h4>
<p>延迟和延误</p>
<ul>
<li>
<p>Client send operation</p>
<p>客户端发送操作</p>
</li>
<li>
<p>Receive the operation of this frame from the server</p>
<p>从服务器接收此帧的操作</p>
</li>
<li>
<p>execute</p>
<p>执行</p>
</li>
</ul>
<p><strong>Lag</strong>: Network is unstable. lf you wait until you receivenew frame, there will be a lag</p>
<p><strong>滞后</strong>：网络不稳定。如果你等到收到新帧，就会产生延迟</p>
<p><strong>Solution</strong></p>
<p><strong>解决方案</strong></p>
<ul>
<li>
<p>use buffer to cache frames</p>
<p>使用缓冲区缓存帧</p>
<ul>
<li>
<p>Large buffer, large delay</p>
<p>缓冲区大，延迟大</p>
</li>
<li>
<p>Small buffer, sensitive to lag</p>
<p>小缓冲区，对延迟敏感</p>
</li>
</ul>
</li>
</ul>
<p><img src="18.57.webp" alt="webp"></p>
<h4 id="separating-game-logic-from-rendering" tabindex="-1" id="Separating-Game-Logic-from-Rendering">Separating Game Logic from Rendering</h4>
<p>将游戏逻辑与渲染分离</p>
<p><strong>Lag problem</strong></p>
<p><strong>滞后问题</strong></p>
<ul>
<li>
<p>Separation of logic and rendering</p>
<p>逻辑与渲染的分离</p>
</li>
<li>
<p>Local client-side interpolation smoothing</p>
<p>本地客户端插值平滑</p>
</li>
</ul>
<p><strong>Frame rate</strong></p>
<p><strong>帧率</strong></p>
<ul>
<li>
<p>The logical frame rate is generally 10~30 frames</p>
<p>逻辑帧率一般为 10~30 帧</p>
</li>
<li>
<p>The rendering frame rate is generally higher</p>
<p>渲染帧率通常较高</p>
</li>
</ul>
<p><img src="18.58.webp" alt="webp"></p>
<p><strong>Advantage</strong></p>
<p><strong>优势</strong></p>
<ul>
<li>
<p>Different frequencies, independent operation</p>
<p>不同频率，独立运行</p>
</li>
<li>
<p>Rendering separation to avoid tearing and freezing</p>
<p>渲染分离以避免撕裂和冻结</p>
</li>
<li>
<p>Rendering freezes, does not affect the operation of logical frames</p>
<p>渲染冻结，不影响逻辑帧的操作</p>
</li>
<li>
<p>Servers can run logic frames to solve some cheating problems</p>
<p>服务器可以运行逻辑框架来解决一些作弊问题</p>
</li>
<li>
<p>If the server runs logical frames, it can save key frame snapshots to speed up reconnection</p>
<p>如果服务器运行逻辑帧，它可以保存关键帧快照以加快重新连接</p>
</li>
</ul>
<h4 id="reconnection-problem" tabindex="-1" id="Reconnection-Problem">Reconnection Problem</h4>
<p>重新连接问题</p>
<ul>
<li>
<p>Offline</p>
<p>离线</p>
</li>
<li>
<p>Reconnect</p>
<p>重新连接</p>
</li>
<li>
<p>Catch up</p>
<p>赶上</p>
</li>
</ul>
<p><img src="18.59.webp" alt="webp"></p>
<h4 id="client-game-state-snapshots" tabindex="-1" id="Client-Game-State-Snapshots">Client Game State Snapshots</h4>
<p>客户端游戏状态快照</p>
<ul>
<li>
<p>Snapshots can be saved regularly on the local client and serialized to disk</p>
<p>快照可以定期保存在本地客户端上并序列化到磁盘</p>
</li>
<li>
<p>When reconnection occurs, restore thegame state from the disk serialized data</p>
<p>重新连接时，从磁盘序列化数据还原游戏状态</p>
</li>
<li>
<p>Server sends player commands after snapshot</p>
<p>服务器在快照后发送玩家命令</p>
</li>
<li>
<p>Accelerate to catch up with the game progress</p>
<p>加速以赶上游戏进度</p>
</li>
</ul>
<p><img src="18.60.webp" alt="webp"></p>
<h4 id="quick-catch-up" tabindex="-1" id="Quick-Catch-Up">Quick Catch Up</h4>
<p>快速赶上</p>
<p><strong>How to catch up?</strong></p>
<p><strong>如何迎头赶上</strong></p>
<ul>
<li>
<p>In the sample code, chasing 10 frames each time</p>
<p>在示例代码中，每次追踪 10 帧</p>
</li>
<li>
<p>If originally 10 frames per second, when chasing frames, it may run 100 frames per second</p>
<p>如果最初每秒 10 帧，在追逐帧时，它可能每秒运行 100 帧</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-type">float</span> m_delta = <span class="hljs-number">0</span>;<br><span class="hljs-type">float</span> m_tick_delta = <span class="hljs-number">100</span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CBattleLayer::update</span><span class="hljs-params">(<span class="hljs-type">float</span> delta)</span> </span>&#123;<br>    <span class="hljs-comment">// do something</span><br>    m_delta += delta;<br>    <span class="hljs-type">int</span> exec_count = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span>(m_delta &gt;= m_tick_delta) &#123;<br>        m_delta -= m_tick_delta;<br>        <span class="hljs-comment">// logic frame</span><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">logicUpdate</span>(LOGIC_TIME)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// catch up 10 frames at a time</span><br>        <span class="hljs-keyword">if</span>(exec_count++ &gt;= <span class="hljs-number">10</span>)&#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>	<span class="hljs-comment">// do something</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="server-state-snapshot-optimization" tabindex="-1" id="Server-State-Snapshot-Optimization">Server State Snapshot Optimization</h4>
<p>服务器状态快照优化</p>
<ul>
<li>
<p>The server runs logical frames and saves snapshots of keyframes</p>
<p>服务器运行逻辑帧并保存关键帧的快照</p>
</li>
<li>
<p>The server sends the snapshot, and the player commands after the snapshot</p>
<p>服务器发送快照，玩家在快照后发出命令</p>
</li>
<li>
<p>Accelerate to catch up with the game progress</p>
<p>加速以赶上游戏进度</p>
</li>
</ul>
<p><img src="18.61.webp" alt="webp"></p>
<h4 id="temporary-offline%2C-no-crash" tabindex="-1" id="Temporary-Offline-No-Crash">Temporary Offline, No Crash</h4>
<p>暂时离线，无崩溃</p>
<ul>
<li>
<p>Client also keeps game state, keyframes, deterministic-timed frames</p>
<p>客户端还保留游戏状态、关键帧、确定性定时帧</p>
</li>
<li>
<p>After reconnecting, the server sends commands to the dropped player</p>
<p>重新连接后，服务器向被删除的播放器发送命令</p>
</li>
<li>
<p>Accelerate to catch up the game progress</p>
<p>加速以赶上游戏进度</p>
</li>
</ul>
<p><img src="18.62.webp" alt="webp"></p>
<h4 id="observing" tabindex="-1" id="Observing">Observing</h4>
<p>观察</p>
<p>Watching other players playing the game</p>
<p>观看其他玩家玩游戏</p>
<ul>
<li>
<p>Reconnecting and watching are essentially the same</p>
<p>重新连接和观看基本上是一样的</p>
</li>
<li>
<p>Watching is similar to reconnecting after a client crash</p>
<p>监视类似于在客户端崩溃后重新连接</p>
</li>
<li>
<p>Player action command, forwarded to the player watching the game</p>
<p>玩家动作命令，转发给观看游戏的玩家</p>
</li>
<li>
<p>Watching is usually delayed for a few minutes to prevent screen peeping</p>
<p>观看通常会延迟几分钟，以防止偷看屏幕</p>
</li>
</ul>
<p><img src="18.63.webp" alt="webp"></p>
<h4 id="replay" tabindex="-1" id="Replay">Replay</h4>
<p>重播</p>
<p>Execute player commands in order which can speed up</p>
<p>按照可以加速的顺序执行玩家命令</p>
<ul>
<li>
<p>Replay file</p>
<p>回放文件</p>
<ul>
<li>
<p>Save game commands for a game</p>
<p>保存游戏命令</p>
</li>
<li>
<p>Files take up little space</p>
<p>文件占用的空间很小</p>
</li>
</ul>
</li>
<li>
<p>How to implement go back?</p>
<p>如何实施回退？</p>
<ul>
<li>
<p>When the client executes the replay file, it adds a key frame snapshot, which can go back to the key frame moment</p>
<p>当客户端执行回放文件时，它会添加一个关键帧快照，该快照可以返回到关键帧时刻</p>
</li>
<li>
<p>The current version of Honor of Kings go back to the key frame before 60s</p>
<p>当前版本的《王者荣耀》回退了 60s 的关键帧</p>
</li>
</ul>
</li>
</ul>
<p><img src="18.64.webp" alt="webp"></p>
<h4 id="lockstep-cheating-lssues" tabindex="-1" id="Lockstep-Cheating-lssues">Lockstep Cheating lssues</h4>
<p>锁步作弊问题</p>
<p><strong>Multiplayer-PVP</strong></p>
<p><strong>多人 PVP</strong></p>
<ul>
<li>
<p>Game over</p>
<p>游戏结束</p>
<ul>
<li>
<p>The client uploads the key data checksum, the server verifys the game result</p>
<p>客户端上传密钥数据校验和，服务器验证游戏结果</p>
</li>
</ul>
</li>
<li>
<p>During the game</p>
<p>在游戏过程中</p>
<ul>
<li>
<p>Report the key data checksum</p>
<p>报告密钥数据校验和</p>
</li>
<li>
<p>Cheating players are kicked out, etc.</p>
<p>作弊的玩家被踢出等等。</p>
</li>
</ul>
</li>
</ul>
<p><img src="18.65.webp" alt="webp"></p>
<p><strong>2 Players</strong></p>
<p><strong>2 名玩家</strong></p>
<ul>
<li>
<p>Server can not detect who is cheating using key data checksum</p>
<p>服务器无法使用密钥数据校验和检测谁在作弊</p>
</li>
<li>
<p>If the server is not verified, the cheating player will only affect one player in this case</p>
<p>如果服务器未经验证，作弊玩家在这种情况下只会影响一个玩家</p>
</li>
</ul>
<p><img src="18.66.webp" alt="webp"></p>
<ul>
<li>
<p>Difficult to avoid third-party plug-in to access war-fog or other hidden data</p>
<p>难以避免第三方插件访问战争迷雾或其他隐藏数据</p>
<ul>
<li>
<p>Game logic is performed on the client side</p>
<p>游戏逻辑在客户端执行</p>
</li>
<li>
<p>Clients have all the game data</p>
<p>客户端拥有所有游戏数据</p>
</li>
</ul>
</li>
</ul>
<p><img src="18.67.webp" alt="webp"></p>
<h4 id="lockstep-summary" tabindex="-1" id="Lockstep-Summary">Lockstep Summary</h4>
<p>锁定步骤摘要</p>
<p><strong>Advantages</strong></p>
<p><strong>优势</strong></p>
<ul>
<li>
<p>Low bandwidth, only sends commands</p>
<p>带宽低，只发送命令</p>
</li>
<li>
<p>High development efficiency, similar to single-player game development</p>
<p>开发效率高，类似单人游戏开发</p>
</li>
<li>
<p>Precise action/hit detection</p>
<p>精确的动作/命中检测</p>
</li>
<li>
<p>Easy to record games</p>
<p>易于录制游戏</p>
</li>
</ul>
<p><strong>Problems</strong></p>
<p><strong>问题</strong></p>
<ul>
<li>
<p>Maintain the consistency is difficult to achieve</p>
<p>保持一致性很难实现</p>
</li>
<li>
<p>Hard to solve the cheat plugin to unveil all game states</p>
<p>难以解决的作弊插件揭示所有游戏状态</p>
</li>
<li>
<p>Longer disconnection and reconnection time</p>
<p>更长的断开和重新连接时间</p>
<ul>
<li>
<p>Need more complex optimization</p>
<p>需要更复杂的优化</p>
</li>
</ul>
</li>
</ul>
<h3 id="state-synchronization" tabindex="-1" id="State-Synchronization">State Synchronization</h3>
<p>状态同步</p>
<p><img src="18.68.webp" alt="webp"></p>
<h4 id="replication-protocol-of-halo" tabindex="-1" id="Replication-Protocol-of-Halo">Replication Protocol of Halo</h4>
<p>Halo 的同步协议</p>
<p><img src="18.69.webp" alt="webp"></p>
<table>
<thead>
<tr>
<th>State Data</th>
<th>Events</th>
<th>Control Data</th>
</tr>
</thead>
<tbody>
<tr>
<td>Guaranteed eventual delivery of most current state<br/>保证最终交付最新状态<br/>- Object position<br/>对象位置<br/>- Object health<br/>对象生命<br/>- 150+ properties<br/>150+ 个属性</td>
<td>Unreliable notifications of transient occurrences<br/>不可靠的瞬态事件通知<br/>- Please fire my weapon<br/>请发射我的武器<br/>- This weapon was fired<br/>此武器已被发射<br/>- Projectile detonated<br/>弹丸被引爆<br/>-More events<br/>更多事件</td>
<td>High-frequency, the best-effort transmission of rapidly-updated data extracted from player control inputs<br/>高频、尽最大努力传输从玩家控制输入中提取的快速更新数据<br/>- Current analog stick values for all players<br/>所有玩家的当前模拟棒值<br/>- Current position of client’s own biped<br/>客户端自己的角色的当前位置<br/>-More properties<br/>更多属性</td>
</tr>
</tbody>
</table>
<p><strong>State</strong></p>
<p><strong>状态</strong></p>
<ul>
<li>
<p>The game state is necessary to represent the game world. e.g: HP, MP</p>
<p>游戏状态是代表游戏世界所必需的。例如：血量、法力</p>
</li>
</ul>
<p><strong>State Synchronization</strong></p>
<p><strong>状态同步</strong></p>
<ul>
<li>
<p>Server does not generate a single update for all clients. lt sends client a customized data packet</p>
<p>服务器不会为所有客户端生成单个更新。它向客户端发送自定义数据包</p>
</li>
<li>
<p>lf the game world is too complex, you can set an Area Of Interest (AOl) for reducing server overhead</p>
<p>如果游戏世界太复杂，您可以设置一个兴趣区域（AOl）来减少服务器开销</p>
</li>
</ul>
<h4 id="server-authorizes-the-game-world" tabindex="-1" id="Server-Authorizes-the-Game-World">Server Authorizes the Game World</h4>
<p>服务器授权游戏世界</p>
<p><strong>Server</strong></p>
<p><strong>服务器</strong></p>
<ul>
<li>
<p>Game world is authorized</p>
<p>游戏世界已授权</p>
</li>
<li>
<p>Receive input and state from client</p>
<p>从客户端接收输入和状态</p>
</li>
<li>
<p>Run game logic</p>
<p>运行游戏逻辑</p>
</li>
<li>
<p>Send state</p>
<p>发送状态</p>
</li>
</ul>
<p><strong>Client</strong></p>
<p><strong>客户端</strong></p>
<ul>
<li>
<p>Receive data and simulate game world</p>
<p>接收数据并模拟游戏世界</p>
</li>
<li>
<p>Game play improvement</p>
<p>游戏玩法改进</p>
</li>
</ul>
<p><img src="18.70.webp" alt="webp"></p>
<h4 id="authorized-and-replicated-clients" tabindex="-1" id="Authorized-and-Replicated-Clients">Authorized and Replicated Clients</h4>
<p>授权和同步客户端</p>
<p><strong>Authorized (1P)</strong></p>
<p><strong>授权（1P）</strong></p>
<ul>
<li>
<p>Player’s local game client</p>
<p>玩家的本地游戏客户端</p>
</li>
</ul>
<p><strong>Server</strong></p>
<p><strong>服务器</strong></p>
<ul>
<li>
<p>Authorized server</p>
<p>授权服务器</p>
</li>
</ul>
<p><strong>Replicated (3P)</strong></p>
<p><strong>已同步（3P）</strong></p>
<ul>
<li>
<p>Simulated character in other player’s client</p>
<p>其他玩家客户端中的模拟角色</p>
</li>
</ul>
<p><img src="18.71.webp" alt="webp"></p>
<h4 id="state-synchronization-example" tabindex="-1" id="State-Synchronization-Example">State Synchronization Example</h4>
<p>状态同步示例</p>
<p><strong>Player1 (Authorized)</strong></p>
<p><strong>玩家 1（授权）</strong></p>
<ul>
<li>
<p>Fire</p>
<p>开火</p>
</li>
</ul>
<p><strong>Player2 (Replicated)</strong></p>
<p><strong>Player2（已同步）</strong></p>
<ul>
<li>
<p>See player1 open fire</p>
<p>看到玩家 1 开火</p>
</li>
</ul>
<hr>
<p>Player 1 presses an input on their local machine to fire</p>
<p>玩家 1 按下本地机器上的输入进行射击</p>
<div class="subfields"><div class="subfield"><p><strong>Player1 (Authorized)</strong></p>
<p><strong>玩家 1（授权）</strong></p>
<ul>
<li>
<p>Fire</p>
<p>开火</p>
</li>
<li>
<p>Send to server</p>
<p>发送到服务器</p>
</li>
</ul>
</div>
<div class="subfield"><p><strong>Server</strong></p>
<p><strong>服务器</strong></p>
<ul>
<li>
<p>Player1 fire</p>
<p>玩家 1 开火</p>
</li>
<li>
<p>Send to each client</p>
<p>发送给每个客户端</p>
</li>
</ul>
</div>
<div class="subfield"><p><strong>Player2 (Replicated)</strong></p>
<p><strong>玩家 2（已同步）</strong></p>
<ul>
<li>
<p>Recieve packet</p>
<p>接收数据包</p>
</li>
<li>
<p>Player1 fire</p>
<p>Player 1 开火</p>
</li>
</ul>
</div></div>
<hr>
<p><strong>Server</strong></p>
<p><strong>服务器</strong></p>
<p>Tell each client to replicate the movement of Player 1’s projectile.</p>
<p>告诉每个客户同步玩家 1 投射物的运动。</p>
<hr>
<p><strong>Server</strong></p>
<ul>
<li>
<p>Tell each client to destroy their copies of Player 1’s projectile</p>
<p>告诉每个客户销毁他们的玩家 1 投射物副本</p>
</li>
<li>
<p>Tell all clients to response to damage of the projectile</p>
<p>告诉所有客户对弹丸的损坏做出反应</p>
</li>
</ul>
<h4 id="dumb-client-problem" tabindex="-1" id="Dumb-Client-Problem">Dumb Client Problem</h4>
<p>哑巴客户端问题</p>
<p>Clients can not to do anything until receive server state update</p>
<p>在收到服务器状态更新之前，客户端无法执行任何操作</p>
<p>How to see an immediate response?</p>
<p>如何看到即时响应？</p>
<ul>
<li>
<p>Client-side prediction</p>
<p>客户端预测</p>
</li>
<li>
<p>Server reconciliation</p>
<p>服务器对账</p>
</li>
</ul>
<p><img src="18.72.webp" alt="webp"></p>
<h4 id="client-side-prediction" tabindex="-1" id="Client-Side-Prediction">Client-Side Prediction</h4>
<p>客户端预测</p>
<p><strong>Authorized client</strong></p>
<p><strong>授权客户</strong></p>
<ul>
<li>
<p>Press “→”</p>
<p>按“→”</p>
</li>
<li>
<p>Received server message</p>
<p>收到服务器消息</p>
</li>
<li>
<p>Start movement</p>
<p>开始移动</p>
</li>
</ul>
<p><img src="18.73.webp" alt="webp"></p>
<h4 id="overwatch---client-side-prediction" tabindex="-1" id="Overwatch-Client-side-Prediction">Overwatch - Client-side Prediction</h4>
<p>守望先锋-客户端预测</p>
<ul>
<li>
<p>RTT = 160ms</p>
<p>RTT = 160 毫秒</p>
</li>
<li>
<p>Half RTT = 80ms</p>
<p>半 RTT = 80 毫秒</p>
</li>
<li>
<p>Command frame = 16ms</p>
<p>命令帧 = 16ms</p>
</li>
</ul>
<p>The client is always ahead of the server by half RTT and one buffered command frame</p>
<p>客户端始终领先于服务器一半的 RTT 和一个缓冲命令帧</p>
<ul>
<li>
<p>Press key and response immediately</p>
<p>按键并立即响应</p>
</li>
</ul>
<p><img src="18.74.webp" alt="webp"></p>
<h4 id="server-reconciliation" tabindex="-1" id="Server-Reconciliation">Server Reconciliation</h4>
<p>服务器对账</p>
<p><strong>Authorized client: Buffer</strong></p>
<p><strong>授权客户：Buffer</strong></p>
<ul>
<li>
<p>Record every state when do the client prediction</p>
<p>在进行客户端预测时记录每个状态</p>
</li>
<li>
<p>Compare with the past server data when it was received on client side</p>
<p>与客户端接收到的过去服务器数据进行比较</p>
</li>
</ul>
<hr>
<p><strong>Ring buffer for states</strong></p>
<p><strong>状态环形缓冲区</strong></p>
<ul>
<li>
<p>Stores all of our states in the past several frames on client</p>
<p>将过去几帧中的所有状态存储在客户端上</p>
</li>
</ul>
<p><strong>Process</strong></p>
<p><strong>流程</strong></p>
<ul>
<li>
<p>If the client computed the same result as server, the client will continue on its merry way to simulate the next input</p>
<p>如果客户端计算出的结果与服务器相同，客户端将继续愉快地模拟下一个输入</p>
</li>
</ul>
<p><strong>Problem</strong></p>
<p><strong>问题</strong></p>
<ul>
<li>
<p>lf misprediction?</p>
<p>如果预测失误？</p>
</li>
</ul>
<p><img src="18.75.webp" alt="webp"></p>
<hr>
<ul>
<li>
<p>If blocked by an obstacle at the server</p>
<p>如果被服务器上的障碍物阻挡</p>
</li>
<li>
<p>Position is wrong! (in red)</p>
<p>位置不对！（红色）</p>
</li>
<li>
<p>Client must accept the new server</p>
<p>客户端必须接受新服务器</p>
</li>
<li>
<p>update</p>
<p>更新</p>
</li>
<li>
<p>Retrace all predicted movement starting from the new confirmed position</p>
<p>从新的确认位置开始回溯所有预测的运动</p>
</li>
</ul>
<p><img src="18.76.webp" alt="webp"></p>
<hr>
<ul>
<li>
<p>If the client and server disagree on the results, we’ve mispredicted</p>
<p>如果客户端和服务器对结果不一致，我们就预测错了</p>
</li>
<li>
<p>Have to reconcile</p>
<p>必须和解</p>
</li>
</ul>
<p><strong>Ring buffer for inputs</strong></p>
<p><strong>用于输入的环形缓冲区</strong></p>
<ul>
<li>
<p>Stores all of inputs we did in the past several frames on client.</p>
<p>在客户端上存储我们在过去几帧中所做的所有输入。</p>
</li>
</ul>
<p><strong>Process</strong></p>
<p><strong>流程</strong></p>
<ul>
<li>
<p>Overwrite the clients results withthe server’s results</p>
<p>用服务器的结果覆盖客户端的结果</p>
</li>
<li>
<p>Replay all of your inputs to catchback up to what you believe now</p>
<p>重播您的所有输入，以回溯您现在所相信的内容</p>
</li>
</ul>
<p><img src="18.77.webp" alt="webp"></p>
<h4 id="server-reconciliation-example" tabindex="-1" id="Server-Reconciliation-Example">Server Reconciliation Example</h4>
<p>服务器对账示例</p>
<p><strong>Overwatch</strong></p>
<p><strong>守望先锋</strong></p>
<ul>
<li>
<p>We try to move</p>
<p>我们试图移动</p>
</li>
<li>
<p>The server said no</p>
<p>服务器拒绝了</p>
</li>
<li>
<p>We got yanked back down to where we were before and froze</p>
<p>我们被拉回到原来的位置，然后僵住了</p>
</li>
</ul>
<p><img src="18.78.webp" alt="webp"></p>
<h4 id="packet-loss" tabindex="-1" id="Packet-Loss">Packet Loss</h4>
<p>数据包丢失</p>
<ul>
<li>
<p>Client input packages fail to reach the server</p>
<p>客户端输入包无法到达服务器</p>
</li>
<li>
<p>The server tries to keep tiny <strong>input buffer</strong> of unprocessed input</p>
<p>服务器试图保留未处理输入的微小<strong>输入缓冲区</strong></p>
</li>
<li>
<p>lf the server run out of input buffer, server will <strong>duplicate</strong> your last input in a window</p>
<p>如果服务器的输入缓冲区用完，服务器将<strong>同步</strong>您在窗口中的最后一个输入</p>
</li>
<li>
<p>Push client sends missed inputs asap</p>
<p>推送客户端尽快发送丢失的输入</p>
</li>
</ul>
<p><img src="18.79.webp" alt="webp"></p>
<h4 id="state-synchronization-vs.-lockstep-synchronization" tabindex="-1" id="State-Synchronization-Vs-Lockstep-Synchronization">State Synchronization Vs. Lockstep Synchronization</h4>
<table>
<thead>
<tr>
<th></th>
<th>State Synchronization<br/>状态同步</th>
<th>Lockstep Synchronization<br/>锁步同步</th>
</tr>
</thead>
<tbody>
<tr>
<td>Deterministic logic<br/>确定性逻辑</td>
<td>Not necessary<br/>不需要</td>
<td>Necessary<br/>必要的</td>
</tr>
<tr>
<td>Response<br/>响应</td>
<td>Better responsiveness<br/>更好的响应能力</td>
<td>Poor responsiveness<br/>响应性差</td>
</tr>
<tr>
<td>Network Traffic<br/>网络流量</td>
<td>Usually high<br/>通常高</td>
<td>Usually low<br/>通常低</td>
</tr>
<tr>
<td>Development efficiency<br/>开发效率</td>
<td>Much more complicated<br/>要复杂得多</td>
<td>Easy to develop, difficult to Debug<br/>易于开发，难以调试</td>
</tr>
<tr>
<td>Number of players<br/>玩家数量</td>
<td>Few players<br/>玩家很少</td>
<td>Support small and large numbers of players<br/>支持小型和大型玩家</td>
</tr>
<tr>
<td>Cross-platform<br/>跨平台</td>
<td>Relatively easy<br/>相对容易</td>
<td>Relatively difficult<br/>相对困难</td>
</tr>
<tr>
<td>Reconnect<br/>重连</td>
<td>Relatively easy<br/>相对容易</td>
<td>Relatively difficult<br/>相对困难</td>
</tr>
<tr>
<td>Replay File size<br/>重播文件大小</td>
<td>Big<br/>大</td>
<td>Small<br/>小</td>
</tr>
<tr>
<td>Cheat<br/>欺骗</td>
<td>Relatively hard<br/>相对困难</td>
<td>Relatively easy<br/>相对容易</td>
</tr>
</tbody>
</table>
<h3 id="references" tabindex="-1" id="References">References</h3>
<h4 id="network-protocols-1" tabindex="-1" id="Network-Protocols-2">Network Protocols</h4>
<ul>
<li>
<p>Internet protocol suite:</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/lnternet_protocol_suite">https://en.wikipedia.org/wiki/lnternet_protocol_suite</a></p>
</li>
<li>
<p>OSI Model:</p>
<p><a target="_blank" rel="noopener" href="https://www.practicalnetworking.net/series/packet-traveling/osi-model">https://www.practicalnetworking.net/series/packet-traveling/osi-model</a></p>
</li>
<li>
<p>Automatic repeat request.</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Automatic_repeat_request">https://en.wikipedia.org/wiki/Automatic_repeat_request</a></p>
</li>
<li>
<p>Network Communication and Remote Procedure Calls (RPCs):</p>
<p><a target="_blank" rel="noopener" href="https://www.cs.princeton.edu/courses/archive/fall18/cos418/docs/L2-rpc.pdf">https://www.cs.princeton.edu/courses/archive/fall18/cos418/docs/L2-rpc.pdf</a></p>
</li>
<li>
<p>What are TCP and UDP?
<a target="_blank" rel="noopener" href="https://www.gdyuniie.cn/showinfo-114-788-0.html">https://www.gdyuniie.cn/showinfo-114-788-0.html</a></p>
</li>
</ul>
<h4 id="network-synchronization" tabindex="-1" id="Network-Synchronization">Network Synchronization</h4>
<ul>
<li>
<p>Synchronization lssues with Smart Solutions:</p>
<p><a target="_blank" rel="noopener" href="https://citeseerxist.psu.edu/viewdoc/download?doi=10.1.1.352.6405&amp;rep=rep1&amp;type=pdf">https://citeseerxist.psu.edu/viewdoc/download?doi=10.1.1.352.6405&amp;rep=rep1&amp;type=pdf</a></p>
</li>
<li>
<p>An Efficient Synchronization Mechanism for Mirrored Game Architectures:</p>
<p><a target="_blank" rel="noopener" href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.87.6043&amp;rep=rep1&amp;type=pdf">https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.87.6043&amp;rep=rep1&amp;type=pdf</a></p>
</li>
<li>
<p>The Brave New World of Multiplayer Online Games - Synchronization lssues with Smart Solutions.Marco Roccetti, Stefano Ferretti, Claudio E. Palazzi:</p>
<p><a target="_blank" rel="noopener" href="https://citeseerxist.psu.edu/viewdoc/download?doi=10.1.1.352.6405&amp;rep=rep1&amp;type=pdf">https://citeseerxist.psu.edu/viewdoc/download?doi=10.1.1.352.6405&amp;rep=rep1&amp;type=pdf</a></p>
</li>
<li>
<p>Network Time Protocol(NTP): <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc958.html">https://www.rfc-editor.org/rfc/rfc958.html</a></p>
</li>
<li>
<p>Algorithms for Synchronizing Network Clocks: <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc956">https://datatracker.ietf.org/doc/html/rfc956</a></p>
</li>
<li>
<p>“Minimizing Latency in RealTime Strategy Games”, Jim Greer, Zack Booth Simpson, GameProgamming Gems 3 chapter 5.1, 2001: <a target="_blank" rel="noopener" href="https://larchive.org/details/game-programming-gems-3">https://larchive.org/details/game-programming-gems-3</a></p>
</li>
<li>
<p>JMP van Waveren, “The DOOM lll Network Architecture”.2006:</p>
<p><a target="_blank" rel="noopener" href="https://mrelusive.com/publications/papers/The-DOOM-l-Network-Architecture.pdf">https://mrelusive.com/publications/papers/The-DOOM-l-Network-Architecture.pdf</a></p>
</li>
<li>
<p>Christophe DlOT, Laurent GAUTlER, “A Distributed Architecture for Mult iplayer Interactive Applicationson the Internet”, lEEE.1999:</p>
<p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/abstract/document/777437/">https://ieeexplore.ieee.org/abstract/document/777437/</a></p>
</li>
<li>
<p>Mark Terrano, Paul Bettner “Network Programming in Age of Empires and Beyond”. GDC 2001.</p>
<p><a target="_blank" rel="noopener" href="https://www.aamedevs.org/uploads/1500-archers-age-of-empires-network-programming.pdf">https://www.aamedevs.org/uploads/1500-archers-age-of-empires-network-programming.pdf</a></p>
</li>
<li>
<p>腾讯游戏, 腾讯游戏开发精粹.电子工业出版社,2019.9:</p>
<p><a target="_blank" rel="noopener" href="https://gameinstitute.gg.com/game-gems">https://gameinstitute.gg.com/game-gems</a></p>
</li>
<li>
<p>Cocos, 帧同步游戏在技术层面的实现细节, 2021</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/408734657">https://zhuanlan.zhihu.com/p/408734657</a></p>
</li>
<li>
<p>IEEE 754:</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IEEE_754">https://en.wikipedia.org/wiki/IEEE_754</a></p>
</li>
<li>
<p>QUAKE 3 SOURCE CODE REVIEW - NETWORK MODEL. 2012:</p>
<p><a target="_blank" rel="noopener" href="https://fabiensanglard.net/quake3/network.php">https://fabiensanglard.net/quake3/network.php</a></p>
</li>
<li>
<p>David Aldridge, l Shot You First - Networking the Gameplay of HALO - REACH. GDC 2011:</p>
<p><a target="_blank" rel="noopener" href="https://www.gdcvault.com/play/1014345/1-Shot-You-First-Networking">https://www.gdcvault.com/play/1014345/1-Shot-You-First-Networking</a></p>
</li>
<li>
<p>Timothy Ford, “Overwatch Gameplay Architecture and Netcode”. GDC 2017: <a target="_blank" rel="noopener" href="https://www.gdcvault.com/play/1024001/-0verwatch-Gameplay-Architecture-and">https://www.gdcvault.com/play/1024001/-0verwatch-Gameplay-Architecture-and</a></p>
</li>
<li>
<p>Unreal engine Document:</p>
<p><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.0/en-US/networking-overview-for-unreal-engine/">https://docs.unrealengine.com/5.0/en-US/networking-overview-for-unreal-engine/</a></p>
</li>
<li>
<p>Gaffer on Games: <a target="_blank" rel="noopener" href="https://gafferongames.com/#posts">https://gafferongames.com/#posts</a></p>
</li>
</ul>
<h2 id="%E7%AC%AC%E5%8D%81%E4%B9%9D%E8%8A%82%EF%BC%9A%E7%BD%91%E7%BB%9C%E6%B8%B8%E6%88%8F%E7%9A%84%E8%BF%9B%E9%98%B6%E6%9E%B6%E6%9E%84" tabindex="-1" id="第十九节：网络游戏的进阶架构">第十九节：网络游戏的进阶架构</h2>
<h3 id="online-gaming-architecture---advanced-topics" tabindex="-1" id="Online-Gaming-Architecture-Advanced-Topics">Online Gaming Architecture - Advanced Topics</h3>
<h3 id="character-movement-replication" tabindex="-1" id="Character-Movement-Replication">Character Movement Replication</h3>
<p>角色动作同步</p>
<h4 id="character-movement-replication-1" tabindex="-1" id="Character-Movement-Replication-2">Character Movement Replication</h4>
<p>角色动作同步</p>
<p>From player 2’s point of view, player1’s movement is very choppyand lags behind player1’s actual position.</p>
<p>从玩家 2 的角度来看，玩家 1 的动作非常不稳定，落后于玩家 1 的实际位置。</p>
<h4 id="interpolation-%26-extrapolation" tabindex="-1" id="Interpolation-Extrapolation">Interpolation &amp; Extrapolation</h4>
<p>内插值和外插值</p>
<p>Purpose: Smooth movementof player’s characters on screen</p>
<p>目的：玩家角色在屏幕上流畅移动</p>
<p><strong>Interpolation</strong></p>
<p><strong>内插值</strong></p>
<ul>
<li>
<p>Calculate the state between old butknown states</p>
<p>计算旧但已知状态之间的状态</p>
</li>
</ul>
<p><img src="19.1.webp" alt="webp"></p>
<p><strong>Extrapolation</strong></p>
<p><strong>外插值</strong></p>
<ul>
<li>
<p>Predict where entity is going from old states</p>
<p>预测实体从旧状态走向何方</p>
</li>
</ul>
<p><img src="19.2.webp" alt="webp"></p>
<h4 id="smooth-states-by-interpolations" tabindex="-1" id="Smooth-States-by-Interpolations">Smooth States by Interpolations</h4>
<p>插值平滑状态</p>
<ul>
<li>
<p>Position and Orientationcan be interpolated between two recently received data</p>
<p>位置和方向可以在最近接收到的两个数据之间进行插值</p>
</li>
</ul>
<h4 id="buffer-states-and-deferred-render" tabindex="-1" id="Buffer-States-and-Deferred-Render">Buffer States and Deferred Render</h4>
<p>缓冲区状态和延迟渲染</p>
<ul>
<li>
<p>Data packet will not be rendered immediately when received</p>
<p>数据包在收到后不会立即呈现</p>
</li>
<li>
<p>Put into memory and wait for a new data packet</p>
<p>放入内存并等待新的数据包</p>
</li>
<li>
<p>After waiting for a time offset, start to render first received data packet</p>
<p>等待时间偏移后，开始渲染第一个接收到的数据包</p>
</li>
<li>
<p>Create an artificial delay of interpolation offset</p>
<p>创建插值偏移的人工延迟</p>
</li>
</ul>
<p><img src="19.3.webp" alt="webp"></p>
<h4 id="character-movement-replication-by-interpolation" tabindex="-1" id="Character-Movement-Replication-by-Interpolation">Character Movement Replication by Interpolation</h4>
<p>通过插值同步角色动作</p>
<p>Result after interpolation was implemented</p>
<p>插值后的结果</p>
<h4 id="interpolation-challenges-of-vehicle-movement-replication" tabindex="-1" id="Interpolation-Challenges-of-Vehicle-Movement-Replication">Interpolation Challenges of Vehicle Movement Replication</h4>
<p>车辆运动同步的插值挑战</p>
<p><img src="19.4.webp" alt="webp"></p>
<h4 id="estimate-current-state-by-extrapolation" tabindex="-1" id="Estimate-Current-State-by-Extrapolation">Estimate Current State by Extrapolation</h4>
<p>通过外推法估计当前状态</p>
<ul>
<li>
<p>Use paststates to estimate currentstate to compensate net lag</p>
<p>使用过去状态来估计当前状态，以补偿净滞后</p>
</li>
</ul>
<h4 id="dead-reckoning" tabindex="-1" id="Dead-Reckoning">Dead Reckoning</h4>
<p>死亡清算</p>
<ul>
<li>
<p>Estimate future state based on states that have been received</p>
<p>根据已收到的状态估计未来状态</p>
</li>
</ul>
<p><img src="19.5.webp" alt="webp"></p>
<h4 id="projective-velocity-blending" tabindex="-1" id="Projective-Velocity-Blending">Projective Velocity Blending</h4>
<p>投影速度混合</p>
<ul>
<li>
<p>At <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, the replicated character is at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">p_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> with velocity <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">v_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> and acceleration <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">a_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">a</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, and receive the
synced states with position <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">p&#x27;_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, velocity <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>v</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">v&#x27;_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:-0.03588em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, acceleration <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>a</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">a&#x27;_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">a</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p>在时间 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，同步的角色位于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">p_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，其速度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">v_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，加速度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">a_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">a</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，并接收到同步的状态，其位置为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">p&#x27;_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，速度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>v</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">v&#x27;_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:-0.03588em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，加速度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>a</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">a&#x27;_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">a</span><span class="vlist"><span style="top:0.24810799999999997em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>。</p>
</li>
<li>
<p>We can predict position <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mi>t</mi><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">p&#x27;_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> after a time duration <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span> based the synced states</p>
<p>我们可以根据同步的状态预测在时间持续 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span> 后的位置 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mi>t</mi><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">p&#x27;_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>。</p>
</li>
</ul>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mi>t</mi><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><mo>=</mo><msubsup><mi>p</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><mo>+</mo><msubsup><mi>v</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><mi>t</mi><mo>+</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mn>2</mn></mrow></mfrac><msubsup><mi>a</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">p&#x27;_t=p&#x27;_0+v&#x27;_0t+\frac{1}{2}a&#x27;_0t^2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.32144em;"></span><span class="strut bottom" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.247em;margin-left:-0.03588em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">2</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mord"><span class="mord mathit">a</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<ul>
<li>
<p>Our goal is to reach <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mi>t</mi><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><msub><mi mathvariant="normal">∣</mi><mrow><mi>t</mi><mo>=</mo><msub><mi>t</mi><mi>B</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">p&#x27;_t|_{t=t_B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:1.0068920000000001em;vertical-align:-0.255em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathrm">∣</span><span class="vlist"><span style="top:0.15000000000000002em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mrel">=</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> smoothly after <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span></span></span></span> fixed blending time duration: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>B</mi></msub><mo>−</mo><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_B-t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p>我们的目标是在固定的混合时间持续 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>B</mi></msub><mo>−</mo><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_B - t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 后平滑地到达 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mi>t</mi><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><msub><mi mathvariant="normal">∣</mi><mrow><mi>t</mi><mo>=</mo><msub><mi>t</mi><mi>B</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">p&#x27;_t |_{t=t_B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:1.0068920000000001em;vertical-align:-0.255em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathrm">∣</span><span class="vlist"><span style="top:0.15000000000000002em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mrel">=</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>。</p>
</li>
</ul>
<p><img src="19.6.webp" alt="webp"></p>
<p>At any time <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>, we can get the blending velocity <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p>在任何时刻 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>，我们可以得到混合速度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>λ</mi><mo>=</mo><mfrac><mrow><mi>t</mi><mo>−</mo><msub><mi>t</mi><mn>0</mn></msub></mrow><mrow><msub><mi>t</mi><mi>B</mi></msub><mo>−</mo><msub><mi>t</mi><mn>0</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\lambda=\frac{t-t_0}{t_B-t_0}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.29208em;"></span><span class="strut bottom" style="height:2.1280799999999997em;vertical-align:-0.8360000000000001em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">λ</span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub><mo>=</mo><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><mi>λ</mi><mo>(</mo><msubsup><mi>v</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><mo>−</mo><msub><mi>v</mi><mn>0</mn></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">v_t=v_0+\lambda(v&#x27;_0-v_0)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8018919999999999em;"></span><span class="strut bottom" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathit">λ</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.247em;margin-left:-0.03588em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>And projecting the position <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">p_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">p_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p>并从 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">p_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 投影位置 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">p_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub><mo>=</mo><msub><mi>p</mi><mn>0</mn></msub><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub><mi>t</mi><mo>+</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mn>2</mn></mrow></mfrac><msubsup><mi>a</mi><mn>0</mn><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">p_t=p_0+v_tt+\frac{1}{2}a&#x27;_0t^2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.32144em;"></span><span class="strut bottom" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">2</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mord"><span class="mord mathit">a</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<p>Then get the dead reckoned position <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">p_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">d</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> by combining <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">p_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mi>t</mi><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">p&#x27;_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p>然后通过结合 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">p_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>p</mi><mi>t</mi><mrow><mi mathvariant="normal">′</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">p&#x27;_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 得到估算位置 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">p_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">d</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>d</mi></msub><mo>=</mo><msub><mi>p</mi><mi>t</mi></msub><mo>+</mo><mi>λ</mi><mo>(</mo><msubsup><mi>p</mi><mi>t</mi><mrow><mi mathvariant="normal">′</mi></mrow></msubsup><mo>−</mo><msub><mi>p</mi><mi>t</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">p_d=p_t+\lambda(p&#x27;_t-p_t)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8018919999999999em;"></span><span class="strut bottom" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">d</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathit">λ</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p><img src="19.7.webp" alt="webp"></p>
<h4 id="collision-issues" tabindex="-1" id="Collision-Issues">Collision Issues</h4>
<p>碰撞问题</p>
<p>Dead reconking Collision trajection looks weird</p>
<p>估算碰撞轨迹看起来很奇怪</p>
<p><strong>Phase 1:</strong> Collision starts</p>
<p>**第一阶段：**碰撞开始</p>
<p><strong>Phase 2:</strong> The replica keeps going, since the extrapolation is basedon the last snaphsot</p>
<p>**第二阶段：**同步继续进行，因为外推是基于最后一次快照</p>
<p><strong>Phase 3:</strong> Finally we receive a snapshot to stop the replica, but replica gives master’s rigidbody a huge velocity to pushing master away</p>
<p>**第三阶段：**最后我们收到一个快照来停止同步，但同步会给主体的刚体以巨大的速度将主体推开</p>
<h4 id="physics-simualtion-blending-during-collision" tabindex="-1" id="Physics-Simualtion-Blending-During-Collision">Physics Simualtion Blending During Collision</h4>
<p>碰撞过程中的物理模拟混合</p>
<p>Tunable between two states</p>
<p>可在两个状态之间调整</p>
<ul>
<li>
<p>State calculated by the client physics simulation</p>
<p>客户端物理模拟计算的状态</p>
</li>
<li>
<p>State that tries to reach the dead reckoned positions</p>
<p>试图到达指定位置</p>
</li>
</ul>
<p><img src="19.8.webp" alt="webp"></p>
<p>Tuned blending factors from Watch Dogs 2, Ubisoft Toronto. Bikes recover faster than cars</p>
<p>调整了育碧多伦多《看门狗 2》的混合因子。自行车的恢复速度比汽车快。</p>
<h4 id="usage-scenario-of-interpolation" tabindex="-1" id="Usage-Scenario-of-Interpolation">Usage Scenario of Interpolation</h4>
<p>插值使用场景</p>
<p><strong>Scenario for Using Interpolation</strong></p>
<p><strong>使用插值的场景</strong></p>
<ul>
<li>
<p>Characters’ movement are very non-deterministic with high acceleration</p>
<p>角色在高加速度下的运动非常不确定</p>
</li>
<li>
<p>Gameplay suffers from the “wrap”when extrapolation errors occur</p>
<p>当出现外推错误时，游戏玩法会受到“包装”的影响</p>
</li>
</ul>
<p><strong>Typical examples</strong></p>
<p><strong>典型示例</strong></p>
<ul>
<li>FPS</li>
<li>MOBA</li>
</ul>
<p><img src="19.9.webp" alt="webp"></p>
<h4 id="usage-scenario-of-extrapolation" tabindex="-1" id="Usage-Scenario-of-Extrapolation">Usage Scenario of Extrapolation</h4>
<p>外推法使用场景</p>
<p><strong>Scenario for Using Extrapolation</strong></p>
<p><strong>使用外推法的场景</strong></p>
<ul>
<li>
<p>Player movement uses a realistic physical model</p>
<p>玩家动作使用逼真的物理模型</p>
</li>
<li>
<p>Gameplay suffers from latency due to network transmission</p>
<p>游戏因网络传输而延迟</p>
</li>
</ul>
<p><strong>Typical examples</strong></p>
<p><strong>典型示例</strong></p>
<ul>
<li>
<p>Racing game. Vehicle systems (Tanks, Ships, etc.)</p>
<p>赛车游戏。载具系统（坦克、船舶等）</p>
</li>
</ul>
<p><img src="19.10.webp" alt="webp"></p>
<h4 id="blend-scenario-of-interpolation-and-extrapolation" tabindex="-1" id="Blend-Scenario-of-Interpolation-and-Extrapolation">Blend Scenario of Interpolation and Extrapolation</h4>
<p>插值和外推的混合场景</p>
<p>Sometimes we need to apply both interpolation and extrapolation for the game to work properly</p>
<p>有时我们需要同时应用插值和外推法才能使游戏正常工作</p>
<ul>
<li>
<p>Apply Extrapolation on vehicles</p>
<p>对车辆应用外推法</p>
</li>
<li>
<p>Apply Interpolation for characters</p>
<p>对角色应用插值</p>
</li>
<li>
<p>Do extrapolation if not enough data received</p>
<p>如果没有收到足够的数据，则进行外推</p>
</li>
</ul>
<p><img src="19.11.webp" alt="webp"></p>
<h3 id="hit-registration" tabindex="-1" id="Hit-Registration">Hit Registration</h3>
<p>点击注册</p>
<h4 id="how-to-make-a-headshot-in-online-game" tabindex="-1" id="How-to-Make-a-Headshot-in-Online-Game">How to Make a Headshot in Online Game</h4>
<p>如何在网络游戏中进行头部射击</p>
<p>Net messages to travel from client to server, and interpolation causes you to see the enemy way lag behind</p>
<p>网络消息从客户端传输到服务器，插值会导致你看到敌人的方式落后</p>
<p><img src="19.12.webp" alt="webp"></p>
<h4 id="where-is-the-enemy%3F" tabindex="-1" id="Where-is-the-Enemy">Where is the Enemy?</h4>
<p>敌人在哪里？</p>
<p>Due to latency, interpolation offsetand time delay, you’ll see other players slightly behind their current server positions. Where should I shot?</p>
<p>由于延迟、插值偏移和时间延迟，你会看到其他玩家稍微落后于他们当前的服务器位置。我应该在哪里开枪？</p>
<h4 id="where-should-i-shot%3F" tabindex="-1" id="Where-Should-I-Shot">Where Should I Shot?</h4>
<p>我应该在哪里开枪？</p>
<p><img src="19.13.webp" alt="webp"></p>
<h4 id="hit-registration-1" tabindex="-1" id="Hit-Registration-2">Hit Registration</h4>
<p>点击注册</p>
<p>Hit registrationis making a consensusof all players that whether you’ve actually hit your enemy</p>
<p>命中注册是让所有玩家就你是否真的击中了敌人达成共识。</p>
<p><img src="19.14.webp" alt="webp"></p>
<ul>
<li>
<p>Detecting hit event on client-side with replicated character positions</p>
<p>通过同步角色位置在客户端检测命中事件</p>
</li>
<li>
<p>Send hit events to the server</p>
<p>将命中事件发送到服务器</p>
</li>
<li>
<p>Server run simple verification</p>
<p>服务器运行简单验证</p>
</li>
</ul>
<p><img src="19.15.webp" alt="webp"></p>
<h4 id="a-comparison-of-hitscanweapons-versus-projectile-weapons" tabindex="-1" id="A-Comparison-of-HitscanWeapons-versus-Projectile-Weapons">A Comparison of HitscanWeapons versus Projectile Weapons</h4>
<p>Hitscan 武器与投射武器的比较</p>
<p>Unlike hitscanweapons, projectile weapons can also simulate the effect of gravity</p>
<p>与 hitscanweapons 不同，投射式武器还可以模拟重力的影响</p>
<p><img src="19.16.webp" alt="webp"></p>
<p>《战地》中的风景是由几个 hitbox 构建的，因此破坏可以带走墙壁、地板等。</p>
<p><img src="19.17.webp" alt="webp"></p>
<ul>
<li>Hitscan 发射射弹后立即击中目标</li>
<li>Projectile 发射射弹后需要一定时间才可击中目标</li>
</ul>
<h4 id="a-very-simple-server-verification-of-hit-event" tabindex="-1" id="A-Very-Simple-Server-Verification-of-Hit-Event">A Very Simple Server Verification of Hit Event</h4>
<p>一种非常简单的服务器命中事件验证</p>
<ul>
<li>
<p>Client send hit event with complete ray information to server</p>
<p>客户端向服务器发送包含完整射线信息的命中事件</p>
<ul>
<li>
<p>StartPoint, HitPointand HitObjectof the Raycast</p>
<p>光线投射的起点、终点和终点</p>
</li>
</ul>
</li>
<li>
<p>Validate StartPointwhether is really close enough to shooter</p>
<p>验证起点是否真的足够接近射击者</p>
</li>
<li>
<p>Validate the HitPointwhether is really belong to HitObject</p>
<p>验证 HitPoint 是否真的属于 HitObject</p>
</li>
<li>
<p>Ensure nothing is blocking along the path by casting a ray from the StartPointand HitPoint</p>
<p>通过从起点和终点投射光线，确保路径上没有任何遮挡</p>
</li>
</ul>
<p>In real game, the server verification is <strong>VERY TRICKY AND COMPLICATED</strong></p>
<p>在真实游戏中，服务器验证<strong>非常棘手和复杂</strong></p>
<h4 id="server-verification-has-to-guess" tabindex="-1" id="Server-Verification-Has-to-Guess">Server Verification Has to Guess</h4>
<p>服务器验证必须猜测</p>
<p><img src="19.18.webp" alt="webp"></p>
<h4 id="problem-of-client-side-hit-detection" tabindex="-1" id="Problem-of-Client-Side-Hit-Detection">Problem of Client-Side Hit Detection</h4>
<p>客户端命中检测问题</p>
<p><strong>Efficient and Precise</strong></p>
<p><strong>高效精准</strong></p>
<ul>
<li>
<p>Very efficient for hit detection without huge server workload</p>
<p>非常有效的命中检测，无需巨大的服务器工作负载</p>
</li>
<li>
<p>Best shooting experience with pixel precision</p>
<p>像素精度最佳的拍摄体验</p>
</li>
</ul>
<p><strong>Unsafe for cheating</strong></p>
<p><strong>易于玩家作弊</strong></p>
<ul>
<li>
<p>Fake hit event message</p>
<p>假热门事件消息</p>
</li>
<li>
<p>Lag switches</p>
<p>滞后开关</p>
</li>
<li>
<p>Infinite ammo</p>
<p>无限弹药</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<h4 id="detecting-hit-on-server-side%3F" tabindex="-1" id="Detecting-Hit-on-Server-Side">Detecting Hit on Server-Side?</h4>
<p>检测服务器端的命中？</p>
<p>Client doesn’t know the target current location on server</p>
<p>客户端不知道服务器上的目标当前位置</p>
<p><img src="19.19.webp" alt="webp"></p>
<h4 id="lag-compensation" tabindex="-1" id="Lag-Compensation">Lag Compensation</h4>
<p>滞后补偿</p>
<p>Server-side state rewinding to compensate network lags when player’s commands are executed</p>
<p>服务器端状态倒带，以补偿执行玩家命令时的网络延迟</p>
<ul>
<li>
<p>Get information from clients</p>
<p>从客户那里获取信息</p>
</li>
<li>
<p>Rewind game state in cached state snapshots that matches the client’s action time</p>
<p>在与客户端操作时间匹配的缓存状态快照中回放游戏状态</p>
</li>
<li>
<p>Run client operation in rewind game state</p>
<p>在倒带游戏状态下运行客户端操作</p>
</li>
</ul>
<p><img src="19.20.webp" alt="webp"></p>
<h4 id="compensate-all-possible-lags" tabindex="-1" id="Compensate-all-Possible-Lags">Compensate all Possible Lags</h4>
<p>补偿所有可能的延迟</p>
<ul>
<li>
<p>RewindTime = Current Server Time - Packet Latency - Client View Interpolation Offset</p>
<p>RewindTime = 当前服务器时间 - 数据包延迟 - 客户端视图插值偏移</p>
</li>
</ul>
<p><img src="19.21.webp" alt="webp"></p>
<p><img src="19.22.webp" alt="webp"></p>
<p>Actor: Enemy’s client state</p>
<p>角色：敌人的客户端状态</p>
<p>Red collision box: Enemy in the player’s view</p>
<p>红色碰撞框：玩家视野中的敌人</p>
<p>Blue collision box: Rewinded server state</p>
<p>蓝色冲突框：倒带服务器状态</p>
<h4 id="cover-problems-%E2%80%93running-into-cover" tabindex="-1" id="Cover-Problems-–Running-into-Cover">Cover Problems –Running into Cover</h4>
<p>掩体问题——遇到掩体</p>
<p><img src="19.23.webp" alt="webp"></p>
<p>被击中者躲到掩体后因为网络延迟仍被击中，Shooter’ s advantage.</p>
<h4 id="cover-problems-%E2%80%93coming-out-from-cover" tabindex="-1" id="Cover-Problems-–Coming-out-from-Cover">Cover Problems –Coming out from Cover</h4>
<p><img src="19.24.webp" alt="webp"></p>
<p>被攻击者从掩体出来因网络延迟未被击中，Peeker’s advantage.</p>
<h4 id="startup-frames-to-ease-latency-feeling" tabindex="-1" id="Startup-Frames-to-Ease-Latency-Feeling">Startup Frames to Ease Latency Feeling</h4>
<p>启动框架缓解延迟感</p>
<ul>
<li>
<p>A fixed animation before attack or move can also eliminate the effect of lag from network transmission</p>
<p>攻击或移动前的固定动画（技能前摇）也可以消除网络传输延迟的影响</p>
</li>
<li>
<p>Players will keep their attention on animations and ignore the state delay</p>
<p>玩家将注意力集中在动画上，忽略状态延迟</p>
</li>
</ul>
<p><img src="19.25.webp" alt="webp"></p>
<h4 id="local-forecast-vfx-impacts" tabindex="-1" id="Local-Forecast-VFX-Impacts">Local Forecast VFX Impacts</h4>
<p>本地预测 VFX 影响</p>
<ul>
<li>
<p>Clients can perform local hit tests in order to give the player some instant feedback, such as displaying a blood splatter visual effect</p>
<p>客户端可以执行本地命中测试，以便为玩家提供一些即时反馈，例如显示血溅的视觉效果</p>
</li>
<li>
<p>However, any permanent effects of the hits, such as reducing the hit points of a player, are only applied after receiving confirmation from the server</p>
<p>但是，只有在收到服务器的确认后，才会应用命中的任何永久效果，例如减少玩家的命中点</p>
</li>
</ul>
<h3 id="mmog-network-architecture" tabindex="-1" id="MMOG-Network-Architecture">MMOG Network Architecture</h3>
<p>MMOG 网络架构</p>
<h4 id="what-is-mmog%3F" tabindex="-1" id="What-is-MMOG">What is MMOG?</h4>
<p>什么是 MMOG？</p>
<p><strong>MMOG</strong>: Massively Multiplayer Online Game, or more commonly <strong>MMO</strong></p>
<p><strong>MMOG</strong>：大型多人在线游戏，或更常见的 <strong>MMO</strong></p>
<p>MMOs with a large numbers of players, often hundreds or thousands, on the same server can enable players to cooperate and compete with each other on a large scale, and include a variety of gameplay types (MMORPG, MMORTS, MMOFPS, etc.)</p>
<p>在同一台服务器上拥有大量玩家（通常是数百或数千人）的 MMO 可以使玩家能够大规模地相互合作和竞争，并包括各种游戏类型（MMORPG、MMORTS、MMOFPS 等）</p>
<p><img src="19.26.webp" alt="webp"></p>
<p><img src="19.27.webp" alt="webp"></p>
<h4 id="diversities-of-modern-mmo" tabindex="-1" id="Diversities-of-Modern-MMO">Diversities of Modern MMO</h4>
<p>现代 MMO 的多样性</p>
<p><img src="19.28.webp" alt="webp"></p>
<h4 id="game-sub-systems" tabindex="-1" id="Game-Sub-Systems">Game Sub-Systems</h4>
<p>游戏子系统</p>
<p>MMOs have a variety of gameplay and are supported by many sub-systems</p>
<p>MMO 具有多种游戏玩法，并得到许多子系统的支持</p>
<ul>
<li>
<p>User management</p>
<p>用户管理</p>
</li>
<li>
<p>Matchmaking</p>
<p>配对</p>
</li>
<li>
<p>Trading system</p>
<p>交易系统</p>
</li>
<li>
<p>Social system</p>
<p>社会制度</p>
</li>
<li>
<p>Data storage</p>
<p>数据存储</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<h4 id="mmo-architecture" tabindex="-1" id="MMO-Architecture">MMO Architecture</h4>
<p>MMO 架构</p>
<p><img src="19.29.webp" alt="webp"></p>
<h4 id="services-of-link-layer" tabindex="-1" id="Services-of-Link-Layer">Services of Link Layer</h4>
<p>链路层服务</p>
<p>Login Server</p>
<p>登录服务器</p>
<ul>
<li>
<p>Verification of client connection</p>
<p>客户端连接验证</p>
</li>
</ul>
<p>Gateway</p>
<p>网关</p>
<ul>
<li>
<p>Very important layer to separate inside/outside networks</p>
<p>分隔内部/外部网络的非常重要的层</p>
</li>
</ul>
<p><img src="19.30.webp" alt="webp"></p>
<h4 id="lobby" tabindex="-1" id="Lobby">Lobby</h4>
<p>大厅</p>
<ul>
<li>
<p>Players can gather in the lobby, see and interact with other players</p>
<p>玩家可以聚集在大厅，观看并与其他玩家互动</p>
</li>
<li>
<p>When the number of players continues to increase, it is a challenge to the performance of the server and the client</p>
<p>当玩家数量持续增加时，服务器和客户端的性能都会受到挑战</p>
</li>
</ul>
<p><img src="19.31.webp" alt="webp"></p>
<h4 id="character-server" tabindex="-1" id="Character-Server">Character Server</h4>
<p>角色服务器</p>
<p>All player data is managed in one system. Such as account info, character info, backpack info, mail info, etc.</p>
<p>所有玩家数据都在一个系统中管理。如账户信息、人物信息、背包信息、邮件信息等。</p>
<p><img src="19.32.webp" alt="webp"></p>
<h4 id="trading-system" tabindex="-1" id="Trading-System">Trading System</h4>
<p>交易系统</p>
<ul>
<li>
<p>Buying and selling items on the marketplace</p>
<p>在市场上买卖商品</p>
</li>
<li>
<p>Sending items or coins to other players through the in-game Mail</p>
<p>通过游戏内邮件向其他玩家发送物品或硬币</p>
</li>
<li>
<p>Game designers need to keep an eye on market prices to prevent imbalances</p>
<p>游戏设计师需要关注市场价格，以防止不平衡</p>
</li>
<li>
<p>For a persistent world to maintain a stable economy, a balance must be struck between currency sources and sinks</p>
<p>为了使世界保持稳定的经济，必须在货币来源和汇之间取得平衡</p>
</li>
<li>
<p>Players can use real-world money to buy a specific in-game item</p>
<p>玩家可以用现实世界的钱购买特定的游戏内物品</p>
</li>
</ul>
<p><img src="19.33.webp" alt="webp"></p>
<h4 id="social-system" tabindex="-1" id="Social-System">Social System</h4>
<p>社会制度</p>
<ul>
<li>
<p>Player-to-player interplay and communication</p>
<p>玩家之间的互动和沟通</p>
</li>
<li>
<p>Foster stronger social cohesion in-game</p>
<p>在游戏中培养更强的社会凝聚力</p>
</li>
</ul>
<p><img src="19.34.webp" alt="webp"></p>
<h4 id="matchmaking" tabindex="-1" id="Matchmaking">Matchmaking</h4>
<p>配对</p>
<ul>
<li>
<p>You have to consider attributes like skills, level, latency, wait time…</p>
<p>你必须考虑技能、级别、延迟、等待时间等属性…</p>
</li>
<li>
<p>Ingeneral, makingagood matchmaking service is core for a game design</p>
<p>一般来说，提供良好的配对服务是游戏设计的核心</p>
</li>
<li>
<p>Running this on a global scale for your player population presents a whole different set of challenges</p>
<p>在全球范围内为您的玩家群体运行此功能会带来一系列完全不同的挑战</p>
</li>
</ul>
<p><img src="19.35.webp" alt="webp"></p>
<h4 id="data-storage" tabindex="-1" id="Data-Storage">Data Storage</h4>
<p>数据存储</p>
<p>The game data is very complex and diverse</p>
<p>游戏数据非常复杂和多样化</p>
<ul>
<li>
<p>Player data (guilds, dungeons, warehouse, etc.)</p>
<p>玩家数据（公会、地下城、仓库等）</p>
</li>
<li>
<p>Monitoring data</p>
<p>监测数据</p>
</li>
<li>
<p>Mining data</p>
<p>最小化数据</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<p>Data needs to be securely persisted and efficiently organized for retrieved and analysis etc.</p>
<p>数据需要安全地持久化，并有效地组织起来进行检索和分析等。</p>
<p><img src="19.36.webp" alt="webp"></p>
<h4 id="relational-data-storage" tabindex="-1" id="Relational-Data-Storage">Relational Data Storage</h4>
<p>关系数据存储：MySQL</p>
<ul>
<li>
<p>Requires Structure to be Predetermined</p>
<p>需要预先确定结构</p>
</li>
<li>
<p>Flexible Queries</p>
<p>灵活的查询</p>
</li>
<li>
<p>Always Consistent</p>
<p>始终保持一致</p>
</li>
</ul>
<p>Game Development Examples</p>
<p>游戏开发示例</p>
<ul>
<li>
<p>Player Data</p>
<p>玩家数据</p>
</li>
<li>
<p>GameData</p>
<p>游戏数据</p>
</li>
<li>
<p>Inventory</p>
<p>库存</p>
</li>
<li>
<p>ItemShops/Trading</p>
<p>商品商店/贸易</p>
</li>
</ul>
<h4 id="non-relational-data-storage" tabindex="-1" id="Non-Relational-Data-Storage">Non-Relational Data Storage</h4>
<p>非关系数据存储：MongoDB</p>
<ul>
<li>
<p>Structure Can Change For Each Entry</p>
<p>每个条目的结构都可能发生变化</p>
</li>
<li>
<p>Queries Have Higher Specificity</p>
<p>查询具有更高的特异性</p>
</li>
<li>
<p>May Not Always Be Consistent</p>
<p>可能并不总是一致的</p>
</li>
</ul>
<p><strong>Game Development Examples</strong></p>
<p><strong>游戏开发示例</strong></p>
<ul>
<li>
<p>Player/Item Stats/Profile Game Data</p>
<p>玩家/物品统计/个人资料游戏数据</p>
</li>
<li>
<p>Enchantments and Upgrades</p>
<p>魔法和升级</p>
</li>
<li>
<p>Game States</p>
<p>游戏状态</p>
</li>
<li>
<p>Quest Data</p>
<p>任务数据</p>
</li>
</ul>
<h4 id="in-memory-data-storage" tabindex="-1" id="In-Memory-Data-Storage">In-Memory Data Storage</h4>
<p>内存数据存储：redis</p>
<ul>
<li>
<p>Extremely Fast (Memory versus Hard Disk)</p>
<p>极快（内存与硬盘）</p>
</li>
<li>
<p>Key-Value</p>
<p>关键价值</p>
</li>
<li>
<p>Fast Sorted/Ranged Searches</p>
<p>快速排序/范围搜索</p>
</li>
<li>
<p>Persistence among servers</p>
<p>服务器间的持久性</p>
</li>
</ul>
<p><strong>Game Development Examples</strong></p>
<p><strong>游戏开发示例</strong></p>
<ul>
<li>
<p>Matchmaking</p>
<p>配对</p>
</li>
<li>
<p>Leaderboards</p>
<p>排行榜</p>
</li>
<li>
<p>Session Management</p>
<p>会话管理</p>
</li>
<li>
<p>Boost Performance For Other Databases</p>
<p>提高其他数据库的性能</p>
</li>
</ul>
<h4 id="player-number-growth" tabindex="-1" id="Player-Number-Growth">Player Number Growth</h4>
<p>玩家数量增长带来的服务器负担</p>
<p><img src="19.37.webp" alt="webp"></p>
<h4 id="distributed-system" tabindex="-1" id="Distributed-System">Distributed System</h4>
<p>分布式系统</p>
<p>A distributed system is a computing environment in which various components are spread across multiple computers (or other computing devices) on a network</p>
<p>分布式系统是一种计算环境，其中各种组件分布在网络上的多台计算机（或其他计算设备）上</p>
<p><img src="19.38.webp" alt="webp"></p>
<h4 id="challenges-with-distributed-systems" tabindex="-1" id="Challenges-with-Distributed-systems">Challenges with Distributed systems</h4>
<p>分布式系统的挑战</p>
<ul>
<li>
<p>Data access mutual exclusion</p>
<p>数据访问互斥</p>
</li>
<li>
<p>Idempotence</p>
<p>意识</p>
</li>
<li>
<p>Failure and partial failure</p>
<p>故障和部分故障</p>
</li>
<li>
<p>Unreliable network</p>
<p>不可靠的网络</p>
</li>
<li>
<p>Distributed bugs spread epidemically</p>
<p>分布式漏洞以流行病的方式传播</p>
</li>
<li>
<p>Consistency and consensus</p>
<p>一致性和共识</p>
</li>
<li>
<p>Distributed transaction</p>
<p>分布式事务</p>
</li>
</ul>
<h4 id="load-balancing" tabindex="-1" id="Load-Balancing">Load Balancing</h4>
<p>负载平衡</p>
<p>Refers to the process of distributing a set of tasks over a set of resources (computing units), with the aim of making their overall processing more efficient</p>
<p>指将一组任务分配到一组资源（计算单元）上的过程，目的是提高其整体处理效率</p>
<ul>
<li>
<p>Optimize the response time</p>
<p>优化响应时间</p>
</li>
<li>
<p>Avoid unevenly overloading some compute nodes while other compute nodes are left idle</p>
<p>避免在其他计算节点处于空闲状态时，不均匀地使某些计算节点过载</p>
</li>
<li>
<p>All players are evenly divided on multiple servers</p>
<p>所有玩家平均分布在多个服务器上</p>
</li>
</ul>
<p><img src="19.39.webp" alt="webp"></p>
<h4 id="consistent-hashing" tabindex="-1" id="Consistent-Hashing">Consistent Hashing</h4>
<p>一致散列</p>
<p>It was designed to avoid the problem of having to reassign every player when a server is added or removed throughout the cluster</p>
<p>它旨在避免在整个集群中添加或删除服务器时必须重新分配每个玩家的问题</p>
<p><img src="19.40.webp" alt="webp"></p>
<p><img src="19.41.webp" alt="webp"></p>
<p><img src="19.42.webp" alt="webp"></p>
<h4 id="virtual-server-node-in-consistent-hashing" tabindex="-1" id="Virtual-Server-Node-in-Consistent-Hashing">Virtual Server Node in Consistent Hashing</h4>
<p>一致散列中的虚拟服务器节点</p>
<p><img src="19.43.webp" alt="webp"></p>
<h4 id="servers-management" tabindex="-1" id="Servers-Management">Servers Management</h4>
<ul>
<li>
<p>The number of services increases</p>
<p>服务数量增加</p>
</li>
<li>
<p>Difficult to manage</p>
<p>难以管理</p>
</li>
<li>
<p>Lacks the flexibility to change the IP or port at a later point in time</p>
<p>缺乏在以后更改 IP 或端口的灵活性</p>
</li>
</ul>
<p><img src="19.44.webp" alt="webp"></p>
<h4 id="service-discovery---registry" tabindex="-1" id="Service-Discovery-Registry">Service Discovery - Registry</h4>
<p>服务发现-注册表</p>
<ul>
<li>
<p>Registers itself with the service registry when it enters the system</p>
<p>当服务进入系统时，在服务注册表中注册</p>
</li>
<li>
<p>An example of Register value</p>
<p>寄存器值示例</p>
<ul>
<li>server type/server_name@server_ip:port</li>
</ul>
</li>
</ul>
<p><img src="19.45.webp" alt="webp"></p>
<h4 id="service-discovery---query-and-watch" tabindex="-1" id="Service-Discovery-Query-and-Watch">Service Discovery - Query and Watch</h4>
<p>服务发现-查询和监视</p>
<ul>
<li>
<p>Request service discovery service to query all values through service type and watch it</p>
<p>请求服务发现服务通过服务类型查询所有值并查看</p>
</li>
</ul>
<p><img src="19.46.webp" alt="webp"></p>
<h4 id="service-discovery---health-check" tabindex="-1" id="Service-Discovery-Health-Check">Service Discovery - Health Check</h4>
<p>服务发现-健康检查</p>
<ul>
<li>
<p>Notice Gateway Server B Failure when Server Instance B Heartbeat timeout</p>
<p>服务器实例 B 心跳超时时通知网关服务器 B 故障</p>
</li>
</ul>
<p><img src="19.47.webp" alt="webp"></p>
<h3 id="bandwidth-optimization" tabindex="-1" id="Bandwidth-Optimization">Bandwidth Optimization</h3>
<p>优化带宽</p>
<h4 id="why-bandwidth-matters" tabindex="-1" id="Why-Bandwidth-Matters">Why Bandwidth Matters</h4>
<p>为什么带宽很重要</p>
<ul>
<li>
<p>Usage-based billing: e.g. mobile, cloud service</p>
<p>基于使用量的计费：例如移动、云服务</p>
</li>
<li>
<p>Latency increased by bandwidth: packet splitting/drop</p>
<p>延迟随带宽增加：数据包拆分/丢弃</p>
</li>
<li>
<p>Connection drops due to message overflow</p>
<p>消息溢出导致连接中断</p>
</li>
</ul>
<h4 id="calculate-bandwidth" tabindex="-1" id="Calculate-Bandwidth">Calculate Bandwidth</h4>
<p>计算带宽</p>
<p><strong>Affecting factors</strong></p>
<p><strong>影响因素</strong></p>
<ul>
<li><strong>n</strong> = player numbers 玩家数量</li>
<li><strong>f</strong> = update frequency 更新频率</li>
<li><strong>s</strong> = size of game state 游戏状态大小</li>
</ul>
<p><img src="19.48.webp" alt="webp"></p>
<p>Data transfer per second</p>
<p>每秒数据传输</p>
<ul>
<li>
<p>Server 服务器：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>⋅</mo><mi>s</mi><mo>⋅</mo><mi>f</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\cdot s\cdot f)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mbin">⋅</span><span class="mord mathit">s</span><span class="mbin">⋅</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>Client (downstream) 客户端（下游）：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>s</mi><mo>⋅</mo><mi>f</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(s\cdot f)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">s</span><span class="mbin">⋅</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>Client (upstream) 客户端（上游）：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>f</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(f)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span></p>
</li>
</ul>
<p><img src="19.49.webp" alt="webp"></p>
<h4 id="data-compression" tabindex="-1" id="Data-Compression">Data Compression</h4>
<p>数据压缩</p>
<ul>
<li>
<p>There are a lot of floating point numbers in the game synchronization data, such as position, rotation, speed, etc.</p>
<p>游戏同步数据中有很多浮点数，如位置、旋转、速度等。</p>
</li>
<li>
<p>Choosing the right floating-point precision can save a lot of bandwidth</p>
<p>选择正确的浮点精度可以节省大量带宽。</p>
<ul>
<li>
<p>e.g When representing human running speed, only half precision is required</p>
<p>例如，在表示人类跑步速度时，只需要一半的精度</p>
</li>
</ul>
</li>
</ul>
<p><img src="19.50.webp" alt="webp"></p>
<ul>
<li>
<p>When representing player position, the player will only move within a certain range due to player speed limitations</p>
<p>代表玩家位置时，由于玩家速度限制，玩家只能在一定范围内移动</p>
</li>
<li>
<p>We can divide the map into different small pieces and use the relative position to represent the player’s position, which can reduce the precision of the floating point number of the synchronization position</p>
<p>我们可以将地图分成不同的小块，并使用相对位置来表示玩家的位置，这会降低同步位置浮点数的精度</p>
</li>
</ul>
<p><img src="19.51.webp" alt="webp"></p>
<h4 id="object-relevance" tabindex="-1" id="Object-Relevance">Object Relevance</h4>
<p>对象相关性</p>
<ul>
<li>
<p>The player will be informed of state updates</p>
<p>玩家将收到状态更新的通知</p>
</li>
<li>
<p>Usually, the ones player can see &amp; interact</p>
<p>通常，玩家可以看到并互动</p>
</li>
<li>
<p>Easiest implementation: all objects relevant to all clients (for small player num).</p>
<p>最简单的实现：与所有客户端相关的所有对象（对于小玩家 num）。<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>Limiting factor for max concurrent players</p>
<p>最大并发玩家的限制因素</p>
</li>
</ul>
<p><img src="19.52.webp" alt="webp"></p>
<h4 id="relevance---static-zones" tabindex="-1" id="Relevance-Static-Zones">Relevance - Static Zones</h4>
<p>相关性-静态区域</p>
<ul>
<li>
<p>Distribute players into different zones</p>
<p>将玩家分配到不同的区域</p>
</li>
<li>
<p>Players are relevant in the same zone</p>
<p>玩家在同一区域内具有相关性</p>
</li>
<li>
<p>Reduce bandwidth waste</p>
<p>减少带宽浪费</p>
</li>
</ul>
<p><img src="19.53.webp" alt="webp"></p>
<h4 id="relevance---area-of-interest-(aoi)" tabindex="-1" id="Relevance-Area-of-Interest-AOI">Relevance - Area of Interest (AOI)</h4>
<p>相关性-关注领域（AOI）</p>
<ul>
<li>
<p>The area within which objects are relevant to Player/NPC</p>
<p>对象与玩家 / NPC 相关的区域</p>
</li>
<li>
<p>Only see &amp; interact with objects within range</p>
<p>仅查看范围内的对象并与之交互</p>
</li>
<li>
<p>Remove unnecessary network data</p>
<p>删除不必要的网络数据</p>
</li>
</ul>
<p><img src="19.54.webp" alt="webp"></p>
<h4 id="aoi--direct-range-query" tabindex="-1" id="AOI-Direct-Range-Query">AOI -Direct Range-Query</h4>
<p>AOI - 直接范围查询</p>
<ul>
<li>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mrow><mo>(</mo><msub><mi>x</mi><mrow><mi>p</mi><mi>l</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><msup><mo>)</mo><mn>2</mn></msup><mo>−</mo><mo>(</mo><msub><mi>y</mi><mrow><mi>p</mi><mi>l</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><msup><mo>)</mo><mn>2</mn></msup></mrow></msqrt><mo>≤</mo><msub><mi>r</mi><mrow><mi>d</mi><mi>o</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sqrt{(x_{player}-x_i)^2-(y_{player}-y_i)^2}\le r_{doi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9169510000000001em;"></span><span class="strut bottom" style="height:1.24001em;vertical-align:-0.32305899999999993em;"></span><span class="base textstyle uncramped"><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.026951000000000058em;"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">√</span></span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.289em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.289em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:-0.836951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mrel">≤</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">o</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
</li>
<li>
<p>Simple to implement 易于实施</p>
</li>
<li>
<p>Time complexity 时间复杂度: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>Not suitable for MMOG, e.g. 1000 players in one zone, 20 ticks/s</p>
<p>不适合 MMOG，例如一个区域有 1000 名玩家，20 滴答/秒</p>
<p>1000 x 1000 x 20 = 20,000,000 distance computations per second</p>
<p>1000 x 1000 x 20 = 每秒 20000000 次距离计算</p>
</li>
</ul>
<p><img src="19.55.webp" alt="webp"></p>
<h4 id="aoi---spatial-grid" tabindex="-1" id="AOI-Spatial-Grid">AOI - Spatial-Grid</h4>
<p>AOI - 空间网格</p>
<p><strong>Mapping Entities</strong></p>
<p><strong>映射实体</strong></p>
<ul>
<li>
<p>Map entity <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> → grid <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span></p>
<p>映射实体<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> → 网格 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span></p>
</li>
<li>
<p>Relevant entities in the grids around current player’s grid</p>
<p>当前玩家网格周围网格中的相关实体</p>
</li>
<li>
<p>Player’s AOI list can be cached</p>
<p>玩家的 AOI 列表可以缓存</p>
</li>
</ul>
<p><img src="19.56.webp" alt="webp"></p>
<p><strong>Events</strong></p>
<p><strong>事件</strong></p>
<p>Enter</p>
<p>进入</p>
<ul>
<li>
<p>Add entities from observation (observed) list</p>
<p>从观察（observation）列表中添加实体</p>
</li>
</ul>
<p>Leave</p>
<p>离开</p>
<ul>
<li>
<p>Remove entities from observation (observed) list</p>
<p>从观察（已观察）列表中删除实体</p>
</li>
</ul>
<p><img src="19.57.webp" alt="webp"></p>
<p><strong>Pros and Cons</strong></p>
<p><strong>优点和缺点</strong></p>
<p>Pros</p>
<ul>
<li>
<p>Fast query time <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span></p>
<p>快速查询时间 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span></p>
</li>
</ul>
<p>Cons</p>
<ul>
<li>
<p>Small grid: high memory cost</p>
<p>小网格：内存成本高</p>
</li>
<li>
<p>Large grid: high CPU cost</p>
<p>大网格：CPU 成本高</p>
</li>
<li>
<p>Object with varying AOI radius?</p>
<p>具有不同 AOI 半径的物体？</p>
</li>
</ul>
<p><img src="19.58.webp" alt="webp"></p>
<h4 id="aoi---orthogonal-linked-list" tabindex="-1" id="AOI-Orthogonal-Linked-list">AOI - Orthogonal Linked-list</h4>
<p>AOI - 正交链表</p>
<ul>
<li>
<p>Game entities in double linked-list</p>
<p>双链表中的游戏实体</p>
<ul>
<li>
<p>xlist, ylist</p>
</li>
<li>
<p>ascending order</p>
<p>升序</p>
</li>
</ul>
</li>
<li>
<p>Less Objects to traverse</p>
<p>需要遍历的对象更少</p>
</li>
</ul>
<p><img src="19.59.webp" alt="webp"></p>
<p><strong>Traverse entities</strong></p>
<p><strong>遍历实体</strong></p>
<ul>
<li>
<p>Within aoi radius</p>
<p>aoi 半径内</p>
</li>
<li>
<p>Left/right direction</p>
<p>左 / 右方向</p>
</li>
<li>
<p>For both x/y lists</p>
<p>对于 x/y 两个列表</p>
</li>
</ul>
<p><img src="19.60.webp" alt="webp"></p>
<p><strong>Better Approach - Range Trigger</strong></p>
<p><strong>更好的方法-范围触发</strong></p>
<ul>
<li>
<p>Entity move → trigger move</p>
<p>实体移动 → 触发移动</p>
</li>
<li>
<p>Compare with trigger</p>
<p>与触发器比较</p>
</li>
<li>
<p>Event driven</p>
<p>事件驱动</p>
</li>
</ul>
<p><img src="19.61.webp" alt="webp"></p>
<p><strong>Pros</strong></p>
<ul>
<li>
<p>Memory efficient</p>
<p>内存效率高</p>
</li>
<li>
<p>Varying AOI radius</p>
<p>可变 AOI 半径</p>
</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>
<p>New object insertion cost <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></p>
<p>新对象插入成本 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>Not Suitable when entities move large distance frequently</p>
<p>当实体频繁移动远距离时不适用</p>
</li>
</ul>
<p><img src="19.62.webp" alt="webp"></p>
<h4 id="aoi---potentially-visible-set-(pvs)" tabindex="-1" id="AOI-Potentially-Visible-Set-PVS">AOI - Potentially Visible Set (PVS)</h4>
<p>AOI - 潜在可见集（PVS）</p>
<ul>
<li>
<p>Set of potentially visible areas</p>
<p>一组潜在可见区域</p>
</li>
<li>
<p>Can be calculated offline</p>
<p>可以离线计算</p>
</li>
<li>
<p>Determine relevant objects from PVS</p>
<p>从 PVS 中确定相关对象</p>
</li>
<li>
<p>e.g. Racing game: fast-moving car</p>
<p>例如赛车游戏：快速行驶的汽车</p>
</li>
</ul>
<p><img src="19.63.webp" alt="webp"></p>
<h4 id="varying-update-frequency-by-player-position" tabindex="-1" id="Varying-Update-Frequency-by-Player-Position">Varying Update Frequency by Player Position</h4>
<p>根据玩家位置改变更新频率</p>
<ul>
<li>
<p>Distance-based update frequency</p>
<p>基于距离的更新频率</p>
</li>
<li>
<p>Only closer objects are interactable</p>
<p>只有较近的对象是可交互的</p>
</li>
<li>
<p>Distance ↑ → f  → bandwidth ↓</p>
<p>距离 ↑ → f → 带宽 ↓</p>
</li>
</ul>
<p><img src="19.64.webp" alt="webp"></p>
<h4 id="cheating-kill-online-games" tabindex="-1" id="Cheating-Kill-Online-Games">Cheating Kill Online Games</h4>
<p>作弊杀死在线游戏</p>
<p>How likely, if at all, would you be to stop playing a multiplayer game online if you thought other players were cheating to gain an unfair advantage?</p>
<p>如果你认为其他玩家作弊以获得不公平的优势，你有多大可能停止玩在线多人游戏？</p>
<table>
<thead>
<tr>
<th></th>
<th>Very likely</th>
<th>Fairly likely</th>
<th>Not very likely</th>
<th>Nor linkly at all</th>
<th>Don’t konw</th>
</tr>
</thead>
<tbody>
<tr>
<td>Global</td>
<td>29%</td>
<td>48%</td>
<td>15%</td>
<td>4%</td>
<td>5%</td>
</tr>
<tr>
<td>China</td>
<td>25%</td>
<td>56%</td>
<td>16%</td>
<td>2%</td>
<td>1%</td>
</tr>
<tr>
<td>Germany</td>
<td>30%</td>
<td>36%</td>
<td>17%</td>
<td>8%</td>
<td>8%</td>
</tr>
<tr>
<td>Japan</td>
<td>26%</td>
<td>49%</td>
<td>16%</td>
<td>2%</td>
<td>7%</td>
</tr>
<tr>
<td>South Korea</td>
<td>27%</td>
<td>59%</td>
<td>11%</td>
<td>1%</td>
<td>1%</td>
</tr>
<tr>
<td>UK</td>
<td>33%</td>
<td>39%</td>
<td>12%</td>
<td>6%</td>
<td>10%</td>
</tr>
<tr>
<td>US</td>
<td>37%</td>
<td>32%</td>
<td>15%</td>
<td>7%</td>
<td>8%</td>
</tr>
</tbody>
</table>
<p>77% of players will likely stop playing online games when other players are cheating, according to the survey of Irdeto.</p>
<p>爱迪德的调查显示，当其他玩家作弊时，77% 的玩家可能会停止玩网络游戏。</p>
<h4 id="millions-ways-of-cheating" tabindex="-1" id="Millions-Ways-of-Cheating">Millions Ways of Cheating</h4>
<p>数百万种作弊方式</p>
<p><strong>Game code modifications</strong></p>
<p><strong>游戏代码修改</strong></p>
<ul>
<li>
<p>Modify or read memory data</p>
<p>修改或读取内存数据</p>
</li>
<li>
<p>Crack client</p>
<p>破解客户端</p>
</li>
</ul>
<p><strong>System software invoke</strong></p>
<p><strong>系统软件调用</strong></p>
<ul>
<li>
<p>D3D Render Hook</p>
<p>D3D 渲染挂钩</p>
</li>
<li>
<p>Simulate mouse and keyboard operations</p>
<p>模拟鼠标和键盘操作</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<p><strong>Net Packet interception</strong></p>
<p><strong>网络数据包拦截</strong></p>
<ul>
<li>
<p>Send fake packets</p>
<p>发送虚假数据包</p>
</li>
<li>
<p>Modify packet data</p>
<p>修改数据包</p>
</li>
</ul>
<p><img src="19.65.webp" alt="webp"></p>
<h4 id="obfuscating-memory" tabindex="-1" id="Obfuscating-Memory">Obfuscating Memory</h4>
<p>混淆记忆</p>
<ul>
<li>
<p>A cheater might be able to get the location of the player coordinates in the memory and move the character ignoring the game rules, such as passing the wall</p>
<p>作弊者可能能够获得玩家在内存中的坐标位置，并忽略游戏规则移动角色，例如通过墙壁</p>
</li>
<li>
<p>Furthermore, the cheater can utilize the location of these values to map out even larger data structures in the memory, such as the player object itself</p>
<p>此外，作弊者可以利用这些值的位置在内存中绘制出更大的数据结构，例如玩家对象本身</p>
</li>
</ul>
<p><img src="19.66.webp" alt="webp"></p>
<h4 id="executable-packers" tabindex="-1" id="Executable-Packers">Executable Packers</h4>
<p>可执行打包器</p>
<ul>
<li>
<p>Game core logic can be restored by reverse engineering</p>
<p>游戏核心逻辑可以通过逆向工程恢复</p>
</li>
<li>
<p>Players can crack the game by analyzing the code, finding game loopholes, making plug-ins, etc…</p>
<p>玩家可以通过分析代码、发现游戏漏洞、制作插件等来破解游戏…</p>
</li>
</ul>
<p><img src="19.67.webp" alt="webp"></p>
<ul>
<li>
<p>The packager obfuscates the source program and adds decompression code</p>
<p>打包器混淆源程序并添加解压缩代码</p>
</li>
<li>
<p>The decompression code will execute first, and the source program is decrypted in memory</p>
<p>解压缩代码将首先执行，源程序在内存中解密</p>
</li>
</ul>
<p><img src="19.68.webp" alt="webp"></p>
<h4 id="verifying-local-files-by-hashing" tabindex="-1" id="Verifying-Local-Files-by-Hashing">Verifying Local Files by Hashing</h4>
<p>通过哈希验证本地文件</p>
<ul>
<li>
<p>Ensure that the game files have not been modified</p>
<p>确保游戏文件未被修改</p>
</li>
<li>
<p>For example, the cheater could modify the wall textures to be transparent so all enemies could be seen through the walls</p>
<p>例如，作弊者可以将墙壁纹理修改为透明，这样所有敌人都可以透过墙壁看到</p>
</li>
<li>
<p>The cheater could also adjust the lightning to make it easier to see enemies</p>
<p>作弊者还可以调整闪电，使其更容易看到敌人</p>
</li>
</ul>
<p><img src="19.69.webp" alt="webp"></p>
<h4 id="packet-interception-and-manipulation" tabindex="-1" id="Packet-Interception-and-Manipulation">Packet Interception and Manipulation</h4>
<p>数据包拦截和操纵</p>
<ul>
<li>
<p>When the data is not encrypted or hacked, the player can build game logic based on packet data even without starting the game</p>
<p>当数据未被加密或黑客攻击时，即使不启动游戏，玩家也可以基于数据包构建游戏逻辑</p>
</li>
<li>
<p>Such cheat programs often become money-making tools, which seriously reduce game’s the overall profit</p>
<p>这种作弊程序往往成为赚钱的工具，严重降低了游戏的整体利润</p>
</li>
</ul>
<p><img src="19.70.webp" alt="webp"></p>
<h4 id="encrypt-the-network-traffic" tabindex="-1" id="Encrypt-the-Network-Traffic">Encrypt the Network Traffic</h4>
<p>加密网络流量</p>
<p><strong>Two kinds of algorithms</strong></p>
<p><strong>两种算法</strong></p>
<ul>
<li>
<p>Symmetric-key algorithm</p>
<p>对称密钥算法</p>
<ul>
<li>
<p>Obfuscate and restore data according to the same key</p>
<p>根据同一密钥混淆和还原数据</p>
</li>
<li>
<p>Fast and efficient</p>
<p>快速高效</p>
</li>
</ul>
</li>
</ul>
<p><img src="19.71.webp" alt="webp"></p>
<p><strong>Asymmetric encryption</strong></p>
<p><strong>非对称加密</strong></p>
<ul>
<li>
<p>Encryption and decryption use different keys</p>
<p>加密和解密使用不同的密钥</p>
</li>
<li>
<p>Slow, only used for encrypting critical data</p>
<p>速度慢，仅用于加密关键数据</p>
</li>
</ul>
<p><img src="19.72.webp" alt="webp"></p>
<ul>
<li>
<p>Distribute symmetric key securely using asymmetric encryption</p>
<p>使用非对称加密安全地分发对称密钥</p>
</li>
<li>
<p>Transfer data using symmetric encryption key</p>
<p>使用对称加密密钥传输数据</p>
</li>
</ul>
<p><img src="19.73.webp" alt="webp"></p>
<h4 id="system-software-invoke" tabindex="-1" id="System-Software-Invoke">System Software Invoke</h4>
<p>系统软件调用</p>
<ul>
<li>
<p>Modify the DirectX kernel and change the execution flow of the rendering function</p>
<p>修改 DirectX 内核并更改渲染函数的执行流程</p>
</li>
<li>
<p>Can force the rendering engine to modify the occlusion relationship</p>
<p>可以强制渲染引擎修改遮挡关系</p>
</li>
<li>
<p>See the movement of the enemy behind the wall</p>
<p>看墙后敌人的动向</p>
</li>
</ul>
<p><img src="19.74.webp" alt="webp"></p>
<h4 id="valve-anti-cheat-and-easy-anti-cheat" tabindex="-1" id="Valve-Anti-Cheat-and-Easy-Anti-Cheat">Valve Anti-Cheat and Easy Anti-Cheat</h4>
<p>阀门防作弊和简易防作弊</p>
<ul>
<li>
<p>Detects malicious behavior caused by any file conflicts while interacting with the game</p>
<p>检测与游戏交互时由任何文件冲突引起的恶意行为</p>
</li>
<li>
<p>Stops the player from playing the game at all</p>
<p>完全阻止玩家玩游戏</p>
</li>
<li>
<p>Prevents any illegal modifications and configuration changes that enable the use of exploits in a game</p>
<p>防止任何非法修改和配置更改，从而在游戏中使用漏洞</p>
</li>
</ul>
<p><img src="19.75.webp" alt="webp"></p>
<h4 id="ai-cheat" tabindex="-1" id="AI-Cheat">AI Cheat</h4>
<p>AI 作弊</p>
<ul>
<li>
<p>All platforms</p>
<p>所有平台</p>
</li>
<li>
<p>No code modification required</p>
<p>无需修改代码</p>
</li>
<li>
<p>Independent from the game</p>
<p>独立于游戏</p>
</li>
<li>
<p>Game screen</p>
<p>游戏画面</p>
</li>
<li>
<p>Target detection</p>
<p>目标检测</p>
</li>
<li>
<p>Move cursor</p>
<p>移动光标</p>
</li>
<li>
<p>Fire</p>
<p>开火</p>
</li>
</ul>
<p><img src="19.76.webp" alt="webp"></p>
<h4 id="rich-ai-middlewares" tabindex="-1" id="Rich-AI-Middlewares">Rich AI Middlewares</h4>
<p>丰富的 AI 中间件</p>
<ul>
<li>
<p>Real-Time Object Detection. YOLO V5, V7…</p>
<p>实时目标检测。YOLO V5，V7…</p>
</li>
<li>
<p>Skeleton based Action recognition</p>
<p>基于骨架的动作识别</p>
</li>
</ul>
<p><img src="19.77.webp" alt="webp"></p>
<h4 id="counter-strike%3A-overwatch" tabindex="-1" id="Counter-Strike-Overwatch">Counter-Strike: Overwatch</h4>
<p>反恐精英：守望先锋</p>
<ul>
<li>
<p>The system is based on other players reviewing footage from players that are suspected of cheating</p>
<p>该系统基于其他玩家查看涉嫌作弊的玩家的录像</p>
</li>
<li>
<p>Many reviewers are looking at the same cases and the majority decide whether the suspect was cheating or not</p>
<p>许多审查人员正在审查同样的案件，大多数人决定嫌疑人是否作弊</p>
</li>
</ul>
<p><img src="19.78.webp" alt="webp"></p>
<p>Passing judgement after reviewing evidence in Counter Strike: Global Offensive’s Overwatch system</p>
<p>在《反恐精英：全球攻势的守望先锋》系统中审查证据后作出判断</p>
<h4 id="statistic-based-system" tabindex="-1" id="Statistic-based-System">Statistic-based System</h4>
<p>基于统计的系统</p>
<ul>
<li>
<p>Collect the user’s game information, such as victory and critical hit rate</p>
<p>收集用户的游戏信息，如胜利和暴击率</p>
</li>
<li>
<p>Compare your own historical data and some thresholds rules or from other player’s reports to mark players</p>
<p>比较您自己的历史数据和一些阈值规则或其他玩家的报告，以标记玩家</p>
</li>
<li>
<p>Check manually to confirm whether they cheat</p>
<p>手动检查以确认他们是否作弊</p>
</li>
</ul>
<p><img src="19.79.webp" alt="webp"></p>
<h4 id="detecting-known-cheat-program" tabindex="-1" id="Detecting-Known-Cheat-Program">Detecting Known Cheat Program</h4>
<p>检测已知作弊程序</p>
<ul>
<li>
<p>A proper anti-cheat program should have a way to scan the user’s computer for known cheating programs based on various signatures</p>
<p>一个合适的反作弊程序应该有一种方法，可以根据各种签名扫描用户的计算机，寻找已知的作弊程序</p>
</li>
<li>
<p>The simplest method can simply entail comparing hashes or process names</p>
<p>最简单的方法可能只是比较哈希或进程名称</p>
</li>
</ul>
<p><img src="19.80.webp" alt="webp"></p>
<h3 id="build-a-scalable-world" tabindex="-1" id="Build-a-Scalable-World">Build a Scalable World</h3>
<p>构建一个可扩展的世界</p>
<h4 id="scalable-game-servers" tabindex="-1" id="Scalable-Game-Servers">Scalable Game Servers</h4>
<p>可扩展游戏服务器</p>
<p><strong>Zoning</strong></p>
<p><strong>分区</strong></p>
<ul>
<li>
<p>Distribute large player numbers in a large world</p>
<p>在广阔的世界中分配大量玩家</p>
</li>
<li>
<p>Distribution might be uneven</p>
<p>分布可能不均匀</p>
</li>
</ul>
<p><strong>Instancing</strong></p>
<p><strong>实例化</strong></p>
<ul>
<li>
<p>Run a large number of game areas independently in parallel</p>
<p>并行独立运行大量游戏区域</p>
</li>
<li>
<p>Reduce congestion/competition</p>
<p>减少拥堵 / 竞争</p>
</li>
</ul>
<p><strong>Replication</strong></p>
<p><strong>同步</strong></p>
<ul>
<li>
<p>Allows high user density</p>
<p>允许高用户密度</p>
</li>
<li>
<p>E.g. high density PVP games</p>
<p>例如高密度 PVP 游戏</p>
</li>
</ul>
<h4 id="zoning---seamless-zones" tabindex="-1" id="Zoning-Seamless-Zones">Zoning - Seamless Zones</h4>
<p>分区-无缝分区</p>
<ul>
<li>
<p>Players are reasonably distributed in a large world</p>
<p>玩家在广阔的世界中分布合理</p>
</li>
<li>
<p>The client only connects to one responsible server</p>
<p>客户端只连接到一个负责的服务器</p>
</li>
<li>
<p>Cross border: auto transfer client to another server</p>
<p>跨境：自动将客户端转移到另一台服务器</p>
</li>
</ul>
<p><img src="19.81.webp" alt="webp"></p>
<p><strong>Zone Border</strong></p>
<p><strong>区域边界</strong></p>
<p>Smooth experience:</p>
<p>流畅体验：</p>
<ul>
<li>
<p>Border width &gt;= max AOI radius</p>
<p>边框宽度 &gt;= 最大 AOI 半径</p>
</li>
</ul>
<p>But how to make them interact?</p>
<p>但是如何让它们互动呢？</p>
<p><img src="19.82.webp" alt="webp"></p>
<h4 id="zone-border---entities" tabindex="-1" id="Zone-Border-Entities">Zone Border - Entities</h4>
<p>区域边界-实体</p>
<p><strong>Active Entity</strong></p>
<p><strong>活跃实体</strong></p>
<ul>
<li>
<p>Resides in connected zoned server (authority)</p>
<p>驻留在已连接的分区服务器（权限）中</p>
</li>
<li>
<p>Has a ghost agent in other zones</p>
<p>在其他区域有幽灵特工</p>
</li>
<li>
<p>Can see ghost entities in another zone</p>
<p>可以在另一个区域中看到幽灵实体</p>
</li>
</ul>
<p><strong>Ghost Entity</strong></p>
<p><strong>幽灵实体</strong></p>
<ul>
<li>
<p>Also called shadow entity</p>
<p>也称为阴影实体</p>
</li>
<li>
<p>Is an agent entity owned by another zone</p>
<p>代理实体是否由另一个区域拥有</p>
</li>
<li>
<p>Receive updates from original entity</p>
<p>接收来自原始实体的更新</p>
</li>
</ul>
<p><img src="19.83.webp" alt="webp"></p>
<p><strong>Cross Border: A -&gt; B</strong></p>
<p><strong>跨境：A-&gt;B</strong></p>
<ol>
<li>
<p>Before move</p>
<p>移动前</p>
<ul>
<li>
<p>An active entity in zone A</p>
<p>A 区中的活动实体</p>
</li>
</ul>
</li>
<li>
<p>Near boundary (A)</p>
<p>近边界（A）</p>
<ul>
<li>
<p>Active in A; Ghost in B</p>
<p>活跃在 A；鬼魂在 B</p>
</li>
</ul>
</li>
<li>
<p>At boundary</p>
<p>边界处</p>
<ul>
<li>
<p>The entity has been transferred to zone B</p>
<p>实体已转移到 B 区</p>
</li>
</ul>
</li>
<li>
<p>Near boundary (B)</p>
<p>边界附近（B）</p>
<ul>
<li>
<p>Active in B; Ghost in A</p>
<p>活跃于 B；鬼魂在 A</p>
</li>
</ul>
</li>
<li>
<p>Beyond boundary (B)</p>
<p>边界之外（B）</p>
<ul>
<li>
<p>Removedfrom zone A</p>
<p>从 A 区移除</p>
</li>
</ul>
</li>
</ol>
<p><img src="19.84.webp" alt="webp"></p>
<h4 id="replication" tabindex="-1" id="Replication">Replication</h4>
<p>同步</p>
<ul>
<li>
<p>Cooperatively process same world zone</p>
<p>合作处理同一世界区</p>
</li>
<li>
<p>Entity updates are distributed among servers</p>
<p>实体更新分布在服务器之间</p>
</li>
<li>
<p>Each server creates its own active entities</p>
<p>每个服务器都创建自己的活动实体</p>
</li>
<li>
<p>Updates to active entities will be auto replicated to all remaining servers (as Ghost)</p>
<p>对活动实体的更新将自动复制到所有剩余的服务器（作为 Ghost）</p>
</li>
</ul>
<p><img src="19.85.webp" alt="webp"></p>
<h4 id="scalable-game-servers--combination" tabindex="-1" id="Scalable-Game-Servers-Combination">Scalable Game Servers -Combination</h4>
<p><img src="19.86.webp" alt="webp"></p>
<h3 id="references-1" tabindex="-1" id="References-2">References</h3>
<h4 id="replicate-character-movement" tabindex="-1" id="Replicate-Character-Movement">Replicate Character Movement</h4>
<ul>
<li>Replicating Chaos: Vehicle Replication in ‘Watch Dogs 2’, Matt Delbosc, Ubisoft Toronto, GDC 2017: <a target="_blank" rel="noopener" href="https://www.gdcvault.com/play/1024597/Replicating-Chaos-Vehicle-Replication-in">https://www.gdcvault.com/play/1024597/Replicating-Chaos-Vehicle-Replication-in</a></li>
<li>“Believable dead reckoning for networked games.”, Murphy, Curtiss, and E. Lengyel, Game Engine Gems 2 (2011) : 307-328. <a target="_blank" rel="noopener" href="https://www.researchgate.net/publication/293809946_Believable_Dead_Reckoning_for_Networked_Games">https://www.researchgate.net/publication/293809946_Believable_Dead_Reckoning_for_Networked_Games</a></li>
<li>Client-side Interpolation:<a target="_blank" rel="noopener" href="https://docs-multiplayer.unity3d.com/netcode/0.1.0/learn/clientside_interpolation/index.html">https://docs-multiplayer.unity3d.com/netcode/0.1.0/learn/clientside_interpolation/index.html</a></li>
<li>Source Multiplayer Networking:
<a target="_blank" rel="noopener" href="https://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking">https://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking</a></li>
</ul>
<h4 id="lag-mitigation" tabindex="-1" id="Lag-Mitigation">Lag Mitigation</h4>
<ul>
<li>Latency Compensating Methods in Client/Server In-game Protocol Design and Optimization, Yahn W. Bernier: <a target="_blank" rel="noopener" href="https://www.gamedevs.org/uploads/latency-compensation-in-client-server-protocols.pdf">https://www.gamedevs.org/uploads/latency-compensation-in-client-server-protocols.pdf</a></li>
<li>Valorant’s netcode:<a target="_blank" rel="noopener" href="https://technology.riotgames.com/news/peeking-valorants-netcode">https://technology.riotgames.com/news/peeking-valorants-netcode</a></li>
<li>Source Multiplayer Networking, valve developer community: <a target="_blank" rel="noopener" href="https://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking">https://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking</a></li>
<li>Implementation and Evaluation of Hit Registration in Networked First Person Shooters, Jonathan Lundgren:<a target="_blank" rel="noopener" href="https://liu.diva-portal.org/smash/get/diva2:1605200/FULLTEXT01.pdf">https://liu.diva-portal.org/smash/get/diva2:1605200/FULLTEXT01.pdf</a></li>
<li>How It Works: Lag compensation and Interp in CS:GO:<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=6EwaW2iz4iA&amp;ab_channel=DevinDTV">https://www.youtube.com/watch?v=6EwaW2iz4iA&amp;ab_channel=DevinDTV</a></li>
</ul>
<h4 id="mmog-network-architecture-1" tabindex="-1" id="MMOG-Network-Architecture-2">MMOG Network Architecture</h4>
<ul>
<li>
<p>Intro to Databases in Games: How to Use Them in Games and Game Development -AWS Online Tech Talks: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=7HppNxu_hdA">https://www.youtube.com/watch?v=7HppNxu_hdA</a></p>
</li>
<li>
<p>Massively multiplayer online game, WIKI: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Massively_multiplayer_online_game">https://en.wikipedia.org/wiki/Massively_multiplayer_online_game</a></p>
</li>
<li>
<p>Consistent Hashing and Random Trees:</p>
</li>
<li>
<p>Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web: <a target="_blank" rel="noopener" href="https://dl.acm.org/doi/pdf/10.1145/258533.258660">https://dl.acm.org/doi/pdf/10.1145/258533.258660</a></p>
</li>
<li>
<p>Consistent hashing:<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Consistent_hashing">https://en.wikipedia.org/wiki/Consistent_hashing</a></p>
</li>
<li>
<p>Fowler–Noll–Vo hash function: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function">https://en.wikipedia.org/wiki/Fowler–Noll–Vo_hash_function</a></p>
</li>
<li>
<p>Performance Testing Methodology: <a target="_blank" rel="noopener" href="http://hosteddocs.ittoolbox.com/questnolg22106java.pdf">http://hosteddocs.ittoolbox.com/questnolg22106java.pdf</a></p>
</li>
<li>
<p>Glinka, <a target="_blank" rel="noopener" href="http://F.et">F.et</a> al. (2008) ‘High-Level Development of Multiserver Online Games’, International Journal of Computer Games Technology,2008(327387). Available at: <a target="_blank" rel="noopener" href="https://downloads.hindawi.com/journals/ijcgt/2008/327387.pdf">https://downloads.hindawi.com/journals/ijcgt/2008/327387.pdf</a></p>
</li>
<li>
<p>Alibaba Cloud MMO Gaming Solution Architecture: <a target="_blank" rel="noopener" href="https://www.alibabacloud.com/blog/593877">https://www.alibabacloud.com/blog/593877</a></p>
</li>
</ul>
<h4 id="bandwidth-optimization-1" tabindex="-1" id="Bandwidth-Optimization-2">Bandwidth Optimization</h4>
<ul>
<li>Replication in network games: Bandwidth (Part 4): <a target="_blank" rel="noopener" href="https://0fps.net/2014/03/09/replication-in-network-games-bandwidth-part-4/">https://0fps.net/2014/03/09/replication-in-network-games-bandwidth-part-4/</a></li>
<li>Introducing Time Dilation: <a target="_blank" rel="noopener" href="https://www.eveonline.com/news/view/introducing-time-dilation-tidi">https://www.eveonline.com/news/view/introducing-time-dilation-tidi</a></li>
<li>Glazer, J. and Madhav, S. (2016) Multiplayer Game Programming: Architecting Networked Games. New York: Addison-Wesley</li>
<li>Managing and Mining Multiplayer Online Games for the Summer Semester 2017: <a target="_blank" rel="noopener" href="https://www.dbs.ifi.lmu.de/Lehre/mmmo/sose17/slides/MMMO-2-Core_1.pdf">https://www.dbs.ifi.lmu.de/Lehre/mmmo/sose17/slides/MMMO-2-Core_1.pdf</a></li>
<li>Handling large amounts of players: <a target="_blank" rel="noopener" href="https://mmo-blueprint.com/handling-large-amounts-of-players/?i=1">https://mmo-blueprint.com/handling-large-amounts-of-players/?i=1</a></li>
<li>Zinx 应用-MMO 游戏案例: <a target="_blank" rel="noopener" href="https://github.com/aceld/zinx">https://github.com/aceld/zinx</a></li>
<li>KBEngine: <a target="_blank" rel="noopener" href="https://github.com/kbengine/kbengine">https://github.com/kbengine/kbengine</a></li>
</ul>
<h4 id="anti-cheat" tabindex="-1" id="Anti-Cheat">Anti-Cheat</h4>
<ul>
<li>
<p>Cheating in online games, WIKI: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cheating_in_online_games">https://en.wikipedia.org/wiki/Cheating_in_online_games</a></p>
</li>
<li>
<p>The Day FPS Games Died, 2021.07: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=revk5r5vqxA">https://www.youtube.com/watch?v=revk5r5vqxA</a></p>
</li>
<li>
<p>警惕 AI 外挂, LYi, 2021.08: <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Lq4y1M7E2">https://www.bilibili.com/video/BV1Lq4y1M7E2</a></p>
</li>
<li>
<p>YOLOv7: Trainable bag-of-freebies sets new state-of-the-art for real-time object detectors, Chien-Yao Wang, Alexey Bochkovskiy, Hong-Yuan Mark Liao, 2022.07: <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2207.02696">https://arxiv.org/abs/2207.02696</a></p>
</li>
<li>
<p>MarI/O -Machine Learning for Video Games, SethBling: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=qv6UVOQ0F44">https://www.youtube.com/watch?v=qv6UVOQ0F44</a></p>
</li>
<li>
<p>Comparative Study of Anti-cheat Methods in Video Games, Samuli Lehtonen, 2020.3:<a target="_blank" rel="noopener" href="https://helda.helsinki.fi/bitstream/handle/10138/313587/Anti_cheat_for_video_games_final_07_03_2020.pdf">https://helda.helsinki.fi/bitstream/handle/10138/313587/Anti_cheat_for_video_games_final_07_03_2020.pdf</a></p>
</li>
<li>
<p>游戏外挂攻防艺术, 徐胜, 2013</p>
</li>
<li>
<p>Python Plays Grand Theft Auto 5 -Reboot, Harrison: <a target="_blank" rel="noopener" href="https://github.com/Sentdex/pygta5">https://github.com/Sentdex/pygta5</a></p>
</li>
</ul>
<h4 id="citation" tabindex="-1" id="Citation">Citation</h4>
<ul>
<li>
<p>Maze War (1978) -First Person Shooter History -Ep01: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=ZjY5s_05Qlw">https://www.youtube.com/watch?v=ZjY5s_05Qlw</a></p>
</li>
<li>
<p>How It Works: Lag compensation and Interp in CS:GO:<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=6EwaW2iz4iA&amp;ab_channel=DevinDTV">https://www.youtube.com/watch?v=6EwaW2iz4iA&amp;ab_channel=DevinDTV</a></p>
</li>
<li>
<p>World of Warcraft (2021) -Gameplay (PC UHD) [4K60FPS]: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=d26Kl98_qo8">https://www.youtube.com/watch?v=d26Kl98_qo8</a></p>
</li>
<li>
<p>Guild Wars 2’s greatest STRENGTH is also its WEAKNESS: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=jGcQDhSPLHM">https://www.youtube.com/watch?v=jGcQDhSPLHM</a></p>
</li>
<li>
<p>FINAL FANTASY XIV: <a target="_blank" rel="noopener" href="https://jp.finalfantasyxiv.com">https://jp.finalfantasyxiv.com</a></p>
</li>
<li>
<p>WHY PLAY EVE ONLINE in 2022? -And why this is one of my favorite games: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=j2t_XPDOIFc">https://www.youtube.com/watch?v=j2t_XPDOIFc</a></p>
</li>
<li>
<p>World of Warcraft: Cataclysm Login Screen: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=isCsAEwpIOY">https://www.youtube.com/watch?v=isCsAEwpIOY</a></p>
</li>
<li>
<p>10 Best MMOs To Play In 2022: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=W0rvIv6diVU">https://www.youtube.com/watch?v=W0rvIv6diVU</a></p>
</li>
<li>
<p>Planetside 2: <a target="_blank" rel="noopener" href="https://www.planetside2.com/home">https://www.planetside2.com/home</a></p>
</li>
<li>
<p>Planetside 2: Things Just Got Harder: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=HTN-yc5x0pA">https://www.youtube.com/watch?v=HTN-yc5x0pA</a></p>
</li>
<li>
<p>15 Years of WoW vs 1 Year of FFXIV: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=5T-mcLYBnKc">https://www.youtube.com/watch?v=5T-mcLYBnKc</a></p>
</li>
<li>
<p>MUD1 (1978) -First MUD game:<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=9Gep3LwLKWk">https://www.youtube.com/watch?v=9Gep3LwLKWk</a></p>
</li>
</ul>

            </article>
            
	<div class="rightside">
	
		<div class="rightside-button" id="js-aside">
			<span>
				<img no-lazy src="/images/icon/aside.png" class="rightside-button-icon" alt="Icon">
			</span>
		</div>
		<script>
			$("#js-aside").click(function () {
				onShowAsideButton();
			});
		</script>
	
	<div class="rightside-button" id="js-toggle_theme">
		<span>
			<img no-lazy src="/images/icon/toggle_theme.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	
<script src="/js/plugins/goto_position.js"></script>

	
	<div class="rightside-button" id="js-go_top">
		<span>
			<img no-lazy src="/images/icon/go_top.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>
	<div class="rightside-button" id="js-go_bottom">
		<span>
			<img no-lazy src="/images/icon/go_bottom.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	<script>
		setToggleThemeButtonListener();
	</script>
	<script>
		$('#js-go_top')
		.gotoPosition( {
			speed: 300,
			target: 'top',
		} );
		$('#js-go_bottom')
		.gotoPosition( {
			speed: 300,
			target: 'bottom',
		} );
	</script>
</div>


<div class="post-bottom">
    
        <div class="post-paging">     
            <div class="post-paging-last">
                
                    <a href="/posts/Course-%E6%96%87%E6%9C%AC%E8%AF%86%E5%88%AB%20OCR%20%E7%A5%9E%E5%99%A8%20MMOCR/">
                        上一篇：Course-文本识别 OCR 神器 MMOCR
                    </a>
                
            </div>
            <div class="post-paging-next">
                
                    <a href="/posts/Unity-HDRP/">
                        下一篇：Unity-HDRP
                    </a>
                
            </div>
        </div>
    
    
    
        
            <div class="giscus comments"></div>
            <script>
                var scriptElement = document.createElement('script');
                scriptElement.src = 'https://giscus.app/client.js';
                scriptElement.setAttribute('data-repo', 'GZ-Metal-Cell/GZ-Metal-Cell.github.io');
                scriptElement.setAttribute('data-repo-id', 'R_kgDOIHLEOQ');
                scriptElement.setAttribute('data-category', 'Announcements');
                scriptElement.setAttribute('data-category-id', 'DIC_kwDOIHLEOc4CcVwP');
                scriptElement.setAttribute('data-mapping', 'title');
                scriptElement.setAttribute('data-strict', '1');
                scriptElement.setAttribute('data-reactions-enabled', '');
                scriptElement.setAttribute('data-emit-metadata', '0');
                scriptElement.setAttribute('data-input-position', 'bottom');
                scriptElement.setAttribute('data-theme', localStorage.getItem('theme') === 'light' ? 'light' : 'dark_high_contrast');
                scriptElement.setAttribute('data-lang', 'zh-CN');
                
                scriptElement.setAttribute('crossorigin', 'anonymous');
                scriptElement.async = true;
                document.head.appendChild(scriptElement);
            </script>
        
    
</div>
        </div>
    </main>
    
        <aside class="main-aside">
    
<script src="/js/widgets/aside.js"></script>

    <script>
        showAside();
    </script>

    <div class="aside-top">
        <div class="aside-top-about aside-card">
            <a href="/about" class="aside-top-about-portrait">
                <img no-lazy src="/about/portrait.png" alt="Q">
            </a>
            <div class="aside-top-about-info">
                <span class="author"> Zi-Zi</span>
                <span class="description">不以物喜，不以己悲。</span>
            </div>              
            <div class="aside-top-about-site">
                <a href="/categories" class="aside-top-about-site-item">
                    <span class="title">类别</span>
                    <span class="count">5</span>
                </a>
                <a href="/tags" class="aside-top-about-site-item">
                    <span class="title">标签</span>
                    <span class="count">121</span>
                </a>
                <a href="/archives" class="aside-top-about-site-item">
                    <span class="title">归档</span>
                    <span class="count">436</span>
                </a>
            </div>
            <div class="aside-top-about-contact">
                
                    
                        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
                            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
                            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
                            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
                            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
                        </a>
                    
                
            </div>
        </div> 

        
            <div class="aside-top-series aside-card">
                <ol class="aside-top-series-content">
                    
                    
                    
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Basic Elements/">
                                                <span class="text">GAMES104-Basic Elements</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Rendering/">
                                                <span class="text">GAMES104-Rendering</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Animation/">
                                                <span class="text">GAMES104-Animation</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Physics/">
                                                <span class="text">GAMES104-Physics</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Effects/">
                                                <span class="text">GAMES104-Effects</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Tool Chains/">
                                                <span class="text">GAMES104-Tool Chains</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Gameplay/">
                                                <span class="text">GAMES104-Gameplay</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        
                                        <li class="series-item active">
                                            <a class="series-link active" href="/posts/GAMES104-Online Gaming Architecture/">
                                                <span class="text">GAMES104-Online Gaming Architecture</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Data-Oriented Programming and Job System/">
                                                <span class="text">GAMES104-Data-Oriented Programming and Job System</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-Dynamic Global Illumination and Lumen/">
                                                <span class="text">GAMES104-Dynamic Global Illumination and Lumen</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                                    
                                    
                                    
                                        <li class="series-item">
                                            <a class="series-link" href="/posts/GAMES104-GPU-Driven Geometry Pipeline-Nanite/">
                                                <span class="text">GAMES104-GPU-Driven Geometry Pipeline-Nanite</span>
                                            </a>
                                        </li>
                                    
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                        
                        
                            
                                
                            
                        
                    
                </ol>
                <div class="aside-top-series-title">
                    <h1>
                        <a href="/tags/GAMES104">标签：GAMES104</a>
                    </h1>
                    <span id="serial-number">8/11</span>
                </div>
            </div>
            <script>
                activeSeriesItem();
            </script> 
        
    </div>

    <div class="aside-bottom">
        
            <script>
                
                    const tocCollapsed = true;
                
                
                    const tocDepth = 3;
                
                var headerString = '';
                for (let i = 1; i <= tocDepth; i++) {
                    if (i === 1) {
                        headerString += 'h1';
                    } else {
                        headerString += ', h' + i;
                    }
                }
                hbeToc();
            </script>
            <div class="aside-bottom-toc aside-card">
                <div class="aside-bottom-toc-title">
                    <h1>目录</h1>
                    <span class="toc-percentage"></span>
                </div>
                <ol class="aside-bottom-toc-content"></ol>
            </div>
        
    </div>
</aside>
    
</div>
		<footer>
	<div class="content">
		
			<span>©2022-2025&nbsp;By&nbsp;<a href="/about">Zi-Zi</a>.</span>
		
		<span><a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> theme by <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell/hexo-theme-quieter">Quieter</a>.</span>
		
			<span style="display: flex;">
				<img no-lazy alt="icp" src="/images/icp_icon.png" style="width: 16px; height: 16px;">
				<a href="https://icp.gov.moe/?keyword=20241647" target="_blank">萌 ICP 备 20241647 号</a>
			</span>
		
	</div>

	
<script src="/js/plugins/ref.js"></script>

	
<script src="/js/plugins/highlight_tools.js"></script>

	<script>
		const  COPY_ICON = "/images/icon/copy.png";
		const CLOSE_CODE_BLOCK_ICON = "/images/icon/close_code_block.png";
		const HIGHLIGHT_SHRINK = "";
		const HIGHLIGHT_HEIGHT_LIMIT = "";
	</script>

	
	
	<!-- Analytics -->

    
        <!-- Busuanzi Analytics -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?e57cf62289f84322ebff116e8b3d343e";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    


	

	
		
			
				<link rel="stylesheet" href="/css/plugins/katex/katex.min.css">
				<script src="/js/plugins/copy-tex.js"></script>
			
		
	

    
		
<link rel="stylesheet" href="/css/plugins/textIndent.css">

		
<script src="/js/plugins/textIndent.js"></script>

	

	
	
	
		<script>
			if (typeof init === 'function') {
				init();
			}
		</script>
	

	
		
	

	
		
	

	<!--
		
<script src="/js/plugins/jquery.pjax.min.js"></script>

		<script>
			$(document).pjax('a[target!=_blank]', 'main', {
				fragment: 'main',
				timeout: 8000
			});

			$(document).on('pjax:complete', function() {
			});
		</script> 
	-->
	<script>
		console.log('\n %c Hexo-Quieter 主题 %c https://github.com/GZ-Metal-Cell/hexo-theme-quieter \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
	</script>
</footer>
	</body>

	<!-- Hexo-Quieter 主题  https://github.com/GZ-Metal-Cell/hexo-theme-quieter -->
</html>

