<!DOCTYPE html>
<html lang=zh-CN data-theme="light">
	
<script src="/js/plugins/toggleTheme.js"></script>

	<script>
		setTheme();
	</script>
	<head>
		
<title>Work-OCPP 1.6 | Zi-Zi's Journey</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/images/icon/favicon.ico">
<link href="/css/plugins/print.css" media="print" rel="stylesheet" />

<link rel="stylesheet" href="/css/index.css">



<meta name="keywords" content="Figma,">
<meta name="description" content="学习汽车充电桩通信协议！">



<script src="/js/plugins/jquery.min.js"></script>


<script src="/js/plugins/hljs.min.js"></script>


<script src="/js/plugins/init.js"></script>


<script src="/js/plugins/hide.js"></script>


<script src="/js/plugins/tabs.js"></script>



    



    
<script src="/js/plugins/alert-title.js"></script>

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-base.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-dark-class.css">

    
<link rel="stylesheet" href="/css/plugins/github-alerts/github-colors-light.css">






    

	<meta name="generator" content="Hexo 6.1.0"></head>

	<body>
		<header class="sticky-header">
	<nav>
		<div class="nav-left">
			<a href="/" class="logo">
				<img no-lazy src="/images/headers_icon/logo.webp" alt="Quieter">
			</a>
			<ul class="breadcrumb" id="breadcrumb"></ul>
		</div>
		<div class="nav-right">
			<ul>
				
					<li>
						<a href="/">
						  主页
						</a>
					</li>
				
					<li>
						<a href="/categories">
						  类别
						</a>
					</li>
				
					<li>
						<a href="/tags">
						  标签
						</a>
					</li>
				
					<li>
						<a href="/archives">
						  归档
						</a>
					</li>
				
					<li>
						<a href="/galleries">
						  相册
						</a>
					</li>
				
					<li>
						<a href="/links">
						  链接
						</a>
					</li>
				
					<li>
						<a href="/about">
						  关于
						</a>
					</li>
								  
			</ul>
		</div>
		<div class="nav-right-close">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
				<path fill="none" d="M0 0h24v24H0z" />
				<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
			</svg>
		</div>

		<div class="sidebar">
    <div class="topo">
        <p>Zi-Zi's Journey</p>
    </div>
    <ul>
        
        <li>
            <a href="/">
                主页
            </a>
        </li>
        
        <li>
            <a href="/categories">
                类别
            </a>
        </li>
        
        <li>
            <a href="/tags">
                标签
            </a>
        </li>
        
        <li>
            <a href="/archives">
                归档
            </a>
        </li>
        
        <li>
            <a href="/galleries">
                相册
            </a>
        </li>
        
        <li>
            <a href="/links">
                链接
            </a>
        </li>
        
        <li>
            <a href="/about">
                关于
            </a>
        </li>
        
    </ul>
    <div class="sidebar-footer">
        
        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
        </a>
        
        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
        </a>
        
    </div>
</div>
<div class='shelter'>
    <script>
        $(function() {
            $('.nav-right-close > svg').click(function() {
                $('.sidebar').animate({
                    right: "0"
                }, 500);
                $('.shelter').fadeIn("slow");
            
                var element = $('.topo');
                element.addClass('custom-style');
            
                var links = null;
                if ("") {
                    links = "".split(',');
                } else {
                    links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
                }
            
                var randomLink = links[Math.floor(Math.random() * links.length)];
                element.css('background-image', "url('" + randomLink + "')");
            });
          
            $('.shelter').click(function(e) {
                $('.sidebar').animate({
                    right: "-100%"
                }, 500);
                $('.shelter').fadeOut("slow");
            });
        });      
    </script>
</div>
	</nav>

	
		<div class="header-background"></div>
	

	<script>
		const name = 'post';
		const ul = document.querySelectorAll('.nav-right ul')[0];
		const lis = ul.querySelectorAll('li');

		if (name == 'home') {
			lis[0].classList.add('select');
		} else {
			for (let i = 0; i < lis.length; i++) {
				const li = lis[i];
				const a = li.querySelector('a');
				if (name === a.href.split('/')[3]) {
					li.classList.add('select');
				}
			}
		}
	</script>
	
	<script>
		var element = document.querySelector('.header-background');
		if(element) {
			element.classList.add('custom-style');
			var links = null;
			if("")
			{
				links = "".split(',');
			} else
			{
				links = "/images/random_top_img/01.webp,/images/random_top_img/02.webp,/images/random_top_img/03.webp,/images/random_top_img/04.webp,/images/random_top_img/05.webp,/images/random_top_img/06.webp,/images/random_top_img/07.webp,/images/random_top_img/08.webp,/images/random_top_img/09.webp,/images/random_top_img/10.webp,/images/random_top_img/11.webp,/images/random_top_img/12.webp,/images/random_top_img/13.webp,/images/random_top_img/14.webp,/images/random_top_img/15.webp,/images/random_top_img/16.webp,/images/random_top_img/17.webp,/images/random_top_img/18.webp,/images/random_top_img/19.webp,/images/random_top_img/20.webp,/images/random_top_img/21.webp,/images/random_top_img/22.webp,/images/random_top_img/23.webp,/images/random_top_img/24.webp,/images/random_top_img/25.webp,/images/random_top_img/26.webp,/images/random_top_img/27.webp,/images/random_top_img/28.webp,/images/random_top_img/29.webp,/images/random_top_img/30.webp,/images/random_top_img/31.webp,/images/random_top_img/32.webp,/images/random_top_img/33.webp,/images/random_top_img/34.webp,/images/random_top_img/35.webp,/images/random_top_img/36.webp,/images/random_top_img/37.webp,/images/random_top_img/38.webp,/images/random_top_img/39.webp,/images/random_top_img/40.webp,/images/random_top_img/41.webp,/images/random_top_img/42.webp,/images/random_top_img/43.webp,/images/random_top_img/44.webp,/images/random_top_img/45.webp,/images/random_top_img/46.webp,/images/random_top_img/47.webp,/images/random_top_img/48.webp,/images/random_top_img/49.webp,/images/random_top_img/50.webp,/images/random_top_img/51.webp,/images/random_top_img/52.webp,/images/random_top_img/53.webp,/images/random_top_img/54.webp,/images/random_top_img/55.webp,/images/random_top_img/56.webp,/images/random_top_img/57.webp".split(',');
			}
			var randomLink = links[Math.floor(Math.random() * links.length)];
			element.style.backgroundImage = "url('" + randomLink + "')";
		}
	</script>

	
<script src="/js/plugins/breadcrumb.js"></script>

	<script>
		var menus_title = [];
		
			menus_title.push({home: '主页'});
		
			menus_title.push({categories: '类别'});
		
			menus_title.push({tags: '标签'});
		
			menus_title.push({archives: '归档'});
		
			menus_title.push({galleries: '相册'});
		
			menus_title.push({links: '链接'});
		
			menus_title.push({about: '关于'});
		
		
			
				postsBreadcrumb(
					document.getElementById('breadcrumb'),
					"类别",
					"/categories",
					"学习",
					"/categories/学习",
					1
				);
			
		
	</script>
</header>

<div class="main-wrapper">
    <main class="post">
        <header class="main-header">
	
		
			
				
<link rel="stylesheet" href="/css/plugins/fancybox.css">

				
<script src="/js/plugins/fancybox.umd.js"></script>

				
<script src="/js/plugins/fancybox.js"></script>

			
			<div class="post-header-background-content">
				<ul class="post-header-tag">
					
						
							<li><a href="/tags/Figma"><span>Figma</span></a></li>
						
					
				</ul>
				
				<h1>Work-OCPP 1.6</h1>
		
				
					<div class="post-header-desc">
						<svg t="1714702231661" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1154" xmlns:xlink="http://www.w3.org/1999/xlink"
						width="20" height="20">
						<path
							d="M778.24 117.76A46.08 46.08 0 0 1 824.32 163.84v430.08c0 8.4992-4.13696 16.01536-10.50624 20.6848l-0.24576 0.2048L587.5712 846.09024a35.84 35.84 0 0 1-61.48096-25.06752v-220.9792a46.08 46.08 0 0 1 46.08-46.08l200.94976-0.02048V168.96h-522.24v686.08H389.12c13.25056 0 24.1664 10.07616 25.47712 22.97856l0.12288 2.62144c0 14.1312-11.4688 25.6-25.6 25.6h-143.36A46.08 46.08 0 0 1 199.68 860.16V163.84A46.08 46.08 0 0 1 245.76 117.76h532.48z m-26.78784 487.38304h-174.16192v178.176l174.16192-178.176z m-45.19936-169.94304a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z m0-122.88a25.6 25.6 0 0 1 0 51.2H307.2a25.6 25.6 0 0 1 0-51.2h399.0528z"
							fill="#ffffff" p-id="1155"></path>
						</svg>
						<p>学习汽车充电桩通信协议！</p>
					</div>
				
		
				<div class="post-header-info">
					<svg t="1604839279282" class="icon" viewBox="0 0 1024 1024" version="1.1"
					xmlns="http://www.w3.org/2000/svg" p-id="2901" width="20" height="20">
						<path
							d="M513 956.3c-247.7 0-448-200.3-448-448S265.3 66.2 513 66.2s448 200.3 448 448-200.3 442.1-448 442.1z m0-830.9c-212.2 0-388.8 170.7-388.8 388.8C124.2 726.3 294.9 903 513 903c212.2 0 388.8-170.7 388.8-388.8S725.2 125.4 513 125.4z m0 430.2c-94.2 0-170.7-76.5-170.7-170.7S418.8 207.8 513 207.8s170.7 76.5 170.7 170.7S607.2 555.6 513 555.6z m0-289.1c-64.6 0-112 52.8-112 112s47.4 117.9 112 117.9 112-52.8 112-112-47.4-117.9-112-117.9z m0 689.8c-135.7 0-259-58.7-341.9-158.9l-11.8-17.8 11.8-17.8c76.5-117.9 206.2-188.5 347.8-188.5 135.7 0 265 64.6 341.9 182.6l11.8 17.8-11.8 17.8C778 897.1 648.7 956.3 513 956.3zM230.3 773.2C300.9 849.7 406.9 897 513 897c112 0 218.1-47.4 288.6-129.8-70.5-88.2-170.7-135.6-282.7-135.6s-218.1 53.3-288.6 141.6z"
							p-id="2902" fill="#ffffff"></path>
					</svg>
					<div class="post-header-info-author">
						<a href="/about">Zi-Zi</a>
					</div>
					
						<div class="post-header-info-categories">
							
								<a href="/categories/学习">学习</a>
							
						</div>
					
					<time>2025/08/22 09:12:00</time>
				</div>
		
				
					<div class="post-header-stat">
						<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve" width="20" height="20">
							<path fill="#FFFFFF" d="M187.2,165.6c0,2.6-2.1,4.7-4.7,4.7H17.5c-2.6,0-4.7-2.1-4.7-4.7s2.1-4.7,4.7-4.7h165.1
								C185.2,160.9,187.2,163,187.2,165.6z"/>
							<path fill="#FFFFFF" d="M17.5,29.7c2.6,0,4.7,2.1,4.7,4.7v131.2c0,2.6-2.1,4.7-4.7,4.7s-4.7-2.1-4.7-4.7V34.4
								C12.8,31.8,14.9,29.7,17.5,29.7z M77.9,91.5c1.8,1.8,1.8,4.8,0,6.6l-39.8,39.8c-1.9,1.8-4.9,1.7-6.6-0.2c-1.7-1.8-1.7-4.6,0-6.4
								l39.8-39.8C73.1,89.6,76,89.6,77.9,91.5z M169.9,70.2c1.6,2.1,1.1,5-0.9,6.5c0,0,0,0,0,0l-64.2,48.2c-2.1,1.5-5,1.1-6.6-0.9
								c-1.6-2.1-1.1-5,0.9-6.5c0,0,0,0,0,0l64.2-48.2C165.4,67.7,168.3,68.1,169.9,70.2L169.9,70.2z"/>
							<path fill="#FFFFFF" d="M104.6,124.5c-1.8,1.8-4.8,1.8-6.6,0L71.6,98.1c-1.8-1.8-1.8-4.8,0-6.6c1.8-1.8,4.8-1.8,6.6,0l26.3,26.3
								C106.4,119.6,106.4,122.6,104.6,124.5C104.6,124.4,104.6,124.4,104.6,124.5z"/>
						</svg>
		
						
							
<script src="/js/plugins/wordCount.js"></script>

							<p class="post-count">文字数：---</p>
						
		
						
							<p id="busuanzi_container_page_pv" style='display:none;'>阅读数：<span id="busuanzi_value_page_pv"></span></p>
						
					</div>
				
			</div>
		
	
</header>
        <div class="post-content article-container">
            <article class="post-content-info">
                <h1 id="%E8%B5%84%E6%BA%90" tabindex="-1">资源</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://openchargealliance.org/protocols/open-charge-point-protocol/#OCPP1.6">Open charge point protocol - Open Charge Alliance</a></li>
</ul>
<h1 id="%E6%AD%A3%E6%96%87" tabindex="-1">正文</h1>
<h2 id="1-scope" tabindex="-1" id="1-Scope">1 Scope</h2>
<p><img src="01.webp" alt="webp"></p>
<p>​	OCPP 是一种定义在<strong>充电桩</strong>（<strong>Charge Point</strong>）与<strong>中央系统</strong>（<strong>Central System</strong>）之间使用的协议。要求一方或另一方采取某种行动或作出某种回应。</p>
<p>​	OCPP 并未定义通信技术。任何技术都可以，只要它支持 TCP/IP 连接。</p>
<h2 id="3-introduction" tabindex="-1" id="3-Introduction">3 Introduction</h2>
<h3 id="%E6%A0%87%E5%87%86%E7%9A%84%E5%85%85%E7%94%B5%E6%B5%81%E7%A8%8B" tabindex="-1" id="标准的充电流程">标准的充电流程</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System

    CP->>CS: Authorize.req(idTag)
    CS-->>CP: Authorize.conf(idTagInfo)

    Note over CP: Start Charging
    CP->>CS: StartTransaction.req(connectorId, idTag, meterStart, timestamp, [reservationId])
    CS-->>CP: StartTransaction.conf(idTagInfo, transactionId)

    Note over CP: Charging...
    CP->>CS: Authorize.req(idTag)
    CS-->>CP: Authorize.conf(idTagInfo)

    Note over CP: Stop Charging
    CP->>CS: StopTransaction.req(meterStop, timestamp, transactionId, [reason], [idTag], [transactionData])
    CS-->>CP: StopTransaction.conf(idTagInfo)</pre>
<p>​	典型的 OCPP 充电流程时序图，包括 <strong>Authorize → StartTransaction → Charging → StopTransaction</strong>。</p>
<ul>
<li>
<p>在为电动汽车充电时，需要先对用户进行身份验证，然后才能开始充电。</p>
</li>
<li>
<p>如果用户获得授权，充电点就会通知中央系统它已开始充电。</p>
</li>
<li>
<p>当用户结束充电时，如果充电桩已经确认该用户有权限结束交易，就直接发送 <strong>StopTransaction</strong> 消息给中央系统，<strong>不要再去重新发送 Authorize 请求</strong>。</p>
<ul>
<li>如果提交的 <code>idTag</code> 与开始交易时提交的 <code>idTag</code> 相同，则充电点在停止交易前不得发送 <code>Authorize.req</code>。</li>
</ul>
</li>
</ul>
<h3 id="%E5%85%85%E7%94%B5%E6%A1%A9%E9%9C%80%E8%A6%81%E6%9B%B4%E6%96%B0%E6%97%B6" tabindex="-1" id="充电桩需要更新时">充电桩需要更新时</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System

    CP->>CS: UpdateFirmware.req(location, retrieveDate, [retries], [retryInterval])
    CS-->>CP: UpdateFirmware.conf()
    
    Note over CP: Downloading firmware...
    
    CP->>CS: FirmwareStatusNotification.req(status: Downloaded)
    CS-->>CP: FirmwareStatusNotification.conf()
    
    Note over CP: Installing...
    
    CP->>CS: FirmwareStatusNotification.req(status: Installed)
    CS-->>CP: FirmwareStatusNotification.conf()
    
    Note over CP: Reboot
    
    CP->>CS: BootNotification.req(chargePointModel, chargePointVendor, [chargeBoxSerialNumber], [chargePointSerialNumber],[firmwareVersion], [iccid], [imsi], [meterSerialNumber], [meterType])
    CS-->>CP: BootNotification.conf(currentTime, heartbeatInterval, status)</pre>
<p>​	如果充电桩需要安装新固件，中央系统会通知充电桩开始下载新固件的时间。充电桩应在下载和安装新固件的每个步骤后通知中央系统。</p>
<h3 id="%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E4%B8%8E%E7%A6%BB%E7%BA%BF%E8%A1%8C%E4%B8%BA" tabindex="-1" id="本地授权与离线行为">本地授权与离线行为</h3>
<pre class="mermaid">sequenceDiagram
    participant Charge Point
    participant Central System
    
    Charge Point->>Central System: SendLocalList.req (listVersion: 234, updateType: Full, [localAuthorizationList])
    Central System-->>Charge Point: SendLocalList.conf (status: Accepted)</pre>
<p>​	完整本地授权列表更新示例。</p>
<pre class="mermaid">sequenceDiagram
    participant Charge Point
    participant Central System
    
    Charge Point->>Central System: GetLocalListVersion.req()
    Central System-->>Charge Point: GetLocalListVersion.conf( listVersion: 234 )
    Charge Point->>Central System: SendLocalList.req( listVersion: 239, updateType: Differential, [AuthorisationData] )
    Central System-->>Charge Point: SendLocalList.conf( status: Accepted )</pre>
<p>​	差异化本地授权列表更新示例。</p>
<p>​	如果中央系统不可用，充电点是否还能工作取决于是否启用了本地授权列表 <code>localAuthorizationList</code> 以及充电点的具体配置：</p>
<ul>
<li><strong>如果启用了本地授权列表</strong>：充电点可以在中央系统不可用的情况下继续工作，因为它可以依赖保存在非易失性内存中的本地授权列表来进行授权决策。列表中的标识符状态（有效、过期、阻止或黑名单）允许充电点独立处理本地授权请求，而无需实时与中央系统通信。</li>
<li><strong>如果未启用本地授权列表</strong>：充电点将无法进行授权，因为它需要中央系统的实时响应来验证标识符。在这种情况下，充电点可能无法正常提供服务，直到中央系统恢复可用。</li>
</ul>
<p>​	此外，充电点通过 <code>LocalAuthListEnabled</code> 配置键报告和控制本地授权列表的启用状态。如果此功能未启用或配置不当，中央系统不可用将导致服务中断。因此，充电点的独立工作能力依赖于<strong>事先正确配置和维护本地授权列表</strong>。</p>
<hr>
<p><strong>授权缓存（Authorization Cache）和本地授权列表（Local Authorization List）</strong></p>
<p><strong>两者的区别</strong>：</p>
<ul>
<li>授权缓存和本地授权列表是两个独立的数据结构，逻辑上分开管理。</li>
<li>它们分别用于不同的授权处理机制，彼此之间不共享相同的标识符数据。</li>
</ul>
<p><strong>数据隔离规则</strong>：</p>
<ul>
<li>本地授权列表中已知的标识符不得被添加到授权缓存中。这确保了两者数据结构的独立性，避免重复或冲突。</li>
</ul>
<p><strong>优先级规则</strong>：</p>
<ul>
<li>如果充电点同时支持授权缓存和本地授权列表，对于相同的标识符，本地授权列表中的条目具有更高的优先级。</li>
<li>这意味着，在授权决策中，充电点会优先考虑本地授权列表中的状态（例如有效、过期等），而不是授权缓存中的状态。</li>
</ul>
<hr>
<p>这段文字描述了充电点（Charge Point）在离线状态下处理未知标识符授权的规则和相关行为：</p>
<ol>
<li>
<p><strong>离线授权的规则</strong>：</p>
<ul>
<li>当充电点离线时，可以选择允许对任何“未知”标识符（即无法通过本地授权列表或授权缓存明确授权的标识符）进行自动授权，但这取决于配置。</li>
<li>如果本地授权列表中存在标识符，且状态不是“Accepted”（例如“Invalid”、“Blocked”或“Expired”），必须拒绝这些标识符。</li>
<li>对于曾有效但因时间过去而过期的标识符，也必须拒绝。</li>
</ul>
</li>
<li>
<p><strong>未知离线授权的功能</strong>：</p>
<ul>
<li>支持未知离线授权（Unknown Offline Authorization）时，其启用状态通过配置键 <code>AllowOfflineTxForUnknownId</code> 报告（并在可能的情况下进行控制）。</li>
<li>这允许充电点在中央服务器不可用时为未知标识符提供临时授权。</li>
</ul>
</li>
<li>
<p><strong>连接恢复后的处理</strong>：</p>
<ul>
<li>一旦与中央服务器的连接恢复，充电点必须为任何离线授权的交易发送 <code>Start Transaction</code> 请求，以符合交易相关消息处理的规则。</li>
<li>如果 <code>StartTransaction.conf</code> 中的授权状态不是“Accepted”，且交易仍在进行，充电点的行为取决于 <code>StopTransactionOnInvalidId</code> 配置：
<ul>
<li><strong>若 <code>StopTransactionOnInvalidId</code> 为 true</strong>：充电点应按照 <code>Stop Transaction</code> 的正常流程停止交易，<code>Reason</code> 字段应设为 <code>DeAuthorized</code>。如果充电点能锁定充电电缆，应保持电缆锁定，直到车主出示其标识符。</li>
<li><strong>若 <code>StopTransactionOnInvalidId</code> 为 false</strong>：仅停止向车辆供电，而不完全终止交易。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>特殊情况：无效标识符处理</strong>：</p>
<ul>
<li>对于无效标识符，运营商可以选择提供最小的能量量（由可选配置键 <code>MaxEnergyOnInvalidId</code> 控制），以确保电动车（EV）能够开走。</li>
</ul>
</li>
</ol>
<p>​	总结来说，未知离线授权为离线状态下的充电点提供了一种灵活性，但有严格的拒绝规则（非“Accepted”状态或过期标识符）。连接恢复后，充电点会与中央系统同步，并根据配置决定是否终止交易或仅停止供电，特殊情况下还可提供最小能量支持。这种机制平衡了离线操作的便利性与安全性。</p>
<h3 id="%E8%83%BD%E9%87%8F%E4%BC%A0%E8%BE%93%E5%91%A8%E6%9C%9F" tabindex="-1" id="能量传输周期">能量传输周期</h3>
<p>​	这段文字是关于交易（Transaction）与能量传输周期（Energy Transfer Period）之间关系的说明性内容（informative），旨在提供背景信息而非强制性要求。以下是逐步解释：</p>
<ol>
<li>
<p><strong>能量传输周期的定义</strong>：</p>
<ul>
<li>能量传输周期是指电动车（EV）与电动车充电设备（EVSE）之间进行能量传输的一段时间。</li>
<li>在一个交易中，可能存在多个能量传输周期。</li>
</ul>
</li>
<li>
<p><strong>能量传输周期的间隔</strong>：</p>
<ul>
<li>多个能量传输周期之间可能因以下情况中断：
<ul>
<li><strong>EVSE发起的暂停</strong>：EVSE在暂停期间不提供能量传输。</li>
<li><strong>EV发起的暂停（保持连接）</strong>：EV保持与EVSE的电气连接，但不传输能量。</li>
<li><strong>EV发起的暂停（断开连接）</strong>：EV与EVSE电气断开连接。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>中央系统的推断方式</strong>：</p>
<ul>
<li>中央系统可以通过以下信息推断能量传输周期的开始和结束：
<ul>
<li>交易期间发送的 <code>MeterValues</code>（电表值）。</li>
<li>状态通知，如 <code>Charging</code>（充电中）、<code>SuspendedEV</code>（EV 暂停）、<code>SuspendedEVSE</code>（EVSE 暂停）等。</li>
</ul>
</li>
<li>然而，中央系统实现时需要考虑一些特殊情况：
<ul>
<li>某些 EV 不会进入 <code>SuspendedEV</code> 状态，它们可能继续以涓流充电（trickle charge）方式运行。</li>
<li>一些充电点可能甚至没有电表（electrical meter），无法提供精确的能量数据。</li>
</ul>
</li>
</ul>
</li>
</ol>
<pre class="mermaid">graph TD
    A[Charging Session<br>充电会话在用户或电动车首次互动时开始。这可以通过刷卡、远程启动交易、连接电缆和/或电动车、停车位占用检测器等方式触发。] --> B[Transaction<br>交易在满足所有充电条件时开始，例如电动车已连接到充电桩且用户已获得授权。]
    B --> C[Energy Offer Period<br>能源供应周期在电动车供电设备（EVSE）准备好并愿意供应能源时开始]
    C --> D[Energy Transfer Period<br>能源已传输。]
    D --> E[在能源供应周期中，可能存在电动车未充电的时期，原因可能是例如电池过热/充满或电动车内部智能充电。]
    E --> F[Energy Transfer Period<br>能源已传输。]
    F --> G[Energy Offer Suspend Period<br>在交易期间，能源供应可能因智能充电或本地平衡而暂停。]
    G --> H[Energy Offer Period]
    H --> I[Energy Transfer Period<br>能源已传输。]
    I --> J[Transaction<br>交易在充电的前提条件之一不可逆转地变为假时结束，例如当用户刷卡停止交易且停止被授权时。]
    J --> K[Session<br>会话在充电站再次可用时结束。无电缆插入，停车位空闲。]</pre>
<h3 id="%E5%85%85%E7%94%B5%E6%A1%A9%EF%BC%88charge-point%EF%BC%89%E4%B8%8E%E4%B8%AD%E5%A4%AE%E7%B3%BB%E7%BB%9F%EF%BC%88central-system%EF%BC%89%E4%B9%8B%E9%97%B4%E5%85%B3%E4%BA%8E%E4%BA%A4%E6%98%93%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF" tabindex="-1" id="充电桩（Charge-Point）与中央系统（Central-System）之间关于交易相关消息">充电桩（Charge Point）与中央系统（Central System）之间关于交易相关消息</h3>
<p><strong>充电桩应尽快按时间顺序发送交易相关消息</strong></p>
<ul>
<li>充电桩应该尽快将交易相关消息（包括 StartTransaction.req、StopTransaction.req 以及周期性或按时间对齐的 MeterValues.req）以时间顺序发送给中央系统。这确保了消息的连续性和可追溯性。</li>
</ul>
<p><strong>离线时需队列存储交易相关消息</strong></p>
<ul>
<li>当充电桩离线时，它必须将本应发送给中央系统的交易相关消息排队存储，直到恢复在线。这保证了即使在网络中断的情况下，数据也不会丢失。</li>
</ul>
<p><strong>非交易相关消息可立即发送</strong></p>
<ul>
<li>如果充电桩有待发送的交易相关消息队列，新的非交易相关消息（例如 Authorize 请求或 Notifications 请求）可以立即发送，无需等待队列清空。这样可以避免客户等待过长或紧急通知延迟。</li>
</ul>
<p><strong>新交易相关消息需等待队列清空</strong></p>
<ul>
<li>新的交易相关消息必须等到现有队列清空后再发送，以确保所有交易相关消息按时间顺序交付，避免混乱或数据错序。</li>
</ul>
<p><strong>中央系统处理历史消息</strong></p>
<ul>
<li>当中央系统接收到充电桩队列中存储了一段时间的交易相关消息时，除非通过检查时间戳推断这些消息是历史数据，否则它无法直接识别这些消息为历史消息。中央系统应像处理其他实时消息一样处理这些消息，确保一致性。</li>
</ul>
<h3 id="%E5%A4%84%E7%90%86%E4%BA%A4%E6%98%93%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF%E6%97%B6%E9%81%87%E5%88%B0%E4%B8%AD%E5%A4%AE%E7%B3%BB%E7%BB%9F%EF%BC%88central-system%EF%BC%89%E5%A4%84%E7%90%86%E5%A4%B1%E8%B4%A5%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E5%BA%94%E5%AF%B9%E6%9C%BA%E5%88%B6" tabindex="-1" id="处理交易相关消息时遇到中央系统（Central-System）处理失败的情况下的应对机制">处理交易相关消息时遇到中央系统（Central System）处理失败的情况下的应对机制</h3>
<p><strong>允许跳过处理失败的交易相关消息</strong></p>
<ul>
<li>充电桩仅在中央系统反复报告“无法处理消息”（failure to process the message）时，才可以跳过某个交易相关消息。否则，如果严格要求按时间顺序发送每条消息，一旦中央系统因软件bug未确认某条消息，充电桩将无法继续发送其他交易相关消息。这种灵活性是为了避免系统因单一故障而完全停滞。</li>
</ul>
<p><strong>“无法处理消息”的定义</strong></p>
<ul>
<li>什么是“无法处理消息”的响应或未响应状态，在 OCPP JSON Specification 和 OCPP SOAP Specification 文档中有所定义。这些规范提供了具体的失败条件（如超时、无效响应等）。</li>
</ul>
<p><strong>重试配置的可选设置</strong></p>
<ul>
<li>充电桩重试失败交易相关消息的次数和间隔可以通过 <code>TransactionMessageAttempts</code>（重试次数）和 <code>TransactionMessageRetryInterval</code>（重试间隔）配置项进行设置。这些参数是可选的，允许根据需求调整。</li>
</ul>
<p><strong>重试机制的规则</strong></p>
<ul>
<li>当充电桩首次发现某条交易相关消息无法交付时，它应该继续重发该消息，前提是每次重试仍失败，且重试次数未超过 <code>TransactionMessageAttempts</code> 配置值。每次重试前，充电桩应等待的时间为 <code>TransactionMessageRetryInterval</code> 值乘以之前该消息的重试次数（例如，第2次重试等待时间为间隔值 ×2）。</li>
</ul>
<p><strong>示例说明</strong></p>
<ul>
<li>假设充电桩的 <code>TransactionMessageAttempts</code> 设置为 3（最多重试3次），<code>TransactionMessageRetryInterval</code> 设置为 60 秒（间隔60秒）。当发送 <code>StopTransaction</code> 消息时，中央系统报告处理失败：
<ul>
<li>第一次失败后，充电桩等待 60 秒后重发。</li>
<li>第二次失败后，等待 120 秒（60×2）后重发。</li>
<li>如果第三次仍失败，充电桩应放弃该消息，转而处理下一条交易相关消息（如果有的话）。</li>
</ul>
</li>
</ul>
<h3 id="%E8%BF%9E%E6%8E%A5%E5%99%A8%E7%BC%96%E5%8F%B7" tabindex="-1" id="连接器编号">连接器编号</h3>
<p><strong>编号的必要性</strong></p>
<ul>
<li>为了让中央系统能够有效管理充电桩的所有连接器，连接器编号（ConnectorIds）必须始终采用一致的方式。这确保了跨系统和设备的一致性。</li>
</ul>
<p><strong>连接器编号规则</strong></p>
<ul>
<li>具体编号要求如下：
<ul>
<li>第一个连接器的 ID 必须是 1。</li>
<li>其他连接器必须按顺序编号（不能跳号）。</li>
<li>连接器 ID 不得超过充电桩的总连接器数量。</li>
<li>对于中央系统发起的操作，ConnectorId 0 被保留用于 addressing 整个充电桩（而不是具体连接器）。</li>
<li>对于充电桩发起的操作（如报告状态），ConnectorId 0 被保留用于充电桩的主控制器。</li>
</ul>
</li>
</ul>
<p><strong>示例和建议</strong></p>
<ul>
<li>例如，一个拥有 3 个连接器的充电桩，所有连接器必须按 1、2、3 编号。建议按照逻辑顺序编号，例如从左到右、从上到下递增，以提高操作的可理解性和一致性。</li>
</ul>
<h3 id="id-tokens" tabindex="-1" id="ID-Tokens">ID Tokens</h3>
<p><strong>本地获取的 IdToken 数据</strong></p>
<ul>
<li>通常通过本地令牌读取硬件（如 RFID 卡读取器）获取的 IdToken 数据，主要是物理 RFID 卡的 UID 值（通常为 4 或 7 字节），以 8 或 14 个十六进制字符表示。这是最常见的场景，例如用户刷卡启动充电。</li>
</ul>
<p><strong>远程发起的 IdToken 数据</strong></p>
<ul>
<li>中央系统（Central System）发送给充电桩以启动远程充电会话的 IdToken 可能不是传统的 UID，而是单次使用的虚拟交易授权码或虚拟 RFID 令牌。这些虚拟令牌可能故意采用非标准的 UID 格式，以避免与真实 UID 值冲突。</li>
</ul>
<p><strong>ParentId 的特殊使用</strong></p>
<ul>
<li>作为 ParentId 的 IdToken 数据通常使用一个共享的中央账户标识符，而不是账户第一个/主 RFID 卡的 UID。这允许更灵活的账户管理，例如关联多个用户。</li>
</ul>
<p><strong>IdToken 数据的灵活性</strong></p>
<ul>
<li>IdToken 类（包括 ParentId）的消息数据元素可以包含任何对中央系统有意义的数据，前提是符合 CiString20Type 数据类型的约束（例如长度限制为 20 个字符）。充电桩不得对这些数据的格式或内容做任何假设（例如假设必须是偶数位十六进制字符或类似 UID 的值），以保持兼容性。</li>
</ul>
<p><strong>互操作性建议</strong></p>
<ul>
<li>为了提升互操作性，基于当前 RFID 卡 UID（符合 ISO 14443 标准的物理 RFID 卡）的常见做法，建议将此类 UID 表示为 UID 字节的十六进制表示。按 ISO 14443-3 标准，十六进制字符串应以第 0 字节开头。</li>
</ul>
<h3 id="parent-idtag" tabindex="-1" id="Parent-idTag">Parent idTag</h3>
<p>​	如何通过分组身份令牌（idTags）来支持共享充电账户的使用。</p>
<p><strong>ParentId 的分组功能</strong></p>
<ul>
<li>中央系统（Central System）可以将一组身份令牌（idTags）视为一个“组”。在这个组中，任意一个令牌可以启动交易，同一令牌或组内其他令牌可以停止交易。这适用于家庭或企业等场景，多个司机共享一辆或多辆电动车，并使用单一充电合约账户。</li>
</ul>
<p><strong>令牌分组的实现</strong></p>
<ul>
<li>为了授权目的，将令牌分组是通过在 IdTagInfo 中的可选 ParentId 元素指定一个共同的组标识符来实现的。如果两个 idTags 的 ParentId 值匹配，则认为它们属于同一组。</li>
</ul>
<p><strong>ParentId 的特殊性</strong></p>
<ul>
<li>尽管 ParentId 的名义数据类型与 idTag 相同（均为 IdToken），但其值可能不采用常见的 IdToken 格式，也不一定代表一个有效的实际 IdToken（例如，它可能是一个共享的“账户号码”）。因此，除非 ParentId 本身也作为 idTag 值出现，否则不建议将 ParentId 值与提交的令牌值进行比较。</li>
</ul>
<h3 id="%E9%A2%84%E5%AE%9A" tabindex="-1" id="预定">预定</h3>
<p><strong>预订功能概述</strong></p>
<ul>
<li>可以使用 Reserve Now 操作对充电桩进行预订。该操作会为特定 idTag 预留充电桩，直到指定的到期时间（expiry time）。这允许用户提前锁定充电资源。</li>
</ul>
<p><strong>支持组预订</strong></p>
<ul>
<li>预订中可以包含一个 parent idTag，以支持“组”预订功能。这样，组内的任何 idTag 都可以使用预订的充电桩，适用于共享账户场景。</li>
</ul>
<p><strong>预订灵活性</strong></p>
<ul>
<li>用户可以预订充电桩上的特定连接器（connector），也可以预订充电桩上的任意连接器（未指定具体连接器），提供更大的灵活性。</li>
</ul>
<p><strong>预订的释放条件</strong></p>
<ul>
<li>预订会在以下情况之一发生时释放：
<ul>
<li>预订的 idTag 在指定的连接器上使用（如果指定了连接器）。</li>
<li>预订的 idTag 在任意连接器上使用（如果未指定连接器）。</li>
<li>到期时间到达。</li>
<li>预订被明确取消。</li>
</ul>
</li>
</ul>
<h3 id="%E5%8E%82%E5%95%86%E7%89%B9%E5%AE%9A%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93" tabindex="-1" id="厂商特定数据传输">厂商特定数据传输</h3>
<p><strong>厂商特定数据传输的机制</strong></p>
<ul>
<li>厂商特定数据传输允许交换 OCPP（开放充电点协议）中未标准化的数据或消息。这为实验性功能提供了一个框架，这些功能可能在未来的 OCPP 版本中被采纳。通过这种方式，可以在不创建新的（可能不兼容的）OCPP 方言的情况下进行实验。</li>
</ul>
<p><strong>额外功能的实现</strong></p>
<ul>
<li>它还为特定中央系统和充电桩厂商之间协商的附加功能提供了实现可能性，使厂商能够根据自身需求定制功能，而不局限于 OCPP 标准。</li>
</ul>
<p><strong>操作的发起方</strong></p>
<ul>
<li>Vendor Specific Data 操作可以由中央系统或充电桩发起，提供了双向通信的灵活性。</li>
</ul>
<p><strong>使用注意事项</strong></p>
<ul>
<li>使用此功能需极其谨慎，仅限于可选功能，因为它会影响与其他未使用此选项的系统的兼容性。建议在文档和/或通信中明确说明其使用情况，并考虑在添加功能前咨询开放充电联盟（Open Charge Alliance）。</li>
</ul>
<h3 id="%E6%99%BA%E8%83%BD%E5%85%85%E7%94%B5" tabindex="-1" id="智能充电">智能充电</h3>
<p><strong>智能充电的基本功能</strong></p>
<ul>
<li>通过智能充电，中央系统能够影响特定电动车（EV）的充电功率或电流，或者控制整个充电桩/一组充电桩的总允许能耗。这允许根据电网连接、电网上的可用能源或建筑物的布线等因素进行动态调整。</li>
</ul>
<p><strong>影响充电功率或电流的机制</strong></p>
<ul>
<li>充电功率或电流的调整基于特定时间点的能量传输限制。这些限制被整合到一个充电配置文件（Charging Profile）中，用于指导充电过程。</li>
</ul>
<h3 id="%E5%85%85%E7%94%B5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%94%A8%E9%80%94" tabindex="-1" id="充电配置文件用途">充电配置文件用途</h3>
<p><strong>充电配置文件的组成</strong></p>
<ul>
<li>充电配置文件包含一个充电计划（charging schedule），即一系列时间间隔及其最大充电功率或电流的列表，以及一些值来指定计划的时间段和重复模式。这是充电管理的核心数据结构。</li>
</ul>
<p><strong>充电配置文件的类型与用途</strong></p>
<ul>
<li>
<p>根据目的，充电配置文件分为三种类型：</p>
<ul>
<li>
<p>ChargePointMaxProfile</p>
<ul>
<li>在负载平衡场景中，充电桩有一个或多个本地充电配置文件，用于限制所有连接器共享的功率或电流。中央系统（Central System）应将 ChargingProfilePurpose 设置为 “ChargePointMaxProfile”。此类型只能在充电桩的 ConnectorId 0 上设置，适用于整个充电桩的整体限制。</li>
</ul>
</li>
<li>
<p>TxDefaultProfile</p>
<ul>
<li>
<p>默认计划可用于新交易施加充电策略，例如禁止白天充电。</p>
<p>ChargingProfilePurpose</p>
<p>应设置为 “TxDefaultProfile”。</p>
<ul>
<li>如果设置为 ConnectorId 0，则该默认计划适用于所有连接器。</li>
<li>如果 ConnectorId &gt; 0，则仅适用于指定连接器。</li>
<li>如果 ConnectorId 0 的 TxDefaultProfile 已安装，且中央系统发送了 ConnectorId &gt; 0 的新配置文件，则仅替换该特定连接器的默认计划。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>TxProfile</p>
<ul>
<li>如果存在特定于交易的 TxProfile 配置文件，它在当前交易期间应覆盖目的为 TxDefaultProfile 的默认配置文件。交易结束后，该配置文件应被删除。如果指定了 TxProfile 的连接器上没有活动交易，充电桩应丢弃该配置文件并在 SetChargingProfile.conf 中返回错误状态。TxProfile 只能在 ConnectorId &gt; 0 上设置。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>最终计划的确定</strong></p>
<ul>
<li>适用于交易的最终充电计划通过合并 ChargePointMaxProfile 与 TxProfile（如果提供）或 TxDefaultProfile（如果未提供 TxProfile）来确定。TxProfile 的优先级最高，仅在特定连接器上生效。</li>
</ul>
<h3 id="%E5%A0%86%E5%8F%A0%E5%85%85%E7%94%B5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" tabindex="-1" id="堆叠充电配置文件">堆叠充电配置文件</h3>
<p><strong>堆叠充电配置文件的允许性</strong></p>
<ul>
<li>允许为同一充电配置文件目的（purpose）堆叠多个配置文件，以描述复杂的日历。例如，可以定义一个目的为 TxDefaultProfile 的配置文件，持续时间和重复周期为一周，允许工作日 23:00 至 06:00 和周末 00:00 至 24:00 提供全功率充电，其他时间提供降低的功率。此外，可以定义其他 TxDefaultProfile 作为例外规则，例如适用于节假日。</li>
</ul>
<p><strong>优先级的确定</strong></p>
<ul>
<li>充电配置文件的优先级由其 StackLevel 参数值决定。在任何时间点，起作用的充电配置文件应是当时有效的配置文件中 StackLevel 值最高的那个，有效性由 validFrom 和 validTo 参数确定。</li>
</ul>
<p><strong>避免冲突的规则</strong></p>
<ul>
<li>充电桩中不允许存在多个具有相同 stackLevel 和 Purpose 的充电配置文件，以避免冲突。如果充电桩接收到一个已存在的 stackLevel 和 Purpose 的新配置文件，充电桩必须替换现有的配置文件。</li>
</ul>
<p><strong>更新配置文件的处理</strong></p>
<ul>
<li>如果发送的更新配置文件（具有相同 stackLevel 和 purpose）包含未来的 validFrom 时间，充电桩应替换已安装的配置文件，并在 validFrom 到达前恢复到默认行为。建议提供过去的开始时间，以防止出现时间空隙。</li>
</ul>
<p><strong>无持续时间的堆叠注意事项</strong></p>
<ul>
<li>如果在最高 stackLevel 上使用无持续时间的堆叠，充电桩将永远不会回退到较低 stackLevel 的配置文件。</li>
</ul>
<h3 id="%E5%90%88%E5%B9%B6%E4%B8%8D%E5%90%8C%E5%85%85%E7%94%B5%E9%85%8D%E7%BD%AE" tabindex="-1" id="合并不同充电配置">合并不同充电配置</h3>
<p><strong>Charging Profile（充电配置）</strong></p>
<p>​	OCPP 允许对充电桩的充电行为进行限制和规划。每个 Charging Profile 都可以有一个 <strong>purpose（目的）</strong>，比如：</p>
<ul>
<li><code>ChargePointMaxProfile</code>：限制充电桩本身最大可用功率（设备物理限制）。</li>
<li><code>TxDefaultProfile</code>：默认交易（Transaction）充电配置。</li>
<li><code>TxProfile</code>：特定交易的充电配置。</li>
</ul>
<p><strong>合并规则</strong></p>
<ul>
<li>对于每个时间间隔（time interval），<strong>Composite Schedule</strong> 的功率/电流取所有配置中 <strong>最小的值</strong>。
<ul>
<li>也就是说，哪个 Charging Profile 限制更严格，就用哪个。</li>
<li>这是为了确保充电桩不会超过任何一个配置的限制。</li>
</ul>
</li>
<li><strong>时间间隔不必统一</strong>
<ul>
<li>不同 Charging Profile 的时间间隔可以不一样，也可以长度不同。</li>
<li>因此，生成的 Composite Schedule 也可能包含长度不一致的时间段。</li>
</ul>
</li>
</ul>
<h3 id="%E6%99%BA%E8%83%BD%E5%85%85%E7%94%B5%E7%9A%84%E5%85%B8%E5%9E%8B%E7%94%A8%E4%BE%8B" tabindex="-1" id="智能充电的典型用例">智能充电的典型用例</h3>
<p>三种典型的智能充电方式（Smart Charging Use Cases）：</p>
<p><strong>Load Balancing（负载平衡）</strong></p>
<pre class="mermaid">graph TD
    subgraph Central System
        CS[Central System<br/>Sets Grid Limits<br/>Sends OCPP Charging Profile]
    end

    subgraph Charge Point CP10
        CP10[Charge Point: CP10]
        CP10_C1[Connector 1]
        CP10_C2[Connector 2]
    end

    subgraph Charge Point CP11
        CP11[Charge Point: CP11]
        CP11_C1[Connector 1]
        CP11_C2[Connector 2]
    end

    EV1[EV1]
    EV2[EV2]

    CS -->|OCPP Charging Profile| CP10
    CS -->|OCPP Charging Profile| CP11

    CP10_C1 -->|Control Pilot signal| EV1
    CP10_C2 -->|Control Pilot signal| EV2</pre>
<ul>
<li>充电桩内部在多个接口（Connector）之间进行功率分配。</li>
<li>充电桩会根据总的电网连接限制（比如总电流最大值）来控制各接口的充电计划。</li>
<li>可选字段 <code>minChargingRate</code>：
<ul>
<li>指示充电桩低于某个功率充电效率低，可以触发充电桩使用其他分配策略。</li>
<li>例如，如果某接口功率太低，就可能优先给另一个接口更多功率，从而优化总功率分配。</li>
</ul>
</li>
</ul>
<p><strong>Central Smart Charging（集中式智能充电）</strong></p>
<pre class="mermaid">graph TD
    DSO["CS receives a capacity<br/>forecast from an external<br/>party (e.g. DSO)"] --> CS[Central System]
    
    CS -->|OCPP charging profile| CP10[Charge Point<br/>CP10]
    CS -->|OCPP charging profile| CP11[Charge Point<br/>CP11]
    CS -->|OCPP charging profile| CP12[Charge Point<br/>CP12]
    
    CP11 -.->|Control Pilot signal| EV1[EV1]
    CP12 -.->|Control Pilot signal| EV2[EV2]</pre>
<ul>
<li>集中控制，通常由后台系统（Central System）统一管理多个充电桩。</li>
<li>可以基于电网负荷、电价、用户需求等因素动态调整充电计划。</li>
</ul>
<p><strong>Local Smart Charging（本地智能充电）</strong></p>
<pre class="mermaid">graph TD
    CS[Central System] -->|OCPP ChargePointMaxProfile| LC[Local Controller<br/>CP00]
    
    subgraph LocalGroup["Local group"]
        LC -->|OCPP charging profile| CP03[Charge Point<br/>CP03]
        LC -->|OCPP charging profile| CP02[Charge Point<br/>CP02]
        LC -->|OCPP charging profile| CP01[Charge Point<br/>CP01]
        
        LC --> Limit["Local Controller limits<br/>power usage of total<br/>group to pre-configured<br/>maximum capacity"]
    end
    
    CP03 -.->|Control Pilot signal| EV2[EV2]
    CP02 -.->|Control Pilot signal| EV1[EV1]</pre>
<ul>
<li>充电桩本地进行智能决策，不依赖中央系统。</li>
<li>可以根据实时电网情况、本地设备状态或连接的车辆状态调整功率。</li>
</ul>
<pre class="mermaid">sequenceDiagram
    participant User
    participant EV
    participant CP as Charge Point
    participant LC as Local Controller
    participant CS as Central System
    
    Note over User, CS: RFID or other Authorization
    
    User->>CP: start charging()
    CP->>EV: set max current(limit)
    EV->>CP: switch power on()
    
    CP->>LC: StartTransaction.req(connectorId, idTag, meterStart, timestamp, [reservationId])
    LC->>CS: StartTransaction.req(connectorId, idTag, meterStart, timestamp, [reservationId])
    CS->>LC: StartTransaction.conf(idTagInfo, transactionId)
    LC->>CP: StartTransaction.conf(idTagInfo, transactionId)
    
    Note over CP, LC: loop Change according to charging profile<br/>[for each interval period in charging profile]
    
    loop Charging Profile Implementation
        CP->>CP: get limit from charging profile().limit
        Note over CP: Charge Point implements charging<br/>profile via the Control Pilot<br/>signal whenever maximum current<br/>needs changing.
        CP->>EV: set max current(limit)
        
        opt Change of limits by controller
            Note over LC: Local Controller decides to<br/>change the charging profile.
            LC->>CP: SetChargingProfile.req(connectorId, csChargingProfiles)
            CP->>LC: SetChargingProfile.conf(Accepted)
        end
    end
    
    Note over User, CS: RFID or other Authorization
    
    User->>CP: end charging()
    EV->>CP: switch power off()
    
    CP->>LC: StopTransaction.req(meterStop, timestamp, transactionId, reason, [idTag], [transactionData])
    LC->>CS: StopTransaction.req(meterStop, timestamp, transactionId, reason, [idTag], [transactionData])
    CS->>LC: StopTransaction.conf([idTagInfo])
    LC->>CP: StopTransaction.conf([idTagInfo])</pre>
<p><strong>授权阶段</strong>：使用 RFID 或其他方式进行身份验证</p>
<p><strong>开始充电</strong>：</p>
<ul>
<li>用户启动充电</li>
<li>充电点设置最大电流限制</li>
<li>电动汽车开启电源</li>
<li>各系统间进行 StartTransaction 消息交互</li>
</ul>
<p><strong>充电过程</strong>：</p>
<ul>
<li>充电点根据充电配置文件循环调整电流限制</li>
<li>本地控制器可以动态修改充电配置文件</li>
<li>通过 Control Pilot 信号实时控制充电参数</li>
</ul>
<p><strong>结束充电</strong>：</p>
<ul>
<li>用户结束充电</li>
<li>电动汽车关闭电源</li>
<li>各系统间进行 StopTransaction 消息交互</li>
</ul>
<h3 id="%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86%E5%92%8C%E7%94%B5%E8%A1%A8%E6%95%B0%E6%8D%AE" tabindex="-1" id="时间处理和电表数据">时间处理和电表数据</h3>
<p><strong>Time zones</strong>（时区）</p>
<ul>
<li>这一部分是 <strong>informative（说明性）</strong>，不强制。</li>
<li>OCPP <strong>没有规定必须用哪种时区</strong>。</li>
<li><strong>强烈推荐</strong>：使用 <strong>UTC 时间</strong>，这样可以避免中央系统和充电桩跨时区时出现不一致，提升互操作性。</li>
</ul>
<p>​	简单说：最好所有时间都用 UTC，但不是强制要求。</p>
<p><strong>Time notations（时间表示法）</strong></p>
<ul>
<li>
<p>这一部分是 <strong>normative（规范性，必须遵守）</strong>。</p>
</li>
<li>
<p>时间必须使用 <strong>ISO 8601 标准格式</strong>，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">2025-08-22T11:30:00Z<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>要求：</p>
<ol>
<li><strong>接收端必须能处理</strong>：
<ul>
<li>带小数秒（fractional seconds），如 <code>2025-08-22T11:30:00.123Z</code></li>
<li>带时区偏移（offset），如 <code>2025-08-22T11:30:00+08:00</code></li>
</ul>
</li>
<li><strong>发送端可以省略</strong>：如果小数部分没意义，可以省略来节省数据量。</li>
</ol>
</li>
</ul>
<p>​	统一用 ISO 8601，接收方必须健壮，发送方可简化。</p>
<p><strong>Metering Data（电表数据）</strong></p>
<p>这一部分是 <strong>规范性要求</strong>，规定了充电过程中的电表数据记录和传输方式。</p>
<p><strong>主要用途：</strong></p>
<ol>
<li><strong>Charging Session Meter Values</strong>（充电会话电表值）
<ul>
<li>在充电过程中，定期（例如每 1-5 分钟）向中央系统发送电表读数。</li>
<li>目的：让中央系统能实时向用户（通常不在充电桩旁边）报告充电进度，例如通过网页、App、短信。</li>
<li>在 OCPP 中称为 <strong>sampled meter data（采样电表数据）</strong>。</li>
<li>特点：不需要严格的采样时间点，只要“够频繁”即可。</li>
</ul>
</li>
<li><strong>Clock-Aligned Meter Values</strong>（时钟对齐电表值）
<ul>
<li>（文中没展开，这里只是点到）通常用于需要对齐到整点、半点等时刻的数据采集，便于计费或统计。</li>
</ul>
</li>
</ol>
<p>两种数据都可以：</p>
<ul>
<li>独立通过 <strong>MeterValues.req 消息</strong> 发送（在交易进行中）。</li>
<li>或者放在 <strong>StopTransaction.req</strong> 的 <code>transactionData</code> 元素里（交易结束时一起上传）。</li>
</ul>
<p><strong>配置参数（keys）</strong></p>
<p>OCPP 定义了一些关键配置项，控制电表数据采样和上传：</p>
<ul>
<li><strong>MeterValueSampleInterval</strong>
<ul>
<li>采样间隔（秒）。</li>
<li>从充电开始起，每隔这个时间采集一次电表数据并通过 <code>MeterValues</code> PDU 发送。</li>
<li>值为 <code>0</code> 表示 <strong>不发送采样数据</strong>。</li>
</ul>
</li>
<li><strong>MeterValuesSampledData</strong>
<ul>
<li>逗号分隔的列表，定义每次发送的电表测量项（measurands）。</li>
<li>例如 <code>Energy.Active.Import.Register, Power.Active.Import, Current.Import</code>。</li>
<li><strong>最大长度</strong>由 <code>MeterValuesSampledDataMaxLength</code> 决定。</li>
</ul>
</li>
<li><strong>StopTxnSampledData</strong>
<ul>
<li>逗号分隔的列表，定义在交易结束时（StopTransaction.req）上传的采样数据。</li>
<li><strong>最大长度</strong>由 <code>StopTxnSampledDataMaxLength</code> 决定。</li>
</ul>
</li>
</ul>
<p><strong>举个例子</strong></p>
<p>假设配置：</p>
<ul>
<li><code>MeterValueSampleInterval = 60</code>（每 60 秒采一次数据）</li>
<li><code>MeterValuesSampledData = Energy.Active.Import.Register, Power.Active.Import</code></li>
</ul>
<p>充电时的报文会是这样（简化版）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;messageType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;uniqueId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;12345&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MeterValues&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;payload&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;connectorId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;transactionId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6789</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;meterValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2025-08-22T11:30:00Z&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sampledValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;measurand&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Energy.Active.Import.Register&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;120.5&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;measurand&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Power.Active.Import&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;22.3&quot;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p><strong>总结关键点</strong>：</p>
<ol>
<li><strong>时间</strong>：推荐 UTC，必须用 ISO 8601。</li>
<li><strong>电表数据</strong>：两种典型用途 —— 会话实时上传 &amp; 时钟对齐上传。</li>
<li><strong>配置项</strong>：采样间隔、采样项目、最大长度。</li>
<li><strong>0 值</strong>：<code>MeterValueSampleInterval=0</code> 表示不上传实时数据。</li>
</ol>
<h2 id="4-%E5%85%85%E7%94%B5%E7%82%B9%E5%90%AF%E5%8A%A8%E7%9A%84%E6%93%8D%E4%BD%9C" tabindex="-1" id="4-充电点启动的操作">4 充电点启动的操作</h2>
<h3 id="4.1-authorize" tabindex="-1" id="4-1-Authorize">4.1 Authorize</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: Authorize.req(idTag)
    CS->>CP: Authorize.conf(idTagInfo)</pre>
<ol>
<li>用户刷卡（idTag）。</li>
<li>桩先查 <strong>Local Authorization List / Cache</strong>：
<ul>
<li>有 → 可直接授权（也可选发 <code>Authorize.req</code>）。</li>
<li>没有 → 必须发 <code>Authorize.req</code> 给中央系统。</li>
</ul>
</li>
<li>中央系统返回 <code>Authorize.conf</code>：
<ul>
<li>Status = Accepted → 允许充电。</li>
<li>Status = Rejected → 拒绝充电。</li>
</ul>
</li>
<li>桩更新缓存（如果实现了 Authorization Cache）。</li>
</ol>
<h3 id="4.2-boot-notification" tabindex="-1" id="4-2-Boot-Notification">4.2 Boot Notification</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: BootNotification.req(chargePointModel, chargePointVendor, [chargeBoxSerialNumber], [chargePointSerialNumber], [firmwareVersion], [iccid], [imsi], [meterSerialNumber], [meterType])
    CS->>CP: BootNotification.conf(currentTime, interval, status)</pre>
<ul>
<li><strong>开机 → BootNotification.req → 等待中央系统决定 → 根据状态走不同分支</strong></li>
<li>Accepted → 正常通信</li>
<li>Rejected → 等待间隔，期间不通信</li>
<li>Pending → 只能响应，不能主动发请求，且禁止远程启停交易</li>
</ul>
<p><strong>中央系统接受前的交易</strong></p>
<ul>
<li>
<p>如果充电桩在没有中央系统确认之前就运行交易，会有数据丢失和认证风险。</p>
</li>
<li>
<p>重启后必须重新向中央系统报告（BootNotification）。</p>
</li>
<li>
<p>如果中央系统没确认，最好不要允许用户充电，以免后续账单或认证出问题。</p>
</li>
</ul>
<h3 id="4.3-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93-data-transfer" tabindex="-1" id="4-3-数据传输-Data-Transfer">4.3 数据传输 Data Transfer</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: DataTransfer.req(vendorId, [messageId], [data])
    CS->>CP: DataTransfer.conf(status, [data])</pre>
<ul>
<li>
<p>充电桩想做 OCPP 没规定的功能 → 用 DataTransfer.req。</p>
</li>
<li>
<p>vendorId 唯一标识厂商，messageId 可标识具体消息。</p>
</li>
<li>
<p>不识别 vendorId → 返回 <code>UnknownVendor</code>。</p>
</li>
<li>
<p>messageId 不匹配 → 返回 <code>UnknownMessageId</code>。</p>
</li>
<li>
<p>其他情况 → 状态和 data 由厂商协议决定。</p>
</li>
</ul>
<h3 id="4.4-%E8%AF%8A%E6%96%AD%E7%8A%B6%E6%80%81%E9%80%9A%E7%9F%A5-diagnostics-status-notification" tabindex="-1" id="4-4-诊断状态通知-Diagnostics-Status-Notification">4.4 诊断状态通知 Diagnostics Status Notification</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: DiagnosticsStatusNotification.req(status)
    CS->>CP: DiagnosticsStatusNotification.conf()</pre>
<ul>
<li>
<p>诊断上传过程中 → 发送状态 <code>Uploading</code>。</p>
</li>
<li>
<p>上传成功 → 发送 <code>Uploaded</code>。</p>
</li>
<li>
<p>上传失败 → 发送 <code>UploadFailed</code>。</p>
</li>
<li>
<p>空闲状态 → 仅在收到 TriggerMessage 并且没有上传任务时才发送 <code>Idle</code>。</p>
</li>
<li>
<p>中央系统收到请求 → 回复 <code>DiagnosticsStatusNotification.conf</code> 确认。</p>
</li>
</ul>
<h3 id="4.5-%E5%9B%BA%E4%BB%B6%E7%8A%B6%E6%80%81%E9%80%9A%E7%9F%A5-firmware-status-notification" tabindex="-1" id="4-5-固件状态通知-Firmware-Status-Notification">4.5 固件状态通知 Firmware Status Notification</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: FirmwareStatusNotification.req(status)
    CS->>CP: FirmwareStatusNotification.conf()</pre>
<ul>
<li>
<p>中央系统下发 <strong>FirmwareUpdate.req</strong> → 触发更新。</p>
</li>
<li>
<p>充电桩下载固件 → 发送 <code>Downloading</code>。</p>
</li>
<li>
<p>下载完成 → 发送 <code>Downloaded</code>。</p>
</li>
<li>
<p>安装固件 → 发送 <code>Installing</code>。</p>
</li>
<li>
<p>安装成功 → 发送 <code>Installed</code>。</p>
</li>
<li>
<p>安装失败 → 发送 <code>InstallationFailed</code>。</p>
</li>
<li>
<p>空闲状态 → 收到 TriggerMessage 并且没有任务时发送 <code>Idle</code>。</p>
</li>
<li>
<p>中央系统收到每个状态 → 返回 <code>FirmwareStatusNotification.conf</code> 确认。</p>
</li>
</ul>
<h3 id="4.6-%E5%BF%83%E8%B7%B3-heartbeat" tabindex="-1" id="4-6-心跳-Heartbeat">4.6 心跳 Heartbeat</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: Heartbeat.req()
    CS->>CP: Heartbeat.conf(currentTime)</pre>
<ul>
<li>
<p>充电桩周期性发送 Heartbeat.req → 确认在线状态。</p>
</li>
<li>
<p>中央系统收到 → 返回 Heartbeat.conf，并提供当前时间。</p>
</li>
<li>
<p>充电桩可用这个时间同步内部时钟。</p>
</li>
<li>
<p>若期间有其他消息发送 → 可省略心跳。</p>
</li>
<li>
<p>JSON/WebSocket 下 → 心跳非强制，但建议每日一次用于时间同步。</p>
</li>
</ul>
<h3 id="4.7-%E4%BB%AA%E8%A1%A8%E5%80%BC-meter-values" tabindex="-1" id="4-7-仪表值-Meter-Values">4.7 仪表值 Meter Values</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: MeterValues.req(connectorId, meterValue, [transactionId])
    CS->>CP: MeterValues.conf()</pre>
<p>​	充电桩通过 <code>MeterValues.req</code> 上报电表或传感器的采样值，每个样本都有时间戳和数据点，支持上下文、位置、相位、单位等字段，中央系统必须确认收到并回复 <code>MeterValues.conf</code>。</p>
<h3 id="4.8-start-transaction" tabindex="-1" id="4-8-Start-Transaction">4.8 Start Transaction</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: StartTransaction.req(connectorId, idTag, meterStart, timestamp, [reservationId])
    CS->>CP: StartTransaction.conf(idTagInfo, transactionId)</pre>
<p>​	当充电开始时，充电点必须上报 <code>StartTransaction.req</code>，中央系统必须返回一个包含交易 ID 和授权结果的 <code>StartTransaction.conf</code>，同时要确保即便请求有问题也要回复，避免死循环。</p>
<h3 id="4.9-status-notification" tabindex="-1" id="4-9-Status-Notification">4.9 Status Notification</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: StatusNotification.req(connectorId, errorCode, status, [timestamp], [info], [vendorId], [vendorErrorCode])
    CS->>CP: StatusNotification.conf()</pre>
<p>​	只要充电桩的状态或错误信息有变化，就会触发一次 StatusNotification 请求。</p>
<p><strong>主要状态</strong></p>
<ol>
<li><strong>Available（可用）</strong>
插头空闲，可以提供服务。</li>
<li><strong>Preparing（准备中）</strong>
用户/车辆正在准备启动充电（比如插枪、刷卡、远程启动等）。</li>
<li><strong>Charging（充电中）</strong>
正在充电。</li>
<li><strong>SuspendedEV（车辆暂停）</strong>
车辆主动停止充电（例如车端断开充电请求）。</li>
<li><strong>SuspendedEVSE（桩端暂停）</strong>
桩端停止供电（例如因负荷控制、智能调度限制）。</li>
<li><strong>Finishing（结束中）</strong>
充电完成，用户还需要执行操作（比如拔枪、挪车）。</li>
<li><strong>Reserved（已预约）</strong>
该接口被预留，不可供他人使用。</li>
<li><strong>Unavailable（不可用）</strong>
由于运维或配置，被设为不可用。</li>
<li><strong>Faulted（故障）</strong>
出现故障，不能继续提供服务。</li>
</ol>
<p><strong>部分关键状态切换原因（示例）</strong></p>
<ul>
<li><strong>Available → Preparing (A2)</strong>
用户开始使用（插枪、刷卡、远程启动）。</li>
<li><strong>Preparing → Charging (B3)</strong>
所有前置条件满足，车辆开始充电。</li>
<li><strong>Charging → SuspendedEV (C4)</strong>
车辆请求暂停（例如打开 S2 接触器）。</li>
<li><strong>Charging → SuspendedEVSE (C5)</strong>
桩端主动暂停（例如负荷限制或交易无效）。</li>
<li><strong>Charging → Finishing (C6)</strong>
用户或后台发送“停止充电”，等待用户拔枪。</li>
<li><strong>Finishing → Available (F1)</strong>
用户已完成所有操作（例如拔掉插头）。</li>
<li><strong>Available → Reserved (A7)</strong>
后台发送“ReserveNow”消息，预留该接口。</li>
<li><strong>Any → Faulted (A9, B9, C9… etc.)</strong>
发生故障，无法继续充电。</li>
<li><strong>Faulted → 原状态 (I1-I8)</strong>
故障被排除，恢复到之前的状态。</li>
</ul>
<p><strong>特殊说明</strong></p>
<ul>
<li><strong>ConnectorId = 0</strong> 时，只允许有限的状态：
<ul>
<li>Available（可用）</li>
<li>Unavailable（不可用）</li>
<li>Faulted（故障）</li>
</ul>
</li>
<li>不同状态的切换往往由事件触发，比如：
<ul>
<li>用户操作（插枪/拔枪/刷卡）</li>
<li>后台指令（远程启动/停止、修改可用性）</li>
<li>故障发生或排除</li>
<li>预约生效/过期</li>
</ul>
</li>
</ul>
<h3 id="4.10-stop-transaction" tabindex="-1" id="4-10-Stop-Transaction">4.10 Stop Transaction</h3>
<pre class="mermaid">sequenceDiagram
    participant CP as Charge Point
    participant CS as Central System
    
    CP->>CS: StopTransaction.req(meterStop, timestamp, transactionId, reason, [idTag], [transactionData])
    CS->>CP: StopTransaction.conf([idTagInfo])</pre>
<p><strong>StopTransaction 是充电流程的收尾消息</strong></p>
<ul>
<li>桩必须发，后台必须回。</li>
<li>可以带电量数据和结束原因。</li>
<li>是否因拔枪停止，是否解锁电缆，由配置参数控制。</li>
<li>后台只能确认，不能拒绝。</li>
</ul>
<h2 id="5-%E7%94%B1%E4%B8%AD%E5%A4%AE%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E7%9A%84%E6%93%8D%E4%BD%9C-operations-initiated-by-central-system" tabindex="-1" id="5-由中央系统启动的操作-Operations-Initiated-by-Central-System">5 由中央系统启动的操作 Operations Initiated by Central System</h2>
<h3 id="5.1.-cancel-reservation" tabindex="-1" id="5-1-Cancel-Reservation">5.1. Cancel Reservation</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: CancelReservation.req(reservationId)
    CP->>CS: CancelReservation.conf(status)</pre>
<h3 id="5.2.-change-availability" tabindex="-1" id="5-2-Change-Availability">5.2. Change Availability</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: ChangeAvailability.req(connectorId, type)
    CP->>CS: ChangeAvailability.conf(status)</pre>
<p>​	中央系统说“桩，现在变成可用/不可用”，桩先回复能不能做到，然后等状态真正切换时，再主动通知中央系统“我已经变成可用/不可用了”。</p>
<h3 id="5.3.-change-configuration" tabindex="-1" id="5-3-Change-Configuration">5.3. Change Configuration</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: ChangeConfiguration.req(key, value)
    CP->>CS: ChangeConfiguration.conf(status)</pre>
<p><strong>流程</strong></p>
<ol>
<li><strong>中央系统 → 充电点</strong>
<ul>
<li>发送 <code>ChangeConfiguration.req</code></li>
<li>内容包含一个 <strong>键值对</strong>（<code>key</code>, <code>value</code>），表示要修改的配置项。</li>
</ul>
</li>
<li><strong>充电点 → 中央系统</strong>
<ul>
<li>返回 <code>ChangeConfiguration.conf</code>，其中有一个 <code>status</code> 字段，表示执行结果。</li>
</ul>
</li>
</ol>
<p><strong>可能的返回结果 (<code>status</code>)</strong></p>
<ul>
<li><strong>Accepted</strong>：成功执行，立即生效。</li>
<li><strong>RebootRequired</strong>：成功执行，但需要重启才能生效。</li>
<li><strong>Rejected</strong>：执行失败。</li>
<li><strong>NotSupported</strong>：该 <code>key</code> 不存在或不支持。</li>
</ul>
<p><strong>补充细节</strong></p>
<ul>
<li>协议没有规定哪些 <code>key</code> 一定存在，厂商可以自定义。</li>
<li>如果某个 <code>key</code> 是一个 <strong>CSL（Comma Separated List，逗号分隔列表）</strong>，它可能会配套有 <code>[KeyName]MaxLength</code> 这样的键，说明列表最大长度。
<ul>
<li>如果没提供，默认最大长度 = 1。</li>
</ul>
</li>
</ul>
<h3 id="5.4.-clear-cache" tabindex="-1" id="5-4-Clear-Cache">5.4. Clear Cache</h3>
 <pre class="mermaid"> sequenceDiagram
     participant CS as Central System
     participant CP as Charge Point
     
     CS->>CP: ClearCache.req()
     CP->>CS: ClearCache.conf(status)</pre>
<p>​	中央系统对充电桩说：“把本地的用户授权信息全删掉”，充电桩删完后回一句：“我删完了”或者“我没删掉”。</p>
<h3 id="5.5.-clear-charging-profile" tabindex="-1" id="5-5-Clear-Charging-Profile">5.5. Clear Charging Profile</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: ClearChargingProfile.req([id], [connectorId], [chargingProfilePurpose], [stackLevel])
    CP->>CS: ClearChargingProfile.conf(status)</pre>
<p>​	中央系统对充电桩说：“把这些充电策略删掉”，充电桩删完后回一句：“删完了”或“没删掉”。</p>
<h3 id="5.6.-data-transfer" tabindex="-1" id="5-6-Data-Transfer">5.6. Data Transfer</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: DataTransfer.req(vendorId, [messageId], [data])
    CP->>CS: DataTransfer.conf(status, [data])</pre>
<p>​	Data Transfer 就是 <strong>中央系统和充电桩之间的“自定义消息通道”</strong>，用于传递标准 OCPP 没覆盖到的功能或数据。</p>
<h3 id="5.7.-get-composite-schedule" tabindex="-1" id="5-7-Get-Composite-Schedule">5.7. Get Composite Schedule</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: GetCompositeSchedule.req(connectorId, duration, [schedulingUnit])
    CP->>CS: GetCompositeSchedule.conf(status, [connectorId], [scheduleStart], [chargingSchedule])</pre>
<p>​	这就是中央系统向充电桩“问时间表”，充电桩把所有活跃的充电计划和限制计算后返回一个复合计划，告诉中央系统在未来一段时间内每个时段的功率安排。</p>
<h3 id="5.8.-get-configuration" tabindex="-1" id="5-8-Get-Configuration">5.8. Get Configuration</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: GetConfiguration.req([key])
    CP->>CS: GetConfiguration.conf(configurationKey, [unknownKey])</pre>
<p><strong>中央系统发起请求</strong></p>
<ul>
<li>使用 <code>GetConfiguration.req</code> PDU 向充电桩请求配置参数的值。</li>
<li>请求中可以包含 <strong>一组具体的配置项 key</strong>（可选）。</li>
</ul>
<p><strong>充电桩响应规则</strong></p>
<ul>
<li><strong>如果请求中没有 key</strong>（或为空）：
<ul>
<li>充电桩返回 <strong>所有配置参数</strong> 的列表，包括参数名、值以及是否只读（read-only），封装在 <code>GetConfiguration.conf</code> PDU 中。</li>
</ul>
</li>
<li><strong>如果请求中包含 key 列表</strong>：
<ul>
<li>充电桩返回 <strong>识别到的 key 的值和只读状态</strong>。</li>
<li>对于无法识别的 key，会放在 <code>unknownKey</code> 列表中返回。</li>
</ul>
</li>
</ul>
<p><strong>请求数量限制</strong></p>
<ul>
<li>充电桩可能对单次请求的 key 数量有限制。</li>
<li>最大数量可以通过读取配置项 <code>GetConfigurationMaxKeys</code> 获取。</li>
</ul>
<h3 id="5.9.-get-diagnostics" tabindex="-1" id="5-9-Get-Diagnostics">5.9. Get Diagnostics</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: GetDiagnostics.req(location, [retries], [retryInterval], [startTime], [stopTime])
    CP->>CS: GetDiagnostics.conf([fileName])</pre>
<p>​	中央系统向充电桩请求诊断信息时，充电桩会告诉中央系统要上传的诊断文件名称，并将该文件上传到指定位置。如果没有可用的诊断信息，则响应中不会返回文件名。</p>
<h3 id="5.10.-get-local-list-version" tabindex="-1" id="5-10-Get-Local-List-Version">5.10. Get Local List Version</h3>
<pre class="mermaid">sequenceDiagram
    participant CS as Central System
    participant CP as Charge Point
    
    CS->>CP: GetLocalListVersion.req()
    CP->>CS: GetLocalListVersion.conf(listVersion)</pre>
<p>​	中央系统想知道充电桩本地授权列表的版本号时，会发送 <code>GetLocalListVersion</code> 请求，充电桩返回当前版本号。这样中央系统就可以判断是否需要更新充电桩的本地授权列表。</p>
<h3 id="5.11.-remote-start-transaction" tabindex="-1" id="5-11-Remote-Start-Transaction">5.11. Remote Start Transaction</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    C->>S: RemoteStartTransaction.req(idTag, [connectorId], [chargingProfile])
    S-->>C: RemoteStartTransaction.conf(status)</pre>
<p>​	<code>RemoteStartTransaction</code> 允许中央系统远程启动充电事务。充电桩是否在启动前进行授权取决于配置 <code>AuthorizeRemoteTxRequests</code>。请求中必须包含 idTag，可选择指定接口和事务配置文件（TxProfile）。这是远程管理充电的重要机制。</p>
<h3 id="5.12.-remote-stop-transaction" tabindex="-1" id="5-12-Remote-Stop-Transaction">5.12. Remote Stop Transaction</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    C->>S: RemoteStopTransaction.req(transactionId)
    S-->>C: RemoteStopTransaction.conf(status)</pre>
<p>​	Remote Stop Transaction 就是<strong>中央系统通过远程命令要求充电桩结束一笔正在进行的充电交易</strong>，充电桩必须回应并执行，就像用户现场操作一样。</p>
<h3 id="5.13.-reserve-now" tabindex="-1" id="5-13-Reserve-Now">5.13. Reserve Now</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    C->>S: ReserveNow.req(connectorId, expiryDate, idTag, reservationId, [parentIdTag])
    S-->>C: ReserveNow.conf(status)</pre>
<p>​	<strong>中央系统（Central System）</strong> 可以发 <code>ReserveNow.req</code> 给 <strong>充电桩（Charge Point）</strong>，要求为某个 <code>idTag</code> 预约一个充电接口（connector）。</p>
<p>​	充电桩收到请求后，必须返回 <code>ReserveNow.conf</code> 表示结果。</p>
<h3 id="5.14.-reset" tabindex="-1" id="5-14-Reset">5.14. Reset</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    C->>S: Reset.req(type)
    S-->>C: Reset.conf(status)</pre>
<p><strong>Central System（中央系统）</strong> 通过发送 <strong><code>Reset.req</code> PDU</strong> 请求 <strong>Charge Point（充电点）</strong> 执行复位操作。</p>
<p>请求中可以指定两种复位方式：</p>
<ol>
<li><strong>Soft Reset（软复位）</strong></li>
<li><strong>Hard Reset（硬复位）</strong></li>
</ol>
<h3 id="5.15.-send-local-list" tabindex="-1" id="5-15-Send-Local-List">5.15. Send Local List</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    C->>S: SendLocalList.req(listVersion, updateType, [localAuthorisationList])
    S-->>C: SendLocalList.conf(status)</pre>
<p><strong>Central System → Charge Point</strong></p>
<p>发送 <code>SendLocalList.req</code>，里面包含：</p>
<ul>
<li><code>updateType</code>：Full 或 Differential</li>
<li><code>versionNumber</code>：版本号（更新成功后，桩必须记录为此版本号）</li>
<li><code>localAuthorizationList</code>：idTag 列表及其授权信息（新增或替换项）</li>
</ul>
<p><strong>Charge Point → Central System</strong></p>
<p>回复 <code>SendLocalList.conf</code>，指明是否成功应用：</p>
<ul>
<li><code>Accepted</code>：更新成功</li>
<li><code>Failed</code>：更新失败</li>
<li><code>VersionMismatch</code>：版本不匹配（一般说明差分更新基线错误）</li>
</ul>
<h3 id="5.16.-set-charging-profile" tabindex="-1" id="5-16-Set-Charging-Profile">5.16. Set Charging Profile</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    alt at start of transaction
        C->>S: StartTransaction.req(connectorId, idTag, meterStart, timestamp [reservationId])
        S-->>C: StartTransaction.conf(idTagInfo, transactionId)
        C->>S: SetChargingProfile.req(connectorId, csChargingProfiles)
        S-->>C: SetChargingProfile.conf(status)
    else
        C->>S: SetChargingProfile.req(connectorId, csChargingProfiles)
        S-->>C: SetChargingProfile.conf(status)
    end</pre>
<p><strong>在事务开始时</strong>：</p>
<p>用于为该事务设定一个充电配置（TxProfile）。</p>
<p><strong>在 RemoteStartTransaction 请求中</strong>：</p>
<p>当中央系统远程启动事务时，可以同时下发充电配置。</p>
<p><strong>在事务进行过程中</strong>：</p>
<p>可以修改当前正在使用的事务充电配置。</p>
<p><strong>在事务之外</strong>：</p>
<p>可以单独下发一个充电配置，应用于：</p>
<ul>
<li>本地控制器</li>
<li>整个充电桩（Charge Point）</li>
<li>作为某个充电接口（Connector）的默认充电配置</li>
</ul>
<h3 id="5.17.-trigger-message" tabindex="-1" id="5-17-Trigger-Message">5.17. Trigger Message</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    alt at start of transaction
        C->>S: StartTransaction.req(connectorId, idTag, meterStart, timestamp [reservationId])
        S-->>C: StartTransaction.conf(idTagInfo, transactionId)
        C->>S: SetChargingProfile.req(connectorId, csChargingProfiles)
        S-->>C: SetChargingProfile.conf(status)
    else
        C->>S: SetChargingProfile.req(connectorId, csChargingProfiles)
        S-->>C: SetChargingProfile.conf(status)
    end</pre>
<p>​	当中央系统（Central System）想要主动获取某些信息时，可以“触发”充电点（Charge Point）重新上报特定消息。</p>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    C->>S: TriggerMessage.req(RequestedMessage: StatusNotification, ConnectorId: 1)
    S-->>C: TriggerMessage.conf(Status: Accepted)
    C->>S: StatusNotification.req(ConnectorId: 1, errorCode: NoError, Status: Charging)
    S-->>C: StatusNotification.conf()</pre>
<p>​	TriggerMessage 用于中央系统主动让充电点上报<strong>最新状态信息</strong>，充电点先确认（ACCEPTED/REJECTED/NOT_IMPLEMENTED），然后发送消息，不能用来获取历史记录或事务事件。</p>
<h3 id="5.18.-unlock-connector" tabindex="-1" id="5-18-Unlock-Connector">5.18. Unlock Connector</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    C->>S: UnlockConnector.req(connectorId)
    S-->>C: UnlockConnector.conf(status)</pre>
<p>中央系统发送 <code>UnlockConnector.req</code> 给充电点。</p>
<p>充电点接收到请求后：</p>
<ul>
<li>如果该接口正在进行充电事务，<strong>先完成事务（Stop Transaction 流程）</strong>。</li>
<li>尝试解锁接口。</li>
</ul>
<p>充电点回复 <code>UnlockConnector.conf</code>，指示是否成功解锁。</p>
<h3 id="5.19.-update-firmware" tabindex="-1" id="5-19-Update-Firmware">5.19. Update Firmware</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Charge Point
    participant S as Central System

    C->>S: UpdateFirmware.req(location, retrieveDate, [retries], [retryInterval])
    S-->>C: UpdateFirmware.conf()</pre>
<p>中央系统发送 <code>UnlockConnector.req</code> 给充电点。</p>
<p>充电点接收到请求后：</p>
<ul>
<li>如果该接口正在进行充电事务，<strong>先完成事务（Stop Transaction 流程）</strong>。</li>
<li>尝试解锁接口。</li>
</ul>
<p>充电点回复 <code>UnlockConnector.conf</code>，指示是否成功解锁。</p>

            </article>
            
	<div class="rightside">
	
		<div class="rightside-button" id="js-aside">
			<span>
				<img no-lazy src="/images/icon/aside.png" class="rightside-button-icon" alt="Icon">
			</span>
		</div>
		<script>
			$("#js-aside").click(function () {
				onShowAsideButton();
			});
		</script>
	
	<div class="rightside-button" id="js-toggle_theme">
		<span>
			<img no-lazy src="/images/icon/toggle_theme.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	
<script src="/js/plugins/goto_position.js"></script>

	
	<div class="rightside-button" id="js-go_top">
		<span>
			<img no-lazy src="/images/icon/go_top.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>
	<div class="rightside-button" id="js-go_bottom">
		<span>
			<img no-lazy src="/images/icon/go_bottom.png" class="rightside-button-icon" alt="Icon">
		</span>
	</div>

	<script>
		setToggleThemeButtonListener();
	</script>
	<script>
		$('#js-go_top')
		.gotoPosition( {
			speed: 300,
			target: 'top',
		} );
		$('#js-go_bottom')
		.gotoPosition( {
			speed: 300,
			target: 'bottom',
		} );
	</script>
</div>


<div class="post-bottom">
    
        <div class="post-paging">     
            <div class="post-paging-last">
                
                    <a href="/posts/Software-PS%20%E6%8A%A0%E5%9B%BE%E7%9A%84%2016%20%E7%A7%8D%E6%96%B9%E5%BC%8F/">
                        上一篇：Software-PS 抠图的 16 种方式
                    </a>
                
            </div>
            <div class="post-paging-next">
                
                    <a href="/posts/Diary-%E6%AF%95%E4%B8%9A%E6%9C%80%E5%90%8E%E7%96%AF%E7%8B%82%E4%B9%8B%E5%8D%97%E4%BA%AC%E5%8D%97%E4%BA%AC%EF%BC%81%EF%BC%88%E6%80%BB%E7%BB%9F%E5%BA%9C%20&%20%E5%85%AD%E6%9C%9D%E5%8D%9A%E7%89%A9%E9%A6%86%E7%AF%87%EF%BC%89/">
                        下一篇：Diary-毕业最后疯狂之南京南京！（总统府 & 六朝博物馆篇）
                    </a>
                
            </div>
        </div>
    
    
    
        
            <div class="giscus comments"></div>
            <script>
                var scriptElement = document.createElement('script');
                scriptElement.src = 'https://giscus.app/client.js';
                scriptElement.setAttribute('data-repo', 'GZ-Metal-Cell/GZ-Metal-Cell.github.io');
                scriptElement.setAttribute('data-repo-id', 'R_kgDOIHLEOQ');
                scriptElement.setAttribute('data-category', 'Announcements');
                scriptElement.setAttribute('data-category-id', 'DIC_kwDOIHLEOc4CcVwP');
                scriptElement.setAttribute('data-mapping', 'title');
                scriptElement.setAttribute('data-strict', '1');
                scriptElement.setAttribute('data-reactions-enabled', '');
                scriptElement.setAttribute('data-emit-metadata', '0');
                scriptElement.setAttribute('data-input-position', 'bottom');
                scriptElement.setAttribute('data-theme', localStorage.getItem('theme') === 'light' ? 'light' : 'dark_high_contrast');
                scriptElement.setAttribute('data-lang', 'zh-CN');
                
                scriptElement.setAttribute('crossorigin', 'anonymous');
                scriptElement.async = true;
                document.head.appendChild(scriptElement);
            </script>
        
    
</div>
        </div>
    </main>
    
        <aside class="main-aside">
    
<script src="/js/widgets/aside.js"></script>

    <script>
        showAside();
    </script>

    <div class="aside-top">
        <div class="aside-top-about aside-card">
            <a href="/about" class="aside-top-about-portrait">
                <img no-lazy src="/about/portrait.png" alt="Q">
            </a>
            <div class="aside-top-about-info">
                <span class="author"> Zi-Zi</span>
                <span class="description">不以物喜，不以己悲。</span>
            </div>              
            <div class="aside-top-about-site">
                <a href="/categories" class="aside-top-about-site-item">
                    <span class="title">类别</span>
                    <span class="count">5</span>
                </a>
                <a href="/tags" class="aside-top-about-site-item">
                    <span class="title">标签</span>
                    <span class="count">121</span>
                </a>
                <a href="/archives" class="aside-top-about-site-item">
                    <span class="title">归档</span>
                    <span class="count">436</span>
                </a>
            </div>
            <div class="aside-top-about-contact">
                
                    
                        <a target="_blank" rel="noopener" href="https://weibo.com/u/5020307235">
                            <img no-lazy src="/images/bottom_icon/Weibo.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://tieba.baidu.com/home/main?id=tb.1.ff6d2775.vFH7wrdW2ZjPCmyBHJcjnA">
                            <img no-lazy src="/images/bottom_icon/Tieba.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://space.bilibili.com/11547880">
                            <img no-lazy src="/images/bottom_icon/Bilibili.webp" alt="Quieter">
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell">
                            <img no-lazy src="/images/bottom_icon/github.webp" alt="Quieter">
                        </a>
                    
                
            </div>
        </div> 

        
    </div>

    <div class="aside-bottom">
        
            <script>
                
                    const tocCollapsed = true;
                
                
                    const tocDepth = 6;
                
                var headerString = '';
                for (let i = 1; i <= tocDepth; i++) {
                    if (i === 1) {
                        headerString += 'h1';
                    } else {
                        headerString += ', h' + i;
                    }
                }
                hbeToc();
            </script>
            <div class="aside-bottom-toc aside-card">
                <div class="aside-bottom-toc-title">
                    <h1>目录</h1>
                    <span class="toc-percentage"></span>
                </div>
                <ol class="aside-bottom-toc-content"></ol>
            </div>
        
    </div>
</aside>
    
</div>
		<footer>
	<div class="content">
		
			<span>©2022-2025&nbsp;By&nbsp;<a href="/about">Zi-Zi</a>.</span>
		
		<span><a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> theme by <a target="_blank" rel="noopener" href="https://github.com/GZ-Metal-Cell/hexo-theme-quieter">Quieter</a>.</span>
		
			<span style="display: flex;">
				<img no-lazy alt="icp" src="/images/icp_icon.png" style="width: 16px; height: 16px;">
				<a href="https://icp.gov.moe/?keyword=20241647" target="_blank">萌 ICP 备 20241647 号</a>
			</span>
		
	</div>

	
<script src="/js/plugins/ref.js"></script>

	
<script src="/js/plugins/highlight_tools.js"></script>

	<script>
		const  COPY_ICON = "/images/icon/copy.png";
		const CLOSE_CODE_BLOCK_ICON = "/images/icon/close_code_block.png";
		const HIGHLIGHT_SHRINK = "";
		const HIGHLIGHT_HEIGHT_LIMIT = "";
	</script>

	
	
	<!-- Analytics -->

    
        <!-- Busuanzi Analytics -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?e57cf62289f84322ebff116e8b3d343e";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    


	

	

    
		
<link rel="stylesheet" href="/css/plugins/textIndent.css">

		
<script src="/js/plugins/textIndent.js"></script>

	

	
	
	
		<script>
			if (typeof init === 'function') {
				init();
			}
		</script>
	

	
		
	

	

	<!--
		
<script src="/js/plugins/jquery.pjax.min.js"></script>

		<script>
			$(document).pjax('a[target!=_blank]', 'main', {
				fragment: 'main',
				timeout: 8000
			});

			$(document).on('pjax:complete', function() {
			});
		</script> 
	-->
	<script>
		console.log('\n %c Hexo-Quieter 主题 %c https://github.com/GZ-Metal-Cell/hexo-theme-quieter \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
	</script>
</footer>
	</body>

	<!-- Hexo-Quieter 主题  https://github.com/GZ-Metal-Cell/hexo-theme-quieter -->
</html>

